/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is a compiled version of Dojo, built for deployment and not for
	development. To get an editable version, please visit:

		http://dojotoolkit.org

	for documentation and information on getting the source.
*/

(function(){var _1=[["dojo","bespindojo"],["dijit","bespindijit"]];if((_1||(typeof djConfig!="undefined"&&djConfig.scopeMap))&&(typeof window!="undefined")){var _2="",_3="",_4="",_5={},_6={};_1=_1||djConfig.scopeMap;for(var i=0;i<_1.length;i++){var _8=_1[i];_2+="var "+_8[0]+" = {}; "+_8[1]+" = "+_8[0]+";"+_8[1]+"._scopeName = '"+_8[1]+"';";_3+=(i==0?"":",")+_8[0];_4+=(i==0?"":",")+_8[1];_5[_8[0]]=_8[1];_6[_8[1]]=_8[0];}eval(_2+"dojo._scopeArgs = ["+_4+"];");dojo._scopePrefixArgs=_3;dojo._scopePrefix="(function("+_3+"){";dojo._scopeSuffix="})("+_4+")";dojo._scopeMap=_5;dojo._scopeMapRev=_6;}(function(){if(typeof this["loadFirebugConsole"]=="function"){this["loadFirebugConsole"]();}else{this.console=this.console||{};var cn=["assert","count","debug","dir","dirxml","error","group","groupEnd","info","profile","profileEnd","time","timeEnd","trace","warn","log"];var i=0,tn;while((tn=cn[i++])){if(!console[tn]){(function(){var _c=tn+"";console[_c]=("log" in console)?function(){var a=Array.apply({},arguments);a.unshift(_c+":");console["log"](a.join(" "));}:function(){};})();}}}if(typeof dojo=="undefined"){this.dojo={_scopeName:"dojo",_scopePrefix:"",_scopePrefixArgs:"",_scopeSuffix:"",_scopeMap:{},_scopeMapRev:{}};}var d=dojo;if(typeof dijit=="undefined"){this.dijit={_scopeName:"dijit"};}if(typeof dojox=="undefined"){this.dojox={_scopeName:"dojox"};}if(!d._scopeArgs){d._scopeArgs=[dojo,dijit,dojox];}d.global=this;d.config={isDebug:false,debugAtAllCosts:false};if(typeof djConfig!="undefined"){for(var _f in djConfig){d.config[_f]=djConfig[_f];}}dojo.locale=d.config.locale;var rev="$Rev: 17136 $".match(/\d+/);dojo.version={major:0,minor:4,patch:4,flag:"",revision:rev?+rev[0]:NaN,toString:function(){with(d.version){return major+"."+minor+"."+patch+flag+" ("+revision+")";}}};if(typeof OpenAjax!="undefined"){OpenAjax.hub.registerLibrary(dojo._scopeName,"http://dojotoolkit.org",d.version.toString());}var _11={};dojo._mixin=function(obj,_13){for(var x in _13){if(_11[x]===undefined||_11[x]!=_13[x]){obj[x]=_13[x];}}if(d.isIE&&_13){var p=_13.toString;if(typeof p=="function"&&p!=obj.toString&&p!=_11.toString&&p!="\nfunction toString() {\n    [native code]\n}\n"){obj.toString=_13.toString;}}return obj;};dojo.mixin=function(obj,_17){if(!obj){obj={};}for(var i=1,l=arguments.length;i<l;i++){d._mixin(obj,arguments[i]);}return obj;};dojo._getProp=function(_1a,_1b,_1c){var obj=_1c||d.global;for(var i=0,p;obj&&(p=_1a[i]);i++){if(i==0&&this._scopeMap[p]){p=this._scopeMap[p];}obj=(p in obj?obj[p]:(_1b?obj[p]={}:undefined));}return obj;};dojo.setObject=function(_20,_21,_22){var _23=_20.split("."),p=_23.pop(),obj=d._getProp(_23,true,_22);return obj&&p?(obj[p]=_21):undefined;};dojo.getObject=function(_26,_27,_28){return d._getProp(_26.split("."),_27,_28);};dojo.exists=function(_29,obj){return !!d.getObject(_29,false,obj);};dojo["eval"]=function(_2b){return d.global.eval?d.global.eval(_2b):eval(_2b);};d.deprecated=d.experimental=function(){};})();(function(){var d=dojo;d.mixin(d,{_loadedModules:{},_inFlightCount:0,_hasResource:{},_modulePrefixes:{dojo:{name:"dojo",value:"."},doh:{name:"doh",value:"../util/doh"},tests:{name:"tests",value:"tests"}},_moduleHasPrefix:function(_2d){var mp=this._modulePrefixes;return !!(mp[_2d]&&mp[_2d].value);},_getModulePrefix:function(_2f){var mp=this._modulePrefixes;if(this._moduleHasPrefix(_2f)){return mp[_2f].value;}return _2f;},_loadedUrls:[],_postLoad:false,_loaders:[],_unloaders:[],_loadNotifying:false});dojo._loadPath=function(_31,_32,cb){var uri=((_31.charAt(0)=="/"||_31.match(/^\w+:/))?"":this.baseUrl)+_31;try{return !_32?this._loadUri(uri,cb):this._loadUriAndCheck(uri,_32,cb);}catch(e){console.error(e);return false;}};dojo._loadUri=function(uri,cb){if(this._loadedUrls[uri]){return true;}var _37=this._getText(uri,true);if(!_37){return false;}this._loadedUrls[uri]=true;this._loadedUrls.push(uri);if(cb){_37="("+_37+")";}else{_37=this._scopePrefix+_37+this._scopeSuffix;}if(d.isMoz){_37+="\r\n//@ sourceURL="+uri;}var _38=d["eval"](_37);if(cb){cb(_38);}return true;};dojo._loadUriAndCheck=function(uri,_3a,cb){var ok=false;try{ok=this._loadUri(uri,cb);}catch(e){console.error("failed loading "+uri+" with error: "+e);}return !!(ok&&this._loadedModules[_3a]);};dojo.loaded=function(){this._loadNotifying=true;this._postLoad=true;var mll=d._loaders;this._loaders=[];for(var x=0;x<mll.length;x++){mll[x]();}this._loadNotifying=false;if(d._postLoad&&d._inFlightCount==0&&mll.length){d._callLoaded();}};dojo.unloaded=function(){var mll=d._unloaders;while(mll.length){(mll.pop())();}};d._onto=function(arr,obj,fn){if(!fn){arr.push(obj);}else{if(fn){var _43=(typeof fn=="string")?obj[fn]:fn;arr.push(function(){_43.call(obj);});}}};dojo.addOnLoad=function(obj,_45){d._onto(d._loaders,obj,_45);if(d._postLoad&&d._inFlightCount==0&&!d._loadNotifying){d._callLoaded();}};var dca=d.config.addOnLoad;if(dca){d.addOnLoad[(dca instanceof Array?"apply":"call")](d,dca);}dojo._modulesLoaded=function(){if(d._postLoad){return;}if(d._inFlightCount>0){console.warn("files still in flight!");return;}d._callLoaded();};dojo._callLoaded=function(){if(typeof setTimeout=="object"||(dojo.config.useXDomain&&d.isOpera)){if(dojo.isAIR){setTimeout(function(){dojo.loaded();},0);}else{setTimeout(dojo._scopeName+".loaded();",0);}}else{d.loaded();}};dojo._getModuleSymbols=function(_47){var _48=_47.split(".");for(var i=_48.length;i>0;i--){var _4a=_48.slice(0,i).join(".");if((i==1)&&!this._moduleHasPrefix(_4a)){_48[0]="../"+_48[0];}else{var _4b=this._getModulePrefix(_4a);if(_4b!=_4a){_48.splice(0,i,_4b);break;}}}return _48;};dojo._global_omit_module_check=false;dojo.loadInit=function(_4c){_4c();};dojo._loadModule=dojo.require=function(_4d,_4e){_4e=this._global_omit_module_check||_4e;var _4f=this._loadedModules[_4d];if(_4f){return _4f;}var _50=this._getModuleSymbols(_4d).join("/")+".js";var _51=(!_4e)?_4d:null;var ok=this._loadPath(_50,_51);if(!ok&&!_4e){throw new Error("Could not load '"+_4d+"'; last tried '"+_50+"'");}if(!_4e&&!this._isXDomain){_4f=this._loadedModules[_4d];if(!_4f){throw new Error("symbol '"+_4d+"' is not defined after loading '"+_50+"'");}}return _4f;};dojo.provide=function(_53){_53=_53+"";return (d._loadedModules[_53]=d.getObject(_53,true));};dojo.platformRequire=function(_54){var _55=_54.common||[];var _56=_55.concat(_54[d._name]||_54["default"]||[]);for(var x=0;x<_56.length;x++){var _58=_56[x];if(_58.constructor==Array){d._loadModule.apply(d,_58);}else{d._loadModule(_58);}}};dojo.requireIf=function(_59,_5a){if(_59===true){var _5b=[];for(var i=1;i<arguments.length;i++){_5b.push(arguments[i]);}d.require.apply(d,_5b);}};dojo.requireAfterIf=d.requireIf;dojo.registerModulePath=function(_5d,_5e){d._modulePrefixes[_5d]={name:_5d,value:_5e};};dojo.requireLocalization=function(_5f,_60,_61,_62){d.require("dojo.i18n");d.i18n._requireLocalization.apply(d.hostenv,arguments);};var ore=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$");var ire=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");dojo._Url=function(){var n=null;var _a=arguments;var uri=[_a[0]];for(var i=1;i<_a.length;i++){if(!_a[i]){continue;}var _69=new d._Url(_a[i]+"");var _6a=new d._Url(uri[0]+"");if(_69.path==""&&!_69.scheme&&!_69.authority&&!_69.query){if(_69.fragment!=n){_6a.fragment=_69.fragment;}_69=_6a;}else{if(!_69.scheme){_69.scheme=_6a.scheme;if(!_69.authority){_69.authority=_6a.authority;if(_69.path.charAt(0)!="/"){var _6b=_6a.path.substring(0,_6a.path.lastIndexOf("/")+1)+_69.path;var _6c=_6b.split("/");for(var j=0;j<_6c.length;j++){if(_6c[j]=="."){if(j==_6c.length-1){_6c[j]="";}else{_6c.splice(j,1);j--;}}else{if(j>0&&!(j==1&&_6c[0]=="")&&_6c[j]==".."&&_6c[j-1]!=".."){if(j==(_6c.length-1)){_6c.splice(j,1);_6c[j-1]="";}else{_6c.splice(j-1,2);j-=2;}}}}_69.path=_6c.join("/");}}}}uri=[];if(_69.scheme){uri.push(_69.scheme,":");}if(_69.authority){uri.push("//",_69.authority);}uri.push(_69.path);if(_69.query){uri.push("?",_69.query);}if(_69.fragment){uri.push("#",_69.fragment);}}this.uri=uri.join("");var r=this.uri.match(ore);this.scheme=r[2]||(r[1]?"":n);this.authority=r[4]||(r[3]?"":n);this.path=r[5];this.query=r[7]||(r[6]?"":n);this.fragment=r[9]||(r[8]?"":n);if(this.authority!=n){r=this.authority.match(ire);this.user=r[3]||n;this.password=r[4]||n;this.host=r[6]||r[7];this.port=r[9]||n;}};dojo._Url.prototype.toString=function(){return this.uri;};dojo.moduleUrl=function(_6f,url){var loc=d._getModuleSymbols(_6f).join("/");if(!loc){return null;}if(loc.lastIndexOf("/")!=loc.length-1){loc+="/";}var _72=loc.indexOf(":");if(loc.charAt(0)!="/"&&(_72==-1||_72>loc.indexOf("/"))){loc=d.baseUrl+loc;}return new d._Url(loc,url);};})();if(typeof window!="undefined"){dojo.isBrowser=true;dojo._name="browser";(function(){var d=dojo;if(document&&document.getElementsByTagName){var _74=document.getElementsByTagName("script");var _75=/dojo(\.xd)?\.js(\W|$)/i;for(var i=0;i<_74.length;i++){var src=_74[i].getAttribute("src");if(!src){continue;}var m=src.match(_75);if(m){if(!d.config.baseUrl){d.config.baseUrl=src.substring(0,m.index);}var cfg=_74[i].getAttribute("djConfig");if(cfg){var _7a=eval("({ "+cfg+" })");for(var x in _7a){dojo.config[x]=_7a[x];}}break;}}}d.baseUrl=d.config.baseUrl;var n=navigator;var dua=n.userAgent,dav=n.appVersion,tv=parseFloat(dav);if(dua.indexOf("Opera")>=0){d.isOpera=tv;}if(dua.indexOf("AdobeAIR")>=0){d.isAIR=1;}d.isKhtml=(dav.indexOf("Konqueror")>=0)?tv:0;d.isWebKit=parseFloat(dua.split("WebKit/")[1])||undefined;d.isChrome=parseFloat(dua.split("Chrome/")[1])||undefined;var _80=Math.max(dav.indexOf("WebKit"),dav.indexOf("Safari"),0);if(_80&&!dojo.isChrome){d.isSafari=parseFloat(dav.split("Version/")[1]);if(!d.isSafari||parseFloat(dav.substr(_80+7))<=419.3){d.isSafari=2;}}if(dua.indexOf("Gecko")>=0&&!d.isKhtml&&!d.isWebKit){d.isMozilla=d.isMoz=tv;}if(d.isMoz){d.isFF=parseFloat(dua.split("Firefox/")[1]||dua.split("Minefield/")[1]||dua.split("Shiretoko/")[1])||undefined;}if(document.all&&!d.isOpera){d.isIE=parseFloat(dav.split("MSIE ")[1])||undefined;if(d.isIE>=8&&document.documentMode!=5){d.isIE=document.documentMode;}}if(dojo.isIE&&window.location.protocol==="file:"){dojo.config.ieForceActiveXXhr=true;}var cm=document.compatMode;d.isQuirks=cm=="BackCompat"||cm=="QuirksMode"||d.isIE<6;d.locale=dojo.config.locale||(d.isIE?n.userLanguage:n.language).toLowerCase();d._XMLHTTP_PROGIDS=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];d._xhrObj=function(){var _82,_83;if(!dojo.isIE||!dojo.config.ieForceActiveXXhr){try{_82=new XMLHttpRequest();}catch(e){}}if(!_82){for(var i=0;i<3;++i){var _85=d._XMLHTTP_PROGIDS[i];try{_82=new ActiveXObject(_85);}catch(e){_83=e;}if(_82){d._XMLHTTP_PROGIDS=[_85];break;}}}if(!_82){throw new Error("XMLHTTP not available: "+_83);}return _82;};d._isDocumentOk=function(_86){var _87=_86.status||0;return (_87>=200&&_87<300)||_87==304||_87==1223||(!_87&&(location.protocol=="file:"||location.protocol=="chrome:"));};var _88=window.location+"";var _89=document.getElementsByTagName("base");var _8a=(_89&&_89.length>0);d._getText=function(uri,_8c){var _8d=this._xhrObj();if(!_8a&&dojo._Url){uri=(new dojo._Url(_88,uri)).toString();}if(d.config.cacheBust){uri+="";uri+=(uri.indexOf("?")==-1?"?":"&")+String(d.config.cacheBust).replace(/\W+/g,"");}_8d.open("GET",uri,false);try{_8d.send(null);if(!d._isDocumentOk(_8d)){var err=Error("Unable to load "+uri+" status:"+_8d.status);err.status=_8d.status;err.responseText=_8d.responseText;throw err;}}catch(e){if(_8c){return null;}throw e;}return _8d.responseText;};var _w=window;var _90=function(_91,fp){var _93=_w[_91]||function(){};_w[_91]=function(){fp.apply(_w,arguments);_93.apply(_w,arguments);};};d._windowUnloaders=[];d.windowUnloaded=function(){var mll=d._windowUnloaders;while(mll.length){(mll.pop())();}};var _95=0;d.addOnWindowUnload=function(obj,_97){d._onto(d._windowUnloaders,obj,_97);if(!_95){_95=1;_90("onunload",d.windowUnloaded);}};var _98=0;d.addOnUnload=function(obj,_9a){d._onto(d._unloaders,obj,_9a);if(!_98){_98=1;_90("onbeforeunload",dojo.unloaded);}};})();dojo._initFired=false;dojo._loadInit=function(e){dojo._initFired=true;var _9c=e&&e.type?e.type.toLowerCase():"load";if(arguments.callee.initialized||(_9c!="domcontentloaded"&&_9c!="load")){return;}arguments.callee.initialized=true;if("_khtmlTimer" in dojo){clearInterval(dojo._khtmlTimer);delete dojo._khtmlTimer;}if(dojo._inFlightCount==0){dojo._modulesLoaded();}};if(!dojo.config.afterOnLoad){if(document.addEventListener){if(dojo.isWebKit>525||dojo.isOpera||dojo.isFF>=3||(dojo.isMoz&&dojo.config.enableMozDomContentLoaded===true)){document.addEventListener("DOMContentLoaded",dojo._loadInit,null);}window.addEventListener("load",dojo._loadInit,null);}if(dojo.isAIR){window.addEventListener("load",dojo._loadInit,null);}else{if((dojo.isWebKit<525)||dojo.isKhtml){dojo._khtmlTimer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){dojo._loadInit();}},10);}}}if(dojo.isIE){if(!dojo.config.afterOnLoad){document.write("<scr"+"ipt defer src=\"//:\" "+"onreadystatechange=\"if(this.readyState=='complete'){"+dojo._scopeName+"._loadInit();}\">"+"</scr"+"ipt>");}try{document.namespaces.add("v","urn:schemas-microsoft-com:vml");document.createStyleSheet().addRule("v\\:*","behavior:url(#default#VML);  display:inline-block");}catch(e){}}}(function(){var mp=dojo.config["modulePaths"];if(mp){for(var _9e in mp){dojo.registerModulePath(_9e,mp[_9e]);}}})();if(dojo.config.isDebug){dojo.require("dojo._firebug.firebug");}if(dojo.config.debugAtAllCosts){dojo.config.useXDomain=true;dojo.require("dojo._base._loader.loader_xd");dojo.require("dojo._base._loader.loader_debug");dojo.require("dojo.i18n");}if(!dojo._hasResource["dojo._base.lang"]){dojo._hasResource["dojo._base.lang"]=true;dojo.provide("dojo._base.lang");dojo.isString=function(it){return !!arguments.length&&it!=null&&(typeof it=="string"||it instanceof String);};dojo.isArray=function(it){return it&&(it instanceof Array||typeof it=="array");};dojo.isFunction=(function(){var _a1=function(it){var t=typeof it;return it&&(t=="function"||it instanceof Function);};return dojo.isSafari?function(it){if(typeof it=="function"&&it=="[object NodeList]"){return false;}return _a1(it);}:_a1;})();dojo.isObject=function(it){return it!==undefined&&(it===null||typeof it=="object"||dojo.isArray(it)||dojo.isFunction(it));};dojo.isArrayLike=function(it){var d=dojo;return it&&it!==undefined&&!d.isString(it)&&!d.isFunction(it)&&!(it.tagName&&it.tagName.toLowerCase()=="form")&&(d.isArray(it)||isFinite(it.length));};dojo.isAlien=function(it){return it&&!dojo.isFunction(it)&&/\{\s*\[native code\]\s*\}/.test(String(it));};dojo.extend=function(_a9,_aa){for(var i=1,l=arguments.length;i<l;i++){dojo._mixin(_a9.prototype,arguments[i]);}return _a9;};dojo._hitchArgs=function(_ad,_ae){var pre=dojo._toArray(arguments,2);var _b0=dojo.isString(_ae);return function(){var _b1=dojo._toArray(arguments);var f=_b0?(_ad||dojo.global)[_ae]:_ae;return f&&f.apply(_ad||this,pre.concat(_b1));};};dojo.hitch=function(_b3,_b4){if(arguments.length>2){return dojo._hitchArgs.apply(dojo,arguments);}if(!_b4){_b4=_b3;_b3=null;}if(dojo.isString(_b4)){_b3=_b3||dojo.global;if(!_b3[_b4]){throw (["dojo.hitch: scope[\"",_b4,"\"] is null (scope=\"",_b3,"\")"].join(""));}return function(){return _b3[_b4].apply(_b3,arguments||[]);};}return !_b3?_b4:function(){return _b4.apply(_b3,arguments||[]);};};dojo.delegate=dojo._delegate=(function(){function TMP(){};return function(obj,_b7){TMP.prototype=obj;var tmp=new TMP();if(_b7){dojo._mixin(tmp,_b7);}return tmp;};})();(function(){var _b9=function(obj,_bb,_bc){return (_bc||[]).concat(Array.prototype.slice.call(obj,_bb||0));};var _bd=function(obj,_bf,_c0){var arr=_c0||[];for(var x=_bf||0;x<obj.length;x++){arr.push(obj[x]);}return arr;};dojo._toArray=dojo.isIE?function(obj){return ((obj.item)?_bd:_b9).apply(this,arguments);}:_b9;})();dojo.partial=function(_c4){var arr=[null];return dojo.hitch.apply(dojo,arr.concat(dojo._toArray(arguments)));};dojo.clone=function(o){if(!o){return o;}if(dojo.isArray(o)){var r=[];for(var i=0;i<o.length;++i){r.push(dojo.clone(o[i]));}return r;}if(!dojo.isObject(o)){return o;}if(o.nodeType&&o.cloneNode){return o.cloneNode(true);}if(o instanceof Date){return new Date(o.getTime());}r=new o.constructor();for(i in o){if(!(i in r)||r[i]!=o[i]){r[i]=dojo.clone(o[i]);}}return r;};dojo.trim=String.prototype.trim?function(str){return str.trim();}:function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"");};}if(!dojo._hasResource["dojo._base.declare"]){dojo._hasResource["dojo._base.declare"]=true;dojo.provide("dojo._base.declare");dojo.declare=function(_cb,_cc,_cd){var dd=arguments.callee,_cf;if(dojo.isArray(_cc)){_cf=_cc;_cc=_cf.shift();}if(_cf){dojo.forEach(_cf,function(m,i){if(!m){throw (_cb+": mixin #"+i+" is null");}_cc=dd._delegate(_cc,m);});}var _d2=dd._delegate(_cc);_cd=_cd||{};_d2.extend(_cd);dojo.extend(_d2,{declaredClass:_cb,_constructor:_cd.constructor});_d2.prototype.constructor=_d2;return dojo.setObject(_cb,_d2);};dojo.mixin(dojo.declare,{_delegate:function(_d3,_d4){var bp=(_d3||0).prototype,mp=(_d4||0).prototype,dd=dojo.declare;var _d8=dd._makeCtor();dojo.mixin(_d8,{superclass:bp,mixin:mp,extend:dd._extend});if(_d3){_d8.prototype=dojo._delegate(bp);}dojo.extend(_d8,dd._core,mp||0,{_constructor:null,preamble:null});_d8.prototype.constructor=_d8;_d8.prototype.declaredClass=(bp||0).declaredClass+"_"+(mp||0).declaredClass;return _d8;},_extend:function(_d9){var i,fn;for(i in _d9){if(dojo.isFunction(fn=_d9[i])&&!0[i]){fn.nom=i;fn.ctor=this;}}dojo.extend(this,_d9);},_makeCtor:function(){return function(){this._construct(arguments);};},_core:{_construct:function(_dc){var c=_dc.callee,s=c.superclass,ct=s&&s.constructor,m=c.mixin,mct=m&&m.constructor,a=_dc,ii,fn;if(a[0]){if(((fn=a[0].preamble))){a=fn.apply(this,a)||a;}}if((fn=c.prototype.preamble)){a=fn.apply(this,a)||a;}if(ct&&ct.apply){ct.apply(this,a);}if(mct&&mct.apply){mct.apply(this,a);}if((ii=c.prototype._constructor)){ii.apply(this,_dc);}if(this.constructor.prototype==c.prototype&&(ct=this.postscript)){ct.apply(this,_dc);}},_findMixin:function(_e5){var c=this.constructor,p,m;while(c){p=c.superclass;m=c.mixin;if(m==_e5||(m instanceof _e5.constructor)){return p;}if(m&&m._findMixin&&(m=m._findMixin(_e5))){return m;}c=p&&p.constructor;}},_findMethod:function(_e9,_ea,_eb,has){var p=_eb,c,m,f;do{c=p.constructor;m=c.mixin;if(m&&(m=this._findMethod(_e9,_ea,m,has))){return m;}if((f=p[_e9])&&(has==(f==_ea))){return p;}p=c.superclass;}while(p);return !has&&(p=this._findMixin(_eb))&&this._findMethod(_e9,_ea,p,has);},inherited:function(_f1,_f2,_f3){var a=arguments;if(!dojo.isString(a[0])){_f3=_f2;_f2=_f1;_f1=_f2.callee.nom;}a=_f3||_f2;var c=_f2.callee,p=this.constructor.prototype,fn,mp;if(this[_f1]!=c||p[_f1]==c){mp=(c.ctor||0).superclass||this._findMethod(_f1,c,p,true);if(!mp){throw (this.declaredClass+": inherited method \""+_f1+"\" mismatch");}p=this._findMethod(_f1,c,mp,false);}fn=p&&p[_f1];if(!fn){throw (mp.declaredClass+": inherited method \""+_f1+"\" not found");}return fn.apply(this,a);}}});}if(!dojo._hasResource["dojo._base.connect"]){dojo._hasResource["dojo._base.connect"]=true;dojo.provide("dojo._base.connect");dojo._listener={getDispatcher:function(){return function(){var ap=Array.prototype,c=arguments.callee,ls=c._listeners,t=c.target;var r=t&&t.apply(this,arguments);var lls;lls=[].concat(ls);for(var i in lls){if(!(i in ap)){lls[i].apply(this,arguments);}}return r;};},add:function(_100,_101,_102){_100=_100||dojo.global;var f=_100[_101];if(!f||!f._listeners){var d=dojo._listener.getDispatcher();d.target=f;d._listeners=[];f=_100[_101]=d;}return f._listeners.push(_102);},remove:function(_105,_106,_107){var f=(_105||dojo.global)[_106];if(f&&f._listeners&&_107--){delete f._listeners[_107];}}};dojo.connect=function(obj,_10a,_10b,_10c,_10d){var a=arguments,args=[],i=0;args.push(dojo.isString(a[0])?null:a[i++],a[i++]);var a1=a[i+1];args.push(dojo.isString(a1)||dojo.isFunction(a1)?a[i++]:null,a[i++]);for(var l=a.length;i<l;i++){args.push(a[i]);}return dojo._connect.apply(this,args);};dojo._connect=function(obj,_113,_114,_115){var l=dojo._listener,h=l.add(obj,_113,dojo.hitch(_114,_115));return [obj,_113,h,l];};dojo.disconnect=function(_118){if(_118&&_118[0]!==undefined){dojo._disconnect.apply(this,_118);delete _118[0];}};dojo._disconnect=function(obj,_11a,_11b,_11c){_11c.remove(obj,_11a,_11b);};dojo._topics={};dojo.subscribe=function(_11d,_11e,_11f){return [_11d,dojo._listener.add(dojo._topics,_11d,dojo.hitch(_11e,_11f))];};dojo.unsubscribe=function(_120){if(_120){dojo._listener.remove(dojo._topics,_120[0],_120[1]);}};dojo.publish=function(_121,args){var f=dojo._topics[_121];if(f){f.apply(this,args||[]);}};dojo.connectPublisher=function(_124,obj,_126){var pf=function(){dojo.publish(_124,arguments);};return (_126)?dojo.connect(obj,_126,pf):dojo.connect(obj,pf);};}if(!dojo._hasResource["dojo._base.Deferred"]){dojo._hasResource["dojo._base.Deferred"]=true;dojo.provide("dojo._base.Deferred");dojo.Deferred=function(_128){this.chain=[];this.id=this._nextId();this.fired=-1;this.paused=0;this.results=[null,null];this.canceller=_128;this.silentlyCancelled=false;};dojo.extend(dojo.Deferred,{_nextId:(function(){var n=1;return function(){return n++;};})(),cancel:function(){var err;if(this.fired==-1){if(this.canceller){err=this.canceller(this);}else{this.silentlyCancelled=true;}if(this.fired==-1){if(!(err instanceof Error)){var res=err;var msg="Deferred Cancelled";if(err&&err.toString){msg+=": "+err.toString();}err=new Error(msg);err.dojoType="cancel";err.cancelResult=res;}this.errback(err);}}else{if((this.fired==0)&&(this.results[0] instanceof dojo.Deferred)){this.results[0].cancel();}}},_resback:function(res){this.fired=((res instanceof Error)?1:0);this.results[this.fired]=res;this._fire();},_check:function(){if(this.fired!=-1){if(!this.silentlyCancelled){throw new Error("already called!");}this.silentlyCancelled=false;return;}},callback:function(res){this._check();this._resback(res);},errback:function(res){this._check();if(!(res instanceof Error)){res=new Error(res);}this._resback(res);},addBoth:function(cb,cbfn){var _132=dojo.hitch.apply(dojo,arguments);return this.addCallbacks(_132,_132);},addCallback:function(cb,cbfn){return this.addCallbacks(dojo.hitch.apply(dojo,arguments));},addErrback:function(cb,cbfn){return this.addCallbacks(null,dojo.hitch.apply(dojo,arguments));},addCallbacks:function(cb,eb){this.chain.push([cb,eb]);if(this.fired>=0){this._fire();}return this;},_fire:function(){var _139=this.chain;var _13a=this.fired;var res=this.results[_13a];var self=this;var cb=null;while((_139.length>0)&&(this.paused==0)){var f=_139.shift()[_13a];if(!f){continue;}var func=function(){var ret=f(res);if(typeof ret!="undefined"){res=ret;}_13a=((res instanceof Error)?1:0);if(res instanceof dojo.Deferred){cb=function(res){self._resback(res);self.paused--;if((self.paused==0)&&(self.fired>=0)){self._fire();}};this.paused++;}};if(dojo.config.debugAtAllCosts){func.call(this);}else{try{func.call(this);}catch(err){_13a=1;res=err;}}}this.fired=_13a;this.results[_13a]=res;if((cb)&&(this.paused)){res.addBoth(cb);}}});}if(!dojo._hasResource["dojo._base.json"]){dojo._hasResource["dojo._base.json"]=true;dojo.provide("dojo._base.json");dojo.fromJson=function(json){return eval("("+json+")");};dojo._escapeString=function(str){return ("\""+str.replace(/(["\\])/g,"\\$1")+"\"").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r");};dojo.toJsonIndentStr="\t";dojo.toJson=function(it,_145,_146){if(it===undefined){return "undefined";}var _147=typeof it;if(_147=="number"||_147=="boolean"){return it+"";}if(it===null){return "null";}if(dojo.isString(it)){return dojo._escapeString(it);}var _148=arguments.callee;var _149;_146=_146||"";var _14a=_145?_146+dojo.toJsonIndentStr:"";var tf=it.__json__||it.json;if(dojo.isFunction(tf)){_149=tf.call(it);if(it!==_149){return _148(_149,_145,_14a);}}if(it.nodeType&&it.cloneNode){throw new Error("Can't serialize DOM nodes");}var sep=_145?" ":"";var _14d=_145?"\n":"";if(dojo.isArray(it)){var res=dojo.map(it,function(obj){var val=_148(obj,_145,_14a);if(typeof val!="string"){val="undefined";}return _14d+_14a+val;});return "["+res.join(","+sep)+_14d+_146+"]";}if(_147=="function"){return null;}var _151=[],key;for(key in it){var _153,val;if(typeof key=="number"){_153="\""+key+"\"";}else{if(typeof key=="string"){_153=dojo._escapeString(key);}else{continue;}}val=_148(it[key],_145,_14a);if(typeof val!="string"){continue;}_151.push(_14d+_14a+_153+":"+sep+val);}return "{"+_151.join(","+sep)+_14d+_146+"}";};}if(!dojo._hasResource["dojo._base.array"]){dojo._hasResource["dojo._base.array"]=true;dojo.provide("dojo._base.array");(function(){var _155=function(arr,obj,cb){return [dojo.isString(arr)?arr.split(""):arr,obj||dojo.global,dojo.isString(cb)?new Function("item","index","array",cb):cb];};dojo.mixin(dojo,{indexOf:function(_159,_15a,_15b,_15c){var step=1,end=_159.length||0,i=0;if(_15c){i=end-1;step=end=-1;}if(_15b!=undefined){i=_15b;}if((_15c&&i>end)||i<end){for(;i!=end;i+=step){if(_159[i]==_15a){return i;}}}return -1;},lastIndexOf:function(_15f,_160,_161){return dojo.indexOf(_15f,_160,_161,true);},forEach:function(arr,_163,_164){if(!arr||!arr.length){return;}var _p=_155(arr,_164,_163);arr=_p[0];for(var i=0,l=arr.length;i<l;++i){_p[2].call(_p[1],arr[i],i,arr);}},_everyOrSome:function(_168,arr,_16a,_16b){var _p=_155(arr,_16b,_16a);arr=_p[0];for(var i=0,l=arr.length;i<l;++i){var _16f=!!_p[2].call(_p[1],arr[i],i,arr);if(_168^_16f){return _16f;}}return _168;},every:function(arr,_171,_172){return this._everyOrSome(true,arr,_171,_172);},some:function(arr,_174,_175){return this._everyOrSome(false,arr,_174,_175);},map:function(arr,_177,_178){var _p=_155(arr,_178,_177);arr=_p[0];var _17a=(arguments[3]?(new arguments[3]()):[]);for(var i=0,l=arr.length;i<l;++i){_17a.push(_p[2].call(_p[1],arr[i],i,arr));}return _17a;},filter:function(arr,_17e,_17f){var _p=_155(arr,_17f,_17e);arr=_p[0];var _181=[];for(var i=0,l=arr.length;i<l;++i){if(_p[2].call(_p[1],arr[i],i,arr)){_181.push(arr[i]);}}return _181;}});})();}if(!dojo._hasResource["dojo._base.Color"]){dojo._hasResource["dojo._base.Color"]=true;dojo.provide("dojo._base.Color");(function(){var d=dojo;dojo.Color=function(_185){if(_185){this.setColor(_185);}};dojo.Color.named={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255]};dojo.extend(dojo.Color,{r:255,g:255,b:255,a:1,_set:function(r,g,b,a){var t=this;t.r=r;t.g=g;t.b=b;t.a=a;},setColor:function(_18b){if(d.isString(_18b)){d.colorFromString(_18b,this);}else{if(d.isArray(_18b)){d.colorFromArray(_18b,this);}else{this._set(_18b.r,_18b.g,_18b.b,_18b.a);if(!(_18b instanceof d.Color)){this.sanitize();}}}return this;},sanitize:function(){return this;},toRgb:function(){var t=this;return [t.r,t.g,t.b];},toRgba:function(){var t=this;return [t.r,t.g,t.b,t.a];},toHex:function(){var arr=d.map(["r","g","b"],function(x){var s=this[x].toString(16);return s.length<2?"0"+s:s;},this);return "#"+arr.join("");},toCss:function(_191){var t=this,rgb=t.r+", "+t.g+", "+t.b;return (_191?"rgba("+rgb+", "+t.a:"rgb("+rgb)+")";},toString:function(){return this.toCss(true);}});dojo.blendColors=function(_194,end,_196,obj){var t=obj||new d.Color();d.forEach(["r","g","b","a"],function(x){t[x]=_194[x]+(end[x]-_194[x])*_196;if(x!="a"){t[x]=Math.round(t[x]);}});return t.sanitize();};dojo.colorFromRgb=function(_19a,obj){var m=_19a.toLowerCase().match(/^rgba?\(([\s\.,0-9]+)\)/);return m&&dojo.colorFromArray(m[1].split(/\s*,\s*/),obj);};dojo.colorFromHex=function(_19d,obj){var t=obj||new d.Color(),bits=(_19d.length==4)?4:8,mask=(1<<bits)-1;_19d=Number("0x"+_19d.substr(1));if(isNaN(_19d)){return null;}d.forEach(["b","g","r"],function(x){var c=_19d&mask;_19d>>=bits;t[x]=bits==4?17*c:c;});t.a=1;return t;};dojo.colorFromArray=function(a,obj){var t=obj||new d.Color();t._set(Number(a[0]),Number(a[1]),Number(a[2]),Number(a[3]));if(isNaN(t.a)){t.a=1;}return t.sanitize();};dojo.colorFromString=function(str,obj){var a=d.Color.named[str];return a&&d.colorFromArray(a,obj)||d.colorFromRgb(str,obj)||d.colorFromHex(str,obj);};})();}if(!dojo._hasResource["dojo._base"]){dojo._hasResource["dojo._base"]=true;dojo.provide("dojo._base");}if(!dojo._hasResource["dojo._base.window"]){dojo._hasResource["dojo._base.window"]=true;dojo.provide("dojo._base.window");dojo.doc=window["document"]||null;dojo.body=function(){return dojo.doc.body||dojo.doc.getElementsByTagName("body")[0];};dojo.setContext=function(_1aa,_1ab){dojo.global=_1aa;dojo.doc=_1ab;};dojo.withGlobal=function(_1ac,_1ad,_1ae,_1af){var _1b0=dojo.global;try{dojo.global=_1ac;return dojo.withDoc.call(null,_1ac.document,_1ad,_1ae,_1af);}finally{dojo.global=_1b0;}};dojo.withDoc=function(_1b1,_1b2,_1b3,_1b4){var _1b5=dojo.doc,_1b6=dojo._bodyLtr;try{dojo.doc=_1b1;delete dojo._bodyLtr;if(_1b3&&dojo.isString(_1b2)){_1b2=_1b3[_1b2];}return _1b2.apply(_1b3,_1b4||[]);}finally{dojo.doc=_1b5;if(_1b6!==undefined){dojo._bodyLtr=_1b6;}}};}if(!dojo._hasResource["dojo._base.event"]){dojo._hasResource["dojo._base.event"]=true;dojo.provide("dojo._base.event");(function(){var del=(dojo._event_listener={add:function(node,name,fp){if(!node){return;}name=del._normalizeEventName(name);fp=del._fixCallback(name,fp);var _1bb=name;if(!dojo.isIE&&(name=="mouseenter"||name=="mouseleave")){var ofp=fp;name=(name=="mouseenter")?"mouseover":"mouseout";fp=function(e){if(dojo.isFF<=2){try{e.relatedTarget.tagName;}catch(e2){return;}}if(!dojo.isDescendant(e.relatedTarget,node)){return ofp.call(this,e);}};}node.addEventListener(name,fp,false);return fp;},remove:function(node,_1bf,_1c0){if(node){_1bf=del._normalizeEventName(_1bf);if(!dojo.isIE&&(_1bf=="mouseenter"||_1bf=="mouseleave")){_1bf=(_1bf=="mouseenter")?"mouseover":"mouseout";}node.removeEventListener(_1bf,_1c0,false);}},_normalizeEventName:function(name){return name.slice(0,2)=="on"?name.slice(2):name;},_fixCallback:function(name,fp){return name!="keypress"?fp:function(e){return fp.call(this,del._fixEvent(e,this));};},_fixEvent:function(evt,_1c6){switch(evt.type){case "keypress":del._setKeyChar(evt);break;}return evt;},_setKeyChar:function(evt){evt.keyChar=evt.charCode?String.fromCharCode(evt.charCode):"";evt.charOrCode=evt.keyChar||evt.keyCode;},_punctMap:{106:42,111:47,186:59,187:43,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39}});dojo.fixEvent=function(evt,_1c9){return del._fixEvent(evt,_1c9);};dojo.stopEvent=function(evt){evt.preventDefault();evt.stopPropagation();};var _1cb=dojo._listener;dojo._connect=function(obj,_1cd,_1ce,_1cf,_1d0){var _1d1=obj&&(obj.nodeType||obj.attachEvent||obj.addEventListener);var lid=_1d1?(_1d0?2:1):0,l=[dojo._listener,del,_1cb][lid];var h=l.add(obj,_1cd,dojo.hitch(_1ce,_1cf));return [obj,_1cd,h,lid];};dojo._disconnect=function(obj,_1d6,_1d7,_1d8){([dojo._listener,del,_1cb][_1d8]).remove(obj,_1d6,_1d7);};dojo.keys={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,HELP:47,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_PLUS:107,NUMPAD_ENTER:108,NUMPAD_MINUS:109,NUMPAD_PERIOD:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,NUM_LOCK:144,SCROLL_LOCK:145};if(dojo.isIE){var _1d9=function(e,code){try{return (e.keyCode=code);}catch(e){return 0;}};var iel=dojo._listener;var _1dd=(dojo._ieListenersName="_"+dojo._scopeName+"_listeners");if(!dojo.config._allow_leaks){_1cb=iel=dojo._ie_listener={handlers:[],add:function(_1de,_1df,_1e0){_1de=_1de||dojo.global;var f=_1de[_1df];if(!f||!f[_1dd]){var d=dojo._getIeDispatcher();d.target=f&&(ieh.push(f)-1);d[_1dd]=[];f=_1de[_1df]=d;}return f[_1dd].push(ieh.push(_1e0)-1);},remove:function(_1e4,_1e5,_1e6){var f=(_1e4||dojo.global)[_1e5],l=f&&f[_1dd];if(f&&l&&_1e6--){delete ieh[l[_1e6]];delete l[_1e6];}}};var ieh=iel.handlers;}dojo.mixin(del,{add:function(node,_1ea,fp){if(!node){return;}_1ea=del._normalizeEventName(_1ea);if(_1ea=="onkeypress"){var kd=node.onkeydown;if(!kd||!kd[_1dd]||!kd._stealthKeydownHandle){var h=del.add(node,"onkeydown",del._stealthKeyDown);kd=node.onkeydown;kd._stealthKeydownHandle=h;kd._stealthKeydownRefs=1;}else{kd._stealthKeydownRefs++;}}return iel.add(node,_1ea,del._fixCallback(fp));},remove:function(node,_1ef,_1f0){_1ef=del._normalizeEventName(_1ef);iel.remove(node,_1ef,_1f0);if(_1ef=="onkeypress"){var kd=node.onkeydown;if(--kd._stealthKeydownRefs<=0){iel.remove(node,"onkeydown",kd._stealthKeydownHandle);delete kd._stealthKeydownHandle;}}},_normalizeEventName:function(_1f2){return _1f2.slice(0,2)!="on"?"on"+_1f2:_1f2;},_nop:function(){},_fixEvent:function(evt,_1f4){if(!evt){var w=_1f4&&(_1f4.ownerDocument||_1f4.document||_1f4).parentWindow||window;evt=w.event;}if(!evt){return (evt);}evt.target=evt.srcElement;evt.currentTarget=(_1f4||evt.srcElement);evt.layerX=evt.offsetX;evt.layerY=evt.offsetY;var se=evt.srcElement,doc=(se&&se.ownerDocument)||document;var _1f8=((dojo.isIE<6)||(doc["compatMode"]=="BackCompat"))?doc.body:doc.documentElement;var _1f9=dojo._getIeDocumentElementOffset();evt.pageX=evt.clientX+dojo._fixIeBiDiScrollLeft(_1f8.scrollLeft||0)-_1f9.x;evt.pageY=evt.clientY+(_1f8.scrollTop||0)-_1f9.y;if(evt.type=="mouseover"){evt.relatedTarget=evt.fromElement;}if(evt.type=="mouseout"){evt.relatedTarget=evt.toElement;}evt.stopPropagation=del._stopPropagation;evt.preventDefault=del._preventDefault;return del._fixKeys(evt);},_fixKeys:function(evt){switch(evt.type){case "keypress":var c=("charCode" in evt?evt.charCode:evt.keyCode);if(c==10){c=0;evt.keyCode=13;}else{if(c==13||c==27){c=0;}else{if(c==3){c=99;}}}evt.charCode=c;del._setKeyChar(evt);break;}return evt;},_stealthKeyDown:function(evt){var kp=evt.currentTarget.onkeypress;if(!kp||!kp[_1dd]){return;}var k=evt.keyCode;var _1ff=k!=13&&k!=32&&k!=27&&(k<48||k>90)&&(k<96||k>111)&&(k<186||k>192)&&(k<219||k>222);if(_1ff||evt.ctrlKey){var c=_1ff?0:k;if(evt.ctrlKey){if(k==3||k==13){return;}else{if(c>95&&c<106){c-=48;}else{if((!evt.shiftKey)&&(c>=65&&c<=90)){c+=32;}else{c=del._punctMap[c]||c;}}}}var faux=del._synthesizeEvent(evt,{type:"keypress",faux:true,charCode:c});kp.call(evt.currentTarget,faux);evt.cancelBubble=faux.cancelBubble;evt.returnValue=faux.returnValue;_1d9(evt,faux.keyCode);}},_stopPropagation:function(){this.cancelBubble=true;},_preventDefault:function(){this.bubbledKeyCode=this.keyCode;if(this.ctrlKey){_1d9(this,0);}this.returnValue=false;}});dojo.stopEvent=function(evt){evt=evt||window.event;del._stopPropagation.call(evt);del._preventDefault.call(evt);};}del._synthesizeEvent=function(evt,_204){var faux=dojo.mixin({},evt,_204);del._setKeyChar(faux);faux.preventDefault=function(){evt.preventDefault();};faux.stopPropagation=function(){evt.stopPropagation();};return faux;};if(dojo.isOpera){dojo.mixin(del,{_fixEvent:function(evt,_207){switch(evt.type){case "keypress":var c=evt.which;if(c==3){c=99;}c=c<41&&!evt.shiftKey?0:c;if(evt.ctrlKey&&!evt.shiftKey&&c>=65&&c<=90){c+=32;}return del._synthesizeEvent(evt,{charCode:c});}return evt;}});}if(dojo.isWebKit){del._add=del.add;del._remove=del.remove;dojo.mixin(del,{add:function(node,_20a,fp){if(!node){return;}var _20c=del._add(node,_20a,fp);if(del._normalizeEventName(_20a)=="keypress"){_20c._stealthKeyDownHandle=del._add(node,"keydown",function(evt){var k=evt.keyCode;var _20f=k!=13&&k!=32&&k!=27&&(k<48||k>90)&&(k<96||k>111)&&(k<186||k>192)&&(k<219||k>222);if(_20f||evt.ctrlKey){var c=_20f?0:k;if(evt.ctrlKey){if(k==3||k==13){return;}else{if(c>95&&c<106){c-=48;}else{if(!evt.shiftKey&&c>=65&&c<=90){c+=32;}else{c=del._punctMap[c]||c;}}}}var faux=del._synthesizeEvent(evt,{type:"keypress",faux:true,charCode:c});fp.call(evt.currentTarget,faux);}});}return _20c;},remove:function(node,_213,_214){if(node){if(_214._stealthKeyDownHandle){del._remove(node,"keydown",_214._stealthKeyDownHandle);}del._remove(node,_213,_214);}},_fixEvent:function(evt,_216){switch(evt.type){case "keypress":if(evt.faux){return evt;}var c=evt.charCode;c=c>=32?c:0;return del._synthesizeEvent(evt,{charCode:c,faux:true});}return evt;}});}})();if(dojo.isIE){dojo._ieDispatcher=function(args,_219){var ap=Array.prototype,h=dojo._ie_listener.handlers,c=args.callee,ls=c[dojo._ieListenersName],t=h[c.target];var r=t&&t.apply(_219,args);var lls=[].concat(ls);for(var i in lls){if(!(i in ap)){h[lls[i]].apply(_219,args);}}return r;};dojo._getIeDispatcher=function(){return new Function(dojo._scopeName+"._ieDispatcher(arguments, this)");};dojo._event_listener._fixCallback=function(fp){var f=dojo._event_listener._fixEvent;return function(e){return fp.call(this,f(e,this));};};}}if(!dojo._hasResource["dojo._base.html"]){dojo._hasResource["dojo._base.html"]=true;dojo.provide("dojo._base.html");try{document.execCommand("BackgroundImageCache",false,true);}catch(e){}if(dojo.isIE||dojo.isOpera){dojo.byId=function(id,doc){if(dojo.isString(id)){var _d=doc||dojo.doc;var te=_d.getElementById(id);if(te&&(te.attributes.id.value==id||te.id==id)){return te;}else{var eles=_d.all[id];if(!eles||eles.nodeName){eles=[eles];}var i=0;while((te=eles[i++])){if((te.attributes&&te.attributes.id&&te.attributes.id.value==id)||te.id==id){return te;}}}}else{return id;}};}else{dojo.byId=function(id,doc){return dojo.isString(id)?(doc||dojo.doc).getElementById(id):id;};}(function(){var d=dojo;var _22e=null;d.addOnWindowUnload(function(){_22e=null;});dojo._destroyElement=dojo.destroy=function(node){node=d.byId(node);try{if(!_22e||_22e.ownerDocument!=node.ownerDocument){_22e=node.ownerDocument.createElement("div");}_22e.appendChild(node.parentNode?node.parentNode.removeChild(node):node);_22e.innerHTML="";}catch(e){}};dojo.isDescendant=function(node,_231){try{node=d.byId(node);_231=d.byId(_231);while(node){if(node===_231){return true;}node=node.parentNode;}}catch(e){}return false;};dojo.setSelectable=function(node,_233){node=d.byId(node);if(d.isMozilla){node.style.MozUserSelect=_233?"":"none";}else{if(d.isKhtml||d.isWebKit){node.style.KhtmlUserSelect=_233?"auto":"none";}else{if(d.isIE){var v=(node.unselectable=_233?"":"on");d.query("*",node).forEach("item.unselectable = '"+v+"'");}}}};var _235=function(node,ref){var _238=ref.parentNode;if(_238){_238.insertBefore(node,ref);}};var _239=function(node,ref){var _23c=ref.parentNode;if(_23c){if(_23c.lastChild==ref){_23c.appendChild(node);}else{_23c.insertBefore(node,ref.nextSibling);}}};dojo.place=function(node,_23e,_23f){_23e=d.byId(_23e);if(d.isString(node)){node=node.charAt(0)=="<"?d._toDom(node,_23e.ownerDocument):d.byId(node);}if(typeof _23f=="number"){var cn=_23e.childNodes;if(!cn.length||cn.length<=_23f){_23e.appendChild(node);}else{_235(node,cn[_23f<0?0:_23f]);}}else{switch(_23f){case "before":_235(node,_23e);break;case "after":_239(node,_23e);break;case "replace":_23e.parentNode.replaceChild(node,_23e);break;case "only":d.empty(_23e);_23e.appendChild(node);break;case "first":if(_23e.firstChild){_235(node,_23e.firstChild);break;}default:_23e.appendChild(node);}}return node;};dojo.boxModel="content-box";if(d.isIE){var _dcm=document.compatMode;d.boxModel=_dcm=="BackCompat"||_dcm=="QuirksMode"||d.isIE<6?"border-box":"content-box";}var gcs;if(d.isWebKit){gcs=function(node){var s;if(node instanceof HTMLElement){var dv=node.ownerDocument.defaultView;s=dv.getComputedStyle(node,null);if(!s&&node.style){node.style.display="";s=dv.getComputedStyle(node,null);}}return s||{};};}else{if(d.isIE){gcs=function(node){return node.nodeType==1?node.currentStyle:{};};}else{gcs=function(node){return node instanceof HTMLElement?node.ownerDocument.defaultView.getComputedStyle(node,null):{};};}}dojo.getComputedStyle=gcs;if(!d.isIE){d._toPixelValue=function(_248,_249){return parseFloat(_249)||0;};}else{d._toPixelValue=function(_24a,_24b){if(!_24b){return 0;}if(_24b=="medium"){return 4;}if(_24b.slice&&_24b.slice(-2)=="px"){return parseFloat(_24b);}with(_24a){var _24c=style.left;var _24d=runtimeStyle.left;runtimeStyle.left=currentStyle.left;try{style.left=_24b;_24b=style.pixelLeft;}catch(e){_24b=0;}style.left=_24c;runtimeStyle.left=_24d;}return _24b;};}var px=d._toPixelValue;var astr="DXImageTransform.Microsoft.Alpha";var af=function(n,f){try{return n.filters.item(astr);}catch(e){return f?{}:null;}};dojo._getOpacity=d.isIE?function(node){try{return af(node).Opacity/100;}catch(e){return 1;}}:function(node){return gcs(node).opacity;};dojo._setOpacity=d.isIE?function(node,_256){var ov=_256*100;node.style.zoom=1;af(node,1).Enabled=!(_256==1);if(!af(node)){node.style.filter+=" progid:"+astr+"(Opacity="+ov+")";}else{af(node,1).Opacity=ov;}if(node.nodeName.toLowerCase()=="tr"){d.query("> td",node).forEach(function(i){d._setOpacity(i,_256);});}return _256;}:function(node,_25a){return node.style.opacity=_25a;};var _25b={left:true,top:true};var _25c=/margin|padding|width|height|max|min|offset/;var _25d=function(node,type,_260){type=type.toLowerCase();if(d.isIE){if(_260=="auto"){if(type=="height"){return node.offsetHeight;}if(type=="width"){return node.offsetWidth;}}if(type=="fontweight"){switch(_260){case 700:return "bold";case 400:default:return "normal";}}}if(!(type in _25b)){_25b[type]=_25c.test(type);}return _25b[type]?px(node,_260):_260;};var _261=d.isIE?"styleFloat":"cssFloat",_262={"cssFloat":_261,"styleFloat":_261,"float":_261};dojo.style=function(node,_264,_265){var n=d.byId(node),args=arguments.length,op=(_264=="opacity");_264=_262[_264]||_264;if(args==3){return op?d._setOpacity(n,_265):n.style[_264]=_265;}if(args==2&&op){return d._getOpacity(n);}var s=gcs(n);if(args==2&&!d.isString(_264)){for(var x in _264){d.style(node,x,_264[x]);}return s;}return (args==1)?s:_25d(n,_264,s[_264]||n.style[_264]);};dojo._getPadExtents=function(n,_26c){var s=_26c||gcs(n),l=px(n,s.paddingLeft),t=px(n,s.paddingTop);return {l:l,t:t,w:l+px(n,s.paddingRight),h:t+px(n,s.paddingBottom)};};dojo._getBorderExtents=function(n,_271){var ne="none",s=_271||gcs(n),bl=(s.borderLeftStyle!=ne?px(n,s.borderLeftWidth):0),bt=(s.borderTopStyle!=ne?px(n,s.borderTopWidth):0);return {l:bl,t:bt,w:bl+(s.borderRightStyle!=ne?px(n,s.borderRightWidth):0),h:bt+(s.borderBottomStyle!=ne?px(n,s.borderBottomWidth):0)};};dojo._getPadBorderExtents=function(n,_277){var s=_277||gcs(n),p=d._getPadExtents(n,s),b=d._getBorderExtents(n,s);return {l:p.l+b.l,t:p.t+b.t,w:p.w+b.w,h:p.h+b.h};};dojo._getMarginExtents=function(n,_27c){var s=_27c||gcs(n),l=px(n,s.marginLeft),t=px(n,s.marginTop),r=px(n,s.marginRight),b=px(n,s.marginBottom);if(d.isWebKit&&(s.position!="absolute")){r=l;}return {l:l,t:t,w:l+r,h:t+b};};dojo._getMarginBox=function(node,_283){var s=_283||gcs(node),me=d._getMarginExtents(node,s);var l=node.offsetLeft-me.l,t=node.offsetTop-me.t,p=node.parentNode;if(d.isMoz){var sl=parseFloat(s.left),st=parseFloat(s.top);if(!isNaN(sl)&&!isNaN(st)){l=sl,t=st;}else{if(p&&p.style){var pcs=gcs(p);if(pcs.overflow!="visible"){var be=d._getBorderExtents(p,pcs);l+=be.l,t+=be.t;}}}}else{if(d.isOpera||(d.isIE>7&&!d.isQuirks)){if(p){be=d._getBorderExtents(p);l-=be.l;t-=be.t;}}}return {l:l,t:t,w:node.offsetWidth+me.w,h:node.offsetHeight+me.h};};dojo._getContentBox=function(node,_28e){var s=_28e||gcs(node),pe=d._getPadExtents(node,s),be=d._getBorderExtents(node,s),w=node.clientWidth,h;if(!w){w=node.offsetWidth,h=node.offsetHeight;}else{h=node.clientHeight,be.w=be.h=0;}if(d.isOpera){pe.l+=be.l;pe.t+=be.t;}return {l:pe.l,t:pe.t,w:w-pe.w-be.w,h:h-pe.h-be.h};};dojo._getBorderBox=function(node,_295){var s=_295||gcs(node),pe=d._getPadExtents(node,s),cb=d._getContentBox(node,s);return {l:cb.l-pe.l,t:cb.t-pe.t,w:cb.w+pe.w,h:cb.h+pe.h};};dojo._setBox=function(node,l,t,w,h,u){u=u||"px";var s=node.style;if(!isNaN(l)){s.left=l+u;}if(!isNaN(t)){s.top=t+u;}if(w>=0){s.width=w+u;}if(h>=0){s.height=h+u;}};dojo._isButtonTag=function(node){return node.tagName=="BUTTON"||node.tagName=="INPUT"&&node.getAttribute("type").toUpperCase()=="BUTTON";};dojo._usesBorderBox=function(node){var n=node.tagName;return d.boxModel=="border-box"||n=="TABLE"||d._isButtonTag(node);};dojo._setContentSize=function(node,_2a4,_2a5,_2a6){if(d._usesBorderBox(node)){var pb=d._getPadBorderExtents(node,_2a6);if(_2a4>=0){_2a4+=pb.w;}if(_2a5>=0){_2a5+=pb.h;}}d._setBox(node,NaN,NaN,_2a4,_2a5);};dojo._setMarginBox=function(node,_2a9,_2aa,_2ab,_2ac,_2ad){var s=_2ad||gcs(node),bb=d._usesBorderBox(node),pb=bb?_2b1:d._getPadBorderExtents(node,s);if(d.isWebKit){if(d._isButtonTag(node)){var ns=node.style;if(_2ab>=0&&!ns.width){ns.width="4px";}if(_2ac>=0&&!ns.height){ns.height="4px";}}}var mb=d._getMarginExtents(node,s);if(_2ab>=0){_2ab=Math.max(_2ab-pb.w-mb.w,0);}if(_2ac>=0){_2ac=Math.max(_2ac-pb.h-mb.h,0);}d._setBox(node,_2a9,_2aa,_2ab,_2ac);};var _2b1={l:0,t:0,w:0,h:0};dojo.marginBox=function(node,box){var n=d.byId(node),s=gcs(n),b=box;return !b?d._getMarginBox(n,s):d._setMarginBox(n,b.l,b.t,b.w,b.h,s);};dojo.contentBox=function(node,box){var n=d.byId(node),s=gcs(n),b=box;return !b?d._getContentBox(n,s):d._setContentSize(n,b.w,b.h,s);};var _2be=function(node,prop){if(!(node=(node||0).parentNode)){return 0;}var val,_2c2=0,_b=d.body();while(node&&node.style){if(gcs(node).position=="fixed"){return 0;}val=node[prop];if(val){_2c2+=val-0;if(node==_b){break;}}node=node.parentNode;}return _2c2;};dojo._docScroll=function(){var _b=d.body(),_w=d.global,de=d.doc.documentElement;return {y:(_w.pageYOffset||de.scrollTop||_b.scrollTop||0),x:(_w.pageXOffset||d._fixIeBiDiScrollLeft(de.scrollLeft)||_b.scrollLeft||0)};};dojo._isBodyLtr=function(){return ("_bodyLtr" in d)?d._bodyLtr:d._bodyLtr=gcs(d.body()).direction=="ltr";};dojo._getIeDocumentElementOffset=function(){var de=d.doc.documentElement;if(d.isIE<7){return {x:d._isBodyLtr()||window.parent==window?de.clientLeft:de.offsetWidth-de.clientWidth-de.clientLeft,y:de.clientTop};}else{if(d.isIE<8){return {x:de.getBoundingClientRect().left,y:de.getBoundingClientRect().top};}else{return {x:0,y:0};}}};dojo._fixIeBiDiScrollLeft=function(_2c8){var dd=d.doc;if(d.isIE<8&&!d._isBodyLtr()){var de=dd.compatMode=="BackCompat"?dd.body:dd.documentElement;return _2c8+de.clientWidth-de.scrollWidth;}return _2c8;};dojo._abs=function(node,_2cc){var db=d.body(),dh=d.body().parentNode,ret;if(node["getBoundingClientRect"]){var _2d0=node.getBoundingClientRect();ret={x:_2d0.left,y:_2d0.top};if(d.isFF>=3){var cs=gcs(dh);ret.x-=px(dh,cs.marginLeft)+px(dh,cs.borderLeftWidth);ret.y-=px(dh,cs.marginTop)+px(dh,cs.borderTopWidth);}if(d.isIE){var _2d2=d._getIeDocumentElementOffset();ret.x-=_2d2.x+(d.isQuirks?db.clientLeft:0);ret.y-=_2d2.y+(d.isQuirks?db.clientTop:0);}}else{ret={x:0,y:0};if(node["offsetParent"]){ret.x-=_2be(node,"scrollLeft");ret.y-=_2be(node,"scrollTop");var _2d3=node;do{var n=_2d3.offsetLeft,t=_2d3.offsetTop;ret.x+=isNaN(n)?0:n;ret.y+=isNaN(t)?0:t;cs=gcs(_2d3);if(_2d3!=node){if(d.isFF){ret.x+=2*px(_2d3,cs.borderLeftWidth);ret.y+=2*px(_2d3,cs.borderTopWidth);}else{ret.x+=px(_2d3,cs.borderLeftWidth);ret.y+=px(_2d3,cs.borderTopWidth);}}if(d.isFF&&cs.position=="static"){var _2d6=_2d3.parentNode;while(_2d6!=_2d3.offsetParent){var pcs=gcs(_2d6);if(pcs.position=="static"){ret.x+=px(_2d3,pcs.borderLeftWidth);ret.y+=px(_2d3,pcs.borderTopWidth);}_2d6=_2d6.parentNode;}}_2d3=_2d3.offsetParent;}while((_2d3!=dh)&&_2d3);}else{if(node.x&&node.y){ret.x+=isNaN(node.x)?0:node.x;ret.y+=isNaN(node.y)?0:node.y;}}}if(_2cc){var _2d8=d._docScroll();ret.x+=_2d8.x;ret.y+=_2d8.y;}return ret;};dojo.coords=function(node,_2da){var n=d.byId(node),s=gcs(n),mb=d._getMarginBox(n,s);var abs=d._abs(n,_2da);mb.x=abs.x;mb.y=abs.y;return mb;};var _2df=d.isIE<8;var _2e0=function(name){switch(name.toLowerCase()){case "tabindex":return _2df?"tabIndex":"tabindex";case "readonly":return "readOnly";case "class":return "className";case "for":case "htmlfor":return _2df?"htmlFor":"for";default:return name;}};var _2e2={colspan:"colSpan",enctype:"enctype",frameborder:"frameborder",method:"method",rowspan:"rowSpan",scrolling:"scrolling",shape:"shape",span:"span",type:"type",valuetype:"valueType",classname:"className",innerhtml:"innerHTML"};dojo.hasAttr=function(node,name){node=d.byId(node);var _2e5=_2e0(name);_2e5=_2e5=="htmlFor"?"for":_2e5;var attr=node.getAttributeNode&&node.getAttributeNode(_2e5);return attr?attr.specified:false;};var _2e7={},_ctr=0,_2e9=dojo._scopeName+"attrid",_2ea={col:1,colgroup:1,table:1,tbody:1,tfoot:1,thead:1,tr:1,title:1};dojo.attr=function(node,name,_2ed){node=d.byId(node);var args=arguments.length;if(args==2&&!d.isString(name)){for(var x in name){d.attr(node,x,name[x]);}return;}name=_2e0(name);if(args==3){if(d.isFunction(_2ed)){var _2f0=d.attr(node,_2e9);if(!_2f0){_2f0=_ctr++;d.attr(node,_2e9,_2f0);}if(!_2e7[_2f0]){_2e7[_2f0]={};}var h=_2e7[_2f0][name];if(h){d.disconnect(h);}else{try{delete node[name];}catch(e){}}_2e7[_2f0][name]=d.connect(node,name,_2ed);}else{if(typeof _2ed=="boolean"){node[name]=_2ed;}else{if(name==="style"&&!d.isString(_2ed)){d.style(node,_2ed);}else{if(name=="className"){node.className=_2ed;}else{if(name==="innerHTML"){if(d.isIE&&node.tagName.toLowerCase() in _2ea){d.empty(node);node.appendChild(d._toDom(_2ed,node.ownerDocument));}else{node[name]=_2ed;}}else{node.setAttribute(name,_2ed);}}}}}}else{var prop=_2e2[name.toLowerCase()];if(prop){return node[prop];}var _2f3=node[name];return (typeof _2f3=="boolean"||typeof _2f3=="function")?_2f3:(d.hasAttr(node,name)?node.getAttribute(name):null);}};dojo.removeAttr=function(node,name){d.byId(node).removeAttribute(_2e0(name));};dojo.create=function(tag,_2f7,_2f8,pos){var doc=d.doc;if(_2f8){_2f8=d.byId(_2f8);doc=_2f8.ownerDocument;}if(d.isString(tag)){tag=doc.createElement(tag);}if(_2f7){d.attr(tag,_2f7);}if(_2f8){d.place(tag,_2f8,pos);}return tag;};d.empty=d.isIE?function(node){node=d.byId(node);for(var c;c=node.lastChild;){d.destroy(c);}}:function(node){d.byId(node).innerHTML="";};var _2fe={option:["select"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","thead","tr"],legend:["fieldset"],caption:["table"],colgroup:["table"],col:["table","colgroup"],li:["ul"]},_2ff=/<\s*([\w\:]+)/,_300={},_301=0,_302="__"+d._scopeName+"ToDomId";for(var _303 in _2fe){var tw=_2fe[_303];tw.pre=_303=="option"?"<select multiple=\"multiple\">":"<"+tw.join("><")+">";tw.post="</"+tw.reverse().join("></")+">";}d._toDom=function(frag,doc){doc=doc||d.doc;var _307=doc[_302];if(!_307){doc[_302]=_307=++_301+"";_300[_307]=doc.createElement("div");}frag+="";var _308=frag.match(_2ff),tag=_308?_308[1].toLowerCase():"",_30a=_300[_307],wrap,i,fc,df;if(_308&&_2fe[tag]){wrap=_2fe[tag];_30a.innerHTML=wrap.pre+frag+wrap.post;for(i=wrap.length;i;--i){_30a=_30a.firstChild;}}else{_30a.innerHTML=frag;}if(_30a.childNodes.length==1){return _30a.removeChild(_30a.firstChild);}df=doc.createDocumentFragment();while(fc=_30a.firstChild){df.appendChild(fc);}return df;};var _30e="className";dojo.hasClass=function(node,_310){return ((" "+d.byId(node)[_30e]+" ").indexOf(" "+_310+" ")>=0);};dojo.addClass=function(node,_312){node=d.byId(node);var cls=node[_30e];if((" "+cls+" ").indexOf(" "+_312+" ")<0){node[_30e]=cls+(cls?" ":"")+_312;}};dojo.removeClass=function(node,_315){node=d.byId(node);var t=d.trim((" "+node[_30e]+" ").replace(" "+_315+" "," "));if(node[_30e]!=t){node[_30e]=t;}};dojo.toggleClass=function(node,_318,_319){if(_319===undefined){_319=!d.hasClass(node,_318);}d[_319?"addClass":"removeClass"](node,_318);};})();}if(!dojo._hasResource["dojo._base.NodeList"]){dojo._hasResource["dojo._base.NodeList"]=true;dojo.provide("dojo._base.NodeList");(function(){var d=dojo;var ap=Array.prototype,aps=ap.slice,apc=ap.concat;var tnl=function(a){a.constructor=d.NodeList;dojo._mixin(a,d.NodeList.prototype);return a;};var _320=function(f,a,o){a=[0].concat(aps.call(a,0));o=o||d.global;return function(node){a[0]=node;return f.apply(o,a);};};var _325=function(f,o){return function(){this.forEach(_320(f,arguments,o));return this;};};var _328=function(f,o){return function(){return this.map(_320(f,arguments,o));};};var _32b=function(f,o){return function(){return this.filter(_320(f,arguments,o));};};var _32e=function(f,g,o){return function(){var a=arguments,body=_320(f,a,o);if(g.call(o||d.global,a)){return this.map(body);}this.forEach(body);return this;};};var _334=function(a){return a.length==1&&d.isString(a[0]);};var _336=function(node){var p=node.parentNode;if(p){p.removeChild(node);}};dojo.NodeList=function(){return tnl(Array.apply(null,arguments));};var nl=d.NodeList,nlp=nl.prototype;nl._wrap=tnl;nl._adaptAsMap=_328;nl._adaptAsForEach=_325;nl._adaptAsFilter=_32b;nl._adaptWithCondition=_32e;d.forEach(["slice","splice"],function(name){var f=ap[name];nlp[name]=function(){return tnl(f.apply(this,arguments));};});d.forEach(["indexOf","lastIndexOf","every","some"],function(name){var f=d[name];nlp[name]=function(){return f.apply(d,[this].concat(aps.call(arguments,0)));};});d.forEach(["attr","style"],function(name){nlp[name]=_32e(d[name],_334);});d.forEach(["connect","addClass","removeClass","toggleClass","empty"],function(name){nlp[name]=_325(d[name]);});dojo.extend(dojo.NodeList,{concat:function(item){var t=d.isArray(this)?this:aps.call(this,0),m=d.map(arguments,function(a){return a&&!d.isArray(a)&&(a.constructor===NodeList||a.constructor==nl)?aps.call(a,0):a;});return tnl(apc.apply(t,m));},map:function(func,obj){return tnl(d.map(this,func,obj));},forEach:function(_347,_348){d.forEach(this,_347,_348);return this;},coords:_328(d.coords),place:function(_349,_34a){var item=d.query(_349)[0];return this.forEach(function(node){d.place(node,item,_34a);});},orphan:function(_34d){return (_34d?d._filterQueryResult(this,_34d):this).forEach(_336);},adopt:function(_34e,_34f){return d.query(_34e).place(item[0],_34f);},query:function(_350){if(!_350){return this;}var ret=this.map(function(node){return d.query(_350,node).filter(function(_353){return _353!==undefined;});});return tnl(apc.apply([],ret));},filter:function(_354){var a=arguments,_356=this,_357=0;if(d.isString(_354)){_356=d._filterQueryResult(this,a[0]);if(a.length==1){return _356;}_357=1;}return tnl(d.filter(_356,a[_357],a[_357+1]));},addContent:function(_358,_359){var c=d.isString(_358)?d._toDom(_358,this[0]&&this[0].ownerDocument):_358,i,l=this.length-1;for(i=0;i<l;++i){d.place(c.cloneNode(true),this[i],_359);}if(l>=0){d.place(c,this[l],_359);}return this;},instantiate:function(_35c,_35d){var c=d.isFunction(_35c)?_35c:d.getObject(_35c);_35d=_35d||{};return this.forEach(function(node){new c(_35d,node);});},at:function(){var t=new dojo.NodeList();d.forEach(arguments,function(i){if(this[i]){t.push(this[i]);}},this);return t;}});d.forEach(["blur","focus","change","click","error","keydown","keypress","keyup","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","submit"],function(evt){var _oe="on"+evt;nlp[_oe]=function(a,b){return this.connect(_oe,a,b);};});})();}if(!dojo._hasResource["dojo._base.query"]){dojo._hasResource["dojo._base.query"]=true;if(typeof dojo!="undefined"){dojo.provide("dojo._base.query");}(function(d){var trim=d.trim;var each=d.forEach;var qlc=d._queryListCtor=d.NodeList;var _36a=d.isString;var _36b=function(){return d.doc;};var _36c=(d.isWebKit&&((_36b().compatMode)=="BackCompat"));var _36d=!!_36b().firstChild["children"]?"children":"childNodes";var _36e=">~+";var _36f=false;var _370=function(){return true;};var _371=function(_372){if(_36e.indexOf(_372.slice(-1))>=0){_372+=" * ";}else{_372+=" ";}var ts=function(s,e){return trim(_372.slice(s,e));};var _376=[];var _377=-1,_378=-1,_379=-1,_37a=-1,_37b=-1,inId=-1,_37d=-1,lc="",cc="",_380;var x=0,ql=_372.length,_383=null,_cp=null;var _385=function(){if(_37d>=0){var tv=(_37d==x)?null:ts(_37d,x);_383[(_36e.indexOf(tv)<0)?"tag":"oper"]=tv;_37d=-1;}};var _387=function(){if(inId>=0){_383.id=ts(inId,x).replace(/\\/g,"");inId=-1;}};var _388=function(){if(_37b>=0){_383.classes.push(ts(_37b+1,x).replace(/\\/g,""));_37b=-1;}};var _389=function(){_387();_385();_388();};var _38a=function(){_389();if(_37a>=0){_383.pseudos.push({name:ts(_37a+1,x)});}_383.loops=(_383.pseudos.length||_383.attrs.length||_383.classes.length);_383.oquery=_383.query=ts(_380,x);_383.otag=_383.tag=(_383["oper"])?null:(_383.tag||"*");if(_383.tag){_383.tag=_383.tag.toUpperCase();}if(_376.length&&(_376[_376.length-1].oper)){_383.infixOper=_376.pop();_383.query=_383.infixOper.query+" "+_383.query;}_376.push(_383);_383=null;};for(;lc=cc,cc=_372.charAt(x),x<ql;x++){if(lc=="\\"){continue;}if(!_383){_380=x;_383={query:null,pseudos:[],attrs:[],classes:[],tag:null,oper:null,id:null,getTag:function(){return (_36f)?this.otag:this.tag;}};_37d=x;}if(_377>=0){if(cc=="]"){if(!_cp.attr){_cp.attr=ts(_377+1,x);}else{_cp.matchFor=ts((_379||_377+1),x);}var cmf=_cp.matchFor;if(cmf){if((cmf.charAt(0)=="\"")||(cmf.charAt(0)=="'")){_cp.matchFor=cmf.slice(1,-1);}}_383.attrs.push(_cp);_cp=null;_377=_379=-1;}else{if(cc=="="){var _38c=("|~^$*".indexOf(lc)>=0)?lc:"";_cp.type=_38c+cc;_cp.attr=ts(_377+1,x-_38c.length);_379=x+1;}}}else{if(_378>=0){if(cc==")"){if(_37a>=0){_cp.value=ts(_378+1,x);}_37a=_378=-1;}}else{if(cc=="#"){_389();inId=x+1;}else{if(cc=="."){_389();_37b=x;}else{if(cc==":"){_389();_37a=x;}else{if(cc=="["){_389();_377=x;_cp={};}else{if(cc=="("){if(_37a>=0){_cp={name:ts(_37a+1,x),value:null};_383.pseudos.push(_cp);}_378=x;}else{if((cc==" ")&&(lc!=cc)){_38a();}}}}}}}}}return _376;};var _38d=function(_38e,_38f){if(!_38e){return _38f;}if(!_38f){return _38e;}return function(){return _38e.apply(window,arguments)&&_38f.apply(window,arguments);};};var _390=function(i,arr){var r=arr||[];if(i){r.push(i);}return r;};var _394=function(n){return (1==n.nodeType);};var _396="";var _397=function(elem,attr){if(!elem){return _396;}if(attr=="class"){return elem.className||_396;}if(attr=="for"){return elem.htmlFor||_396;}if(attr=="style"){return elem.style.cssText||_396;}return (_36f?elem.getAttribute(attr):elem.getAttribute(attr,2))||_396;};var _39a={"*=":function(attr,_39c){return function(elem){return (_397(elem,attr).indexOf(_39c)>=0);};},"^=":function(attr,_39f){return function(elem){return (_397(elem,attr).indexOf(_39f)==0);};},"$=":function(attr,_3a2){var tval=" "+_3a2;return function(elem){var ea=" "+_397(elem,attr);return (ea.lastIndexOf(_3a2)==(ea.length-_3a2.length));};},"~=":function(attr,_3a7){var tval=" "+_3a7+" ";return function(elem){var ea=" "+_397(elem,attr)+" ";return (ea.indexOf(tval)>=0);};},"|=":function(attr,_3ac){var _3ad=" "+_3ac+"-";return function(elem){var ea=" "+_397(elem,attr);return ((ea==_3ac)||(ea.indexOf(_3ad)==0));};},"=":function(attr,_3b1){return function(elem){return (_397(elem,attr)==_3b1);};}};var _3b3=(typeof _36b().firstChild.nextElementSibling=="undefined");var _ns=!_3b3?"nextElementSibling":"nextSibling";var _ps=!_3b3?"previousElementSibling":"previousSibling";var _3b6=(_3b3?_394:_370);var _3b7=function(node){while(node=node[_ps]){if(_3b6(node)){return false;}}return true;};var _3b9=function(node){while(node=node[_ns]){if(_3b6(node)){return false;}}return true;};var _3bb=function(node){var root=node.parentNode;var i=0,tret=root[_36d],ci=(node["_i"]||-1),cl=(root["_l"]||-1);if(!tret){return -1;}var l=tret.length;if(cl==l&&ci>=0&&cl>=0){return ci;}root["_l"]=l;ci=-1;for(var te=root["firstElementChild"]||root["firstChild"];te;te=te[_ns]){if(_3b6(te)){te["_i"]=++i;if(node===te){ci=i;}}}return ci;};var _3c4=function(elem){return !((_3bb(elem))%2);};var _3c6=function(elem){return ((_3bb(elem))%2);};var _3c8={"checked":function(name,_3ca){return function(elem){return !!d.attr(elem,"checked");};},"first-child":function(){return _3b7;},"last-child":function(){return _3b9;},"only-child":function(name,_3cd){return function(node){if(!_3b7(node)){return false;}if(!_3b9(node)){return false;}return true;};},"empty":function(name,_3d0){return function(elem){var cn=elem.childNodes;var cnl=elem.childNodes.length;for(var x=cnl-1;x>=0;x--){var nt=cn[x].nodeType;if((nt===1)||(nt==3)){return false;}}return true;};},"contains":function(name,_3d7){var cz=_3d7.charAt(0);if(cz=="\""||cz=="'"){_3d7=_3d7.slice(1,-1);}return function(elem){return (elem.innerHTML.indexOf(_3d7)>=0);};},"not":function(name,_3db){var p=_371(_3db)[0];var _3dd={el:1};if(p.tag!="*"){_3dd.tag=1;}if(!p.classes.length){_3dd.classes=1;}var ntf=_3df(p,_3dd);return function(elem){return (!ntf(elem));};},"nth-child":function(name,_3e2){var pi=parseInt;if(_3e2=="odd"){return _3c6;}else{if(_3e2=="even"){return _3c4;}}if(_3e2.indexOf("n")!=-1){var _3e4=_3e2.split("n",2);var pred=_3e4[0]?((_3e4[0]=="-")?-1:pi(_3e4[0])):1;var idx=_3e4[1]?pi(_3e4[1]):0;var lb=0,ub=-1;if(pred>0){if(idx<0){idx=(idx%pred)&&(pred+(idx%pred));}else{if(idx>0){if(idx>=pred){lb=idx-idx%pred;}idx=idx%pred;}}}else{if(pred<0){pred*=-1;if(idx>0){ub=idx;idx=idx%pred;}}}if(pred>0){return function(elem){var i=_3bb(elem);return (i>=lb)&&(ub<0||i<=ub)&&((i%pred)==idx);};}else{_3e2=idx;}}var _3eb=pi(_3e2);return function(elem){return (_3bb(elem)==_3eb);};}};var _3ed=(d.isIE)?function(cond){var clc=cond.toLowerCase();if(clc=="class"){cond="className";}return function(elem){return (_36f?elem.getAttribute(cond):elem[cond]||elem[clc]);};}:function(cond){return function(elem){return (elem&&elem.getAttribute&&elem.hasAttribute(cond));};};var _3df=function(_3f3,_3f4){if(!_3f3){return _370;}_3f4=_3f4||{};var ff=null;if(!("el" in _3f4)){ff=_38d(ff,_394);}if(!("tag" in _3f4)){if(_3f3.tag!="*"){ff=_38d(ff,function(elem){return (elem&&(elem.tagName==_3f3.getTag()));});}}if(!("classes" in _3f4)){each(_3f3.classes,function(_3f7,idx,arr){var re=new RegExp("(?:^|\\s)"+_3f7+"(?:\\s|$)");ff=_38d(ff,function(elem){return re.test(elem.className);});ff.count=idx;});}if(!("pseudos" in _3f4)){each(_3f3.pseudos,function(_3fc){var pn=_3fc.name;if(_3c8[pn]){ff=_38d(ff,_3c8[pn](pn,_3fc.value));}});}if(!("attrs" in _3f4)){each(_3f3.attrs,function(attr){var _3ff;var a=attr.attr;if(attr.type&&_39a[attr.type]){_3ff=_39a[attr.type](a,attr.matchFor);}else{if(a.length){_3ff=_3ed(a);}}if(_3ff){ff=_38d(ff,_3ff);}});}if(!("id" in _3f4)){if(_3f3.id){ff=_38d(ff,function(elem){return (!!elem&&(elem.id==_3f3.id));});}}if(!ff){if(!("default" in _3f4)){ff=_370;}}return ff;};var _402=function(_403){return function(node,ret,bag){while(node=node[_ns]){if(_3b3&&(!_394(node))){continue;}if((!bag||_407(node,bag))&&_403(node)){ret.push(node);}break;}return ret;};};var _408=function(_409){return function(root,ret,bag){var te=root[_ns];while(te){if(_3b6(te)){if(bag&&!_407(te,bag)){break;}if(_409(te)){ret.push(te);}}te=te[_ns];}return ret;};};var _40e=function(_40f){_40f=_40f||_370;return function(root,ret,bag){var te,x=0,tret=root[_36d];while(te=tret[x++]){if(_3b6(te)&&(!bag||_407(te,bag))&&(_40f(te,x))){ret.push(te);}}return ret;};};var _416=function(node,root){var pn=node.parentNode;while(pn){if(pn==root){break;}pn=pn.parentNode;}return !!pn;};var _41a={};var _41b=function(_41c){var _41d=_41a[_41c.query];if(_41d){return _41d;}var io=_41c.infixOper;var oper=(io?io.oper:"");var _420=_3df(_41c,{el:1});var qt=_41c.tag;var _422=("*"==qt);var ecs=_36b()["getElementsByClassName"];if(!oper){if(_41c.id){_420=(!_41c.loops&&_422)?_370:_3df(_41c,{el:1,id:1});_41d=function(root,arr){var te=d.byId(_41c.id,(root.ownerDocument||root));if(!te||!_420(te)){return;}if(9==root.nodeType){return _390(te,arr);}else{if(_416(te,root)){return _390(te,arr);}}};}else{if(ecs&&/\{\s*\[native code\]\s*\}/.test(String(ecs))&&_41c.classes.length&&!_36c){_420=_3df(_41c,{el:1,classes:1,id:1});var _427=_41c.classes.join(" ");_41d=function(root,arr){var ret=_390(0,arr),te,x=0;var tret=root.getElementsByClassName(_427);while((te=tret[x++])){if(_420(te,root)){ret.push(te);}}return ret;};}else{if(!_422&&!_41c.loops){_41d=function(root,arr){var ret=_390(0,arr),te,x=0;var tret=root.getElementsByTagName(_41c.getTag());while((te=tret[x++])){ret.push(te);}return ret;};}else{_420=_3df(_41c,{el:1,tag:1,id:1});_41d=function(root,arr){var ret=_390(0,arr),te,x=0;var tret=root.getElementsByTagName(_41c.getTag());while((te=tret[x++])){if(_420(te,root)){ret.push(te);}}return ret;};}}}}else{var _43a={el:1};if(_422){_43a.tag=1;}_420=_3df(_41c,_43a);if("+"==oper){_41d=_402(_420);}else{if("~"==oper){_41d=_408(_420);}else{if(">"==oper){_41d=_40e(_420);}}}}return _41a[_41c.query]=_41d;};var _43b=function(root,_43d){var _43e=_390(root),qp,x,te,qpl=_43d.length,bag,ret;for(var i=0;i<qpl;i++){ret=[];qp=_43d[i];x=_43e.length-1;if(x>0){bag={};ret.nozip=true;}var gef=_41b(qp);while(te=_43e[x--]){gef(te,ret,bag);}if(!ret.length){break;}_43e=ret;}return ret;};var _447={},_448={};var _449=function(_44a){var _44b=_371(trim(_44a));if(_44b.length==1){var tef=_41b(_44b[0]);return function(root){var r=tef(root,new qlc());if(r){r.nozip=true;}return r;};}return function(root){return _43b(root,_44b);};};var nua=navigator.userAgent;var wk="WebKit/";var _452=(d.isWebKit&&(nua.indexOf(wk)>0)&&(parseFloat(nua.split(wk)[1])>528));var _453=d.isIE?"commentStrip":"nozip";var qsa="querySelectorAll";var _455=(!!_36b()[qsa]&&(!d.isSafari||(d.isSafari>3.1)||_452));var _456=function(_457,_458){if(_455){var _459=_448[_457];if(_459&&!_458){return _459;}}var _45a=_447[_457];if(_45a){return _45a;}var qcz=_457.charAt(0);var _45c=(-1==_457.indexOf(" "));if((_457.indexOf("#")>=0)&&(_45c)){_458=true;}var _45d=(_455&&(!_458)&&(_36e.indexOf(qcz)==-1)&&(!d.isIE||(_457.indexOf(":")==-1))&&(!(_36c&&(_457.indexOf(".")>=0)))&&(_457.indexOf(":contains")==-1)&&(_457.indexOf("|=")==-1));if(_45d){var tq=(_36e.indexOf(_457.charAt(_457.length-1))>=0)?(_457+" *"):_457;return _448[_457]=function(root){try{if(!((9==root.nodeType)||_45c)){throw "";}var r=root[qsa](tq);r[_453]=true;return r;}catch(e){return _456(_457,true)(root);}};}else{var _461=_457.split(/\s*,\s*/);return _447[_457]=((_461.length<2)?_449(_457):function(root){var _463=0,ret=[],tp;while((tp=_461[_463++])){ret=ret.concat(_449(tp)(root));}return ret;});}};var _466=0;var _467=d.isIE?function(node){if(_36f){return (node.getAttribute("_uid")||node.setAttribute("_uid",++_466)||_466);}else{return node.uniqueID;}}:function(node){return (node._uid||(node._uid=++_466));};var _407=function(node,bag){if(!bag){return 1;}var id=_467(node);if(!bag[id]){return bag[id]=1;}return 0;};var _46d="_zipIdx";var _zip=function(arr){if(arr&&arr.nozip){return (qlc._wrap)?qlc._wrap(arr):arr;}var ret=new qlc();if(!arr||!arr.length){return ret;}if(arr[0]){ret.push(arr[0]);}if(arr.length<2){return ret;}_466++;if(d.isIE&&_36f){var _471=_466+"";arr[0].setAttribute(_46d,_471);for(var x=1,te;te=arr[x];x++){if(arr[x].getAttribute(_46d)!=_471){ret.push(te);}te.setAttribute(_46d,_471);}}else{if(d.isIE&&arr.commentStrip){try{for(var x=1,te;te=arr[x];x++){if(_394(te)){ret.push(te);}}}catch(e){}}else{if(arr[0]){arr[0][_46d]=_466;}for(var x=1,te;te=arr[x];x++){if(arr[x][_46d]!=_466){ret.push(te);}te[_46d]=_466;}}}return ret;};d.query=function(_474,root){qlc=d._queryListCtor;if(!_474){return new qlc();}if(_474.constructor==qlc){return _474;}if(!_36a(_474)){return new qlc(_474);}if(_36a(root)){root=d.byId(root);if(!root){return new qlc();}}root=root||_36b();var od=root.ownerDocument||root.documentElement;_36f=(root.contentType&&root.contentType=="application/xml")||(d.isOpera&&(root.doctype||od.toString()=="[object XMLDocument]"))||(!!od)&&(d.isIE?od.xml:(root.xmlVersion||od.xmlVersion));var r=_456(_474)(root);if(r&&r.nozip&&!qlc._wrap){return r;}return _zip(r);};d.query.pseudos=_3c8;d._filterQueryResult=function(_478,_479){var _47a=new d._queryListCtor();var _47b=_3df(_371(_479)[0]);for(var x=0,te;te=_478[x];x++){if(_47b(te)){_47a.push(te);}}return _47a;};})(this["queryPortability"]||this["acme"]||dojo);}if(!dojo._hasResource["dojo._base.xhr"]){dojo._hasResource["dojo._base.xhr"]=true;dojo.provide("dojo._base.xhr");(function(){var _d=dojo;function _47f(obj,name,_482){var val=obj[name];if(_d.isString(val)){obj[name]=[val,_482];}else{if(_d.isArray(val)){val.push(_482);}else{obj[name]=_482;}}};dojo.formToObject=function(_484){var ret={};var _486="file|submit|image|reset|button|";_d.forEach(dojo.byId(_484).elements,function(item){var _in=item.name;var type=(item.type||"").toLowerCase();if(_in&&type&&_486.indexOf(type)==-1&&!item.disabled){if(type=="radio"||type=="checkbox"){if(item.checked){_47f(ret,_in,item.value);}}else{if(item.multiple){ret[_in]=[];_d.query("option",item).forEach(function(opt){if(opt.selected){_47f(ret,_in,opt.value);}});}else{_47f(ret,_in,item.value);if(type=="image"){ret[_in+".x"]=ret[_in+".y"]=ret[_in].x=ret[_in].y=0;}}}}});return ret;};dojo.objectToQuery=function(map){var enc=encodeURIComponent;var _48d=[];var _48e={};for(var name in map){var _490=map[name];if(_490!=_48e[name]){var _491=enc(name)+"=";if(_d.isArray(_490)){for(var i=0;i<_490.length;i++){_48d.push(_491+enc(_490[i]));}}else{_48d.push(_491+enc(_490));}}}return _48d.join("&");};dojo.formToQuery=function(_493){return _d.objectToQuery(_d.formToObject(_493));};dojo.formToJson=function(_494,_495){return _d.toJson(_d.formToObject(_494),_495);};dojo.queryToObject=function(str){var ret={};var qp=str.split("&");var dec=decodeURIComponent;_d.forEach(qp,function(item){if(item.length){var _49b=item.split("=");var name=dec(_49b.shift());var val=dec(_49b.join("="));if(_d.isString(ret[name])){ret[name]=[ret[name]];}if(_d.isArray(ret[name])){ret[name].push(val);}else{ret[name]=val;}}});return ret;};dojo._blockAsync=false;dojo._contentHandlers={text:function(xhr){return xhr.responseText;},json:function(xhr){return _d.fromJson(xhr.responseText||null);},"json-comment-filtered":function(xhr){if(!dojo.config.useCommentedJson){console.warn("Consider using the standard mimetype:application/json."+" json-commenting can introduce security issues. To"+" decrease the chances of hijacking, use the standard the 'json' handler and"+" prefix your json with: {}&&\n"+"Use djConfig.useCommentedJson=true to turn off this message.");}var _4a1=xhr.responseText;var _4a2=_4a1.indexOf("/*");var _4a3=_4a1.lastIndexOf("*/");if(_4a2==-1||_4a3==-1){throw new Error("JSON was not comment filtered");}return _d.fromJson(_4a1.substring(_4a2+2,_4a3));},javascript:function(xhr){return _d.eval(xhr.responseText);},xml:function(xhr){var _4a6=xhr.responseXML;if(_d.isIE&&(!_4a6||!_4a6.documentElement)){var ms=function(n){return "MSXML"+n+".DOMDocument";};var dp=["Microsoft.XMLDOM",ms(6),ms(4),ms(3),ms(2)];_d.some(dp,function(p){try{var dom=new ActiveXObject(p);dom.async=false;dom.loadXML(xhr.responseText);_4a6=dom;}catch(e){return false;}return true;});}return _4a6;}};dojo._contentHandlers["json-comment-optional"]=function(xhr){var _4ad=_d._contentHandlers;if(xhr.responseText&&xhr.responseText.indexOf("/*")!=-1){return _4ad["json-comment-filtered"](xhr);}else{return _4ad["json"](xhr);}};dojo._ioSetArgs=function(args,_4af,_4b0,_4b1){var _4b2={args:args,url:args.url};var _4b3=null;if(args.form){var form=_d.byId(args.form);var _4b5=form.getAttributeNode("action");_4b2.url=_4b2.url||(_4b5?_4b5.value:null);_4b3=_d.formToObject(form);}var _4b6=[{}];if(_4b3){_4b6.push(_4b3);}if(args.content){_4b6.push(args.content);}if(args.preventCache){_4b6.push({"dojo.preventCache":new Date().valueOf()});}_4b2.query=_d.objectToQuery(_d.mixin.apply(null,_4b6));_4b2.handleAs=args.handleAs||"text";var d=new _d.Deferred(_4af);d.addCallbacks(_4b0,function(_4b8){return _4b1(_4b8,d);});var ld=args.load;if(ld&&_d.isFunction(ld)){d.addCallback(function(_4ba){return ld.call(args,_4ba,_4b2);});}var err=args.error;if(err&&_d.isFunction(err)){d.addErrback(function(_4bc){return err.call(args,_4bc,_4b2);});}var _4bd=args.handle;if(_4bd&&_d.isFunction(_4bd)){d.addBoth(function(_4be){return _4bd.call(args,_4be,_4b2);});}d.ioArgs=_4b2;return d;};var _4bf=function(dfd){dfd.canceled=true;var xhr=dfd.ioArgs.xhr;var _at=typeof xhr.abort;if(_at=="function"||_at=="object"||_at=="unknown"){xhr.abort();}var err=dfd.ioArgs.error;if(!err){err=new Error("xhr cancelled");err.dojoType="cancel";}return err;};var _4c4=function(dfd){var ret=_d._contentHandlers[dfd.ioArgs.handleAs](dfd.ioArgs.xhr);return ret===undefined?null:ret;};var _4c7=function(_4c8,dfd){console.error(_4c8);return _4c8;};var _4ca=null;var _4cb=[];var _4cc=function(){var now=(new Date()).getTime();if(!_d._blockAsync){for(var i=0,tif;i<_4cb.length&&(tif=_4cb[i]);i++){var dfd=tif.dfd;var func=function(){if(!dfd||dfd.canceled||!tif.validCheck(dfd)){_4cb.splice(i--,1);}else{if(tif.ioCheck(dfd)){_4cb.splice(i--,1);tif.resHandle(dfd);}else{if(dfd.startTime){if(dfd.startTime+(dfd.ioArgs.args.timeout||0)<now){_4cb.splice(i--,1);var err=new Error("timeout exceeded");err.dojoType="timeout";dfd.errback(err);dfd.cancel();}}}}};if(dojo.config.debugAtAllCosts){func.call(this);}else{try{func.call(this);}catch(e){dfd.errback(e);}}}}if(!_4cb.length){clearInterval(_4ca);_4ca=null;return;}};dojo._ioCancelAll=function(){try{_d.forEach(_4cb,function(i){try{i.dfd.cancel();}catch(e){}});}catch(e){}};if(_d.isIE){_d.addOnWindowUnload(_d._ioCancelAll);}_d._ioWatch=function(dfd,_4d5,_4d6,_4d7){var args=dfd.ioArgs.args;if(args.timeout){dfd.startTime=(new Date()).getTime();}_4cb.push({dfd:dfd,validCheck:_4d5,ioCheck:_4d6,resHandle:_4d7});if(!_4ca){_4ca=setInterval(_4cc,50);}if(args.sync){_4cc();}};var _4d9="application/x-www-form-urlencoded";var _4da=function(dfd){return dfd.ioArgs.xhr.readyState;};var _4dc=function(dfd){return 4==dfd.ioArgs.xhr.readyState;};var _4de=function(dfd){var xhr=dfd.ioArgs.xhr;if(_d._isDocumentOk(xhr)){dfd.callback(dfd);}else{var err=new Error("Unable to load "+dfd.ioArgs.url+" status:"+xhr.status);err.status=xhr.status;err.responseText=xhr.responseText;dfd.errback(err);}};dojo._ioAddQueryToUrl=function(_4e2){if(_4e2.query.length){_4e2.url+=(_4e2.url.indexOf("?")==-1?"?":"&")+_4e2.query;_4e2.query=null;}};dojo.xhr=function(_4e3,args,_4e5){var dfd=_d._ioSetArgs(args,_4bf,_4c4,_4c7);dfd.ioArgs.xhr=_d._xhrObj(dfd.ioArgs.args);if(_4e5){if("postData" in args){dfd.ioArgs.query=args.postData;}else{if("putData" in args){dfd.ioArgs.query=args.putData;}}}else{_d._ioAddQueryToUrl(dfd.ioArgs);}var _4e7=dfd.ioArgs;var xhr=_4e7.xhr;xhr.open(_4e3,_4e7.url,args.sync!==true,args.user||undefined,args.password||undefined);if(args.headers){for(var hdr in args.headers){if(hdr.toLowerCase()==="content-type"&&!args.contentType){args.contentType=args.headers[hdr];}else{xhr.setRequestHeader(hdr,args.headers[hdr]);}}}xhr.setRequestHeader("Content-Type",args.contentType||_4d9);if(!args.headers||!args.headers["X-Requested-With"]){xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");}if(dojo.config.debugAtAllCosts){xhr.send(_4e7.query);}else{try{xhr.send(_4e7.query);}catch(e){dfd.ioArgs.error=e;dfd.cancel();}}_d._ioWatch(dfd,_4da,_4dc,_4de);xhr=null;return dfd;};dojo.xhrGet=function(args){return _d.xhr("GET",args);};dojo.rawXhrPost=dojo.xhrPost=function(args){return _d.xhr("POST",args,true);};dojo.rawXhrPut=dojo.xhrPut=function(args){return _d.xhr("PUT",args,true);};dojo.xhrDelete=function(args){return _d.xhr("DELETE",args);};})();}if(!dojo._hasResource["dojo._base.fx"]){dojo._hasResource["dojo._base.fx"]=true;dojo.provide("dojo._base.fx");(function(){var d=dojo;var _4ef=d.mixin;dojo._Line=function(_4f0,end){this.start=_4f0;this.end=end;};dojo._Line.prototype.getValue=function(n){return ((this.end-this.start)*n)+this.start;};d.declare("dojo._Animation",null,{constructor:function(args){_4ef(this,args);if(d.isArray(this.curve)){this.curve=new d._Line(this.curve[0],this.curve[1]);}},duration:350,repeat:0,rate:10,_percent:0,_startRepeatCount:0,_fire:function(evt,args){if(this[evt]){if(dojo.config.debugAtAllCosts){this[evt].apply(this,args||[]);}else{try{this[evt].apply(this,args||[]);}catch(e){console.error("exception in animation handler for:",evt);console.error(e);}}}return this;},play:function(_4f6,_4f7){var _t=this;if(_t._delayTimer){_t._clearTimer();}if(_4f7){_t._stopTimer();_t._active=_t._paused=false;_t._percent=0;}else{if(_t._active&&!_t._paused){return _t;}}_t._fire("beforeBegin");var de=_4f6||_t.delay,_p=dojo.hitch(_t,"_play",_4f7);if(de>0){_t._delayTimer=setTimeout(_p,de);return _t;}_p();return _t;},_play:function(_4fb){var _t=this;if(_t._delayTimer){_t._clearTimer();}_t._startTime=new Date().valueOf();if(_t._paused){_t._startTime-=_t.duration*_t._percent;}_t._endTime=_t._startTime+_t.duration;_t._active=true;_t._paused=false;var _4fd=_t.curve.getValue(_t._percent);if(!_t._percent){if(!_t._startRepeatCount){_t._startRepeatCount=_t.repeat;}_t._fire("onBegin",[_4fd]);}_t._fire("onPlay",[_4fd]);_t._cycle();return _t;},pause:function(){var _t=this;if(_t._delayTimer){_t._clearTimer();}_t._stopTimer();if(!_t._active){return _t;}_t._paused=true;_t._fire("onPause",[_t.curve.getValue(_t._percent)]);return _t;},gotoPercent:function(_4ff,_500){var _t=this;_t._stopTimer();_t._active=_t._paused=true;_t._percent=_4ff;if(_500){_t.play();}return _t;},stop:function(_502){var _t=this;if(_t._delayTimer){_t._clearTimer();}if(!_t._timer){return _t;}_t._stopTimer();if(_502){_t._percent=1;}_t._fire("onStop",[_t.curve.getValue(_t._percent)]);_t._active=_t._paused=false;return _t;},status:function(){if(this._active){return this._paused?"paused":"playing";}return "stopped";},_cycle:function(){var _t=this;if(_t._active){var curr=new Date().valueOf();var step=(curr-_t._startTime)/(_t._endTime-_t._startTime);if(step>=1){step=1;}_t._percent=step;if(_t.easing){step=_t.easing(step);}_t._fire("onAnimate",[_t.curve.getValue(step)]);if(_t._percent<1){_t._startTimer();}else{_t._active=false;if(_t.repeat>0){_t.repeat--;_t.play(null,true);}else{if(_t.repeat==-1){_t.play(null,true);}else{if(_t._startRepeatCount){_t.repeat=_t._startRepeatCount;_t._startRepeatCount=0;}}}_t._percent=0;_t._fire("onEnd");_t._stopTimer();}}return _t;},_clearTimer:function(){clearTimeout(this._delayTimer);delete this._delayTimer;}});var ctr=0,_508=[],_509=null,_50a={run:function(){}};dojo._Animation.prototype._startTimer=function(){if(!this._timer){this._timer=d.connect(_50a,"run",this,"_cycle");ctr++;}if(!_509){_509=setInterval(d.hitch(_50a,"run"),this.rate);}};dojo._Animation.prototype._stopTimer=function(){if(this._timer){d.disconnect(this._timer);this._timer=null;ctr--;}if(ctr<=0){clearInterval(_509);_509=null;ctr=0;}};var _50b=d.isIE?function(node){var ns=node.style;if(!ns.width.length&&d.style(node,"width")=="auto"){ns.width="auto";}}:function(){};dojo._fade=function(args){args.node=d.byId(args.node);var _50f=_4ef({properties:{}},args),_510=(_50f.properties.opacity={});_510.start=!("start" in _50f)?function(){return +d.style(_50f.node,"opacity")||0;}:_50f.start;_510.end=_50f.end;var anim=d.animateProperty(_50f);d.connect(anim,"beforeBegin",d.partial(_50b,_50f.node));return anim;};dojo.fadeIn=function(args){return d._fade(_4ef({end:1},args));};dojo.fadeOut=function(args){return d._fade(_4ef({end:0},args));};dojo._defaultEasing=function(n){return 0.5+((Math.sin((n+1.5)*Math.PI))/2);};var _515=function(_516){this._properties=_516;for(var p in _516){var prop=_516[p];if(prop.start instanceof d.Color){prop.tempColor=new d.Color();}}};_515.prototype.getValue=function(r){var ret={};for(var p in this._properties){var prop=this._properties[p],_51d=prop.start;if(_51d instanceof d.Color){ret[p]=d.blendColors(_51d,prop.end,r,prop.tempColor).toCss();}else{if(!d.isArray(_51d)){ret[p]=((prop.end-_51d)*r)+_51d+(p!="opacity"?prop.units||"px":0);}}}return ret;};dojo.animateProperty=function(args){args.node=d.byId(args.node);if(!args.easing){args.easing=d._defaultEasing;}var anim=new d._Animation(args);d.connect(anim,"beforeBegin",anim,function(){var pm={};for(var p in this.properties){if(p=="width"||p=="height"){this.node.display="block";}var prop=this.properties[p];prop=pm[p]=_4ef({},(d.isObject(prop)?prop:{end:prop}));if(d.isFunction(prop.start)){prop.start=prop.start();}if(d.isFunction(prop.end)){prop.end=prop.end();}var _523=(p.toLowerCase().indexOf("color")>=0);function _524(node,p){var v={height:node.offsetHeight,width:node.offsetWidth}[p];if(v!==undefined){return v;}v=d.style(node,p);return (p=="opacity")?+v:(_523?v:parseFloat(v));};if(!("end" in prop)){prop.end=_524(this.node,p);}else{if(!("start" in prop)){prop.start=_524(this.node,p);}}if(_523){prop.start=new d.Color(prop.start);prop.end=new d.Color(prop.end);}else{prop.start=(p=="opacity")?+prop.start:parseFloat(prop.start);}}this.curve=new _515(pm);});d.connect(anim,"onAnimate",d.hitch(d,"style",anim.node));return anim;};dojo.anim=function(node,_529,_52a,_52b,_52c,_52d){return d.animateProperty({node:node,duration:_52a||d._Animation.prototype.duration,properties:_529,easing:_52b,onEnd:_52c}).play(_52d||0);};})();}if(!dojo._hasResource["dojo._base.browser"]){dojo._hasResource["dojo._base.browser"]=true;dojo.provide("dojo._base.browser");dojo.forEach(dojo.config.require,function(i){dojo["require"](i);});}if(!dojo._hasResource["dojo.regexp"]){dojo._hasResource["dojo.regexp"]=true;dojo.provide("dojo.regexp");dojo.regexp.escapeString=function(str,_530){return str.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(ch){if(_530&&_530.indexOf(ch)!=-1){return ch;}return "\\"+ch;});};dojo.regexp.buildGroupRE=function(arr,re,_534){if(!(arr instanceof Array)){return re(arr);}var b=[];for(var i=0;i<arr.length;i++){b.push(re(arr[i]));}return dojo.regexp.group(b.join("|"),_534);};dojo.regexp.group=function(_537,_538){return "("+(_538?"?:":"")+_537+")";};}if(!dojo._hasResource["dojo.cookie"]){dojo._hasResource["dojo.cookie"]=true;dojo.provide("dojo.cookie");dojo.cookie=function(name,_53a,_53b){var c=document.cookie;if(arguments.length==1){var _53d=c.match(new RegExp("(?:^|; )"+dojo.regexp.escapeString(name)+"=([^;]*)"));return _53d?decodeURIComponent(_53d[1]):undefined;}else{_53b=_53b||{};var exp=_53b.expires;if(typeof exp=="number"){var d=new Date();d.setTime(d.getTime()+exp*24*60*60*1000);exp=_53b.expires=d;}if(exp&&exp.toUTCString){_53b.expires=exp.toUTCString();}_53a=encodeURIComponent(_53a);var _540=name+"="+_53a,_541;for(_541 in _53b){_540+="; "+_541;var _542=_53b[_541];if(_542!==true){_540+="="+_542;}}document.cookie=_540;}};dojo.cookie.isSupported=function(){if(!("cookieEnabled" in navigator)){this("__djCookieTest__","CookiesAllowed");navigator.cookieEnabled=this("__djCookieTest__")=="CookiesAllowed";if(navigator.cookieEnabled){this("__djCookieTest__","",{expires:-1});}}return navigator.cookieEnabled;};}if(!dojo._hasResource["dojo.fx.easing"]){dojo._hasResource["dojo.fx.easing"]=true;dojo.provide("dojo.fx.easing");dojo.fx.easing={linear:function(n){return n;},quadIn:function(n){return Math.pow(n,2);},quadOut:function(n){return n*(n-2)*-1;},quadInOut:function(n){n=n*2;if(n<1){return Math.pow(n,2)/2;}return -1*((--n)*(n-2)-1)/2;},cubicIn:function(n){return Math.pow(n,3);},cubicOut:function(n){return Math.pow(n-1,3)+1;},cubicInOut:function(n){n=n*2;if(n<1){return Math.pow(n,3)/2;}n-=2;return (Math.pow(n,3)+2)/2;},quartIn:function(n){return Math.pow(n,4);},quartOut:function(n){return -1*(Math.pow(n-1,4)-1);},quartInOut:function(n){n=n*2;if(n<1){return Math.pow(n,4)/2;}n-=2;return -1/2*(Math.pow(n,4)-2);},quintIn:function(n){return Math.pow(n,5);},quintOut:function(n){return Math.pow(n-1,5)+1;},quintInOut:function(n){n=n*2;if(n<1){return Math.pow(n,5)/2;}n-=2;return (Math.pow(n,5)+2)/2;},sineIn:function(n){return -1*Math.cos(n*(Math.PI/2))+1;},sineOut:function(n){return Math.sin(n*(Math.PI/2));},sineInOut:function(n){return -1*(Math.cos(Math.PI*n)-1)/2;},expoIn:function(n){return (n==0)?0:Math.pow(2,10*(n-1));},expoOut:function(n){return (n==1)?1:(-1*Math.pow(2,-10*n)+1);},expoInOut:function(n){if(n==0){return 0;}if(n==1){return 1;}n=n*2;if(n<1){return Math.pow(2,10*(n-1))/2;}--n;return (-1*Math.pow(2,-10*n)+2)/2;},circIn:function(n){return -1*(Math.sqrt(1-Math.pow(n,2))-1);},circOut:function(n){n=n-1;return Math.sqrt(1-Math.pow(n,2));},circInOut:function(n){n=n*2;if(n<1){return -1/2*(Math.sqrt(1-Math.pow(n,2))-1);}n-=2;return 1/2*(Math.sqrt(1-Math.pow(n,2))+1);},backIn:function(n){var s=1.70158;return Math.pow(n,2)*((s+1)*n-s);},backOut:function(n){n=n-1;var s=1.70158;return Math.pow(n,2)*((s+1)*n+s)+1;},backInOut:function(n){var s=1.70158*1.525;n=n*2;if(n<1){return (Math.pow(n,2)*((s+1)*n-s))/2;}n-=2;return (Math.pow(n,2)*((s+1)*n+s)+2)/2;},elasticIn:function(n){if(n==0||n==1){return n;}var p=0.3;var s=p/4;n=n-1;return -1*Math.pow(2,10*n)*Math.sin((n-s)*(2*Math.PI)/p);},elasticOut:function(n){if(n==0||n==1){return n;}var p=0.3;var s=p/4;return Math.pow(2,-10*n)*Math.sin((n-s)*(2*Math.PI)/p)+1;},elasticInOut:function(n){if(n==0){return 0;}n=n*2;if(n==2){return 1;}var p=0.3*1.5;var s=p/4;if(n<1){n-=1;return -0.5*(Math.pow(2,10*n)*Math.sin((n-s)*(2*Math.PI)/p));}n-=1;return 0.5*(Math.pow(2,-10*n)*Math.sin((n-s)*(2*Math.PI)/p))+1;},bounceIn:function(n){return (1-dojo.fx.easing.bounceOut(1-n));},bounceOut:function(n){var s=7.5625;var p=2.75;var l;if(n<(1/p)){l=s*Math.pow(n,2);}else{if(n<(2/p)){n-=(1.5/p);l=s*Math.pow(n,2)+0.75;}else{if(n<(2.5/p)){n-=(2.25/p);l=s*Math.pow(n,2)+0.9375;}else{n-=(2.625/p);l=s*Math.pow(n,2)+0.984375;}}}return l;},bounceInOut:function(n){if(n<0.5){return dojo.fx.easing.bounceIn(n*2)/2;}return (dojo.fx.easing.bounceOut(n*2-1)/2)+0.5;}};}if(!dojo._hasResource["bespin.bespin"]){dojo._hasResource["bespin.bespin"]=true;dojo.provide("bespin.bespin");dojo.mixin(bespin,{versionNumber:"0.4.4",versionCodename:"Bubba Ho-Tep",apiVersion:"4",defaultTabSize:4,userSettingsProject:"BespinSettings",_eventLog:{},_lazySubscriptionCount:0,_lazySubscriptionTimeout:{},publish:function(_56e,args){bespin._eventLog[_56e]=true;dojo.publish("bespin:"+_56e,dojo.isArray(args)?args:[args||{}]);},fireAfter:function(_570,_571){if(!dojo.isArray(_570)){throw new Error("fireAfter() takes an array of topics. '"+_570+"' is not an array.");}var _572=_570.length;var done=function(){if(_572==0){_571();}};for(var i=0;i<_570.length;++i){var _575=_570[i];if(bespin._eventLog[_575]){--_572;}else{bespin.subscribe(_575,function(){--_572;done();});}done();}},subscribe:function(_576,_577,_578){if(_578){var orig=_577;var _57a=this._lazySubscriptionCount++;var self=this;_577=function(){if(self._lazySubscriptionTimeout[_57a]){clearTimeout(self._lazySubscriptionTimeout[_57a]);}self._lazySubscriptionTimeout[_57a]=setTimeout(function(){orig.apply(self,arguments);delete self._lazySubscriptionTimeout[_57a];},_578);};}return dojo.subscribe("bespin:"+_576,_577);},unsubscribe:dojo.unsubscribe,registeredComponents:{},register:function(id,_57d){this.registeredComponents[id]=_57d;bespin.publish("component:register:"+id,{id:id,object:_57d});return _57d;},get:function(id){return this.registeredComponents[id];},unregister:function(id){delete this.registeredComponents[id];},withComponent:function(id,func){var _582=this.get(id);if(_582){return func(_582);}},getComponent:function(id,_584,_585){_585=_585||window;var _586=bespin.get(id);if(!_586){var _587=bespin.factories[id];if(!_587){return undefined;}_587(_584,_585);return false;}else{_584.call(_585,_586);}return true;},factories:{popup:function(_588,_589){bespin.plugins.loadOne("popup",function(_58a){var _58b=bespin.register("popup",new _58a.Window());_588.call(_589,_58b);});},piemenu:function(_58c,_58d){bespin.plugins.loadOne("piemenu",function(_58e){bespin.register("piemenu",new _58e.Window());setTimeout(function(){var _58f=bespin.get("piemenu");_58c.call(_58d,_58f);},25);});},commandLine:function(_590,_591){bespin.plugins.loadOne("commandLine",function(_592){var _593=bespin.register("commandLine",new _592.Interface("command",bespin.command.store));_590.call(_591,_593);});},debugbar:function(_594,_595){bespin.plugins.loadOne("debugbar",function(_596){var _597=bespin.register("debugbar",new _596.EvalCommandLineInterface("debugbar_command",null,{idPrefix:"debugbar_",parentElement:dojo.byId("debugbar")}));_594.call(_595,_597);});},breakpoints:function(_598,_599){bespin.plugins.loadOne("breakpoints",function(_59a){var _59b=bespin.register("breakpoints",new _59a());_598.call(_599,_59b);});}},displayVersion:function(el){el=dojo.byId(el)||dojo.byId("version");if(!el){return;}el.innerHTML="<a href=\"https://wiki.mozilla.org/Labs/Bespin/ReleaseNotes\" title=\"Read the release notes\">Version <span class=\"versionnumber\">"+this.versionNumber+"</span> \""+this.versionCodename+"\"</a>";},_subscribeToExtension:function(key){bespin.subscribe("extension:removed:"+key,function(){var item=bespin.get(key);if(item&&item.destroy){item.destroy();}bespin.unregister(key);});},_initializeReloaders:function(){for(var key in bespin.factories){bespin._subscribeToExtension(key);}}});bespin.subscribe("extension:loaded:bespin.subscribe",function(ext){var _5a1=bespin.subscribe(ext.topic,function(e){ext.load(function(func){func(e);});});ext.subscription=_5a1;});bespin.subscribe("extension:removed:bespin.subscribe",function(ext){if(ext.subscription){bespin.unsubscribe(ext.subscription);}});bespin._initializeReloaders();}if(!dojo._hasResource["bespin.command"]){dojo._hasResource["bespin.command"]=true;dojo.provide("bespin.command");dojo.declare("bespin.command.Store",null,{constructor:function(_5a5,_5a6){this.commands={};this.aliases={};if(_5a5){this.containerCommand=_5a6;this.parent=_5a5;_5a6.takes=["*"];_5a6.subcommands=this;_5a5.addCommand(_5a6);}},addCommand:function(_5a7){if(!_5a7){return;}_5a7.parent=this;this.commands[_5a7.name]=_5a7;if(_5a7.takes&&dojo.isArray(_5a7.takes)){_5a7=this.normalizeTakes(_5a7);}if(_5a7.withKey){bespin.fireAfter(["component:register:editor"],function(){bespin.get("editor").bindCommand(_5a7.name,_5a7.withKey);});}if(_5a7.aliases){dojo.forEach(_5a7.aliases,function(_5a8){this.aliases[_5a8]=_5a7.name;},this);}_5a7.getFullCommandName=function(){var name=this.name;if(this.parent){name=this.parent.getFullCommandName()+" "+name;}return dojo.trim(name);};if(!_5a7.findCompletions){_5a7.findCompletions=function(_5aa,_5ab){_5aa.hint=this.completeText;_5ab(_5aa);};}},removeCommand:function(_5ac){if(!_5ac){return;}delete this.commands[_5ac.name];},getFullCommandName:function(){var name=this.containerCommand?this.containerCommand.name:"";if(this.parent){name=this.parent.getFullCommandName()+" "+name;}return dojo.trim(name);},filterOptionsByPrefix:function(_5ae,_5af){return _5ae.filter(function(_5b0){return _5b0.substr(0,_5af.length)===_5af;});},findCommand:function(_5b1){var _5b2=dojo.trim(_5b1).split(/\s+/);var _5b3=_5b2.shift();var _5b4=this.commands[_5b3]||this.commands[this.aliases[_5b3]];if(!_5b4){if(_5b2.length>0){return null;}else{return this;}}if(_5b4.subcommands){return _5b4.subcommands.findCommand(_5b2.join(" "));}else{return _5b4;}},findCompletions:function(_5b5,_5b6){if(_5b5.action.length>1){_5b5.error="No matches";_5b6(_5b5);return;}var _5b7=_5b5.action[0];if(_5b7.length==0&&this.parent==null){_5b6(_5b5);return;}var _5b8=[];for(var _5b9 in this.commands){if(_5b9.indexOf(_5b7)==0){_5b8.push(_5b9);}}for(var _5ba in this.aliases){if(_5ba.indexOf(_5b7)==0){_5b8.push(_5ba);}}if(_5b8.length==1){var _5bb=_5b8[0];var _5b9=this.commands[_5bb]||this.commands[this.aliases[_5bb]];if(this.commandTakesArgs(_5b9)){_5bb=_5bb+" ";}_5b5.autofill=_5b5.prefix+_5bb;_5b5.hint=_5b9.preview;}else{if(_5b8.length==0){_5b5.error="No matches";}else{_5b8.sort(function(a,b){return a.localeCompare(b);});_5b5.options=_5b8;}}_5b6(_5b5);return;},commandTakesArgs:function(_5be){return _5be.takes!=undefined;},getArgs:function(_5bf,_5c0){if(!_5c0.takes){return undefined;}var args;var _5c2=_5bf.join(" ");if(_5c0.takes["*"]){args=new bespin.util.TokenObject(_5c2);args.rawinput=_5c2;args.varargs=args.pieces;}else{if(_5c0.takes&&_5c0.takes.order.length<2){args=_5c2;}else{args=new bespin.util.TokenObject(_5c2,{params:_5c0.takes.order.join(" ")});args.rawinput=_5c2;}}return args;},normalizeTakes:function(_5c3){var _5c4=_5c3.takes;_5c3.takes={order:_5c4};dojo.forEach(_5c4,function(item){_5c3.takes[item]={"short":item[0]};});return _5c3;},getHelp:function(_5c6,_5c7){var _5c8=[];var _5c9,name;if(this.commands[_5c6]){_5c9=this.commands[_5c6];_5c8.push(_5c9["description"]?_5c9.description:_5c9.preview);}else{var _5cb=false;var _5cc="";if(this.containerCommand){_5cc=" for "+this.containerCommand.name;}if(_5c6){if(_5c6=="hidden"){_5c6="";_5cb=true;}_5c8.push("<h2>Commands starting with '"+_5c6+"':</h2>");}else{_5c8.push("<h2>Available Commands:</h2>");}var _5cd=[];for(name in this.commands){_5cd.push(name);}var _5ce=_5cd.sort();_5c8.push("<table>");for(var i=0;i<_5ce.length;i++){name=_5ce[i];_5c9=this.commands[name];if(!_5cb&&_5c9.hidden){continue;}if(_5c6&&name.indexOf(_5c6)!=0){continue;}var args=(_5c9.takes)?" ["+_5c9.takes.order.join("] [")+"]":"";_5c8.push("<tr>");_5c8.push("<th>"+name+"</th>");_5c8.push("<td>"+_5c9.preview+"</td>");_5c8.push("<td>"+args+"</td>");_5c8.push("</tr>");}_5c8.push("</table>");}var _5d1=_5c8.join("");if(_5c7&&_5c7.prefix){_5d1=_5c7.prefix+"<br/>"+_5d1;}if(_5c7&&_5c7.suffix){_5d1=_5d1+"<br/>"+_5c7.suffix;}return _5d1;}});dojo.mixin(bespin.command,{store:new bespin.command.Store(),executeExtensionCommand:function(){var args=arguments;var self=this;this.load(function(_5d4){_5d4.apply(self,args);});}});bespin.subscribe("extension:loaded:bespin.command",function(ext){ext.execute=bespin.command.executeExtensionCommand;bespin.command.store.addCommand(ext);});bespin.subscribe("extension:removed:bespin.command",function(ext){bespin.command.store.removeCommand(ext);});bespin.command.store.addCommand({name:"help",takes:["search"],preview:"show commands",description:"The <u>help</u> gives you access to the various commands in the Bespin system.<br/><br/>You can narrow the search of a command by adding an optional search params.<br/><br/>If you pass in the magic <em>hidden</em> parameter, you will find subtle hidden commands.<br/><br/>Finally, pass in the full name of a command and you can get the full description, which you just did to see this!",completeText:"optionally, narrow down the search",execute:function(_5d7,_5d8){var _5d9=this.parent.getHelp(_5d8,{prefix:"<h2>Welcome to Bespin - Code in the Cloud</h2><ul>"+"<li><a href='http://labs.mozilla.com/projects/bespin' target='_blank'>Home Page</a>"+"<li><a href='https://wiki.mozilla.org/Labs/Bespin' target='_blank'>Wiki</a>"+"<li><a href='https://wiki.mozilla.org/Labs/Bespin/UserGuide' target='_blank'>User Guide</a>"+"<li><a href='https://wiki.mozilla.org/Labs/Bespin/Tips' target='_blank'>Tips and Tricks</a>"+"<li><a href='https://wiki.mozilla.org/Labs/Bespin/FAQ' target='_blank'>FAQ</a>"+"<li><a href='https://wiki.mozilla.org/Labs/Bespin/DeveloperGuide' target='_blank'>Developers Guide</a>"+"</ul>",suffix:"For more information, see the <a href='https://wiki.mozilla.org/Labs/Bespin'>Bespin Wiki</a>."});_5d7.addOutput(_5d9);}});}if(!dojo._hasResource["bespin.util.util"]){dojo._hasResource["bespin.util.util"]=true;dojo.provide("bespin.util.util");bespin.util.queryToObject=function(str,_5db){var ret={};var qp=str.split(_5db);var dec=decodeURIComponent;dojo.forEach(qp,function(item){if(item.length){var _5e0=item.split("=");var name=dec(_5e0.shift());var val=dec(_5e0.join("="));if(dojo.isString(ret[name])){ret[name]=[ret[name]];}if(dojo.isArray(ret[name])){ret[name].push(val);}else{ret[name]=val;}}});return ret;};bespin.util.endsWith=function(str,end){return str.match(new RegExp(end+"$"));};bespin.util.include=function(_5e5,item){return dojo.indexOf(_5e5,item)>-1;};bespin.util.indexOfProperty=function(_5e7,_5e8,item){for(var i=0;i<_5e7.length;i++){if(_5e7[i][_5e8]==item){return i;}}return null;};bespin.util.last=function(_5eb){if(dojo.isArray(_5eb)){return _5eb[_5eb.length-1];}};bespin.util.shrinkArray=function(_5ec){var _5ed=[];var _5ee=true;dojo.forEach(_5ec.reverse(),function(item){if(_5ee&&item===undefined){return;}_5ee=false;_5ed.push(item);});return _5ed.reverse();};bespin.util.makeArray=function(_5f0,_5f1){if(_5f0<1){return [];}if(!_5f1){_5f1=" ";}var _5f2=[];for(var i=0;i<_5f0;i++){_5f2.push(_5f1);}return _5f2;};bespin.util.repeatString=function(_5f4,_5f5){var _5f6="";for(var i=0;i<_5f5;i++){_5f6+=_5f4;}return _5f6;};bespin.util.leadingSpaces=function(row){var _5f9=0;for(var i=0;i<row.length;i++){if(row[i]==" "||row[i]==""||row[i]===undefined){_5f9++;}else{return _5f9;}}return _5f9;};bespin.util.leadingTabs=function(row){var _5fc=0;for(var i=0;i<row.length;i++){if(row[i]=="\t"||row[i]==""||row[i]===undefined){_5fc++;}else{return _5fc;}}return _5fc;};bespin.util.leadingWhitespace=function(row){var _5ff=[];for(var i=0;i<row.length;i++){if(row[i]==" "||row[i]=="\t"||row[i]==""||row[i]===undefined){_5ff.push(row[i]);}else{return _5ff;}}return _5ff;};bespin.util.englishFromCamel=function(_601){dojo.trim(_601.replace(/([A-Z])/g,function(str){return " "+str.toLowerCase();}));};bespin.util.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"};bespin.util.isMac=function(){return navigator.appVersion.indexOf("Mac")>=0;};bespin.util.isLinux=function(){return navigator.appVersion.indexOf("Linux")>=0;};bespin.util.isWindows=function(){return navigator.appVersion.indexOf("Win")>=0;};bespin.util.getOS=function(){if(bespin.util.isMac()){return bespin.util.OS["MAC"];}else{if(bespin.util.isLinux()){return bespin.util.OS["LINUX"];}else{return bespin.util.OS["WINDOWS"];}}};bespin.util.contains=document.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)&16;}:function(a,b){return a!==b&&(a.contains?a.contains(b):true);};bespin.util.randomPassword=function(_607){_607=_607||16;var _608="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";var pass="";for(var x=0;x<_607;x++){var _60b=Math.floor(Math.random()*_608.length);pass+=_608.charAt(_60b);}return pass;};bespin.util.isEmpty=function(_60c){for(var x in _60c){if(_60c.hasOwnProperty(x)){return false;}}return true;};bespin.util.isMyProject=function(_60e){return _60e.indexOf("+")==-1;};}if(!dojo._hasResource["bespin.events"]){dojo._hasResource["bespin.events"]=true;dojo.provide("bespin.events");bespin.events.toFire=function(_60f){var _610={};if(_60f.indexOf(";")<0){_610.name=_60f;}else{var _611=_60f.split(";");_610.name=_611[0];_610.args=bespin.util.queryToObject(_611[1],",");}return _610;};bespin.events.defaultScope=function(){if(bespin.events._defaultScope){return bespin.events._defaultScope;}var _612={bespin:bespin,include:function(file){bespin.get("files").evalFile(bespin.userSettingsProject,file);},tryTocopyComponent:function(id){bespin.withComponent(id,dojo.hitch(this,function(_615){this.id=_615;}));},require:dojo.require,publish:bespin.publish,subscribe:bespin.subscribe};bespin.withComponent("commandLine",function(_616){_612.commandLine=_616;_612.execute=function(cmd){_616.executeCommand(cmd);};});_612.tryTocopyComponent("editor");_612.tryTocopyComponent("editSession");_612.tryTocopyComponent("files");_612.tryTocopyComponent("server");_612.tryTocopyComponent("toolbar");bespin.events._defaultScope=_612;return bespin.events._defaultScope;};}if(!dojo._hasResource["bespin.util.canvas"]){dojo._hasResource["bespin.util.canvas"]=true;dojo.provide("bespin.util.canvas");dojo.mixin(bespin.util.canvas,{fix:function(ctx){if(!ctx.fillText&&ctx.mozDrawText){ctx.fillText=function(_619,x,y,_61c){ctx.translate(x,y);ctx.mozTextStyle=ctx.font;ctx.mozDrawText(_619);ctx.translate(-x,-y);};}if(!ctx.measureText&&ctx.mozMeasureText){ctx.measureText=function(text){if(ctx.font){ctx.mozTextStyle=ctx.font;}var _61e=ctx.mozMeasureText(text);return {width:_61e};};}if(ctx.measureText&&!ctx.html5MeasureText){ctx.html5MeasureText=ctx.measureText;ctx.measureText=function(text){var _620=ctx.html5MeasureText(text);_620.ascent=ctx.html5MeasureText("m").width;return _620;};}if(!ctx.fillText){ctx.fillText=function(){};}if(!ctx.measureText){ctx.measureText=function(){return 10;};}return ctx;}});}if(!dojo._hasResource["bespin.util.keys"]){dojo._hasResource["bespin.util.keys"]=true;dojo.provide("bespin.util.keys");(function(){bespin.util.keys.Key={ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,FORWARD_SLASH:191,TILDE:192,SQUARE_BRACKET_OPEN:219,BACK_SLASH:220,SQUARE_BRACKET_CLOSE:221};dojo.mixin(bespin.util.keys.Key,dojo.keys);var keys=bespin.util.keys.Key;bespin.util.keys.KeyCodeToName={};for(var key in keys){var _623=keys[key];if(typeof _623=="number"){bespin.util.keys.KeyCodeToName[_623]=key;}}})();bespin.util.keys.toKeyCode=function(_624){return bespin.util.keys.Key[_624.toUpperCase()];};bespin.util.keys.fillArguments=function(_625,args){var keys=_625.split(" ");args=args||{};args.key=keys.pop();if(keys.length==0){args.modifiers="none";}else{args.modifiers=keys.join(",");}return args;};bespin.util.keys.PassThroughCharCodes=dojo.map(["k","l","n","o","t","w","+","-","~","0","1","2","3","4","5","6","7","8","9"],function(item){return item.charCodeAt(0);});bespin.util.keys.PassThroughKeyCodes=(function(){var Key=bespin.util.keys.Key;return [Key.C,Key.X,Key.V,Key.K,Key.L,Key.N,Key.O,Key.T,Key.W,Key.NUMPAD_PLUS,Key.NUMPAD_MINUS,Key.TILDE,Key.ZERO,Key.ONE,Key.TWO,Key.THREE,Key.FOUR,Key.FIVE,Key.SIX,Key.SEVEN,Key.EIGHT,Key.NINE];})();bespin.util.keys.passThroughToBrowser=function(e){var Key=bespin.util.keys.Key;if(!e.ctrlKey){return true;}else{if(e.metaKey||e.altKey||e.ctrlKey){if(e.type=="keypress"){var _62c=dojo.some(bespin.util.keys.PassThroughCharCodes,function(item){return (item==e.charCode);});if(_62c){return true;}}else{var _62c=dojo.some(bespin.util.keys.PassThroughKeyCodes,function(item){return (item==e.keyCode);});if(_62c){return true;}}}}return false;};}if(!dojo._hasResource["bespin.util.navigate"]){dojo._hasResource["bespin.util.navigate"]=true;dojo.provide("bespin.util.navigate");(function(){var go=function(url,_631){if(_631){window.open(url,"_blank");}else{location.href=url;}};dojo.mixin(bespin.util.navigate,{home:function(_632){go("index.html",_632);},quickEdit:function(_633){go("editor.html#new=true",_633);},editor:function(_634,path,opts){var url="editor.html#";var args=[];if(_634){args.push("project="+_634);}if(path){args.push("path="+path);}if(!opts){opts={};}if(opts.newFile){args.push("new=true");}if(opts.content){args.push("content="+escape(opts.content));}if(args.length>0){url+=args.join("&");}go(url,opts.newTab);}});})();}if(!dojo._hasResource["bespin.util.path"]){dojo._hasResource["bespin.util.path"]=true;dojo.provide("bespin.util.path");dojo.mixin(bespin.util.path,{combine:function(){var args=Array.prototype.slice.call(arguments);var path=args.join("/");path=path.replace(/\/\/+/g,"/");path=path.replace(/^\s+|\s+$/g,"");return path;},directory:function(path){var dirs=path.split("/");if(dirs.length==1){return "";}else{if((dirs.length==2)&&dirs[dirs.length-1]==""){return path;}else{return dirs.slice(0,dirs.length-1).join("/");}}},makeDirectory:function(path){if(!/\/$/.test(path)){path+="/";}return path;},combineAsDirectory:function(){return this.makeDirectory(this.combine.apply(this,arguments));},escape:function(){return escape(this.combine.apply(this,arguments));},trimLeadingSlash:function(path){if(path.indexOf("/")==0){path=path.substring(1,path.length);}return path;},fileType:function(path){if(path.indexOf(".")>=0){var _640=path.split(".");if(_640.length>1){return _640[_640.length-1];}}}});}if(!dojo._hasResource["bespin.util.tokenobject"]){dojo._hasResource["bespin.util.tokenobject"]=true;dojo.provide("bespin.util.tokenobject");dojo.declare("bespin.util.TokenObject",null,{constructor:function(_641,_642){this._input=_641;this._options=_642||{};this._splitterRegex=new RegExp(this._options.splitBy||"\\s+");this.pieces=this.tokenize(_641.split(this._splitterRegex));if(this._options.params){this._nametoindex={};var _643=this._options.params.split(" ");for(var x=0;x<_643.length;x++){this._nametoindex[_643[x]]=x;if(!this._options["noshortcutvalues"]){this[_643[x]]=this.pieces[x];}}}},tokenize:function(_645){var _646=[];var _647;while(_647=_645.shift()){if(_647[0]=="\""||_647[0]=="'"){var _648=[_647.substring(1,_647.length)];var _649;while(_649=_645.shift()){if(_649[_649.length-1]=="\""||_649[_649.length-1]=="'"){_648.push(_649.substring(0,_649.length-1));break;}else{_648.push(_649);}}_646.push(_648.join(" "));}else{_646.push(_647);}}return _646;},param:function(_64a){return (typeof _64a=="number")?this.pieces[_64a]:this.pieces[this._nametoindex[_64a]];},length:function(){return this.pieces.length;}});}if(!dojo._hasResource["bespin.util.mousewheelevent"]){dojo._hasResource["bespin.util.mousewheelevent"]=true;dojo.provide("bespin.util.mousewheelevent");dojo.mixin(bespin.util.mousewheelevent,{wheel:function(_64b){var _64c=0;if(!_64b){_64b=window.event;}if(_64b.wheelDelta){_64c=-_64b.wheelDelta/40;if(window.opera&&window.opera.version()<9.2){_64c=-_64c;}}else{if(_64b.detail){_64c=_64b.detail;}}return _64c;},axis:function(_64d){var _64e="vertical";if(_64d.axis){if(_64d.axis==_64d.HORIZONTAL_AXIS){_64e="horizontal";}}else{if(_64d.wheelDeltaY||_64d.wheelDeltaX){if(_64d.wheelDeltaX==_64d.wheelDelta){_64e="horizontal";}}else{if(_64d.shiftKey){_64e="horizontal";}}}return _64e;}});}if(!dojo._hasResource["dojo.AdapterRegistry"]){dojo._hasResource["dojo.AdapterRegistry"]=true;dojo.provide("dojo.AdapterRegistry");dojo.AdapterRegistry=function(_64f){this.pairs=[];this.returnWrappers=_64f||false;};dojo.extend(dojo.AdapterRegistry,{register:function(name,_651,wrap,_653,_654){this.pairs[((_654)?"unshift":"push")]([name,_651,wrap,_653]);},match:function(){for(var i=0;i<this.pairs.length;i++){var pair=this.pairs[i];if(pair[1].apply(this,arguments)){if((pair[3])||(this.returnWrappers)){return pair[2];}else{return pair[2].apply(this,arguments);}}}throw new Error("No match found");},unregister:function(name){for(var i=0;i<this.pairs.length;i++){var pair=this.pairs[i];if(pair[0]==name){this.pairs.splice(i,1);return true;}}return false;}});}if(!dojo._hasResource["dijit._base.place"]){dojo._hasResource["dijit._base.place"]=true;dojo.provide("dijit._base.place");dijit.getViewport=function(){var _65a=(dojo.doc.compatMode=="BackCompat")?dojo.body():dojo.doc.documentElement;var _65b=dojo._docScroll();return {w:_65a.clientWidth,h:_65a.clientHeight,l:_65b.x,t:_65b.y};};dijit.placeOnScreen=function(node,pos,_65e,_65f){var _660=dojo.map(_65e,function(_661){var c={corner:_661,pos:{x:pos.x,y:pos.y}};if(_65f){c.pos.x+=_661.charAt(1)=="L"?_65f.x:-_65f.x;c.pos.y+=_661.charAt(0)=="T"?_65f.y:-_65f.y;}return c;});return dijit._place(node,_660);};dijit._place=function(node,_664,_665){var view=dijit.getViewport();if(!node.parentNode||String(node.parentNode.tagName).toLowerCase()!="body"){dojo.body().appendChild(node);}var best=null;dojo.some(_664,function(_668){var _669=_668.corner;var pos=_668.pos;if(_665){_665(node,_668.aroundCorner,_669);}var _66b=node.style;var _66c=_66b.display;var _66d=_66b.visibility;_66b.visibility="hidden";_66b.display="";var mb=dojo.marginBox(node);_66b.display=_66c;_66b.visibility=_66d;var _66f=(_669.charAt(1)=="L"?pos.x:Math.max(view.l,pos.x-mb.w)),_670=(_669.charAt(0)=="T"?pos.y:Math.max(view.t,pos.y-mb.h)),endX=(_669.charAt(1)=="L"?Math.min(view.l+view.w,_66f+mb.w):pos.x),endY=(_669.charAt(0)=="T"?Math.min(view.t+view.h,_670+mb.h):pos.y),_673=endX-_66f,_674=endY-_670,_675=(mb.w-_673)+(mb.h-_674);if(best==null||_675<best.overflow){best={corner:_669,aroundCorner:_668.aroundCorner,x:_66f,y:_670,w:_673,h:_674,overflow:_675};}return !_675;});node.style.left=best.x+"px";node.style.top=best.y+"px";if(best.overflow&&_665){_665(node,best.aroundCorner,best.corner);}return best;};dijit.placeOnScreenAroundNode=function(node,_677,_678,_679){_677=dojo.byId(_677);var _67a=_677.style.display;_677.style.display="";var _67b=_677.offsetWidth;var _67c=_677.offsetHeight;var _67d=dojo.coords(_677,true);_677.style.display=_67a;return dijit._placeOnScreenAroundRect(node,_67d.x,_67d.y,_67b,_67c,_678,_679);};dijit.placeOnScreenAroundRectangle=function(node,_67f,_680,_681){return dijit._placeOnScreenAroundRect(node,_67f.x,_67f.y,_67f.width,_67f.height,_680,_681);};dijit._placeOnScreenAroundRect=function(node,x,y,_685,_686,_687,_688){var _689=[];for(var _68a in _687){_689.push({aroundCorner:_68a,corner:_687[_68a],pos:{x:x+(_68a.charAt(1)=="L"?0:_685),y:y+(_68a.charAt(0)=="T"?0:_686)}});}return dijit._place(node,_689,_688);};dijit.placementRegistry=new dojo.AdapterRegistry();dijit.placementRegistry.register("node",function(n,x){return typeof x=="object"&&typeof x.offsetWidth!="undefined"&&typeof x.offsetHeight!="undefined";},dijit.placeOnScreenAroundNode);dijit.placementRegistry.register("rect",function(n,x){return typeof x=="object"&&"x" in x&&"y" in x&&"width" in x&&"height" in x;},dijit.placeOnScreenAroundRectangle);dijit.placeOnScreenAroundElement=function(node,_690,_691,_692){return dijit.placementRegistry.match.apply(dijit.placementRegistry,arguments);};}if(!dojo._hasResource["bespin.util.webpieces"]){dojo._hasResource["bespin.util.webpieces"]=true;dojo.provide("bespin.util.webpieces");dojo.mixin(bespin.util.webpieces,{showCenterPopup:function(el,_694){if(_694){this.showOverlay();}dojo.style(el,"display","block");var _695=dojo.coords(el);var _696=dijit.getViewport();var y=(_696.h-_695.h)/2;var x=(_696.w-_695.w)/2;dojo.style(el,{position:"absolute",top:y+"px",left:x+"px"});},hideCenterPopup:function(el){dojo.style(el,"display","none");this.hideOverlay();},showOverlay:function(){dojo.style("overlay","display","block");},hideOverlay:function(){dojo.style("overlay","display","none");},fillScreenOverlay:function(){var _69a=dojo.coords(document.body);if(_69a.h){dojo.style(dojo.byId("overlay"),"height",_69a.h+"px");}},showStatus:function(msg){dojo.byId("status").innerHTML=msg;dojo.style("status","display","block");},showContentOverlay:function(msg,_69d){_69d=_69d||{};var el=dojo.byId("centerpopup");var _69f="";var _6a0="";if(_69d.pre){_69f=_69f+"<pre>";_6a0="</pre>"+_6a0;}el.innerHTML="<div style='background-color: #fff; border: 1px solid #000; height: 100%; overflow: auto'>"+_69f+msg+_6a0+"</div>";oldwidth=el.style.width;oldheight=el.style.height;el.style.width="80%";el.style.height="80%";bespin.util.webpieces.showCenterPopup(el);var _6a1=dojo.connect(el,"onclick",function(){bespin.util.webpieces.hideCenterPopup(el);el.style.width=oldwidth;el.style.height=oldheight;dojo.disconnect(_6a1);});}});}if(!dojo._hasResource["bespin.worker.worker"]){dojo._hasResource["bespin.worker.worker"]=true;dojo.provide("bespin.worker.worker");(function(){var _6a2=1;var _6a3=0;var _6a4=0;var _6a5=false;var _6a6=dojo.moduleUrl("bespin","bootstrap_worker.js");var _6a7=function(_6a8){return _6a6+"#"+escape(_6a8);};var _6a9=function(uri){return unescape(uri.substr((_6a6+"#").length));};var _6ab=true;dojo.declare("bespin.worker.WorkerFacade",null,{constructor:function(obj,_6ad,libs){this.__obj__=obj;var _6af={};this.__callbacks__=_6af;this.__workerCount__=_6ad||_6a2;this.__hasWorkers__=false;if(!_6ab){this.__hasWorkers__=true;var _6b0=this.createWorkerSource(obj,libs);var _6b1=this.createWorkers(_6b0);this.__workers__=_6b1;}this.createFacade(obj);},__getWorker__:function(){var _6b2=_6a3++%this.__workerCount__;return this.__workers__[_6b2];},createWorkers:function(_6b3){var self=this;var _6b5=[];var cb=function(_6b7){var data=_6b7.data;if(typeof data=="string"){data=dojo.fromJson(data);}var _6b9=data.callIndex;var _6ba=self.__callbacks__[_6b9];delete self.__callbacks__[_6b9];if(_6ba){_6ba(data.returnValue);}};var _6bb=function(_6bc,url){var _6be=this;bespin.get("server").request("GET",url,null,{onSuccess:function(src){_6be.postMessage("__IMPORT_SCRIPT__//"+_6bc+"\n"+src);}});};for(var i=0;i<this.__workerCount__;i++){var _6c1=new Worker(_6a6,_6b3);var _6c2=function(_6c3){var _6c4=_6c3.data;if(typeof _6c4=="string"){if(_6c4.indexOf("log=")==0){console.log("From Worker: "+_6c4.substr(4));return;}else{if(_6c4.indexOf("__IMPORT_SCRIPT__")==0){var json=_6c4.substr("__IMPORT_SCRIPT__".length);var _6c6=dojo.fromJson(json);_6bb.apply(this,_6c6);return;}else{_6c4=dojo.fromJson(_6c4);}}}if(_6c4.type=="subscribe"){(function(){var _6c7=_6c4.index;var name=_6c4.name;bespin.subscribe(name,function(_6c9){var ret={index:_6c7,name:name,event:_6c9};_6c1.postMessage(_6a5?ret:dojo.toJson(ret));});})();}else{if(_6c4.type=="publish"){bespin.publish(_6c4.name,_6c4.event);}else{throw _6c4;cb.call(this,_6c3);}}};_6c1.onmessage=_6c2;_6b3="// YOUcannotGuessMe\n"+_6b3;window.setTimeout(function(){_6c1.postMessage(_6b3);},0);_6b5.push(_6c1);}return _6b5;},createFacade:function(obj){var _6cc=this;for(var prop in obj){if(prop.charAt(0)!="_"){(function(){var val=obj[prop];var _6cf=prop;if(typeof val=="function"){_6cc[prop]=function(){var self=this;var _6d1=_6a4++;var _6d2=Array.prototype.slice.call(arguments);if(this.__hasWorkers__){var data={callIndex:_6d1,method:_6cf,paras:_6d2};if(!_6a5){data=dojo.toJson(data);}this.__getWorker__().postMessage(data);}else{var self=this;window.setTimeout(function(){var _6d4=self.__obj__[_6cf].apply(self.__obj__,_6d2);var _6d5=self.__callbacks__[_6d1];delete self.__callbacks__[_6d1];if(_6d5){_6d5(_6d4);}},0);}return {and:function(_6d6,_6d7,_6d8,_6d9){var func=arguments[arguments.length-1];if(_6d7 instanceof bespin.worker.Mutex){_6d7.start();func=function(){_6d9.apply(this,arguments);_6d7.stop();};}self.__callbacks__[_6d1]=function(){_6d8=Array.prototype.slice.call(arguments).concat(_6d8);func.apply(_6d6,_6d8);};}};};}else{}})();}}},hasFunctions:function(obj){for(var i in obj){var val=obj[i];if(typeof val=="function"){return true;}if(val&&typeof val=="object"){if(this.hasFunctions(val)){return true;}}}return false;},serializeToPortableSource:function(obj){var self=this;var _6e0=dojo.isArray(obj);var _6e1=_6e0?"[\n":"{\n";for(var prop in obj){(function(){if(prop=="_constructor"){return;}var val=obj[prop];var _6e4=prop;var src="";if(typeof val=="function"){src=val.toString();}else{if(val&&typeof val=="object"&&self.hasFunctions(val)){src=self.serializeToPortableSource(val);}else{src=dojo.toJson(val);}}prop="\""+prop.replace(/"/g,"\\\"","g")+"\"";_6e1+=_6e0?"":prop+": ";_6e1+=src+",\n";})();}_6e1+=_6e0?"]\n":"}\n";return _6e1;},createWorkerSource:function(obj,libs){var con=function(msg){postMessage("log="+msg);};var _6ea="";if(libs){var _6eb=[];dojo.forEach(libs,function(lib){_6eb.push("'"+lib+"'");});_6ea+="importScripts("+_6eb.join(", ")+");\n";}_6ea+="var theObject = "+this.serializeToPortableSource(obj);return _6ea;}});dojo.declare("bespin.worker.Mutex",null,{constructor:function(name,_6ee){this.name=name;this.count=0;this.afterJobs=[];this.options=_6ee||{};},start:function(){this.count=this.count+1;},stop:function(){this.count=this.count-1;if(this.count==0){if(this.options.onlyLast){var last=this.afterJobs[this.afterJobs.length-1];if(last){last();}}else{for(var i=0;i<this.afterJobs.length;++i){var job=this.afterJobs[i];job();}}this.afterJobs=[];}},after:function(_6f2,func){this.afterJobs.push(function(){func.call(_6f2);});}});function _6f4(){if(window.google&&google.gears){return;}var _6f5=null;if(typeof GearsFactory!="undefined"){_6f5=new GearsFactory();}else{try{_6f5=new ActiveXObject("Gears.Factory");if(_6f5.getBuildInfo().indexOf("ie_mobile")!=-1){_6f5.privateSetGlobalObject(this);}}catch(e){if(navigator.mimeTypes["application/x-googlegears"]){_6f5=document.createElement("object");_6f5.style.display="none";_6f5.width=0;_6f5.height=0;_6f5.type="application/x-googlegears";document.documentElement.appendChild(_6f5);}}}if(!_6f5){return;}if(!window.google){google={};}if(!google.gears){google.gears={factory:_6f5};}};})();}if(!dojo._hasResource["bespin.editor.actions"]){dojo._hasResource["bespin.editor.actions"]=true;dojo.provide("bespin.editor.actions");dojo.declare("bespin.editor.Actions",null,{constructor:function(_6f6){this.editor=_6f6;this.model=this.editor.model;this.cursorManager=this.editor.cursorManager;this.ignoreRepaints=false;this.currentEditItem=undefined;this.editDepth=0;},beginEdit:function(name){if(this.editDepth==0){this.currentEditItem=new bespin.editor.ActionHistoryItem(name,this.editor);this.currentEditItem.begin();}this.editDepth++;},endEdit:function(){if(this.editDepth<=0){return;}this.editDepth--;if(this.editDepth==0){this.currentEditItem.end();this.editor.historyManager.add(this.currentEditItem);this.currentEditItem=undefined;}},handleCursorSelection:function(args){if(args.event.shiftKey){if(!this.editor.selection){this.editor.setSelection({startPos:bespin.editor.utils.copyPos(args.pos)});}this.editor.setSelection({startPos:this.editor.selection.startPos,endPos:bespin.editor.utils.copyPos(this.cursorManager.getCursorPosition())});}else{this.editor.setSelection(undefined);}},moveCursor:function(_6f9,args){var _6fb=this.cursorManager[_6f9](args);this.handleCursorSelection(args);this.repaint();args.pos=_6fb.newPos;return args;},moveCursorLeft:function(args){return this.moveCursor("moveLeft",args);},moveCursorRight:function(args){return this.moveCursor("moveRight",args);},moveCursorUp:function(args){return this.moveCursor("moveUp",args);},moveCursorDown:function(args){return this.moveCursor("moveDown",args);},moveToLineStart:function(args){return this.moveCursor("moveToLineStart",args);},moveToLineEnd:function(args){return this.moveCursor("moveToLineEnd",args);},moveToFileTop:function(args){return this.moveCursor("moveToTop",args);},moveToFileBottom:function(args){return this.moveCursor("moveToBottom",args);},movePageUp:function(args){return this.moveCursor("movePageUp",args);},movePageDown:function(args){return this.moveCursor("movePageDown",args);},moveWordLeft:function(args){return this.moveCursor("smartMoveLeft",args);},moveWordRight:function(args){return this.moveCursor("smartMoveRight",args);},deleteWordLeft:function(args){this.beginEdit("deleteWordLeft");this.deleteChunk({endPos:args.pos,pos:this.moveCursor("smartMoveLeft",args).pos});this.endEdit();return args;},deleteWordRight:function(args){this.beginEdit("deleteWordRight");this.deleteChunk({pos:args.pos,endPos:this.moveCursor("smartMoveRight",args).pos});this.endEdit();return args;},applyState:function(_70a){if(this.testHistory.length==0){return;}else{if(_70a<0){_70a=-1;}else{if(_70a>=this.testHistory.length){return;}}}this.testHistoryPosition=_70a;var item=this.testHistory[Math.max(0,this.testHistoryPosition)];var _70c=item.after;var _70d=item.uiAfter;if(_70a<0){_70c=item.before;_70d=item.uiBefore;}this.model.applyState(_70c);this.editor.setState(_70d);},undo:function(){this.editor.historyManager.undo();},redo:function(){this.editor.historyManager.redo();},selectAll:function(args){if(this.model.isEmpty()){return;}args.startPos={row:0,col:0};args.endPos={row:this.model.getRowCount()-1,col:this.editor.ui.getRowScreenLength(this.model.getRowCount()-1)};this.select(args);},select:function(args){if(args.startPos){this.editor.setSelection({startPos:args.startPos,endPos:args.endPos});this.cursorManager.moveCursor(args.endPos);}else{this.editor.setSelection(undefined);}},insertTab:function(args){if(this.editor.readonly){return;}var _711=bespin.get("settings");if(this.editor.getSelection()&&!args.undoInsertTab){this.indent(args);return;}var tab=args.tab;var _713=this.cursorManager.getCharacterLength("\t");if(!tab||!_713){if(_711&&_711.isSettingOn("tabmode")){tab="\t";}else{tab="";var _714=_713;while(_714-->0){tab+=" ";}_713=tab.length;}}this.beginEdit("insertTab");delete this.editor.selection;this.model.insertCharacters(this.cursorManager.getModelPosition({row:args.pos.row,col:args.pos.col}),tab);this.cursorManager.moveCursor({row:args.pos.row,col:args.pos.col+_713});this.repaint();this.endEdit();},indent:function(args){this.beginEdit("indent");var _716=bespin.get("settings");var _717=this.editor.getSelection();var _718=false;if(_717===undefined){_718=true;var _719=this.editor.getCursorPos();var _71a=this.editor.getModelPos();_717={startPos:{row:_719.row,col:0},endPos:{row:_719.row,col:this.model.getRowMetadata(_719.row).lineLength},startModelPos:{row:_71a.row,col:0},endModelPos:{row:_71a.row,col:this.model.getRowMetadata(_71a.row).lineLengthWithoutTabExpansion}};this.editor.setSelection(_717);}var _71b=_717.startPos.row;var _71c=_717.endPos.row;var _71d=this.cursorManager.getStringLength(this.model.getRowArray(_71c).join(""));var _71e=this.cursorManager.getStringLength(this.model.getRowArray(args.pos.row).join(""));var _71f;var tab="";if(_716&&_716.isSettingOn("tabmode")){tab="\t";}else{var _721=this.editor.getTabSize();while(_721-->0){tab+=" ";}}for(var y=_71b;y<=_71c;y++){if(tab!="\t"){_71f=this.cursorManager.getLeadingWhitespace(y);_71f=this.cursorManager.getNextTablevelRight(_71f)-_71f;_71f=tab.substring(0,_71f);}else{_71f="\t";}this.model.insertCharacters(this.cursorManager.getModelPosition({row:y,col:0}),_71f);}var _723=this.cursorManager.getStringLength(this.model.getRowArray(args.pos.row).join(""))-_71e;_717.endPos.col+=this.cursorManager.getStringLength(this.model.getRowArray(_71c).join(""))-_71d;this.editor.setSelection(_717);this.cursorManager.moveCursor({col:args.pos.col+_723});if(_718){this.editor.setSelection(undefined);}this.repaint();this.endEdit();},unindent:function(args){this.beginEdit("unindent");var _725=this.editor.getSelection();var _726=false;if(_725===undefined){_726=true;var _727=this.editor.getCursorPos();var _728=this.editor.getModelPos();_725={startPos:{row:_727.row,col:0},endPos:{row:_727.row,col:this.model.getRowMetadata(_727.row).lineLength},startModelPos:{row:_728.row,col:0},endModelPos:{row:_728.row,col:this.model.getRowMetadata(_728.row).lineLengthWithoutTabExpansion}};this.editor.setSelection(_725);}var _729=_725.startPos.row;var _72a=_725.endPos.row;var _72b=this.cursorManager.getStringLength(this.model.getRowArray(_72a).join(""));var row=false;var _72d;var _72e;for(var y=_729;y<=_72a;y++){row=this.model.getRowArray(y);if(row.length>0&&row[0]=="\t"){_72d=1;_72e=this.editor.getTabSize();}else{var _730=this.cursorManager.getLeadingWhitespace(y);_72d=this.cursorManager.getContinuousSpaceCount(0,this.editor.getTabSize(),y);_72e=_72d;}if(_72d){this.model.deleteCharacters(this.cursorManager.getModelPosition({row:y,col:0}),_72d);}if(y==_729){_725.startPos.col=Math.max(0,_725.startPos.col-_72e);}if(y==_72a){if(!row){row=this.model.getRowArray(y);}var _731=_72b-this.cursorManager.getStringLength(row.join(""));_725.endPos.col=Math.max(0,_725.endPos.col-_731);args.pos.col=Math.max(0,args.pos.col-_731);}}this.editor.setSelection(_725);this.cursorManager.moveCursor({col:args.pos.col});if(_726){this.editor.setSelection(undefined);}this.repaint();this.endEdit();},cutSelection:function(args){if(this.editor.readonly){return;}this.beginEdit("cut");this.copySelection(args);this.deleteSelection(args);this.endEdit();},copySelection:function(args){var _734=this.editor.getSelection();if(_734){var _735=this.model.getChunk(_734);if(_735){bespin.editor.clipboard.Manual.copy(_735);}}},pasteFromClipboard:function(args){if(this.editor.readonly){return;}var _737=(args.clipboard)?args.clipboard:bespin.editor.clipboard.Manual.data();if(_737===undefined){return;}args.chunk=_737;this.beginEdit("paste");this.insertChunk(args);this.endEdit();},insertChunk:function(args){if(this.editor.readonly){return;}this.beginEdit("insertChunk");if(this.editor.selection){this.deleteSelection();}var pos=bespin.editor.utils.copyPos(this.cursorManager.getCursorPosition());pos=this.model.insertChunk(this.cursorManager.getModelPosition(pos),args.chunk);pos=this.cursorManager.getCursorPosition(pos);this.cursorManager.moveCursor(pos);this.repaint();this.endEdit();return pos;},deleteChunk:function(args){if(this.editor.readonly){return;}this.beginEdit("deleteChunk");var _73b=(args.startPos!=undefined)?args.startPos:bespin.editor.utils.copyPos(args.pos);var _73c=this.editor.getSelection({startPos:_73b,endPos:args.endPos});var _73d=this.model.deleteChunk(_73c);this.cursorManager.moveCursor(_73c.startPos);this.editor.setSelection(undefined);this.repaint();this.endEdit();return _73c.startPos;},joinLine:function(args){if(this.editor.readonly){return;}this.beginEdit("joinLine");if(args.joinDirection=="up"){if(args.pos.row==0){return;}var _73f=this.editor.ui.getRowScreenLength(args.pos.row-1);this.model.joinRow(args.pos.row-1);this.cursorManager.moveCursor({row:args.pos.row-1,col:_73f});}else{if(args.pos.row>=this.model.getRowCount()-1){return;}this.model.joinRow(args.pos.row);}this.endEdit();this.repaint();},killLine:function(args){if(this.editor.readonly){return;}this.beginEdit("killLine");this.editor.setSelection({startPos:{row:args.pos.row,col:0},endPos:{row:args.pos.row+1,col:0}});this.cutSelection(args);this.endEdit();},deleteSelection:function(args){if(this.editor.readonly){return;}var _742=this.editor.getSelection();return this.deleteChunk({startPos:_742.startPos,endPos:_742.endPos,clearSelection:true});},backspace:function(args){if(this.editor.readonly){return;}this.beginEdit("backspace");if(this.editor.selection){this.deleteSelection(args);}else{if(args.pos.col>0){var _744=bespin.get("settings");if(_744&&_744.isSettingOn("smartmove")){var _745=this.editor.getTabSize();var _746=this.cursorManager.getContinuousSpaceCount(args.pos.col,this.cursorManager.getNextTablevelLeft(args.pos.col));if(_746==_745){var pos=args.pos;this.editor.selection={startPos:{row:pos.row,col:pos.col-_745},endPos:{row:pos.row,col:pos.col}};this.deleteSelection(args);this.endEdit();return;}}if(_744&&_744.isSettingOn("closepairs")){var _748=["(","[","{","\"","'"];var _749=[")","]","}","\"","'"];var _74a=this.cursorManager.getModelPosition(args.pos);var row=this.model.getRowArray(_74a.row);var _74c="";if(_74a.col-1>=0){_74c=row[_74a.col-1];}if(_748.indexOf(_74c)>=0){var _74d=_749[_748.indexOf(_74c)];if(_74a.col<row.length&&row[_74a.col]==_74d){var pos=args.pos;this.editor.selection={startPos:{row:pos.row,col:pos.col-1},endPos:{row:pos.row,col:pos.col+1}};this.deleteSelection();this.endEdit();return;}}}this.cursorManager.moveCursor({col:Math.max(0,args.pos.col-1)});args.pos.col-=1;this.deleteCharacter(args);}else{args.joinDirection="up";this.joinLine(args);}}this.endEdit();},deleteKey:function(args){if(this.editor.readonly){return;}this.beginEdit("deleteKey");if(this.editor.selection){this.deleteSelection(args);}else{if(args.pos.col<this.editor.ui.getRowScreenLength(args.pos.row)){var _74f=bespin.get("settings");if(_74f&&_74f.isSettingOn("smartmove")){var _750=this.editor.getTabSize();var _751=this.cursorManager.getContinuousSpaceCount(args.pos.col,this.cursorManager.getNextTablevelRight(args.pos.col));if(_751==_750){var pos=args.pos;this.editor.selection={startPos:{row:pos.row,col:pos.col},endPos:{row:pos.row,col:pos.col+_750}};this.deleteSelection(args);this.endEdit();return;}}this.deleteCharacter(args);}else{args.joinDirection="down";this.joinLine(args);}}this.endEdit();},deleteCharacter:function(args){if(this.editor.readonly){return;}if(args.pos.col<this.editor.ui.getRowScreenLength(args.pos.row)){this.beginEdit("deleteCharacter");var _754=this.cursorManager.getModelPosition(args.pos);var _755=1;var _756=this.model.deleteCharacters(_754,_755);this.repaint();this.endEdit();}},newline:function(args){if(this.editor.readonly){return;}var _758=bespin.get("settings");if(_758&&_758.isSettingOn("autoindent")){var _759=bespin.util.leadingWhitespace(this.model.getRowArray(args.pos.row));}else{var _759=[];}args.chunk="\n"+_759.join("");this.insertChunk(args);},newlineBelow:function(args){this.newline(this.moveToLineEnd(args));},insertCharacter:function(args){if(this.editor.readonly){return;}this.beginEdit("insertCharacter");var pos=args.pos;if(this.editor.selection){pos=this.deleteSelection(args);}var _75d=false;var _75e=bespin.get("settings");if(_75e&&_75e.isSettingOn("closepairs")){var _75f=["(","[","{","\"","'"];var _760=[")","]","}","\"","'"];var _761=this.cursorManager.getModelPosition(pos);var row=this.model.getRowArray(_761.row);var _763=false;if(_761.col-1>=0&&row[_761.col-1]=="\\"){_763=true;}var _764=_760.indexOf(args.newchar);if(_764>=0){var _765=_760[_764];var _766=_75f[_764];var _767=0;if(row.length>=_761.col&&row[_761.col]==_765){var _768=0;for(var i=0;i<row.length;i++){if(row[i]==_766){_767++;_768++;}if(row[i]==_765){_767--;_768++;}}if(((_765!=_766&&_767==0)||(_765==_766&&_768%2==0))&&!_763){this.cursorManager.moveRight(true);_75d=true;}}}if(!_75d&&!_763){var _764=_75f.indexOf(args.newchar);if(_764>=0){var _765=_760[_764];var _766=_75f[_764];this.model.insertCharacters(this.cursorManager.getModelPosition(pos),args.newchar);this.cursorManager.moveRight(true);this.model.insertCharacters(this.cursorManager.getModelPosition(),_765);_75d=true;}}}if(!_75d){this.model.insertCharacters(this.cursorManager.getModelPosition(pos),args.newchar);this.cursorManager.moveRight(true);}this.repaint();this.endEdit();},moveCursorRowToCenter:function(args){var _76b=this.editor.getCursorPos().row;var _76c=Math.floor(this.editor.ui.visibleRows/2);if(_76b>(this.editor.ui.firstVisibleRow+_76c)){this.cursorManager.moveCursor({row:this.editor.getCursorPos().row+_76c});}else{this.cursorManager.moveCursor({row:this.editor.getCursorPos().row-_76c});}this.editor.ui.ensureCursorVisible();this.cursorManager.moveCursor({row:_76b});},getOppositeCase:function(_76d){if(!_76d){return undefined;}switch(_76d){case "u":return "l";break;case "l":return "u";break;}},selectionChangeCase:function(args){if(this.editor.readonly){return;}if(this.editor.selection){this.beginEdit("selectionChangeCase");if(!args.selectionObject){args.selectionObject=this.editor.getSelection();}var _76f=this.model.getChunk(args.selectionObject);var _770=_76f.split("\n");for(i in _770){switch(args.stringCase){case "l":_770[i]=_770[i].toLowerCase();break;case "u":_770[i]=_770[i].toUpperCase();break;}}var _771=_770.join("\n");this.model.deleteChunk(args.selectionObject);this.model.insertChunk(args.selectionObject.startModelPos,_771);this.select(args.selectionObject);this.endEdit();}},startSearch:function(str,_773,_774){if(str==""){this.editor.ui.setSearchString(false);this.editor.paint(true);dojo.byId("searchresult").style.display="none";return false;}if(str==this.editor.ui.searchString&&_773=="toolbar"){if(!_774){this.findNext();}else{this.findPrev();}dojo.byId("searchresult").style.display="block";return;}this.editor.ui.setSearchString(str);var _775=this.editor.model.getCountOfString(str);if(_775!=0){var pos=bespin.editor.utils.copyPos(this.editor.cursorManager.getCursorPosition());if(!this.editor.ui.actions.findNext(null,true)){this.editor.cursorManager.moveCursor({col:0,row:0});this.editor.ui.actions.findNext();}}switch(_773){case "commandLine":var msg="Found "+_775+" match";if(_775>1){msg+="es";}msg+=" for your search for <em>"+str+"</em>";bespin.get("commandLine").showHint(msg);break;case "searchwindow":var _778=bespin.get("filesearch");if(_778){_778.setMatchesCount(_775);}break;case "toolbar":var msg=+_775+" Match";if(_775>1){msg+="es";}dojo.byId("searchfeedback").innerHTML=msg;dojo.byId("searchresult").style.display="block";break;}this.editor.paint(true);},findNext:function(_779,_77a){if(!this.editor.ui.searchString){return;}var pos=bespin.editor.utils.copyPos(this.cursorManager.getModelPosition());var sel=this.editor.getSelection();if(_77a&&sel!==undefined){pos.col-=sel.endModelPos.col-sel.startModelPos.col+1;}var _77d=this.model.findNext(pos.row,pos.col,this.editor.ui.searchString);if(!_77d){_77d=this.model.findNext(0,0,this.editor.ui.searchString);}if(_77d){this.editor.setSelection({startPos:this.cursorManager.getCursorPosition(_77d.startPos),endPos:this.cursorManager.getCursorPosition(_77d.endPos)});this.cursorManager.moveCursor(this.cursorManager.getCursorPosition(_77d.endPos));this.editor.ui.ensureCursorVisible(true);this.repaint();return true;}else{return false;}},findPrev:function(){if(!this.editor.ui.searchString){return;}var pos=this.cursorManager.getModelPosition();var _77f=this.model.findPrev(pos.row,pos.col,this.editor.ui.searchString);if(!_77f){var _780=this.model.getRowCount()-1;_77f=this.model.findPrev(_780,this.model.getRowArray(_780).length-1,this.editor.ui.searchString);}if(_77f){this.editor.setSelection({startPos:this.cursorManager.getCursorPosition(_77f.startPos),endPos:this.cursorManager.getCursorPosition(_77f.endPos)});this.cursorManager.moveCursor(this.cursorManager.getCursorPosition(_77f.endPos));this.editor.ui.ensureCursorVisible(true);this.repaint();return true;}else{return false;}},escape:function(){bespin.publish("ui:escape");if(this.editor.ui.searchString){this.editor.ui.setSearchString(false);}},toggleQuickopen:function(){var _781=bespin.get("quickopen");if(_781){_781.toggle();}},togglePieMenu:function(){bespin.getComponent("piemenu",function(_782){_782.toggle();});},focusCommandline:function(){bespin.getComponent("popup",function(_783){_783.show("output","Command Line");});},focusFileBrowser:function(){bespin.getComponent("popup",function(_784){_784.show("files","File Explorer");});},repaint:function(){if(!this.ignoreRepaints){this.editor.ui.ensureCursorVisible();this.editor.paint();}},replace:function(args){this.beginEdit("replace");this.editor.model.replace(args.search,args.replace);this.repaint();this.endEdit();},gotoLine:function(){bespin.getComponent("commandLine",function(cli){cli.setCommandText("goto ");bespin.getComponent("popup",function(_787){_787.show("output");});});},cmdFilesearch:function(){bespin.getComponent("commandLine",function(cli){cli.setCommandText("search ");bespin.getComponent("popup",function(_789){_789.show("output");});});},previousFile:function(){bespin.get("editSession").goToPreviousFile();},nextFile:function(){bespin.get("editSession").goToNextFile();}});dojo.declare("bespin.editor.ActionHistoryItem",null,{constructor:function(name,_78b){this.editor=_78b;},begin:function(_78c,_78d){this.startIndex=this.editor.historyManager.getCurrent();if(_78c){this.editorBefore=_78c;}else{this.editorBefore=this.editor.getState();}if(_78d){this.modelBefore=_78d;}else{this.modelBefore=this.editor.model.getState();}},end:function(_78e,_78f){this.editor.historyManager.truncate(this.startIndex);if(_78e){this.editorAfter=_78e;}else{this.editorAfter=this.editor.getState();}if(_78f){this.modelAfter=_78f;}else{this.modelAfter=this.editor.model.getState();}},undo:function(){this.editor.model.applyState(this.modelBefore);this.editor.setState(this.editorBefore);this.editor.ui.ensureCursorVisible();this.editor.paint();},redo:function(){this.editor.model.applyState(this.modelAfter);this.editor.setState(this.editorAfter);this.editor.ui.ensureCursorVisible();this.editor.paint();}});}if(!dojo._hasResource["bespin.editor.clipboard"]){dojo._hasResource["bespin.editor.clipboard"]=true;dojo.provide("bespin.editor.clipboard");dojo.mixin(bespin.editor.clipboard,{install:function(_790,_791){this.uninstall();this.uses=_791;this.uses.install(_790);},uninstall:function(){if(this.uses&&typeof this.uses["uninstall"]=="function"){this.uses.uninstall();}this.uses=undefined;},createHiddenTextarea:function(){return dojo.create("textarea",{id:"copynpaster",tabIndex:"-1",style:"position:absolute; z-index:999; top:-10000px; width:0px; height:0px; border:none;"},dojo.body());},createHiddenIframe:function(){return dojo.create("iframe",{id:"icopynpaster",style:"position:absolute; z-index:999; top:-10000px; width:0px; height:0px; border:none;"},dojo.body());},setup:function(_792){this.install(_792,new bespin.editor.clipboard.HiddenWorld());if(dojo.isWebKit){this.install(_792,new bespin.editor.clipboard.DOMEvents());}else{this.install(_792,new bespin.editor.clipboard.HiddenWorld());}}});dojo.declare("bespin.editor.clipboard.DOMEvents",null,{install:function(_793){var _794=function(e){return e.target.id=="command";};var _796=function(){return _793.focus;};var _797=this.focuser=bespin.editor.clipboard.createHiddenTextarea();var _798=false;this.beforecopyHandle=dojo.connect(document.body,"onbeforecopy",function(e){if((!_796()&&!_798)||_794(e)){return;}dojo.stopEvent(e);_797.value="Hello";_797.focus();_797.select();_798=true;});this.copyHandle=dojo.connect(document.body,"oncopy",function(e){if(!_796()&&!_798){return;}if(_794(e)){return;}var _79b=_793.getSelectionAsText();if(_79b&&_79b!=""){e.clipboardData.setData("text/plain",_79b);dojo.stopEvent(e);}_793.canvas.focus();_798=false;});this.beforecutHandle=dojo.connect(document,"beforecut",function(e){if((!_796()&&!_798)||_794(e)){return;}dojo.stopEvent(e);_797.value="Hello";_797.focus();_797.select();_798=true;});this.cutHandle=dojo.connect(document,"cut",function(e){if(!_796()&&!_798){return;}if(_794(e)){return;}var _79e=_793.getSelection();if(_79e){var _79f=_793.model.getChunk(_79e);if(_79f&&_79f!=""){e.preventDefault();e.clipboardData.setData("text/plain",_79f);_793.ui.actions.beginEdit("cut");_793.ui.actions.deleteSelection(_79e);_793.ui.actions.endEdit();}}_793.canvas.focus();_798=false;});this.beforepasteHandle=dojo.connect(document,"beforepaste",function(e){if(!_796()){return;}if(_794(e)){return;}dojo.stopEvent(e);e.preventDefault();});this.pasteHandle=dojo.connect(document,"paste",function(e){if(!_796()||_794(e)){return;}dojo.stopEvent(e);e.preventDefault();var args=bespin.editor.utils.buildArgs();args.chunk=e.clipboardData.getData("text/plain");if(args.chunk){_793.ui.actions.beginEdit("paste");_793.ui.actions.insertChunk(args);_793.ui.actions.endEdit();}dojo.byId("canvas").focus();});document.body.focus();},uninstall:function(){dojo.disconnect(this.beforepasteHandle);dojo.disconnect(this.pasteHandle);dojo.disconnect(this.beforecutHandle);dojo.disconnect(this.cutHandle);dojo.disconnect(this.beforecopyHandle);dojo.disconnect(this.copyHandle);document.body.removeChild(this.focuser);}});dojo.declare("bespin.editor.clipboard.HiddenWorld",null,{install:function(_7a3){var _7a4;var _7a5;var _7a6;_7a4=bespin.editor.clipboard.createHiddenTextarea();_7a5=function(text){_7a4.value=text;_7a4.select();_7a4.focus();setTimeout(function(){_7a3.setFocus(true);},10);};_7a6=function(){_7a4.select();setTimeout(function(){var args=bespin.editor.utils.buildArgs();args.chunk=_7a4.value;if(args.chunk){_7a3.ui.actions.beginEdit("paste");_7a3.ui.actions.insertChunk(args);_7a3.ui.actions.endEdit();}_7a3.setFocus(true);},0);};this.keyDown=dojo.connect(document,"keydown",function(e){if(!bespin.get("editor").focus){return;}if((bespin.util.isMac()&&e.metaKey)||e.ctrlKey){if(e.keyCode==67){var _7aa=_7a3.getSelectionAsText();if(_7aa&&_7aa!=""){_7a5(_7aa);}}else{if(e.keyCode==88){var _7ab=_7a3.getSelection();if(_7ab){var _7aa=_7a3.model.getChunk(_7ab);if(_7aa&&_7aa!=""){_7a5(_7aa);_7a3.ui.actions.beginEdit("cut");_7a3.ui.actions.deleteSelection(_7ab);_7a3.ui.actions.endEdit();}}}else{if(e.keyCode==86){if(e.target==dojo.byId("command")){return;}_7a6();}}}}});},uninstall:function(){dojo.disconnect(this.keyDown);if(this.copynpaster){document.body.removeChild(this.copynpaster);}this.copynpaster=undefined;}});dojo.declare("bespin.editor.clipboard.EditorOnly",null,{install:function(){var _7ac=bespin.get("editor");_7ac.bindKey("copySelection","CMD C");_7ac.bindKey("pasteFromClipboard","CMD V");_7ac.bindKey("cutSelection","CMD X");}});bespin.editor.clipboard.Manual=function(){var _7ad;return {copy:function(_7ae){try{if(netscape.security.PrivilegeManager.enablePrivilege){netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");}else{_7ad=_7ae;return;}}catch(ex){_7ad=_7ae;return;}var str=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);str.data=_7ae;var _7b0=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!_7b0){return false;}_7b0.addDataFlavor("text/unicode");_7b0.setTransferData("text/unicode",str,_7ae.length*2);var _7b1=Components.interfaces.nsIClipboard;var clip=Components.classes["@mozilla.org/widget/clipboard;1"].getService(_7b1);if(!clip){return false;}clip.setData(_7b0,null,_7b1.kGlobalClipboard);},data:function(){try{if(netscape.security.PrivilegeManager.enablePrivilege){netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");}else{return _7ad;}}catch(ex){return _7ad;}var clip=Components.classes["@mozilla.org/widget/clipboard;1"].getService(Components.interfaces.nsIClipboard);if(!clip){return false;}var _7b4=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!_7b4){return false;}_7b4.addDataFlavor("text/unicode");clip.getData(_7b4,clip.kGlobalClipboard);var str={};var _7b6={};var _7b7="";_7b4.getTransferData("text/unicode",str,_7b6);if(str){str=str.value.QueryInterface(Components.interfaces.nsISupportsString);}if(str){_7b7=str.data.substring(0,_7b6.value/2);}return _7b7;}};}();}if(!dojo._hasResource["bespin.editor.cursor"]){dojo._hasResource["bespin.editor.cursor"]=true;dojo.provide("bespin.editor.cursor");dojo.declare("bespin.editor.CursorManager",null,{constructor:function(_7b8){this.editor=_7b8;this.position={row:0,col:0};this.virtualCol=0;},getCursorPosition:function(_7b9){if(_7b9==undefined){return this.position;}var pos=bespin.editor.utils.copyPos(_7b9);var line=[];if(this.editor.model.hasRow(pos.row)){line=this.editor.model.getRowArray(pos.row);}var _7bc=this.editor.getTabSize();if(line.indexOf("\t")!=-1){var tabs=0,_7be=0;for(var i=0;i<_7b9.col;i++){if(line[i]=="\t"){pos.col+=_7bc-1-(_7be%_7bc);tabs++;_7be=0;}else{_7be++;tabs=0;}}}return pos;},getModelPosition:function(pos){pos=(pos!=undefined)?pos:this.position;var _7c1=bespin.editor.utils.copyPos(pos);var line=[];if(this.editor.model.hasRow(pos.row)){line=this.editor.model.getRowArray(pos.row);}var _7c3=this.editor.getTabSize();if(line.indexOf("\t")!=-1){var _7c4=0;for(var i=0;i<_7c1.col;i++){var _7c6=_7c4;if(line[i]=="\t"){_7c6=Math.floor((_7c4+_7c3)/_7c3)*_7c3;}else{_7c6+=1;}if(_7c6>_7c1.col){break;}_7c4=_7c6;}_7c1.col=i;}return _7c1;},getCharacterLength:function(_7c7,_7c8){if(_7c7.length>1){return;}if(_7c8==undefined){_7c8=this.position.col;}if(_7c7=="\t"){var _7c9=this.editor.getTabSize();return (_7c9-(_7c8%_7c9));}else{return 1;}},getStringLength:function(str){if(!str||str.length==0){return 0;}var _7cb=0;str=str.split("");for(var x=0;x<str.length;x++){_7cb+=this.getCharacterLength(str[x],_7cb);}return _7cb;},getLeadingWhitespace:function(_7cd){var row=this.editor.model.getRowArray(_7cd).join("");var _7cf=/^(\s+).*/.exec(row);return (_7cf&&_7cf.length==2?this.getStringLength(_7cf[1]):0);},getContinuousSpaceCount:function(from,to,_7d2){_7d2=_7d2||this.position.row;var _7d3=bespin.get("settings");var row=this.editor.model.getRowArray(_7d2);var _7d5=(from<to?1:-1);var _7d6=row.length;from=from+(_7d5==1?0:-1);to=to+(_7d5==1?0:-1);from=this.getModelPosition({col:from,row:_7d2}).col;to=this.getModelPosition({col:to,row:_7d2}).col;if(_7d3&&_7d3.isSettingOn("strictlines")){from=Math.min(from,_7d6);to=Math.min(to,_7d6);}var _7d7=0;for(var x=from;x!=to;x+=_7d5){if(x<_7d6){if(row[x]!=" "){break;}}_7d7++;}return _7d7;},getNextTablevelLeft:function(col){var _7da=this.editor.getTabSize();col=col||this.position.col;col--;return Math.floor(col/_7da)*_7da;},getNextTablevelRight:function(col){var _7dc=this.editor.getTabSize();col=col||this.position.col;col++;return Math.ceil(col/_7dc)*_7dc;},moveToLineStart:function(){var _7dd=bespin.editor.utils.copyPos(this.position);var _7de=this.getLeadingWhitespace(_7dd.row);if(this.position.col==0){this.moveCursor({col:_7de});}else{if(this.position.col==_7de){this.moveCursor({col:0});}else{if(_7de!=this.editor.ui.getRowScreenLength(this.editor.cursorManager.getCursorPosition().row)){this.moveCursor({col:_7de});}else{this.moveCursor({col:0});}}}return {oldPos:_7dd,newPos:bespin.editor.utils.copyPos(this.position)};},moveToLineEnd:function(){var _7df=bespin.editor.utils.copyPos(this.position);this.moveCursor({col:this.editor.ui.getRowScreenLength(_7df.row)});return {oldPos:_7df,newPos:bespin.editor.utils.copyPos(this.position)};},moveToTop:function(){var _7e0=bespin.editor.utils.copyPos(this.position);this.editor.cursorManager.moveCursor({row:0,col:0});return {oldPos:_7e0,newPos:bespin.editor.utils.copyPos(this.position)};},moveToBottom:function(){var _7e1=bespin.editor.utils.copyPos(this.position);var row=this.editor.model.getRowCount()-1;this.editor.cursorManager.moveCursor({row:row,col:this.editor.ui.getRowScreenLength(row)});return {oldPos:_7e1,newPos:bespin.editor.utils.copyPos(this.position)};},moveUp:function(){var _7e3=bespin.get("settings");var _7e4=this.editor.getSelection();var _7e5=bespin.editor.utils.copyPos(this.position);var _7e6=this.virtualCol;this.moveCursor({row:_7e5.row-1,col:Math.max(_7e5.col,this.virtualCol)});if((_7e3&&_7e3.isSettingOn("strictlines"))&&this.position.col>this.editor.ui.getRowScreenLength(this.position.row)){this.moveToLineEnd();this.virtualCol=Math.max(_7e5.col,_7e6);}return {oldPos:_7e5,newPos:bespin.editor.utils.copyPos(this.position)};},moveDown:function(){var _7e7=bespin.get("settings");var _7e8=this.editor.getSelection();var _7e9=bespin.editor.utils.copyPos(this.position);var _7ea=this.virtualCol;this.moveCursor({row:Math.max(0,_7e9.row+1),col:Math.max(_7e9.col,this.virtualCol)});if((_7e7&&_7e7.isSettingOn("strictlines"))&&this.position.col>this.editor.ui.getRowScreenLength(this.position.row)){this.moveToLineEnd();this.virtualCol=Math.max(_7e9.col,_7ea);}return {oldPos:_7e9,newPos:bespin.editor.utils.copyPos(this.position)};},moveLeft:function(args){var _7ec=bespin.get("settings");var _7ed=bespin.editor.utils.copyPos(this.position);var _7ee=(args.event?args.event.shiftKey:false);if(!this.editor.getSelection()||_7ee){if(_7ec&&_7ec.isSettingOn("smartmove")){var _7ef=this.getContinuousSpaceCount(_7ed.col,this.getNextTablevelLeft());if(_7ef==this.editor.getTabSize()){this.moveCursor({col:_7ed.col-_7ef});return {oldPos:_7ed,newPos:bespin.editor.utils.copyPos(this.position)};}}if((_7ec&&_7ec.isSettingOn("strictlines"))&&(this.position.col==0)){this.moveUp();if(_7ed.row>0){this.moveToLineEnd();}}else{this.moveCursor({row:_7ed.row,col:Math.max(0,_7ed.col-1)});}}else{this.moveCursor(this.editor.getSelection().startPos);}return {oldPos:_7ed,newPos:bespin.editor.utils.copyPos(this.position)};},moveRight:function(args){var _7f1=bespin.get("settings");var _7f2=bespin.editor.utils.copyPos(this.position);var _7f3=(args.event?args.event.shiftKey:false);if(!this.editor.getSelection()||_7f3){if((_7f1&&_7f1.isSettingOn("smartmove"))&&args!=true){var _7f4=this.getContinuousSpaceCount(_7f2.col,this.getNextTablevelRight());if(_7f4==this.editor.getTabSize()){this.moveCursor({col:_7f2.col+_7f4});return {oldPos:_7f2,newPos:bespin.editor.utils.copyPos(this.position)};}}if((_7f1&&_7f1.isSettingOn("strictlines"))&&(this.position.col>=this.editor.ui.getRowScreenLength(this.position.row))){this.moveDown();if(_7f2.row<this.editor.model.getRowCount()-1){this.moveCursor({col:0});}}else{this.moveCursor({col:this.position.col+1});}}else{this.moveCursor(this.editor.getSelection().endPos);}return {oldPos:_7f2,newPos:bespin.editor.utils.copyPos(this.position)};},movePageUp:function(){var _7f5=bespin.get("settings");var _7f6=this.editor.getSelection();var _7f7=bespin.editor.utils.copyPos(this.position);var _7f8=this.virtualCol;this.moveCursor({row:Math.max(this.editor.ui.firstVisibleRow-this.editor.ui.visibleRows,0)});if((_7f5&&_7f5.isSettingOn("strictlines"))&&this.position.col>this.editor.ui.getRowScreenLength(this.position.row)){this.moveToLineEnd();this.virtualCol=Math.max(_7f7.col,_7f8);}return {oldPos:_7f7,newPos:bespin.editor.utils.copyPos(this.position)};},movePageDown:function(){var _7f9=bespin.get("settings");var _7fa=this.editor.getSelection();var _7fb=bespin.editor.utils.copyPos(this.position);var _7fc=this.virtualCol;this.moveCursor({row:Math.min(this.position.row+this.editor.ui.visibleRows,this.editor.model.getRowCount()-1)});if((_7f9&&_7f9.isSettingOn("strictlines"))&&this.position.col>this.editor.ui.getRowScreenLength(this.position.row)){this.moveToLineEnd();this.virtualCol=Math.max(_7fb.col,_7fc);}return {oldPos:_7fb,newPos:bespin.editor.utils.copyPos(this.position)};},smartMoveLeft:function(){var _7fd=bespin.editor.utils.copyPos(this.position);var row=this.editor.ui.getRowString(_7fd.row);var c,_800;if(this.position.col==0){this.moveUp();this.moveToLineEnd();}else{if(row.length<this.position.col){this.moveToLineEnd();}var _801=this.position.col;var _802=false;while(_801>0){_801--;c=row.charAt(_801);_800=c.charCodeAt(0);if(_800==32){_802=true;}else{_801++;break;}}if(!_802){while(_801>0){_801--;c=row.charAt(_801);_800=c.charCodeAt(0);if((_800<65)||(_800>122)){if(_801!=this.position.col-1){_801++;}break;}}}this.moveCursor({col:_801});}return {oldPos:_7fd,newPos:bespin.editor.utils.copyPos(this.position)};},smartMoveRight:function(){var _803=bespin.editor.utils.copyPos(this.position);var row=this.editor.ui.getRowString(_803.row);if(row.length<=this.position.col){this.moveDown();this.moveToLineStart();}else{var c,_806;var _807=this.position.col;var _808=false;while(_807<row.length){c=row[_807];_806=c.charCodeAt(0);if(_806==32){_808=true;_807++;}else{break;}}if(!_808){while(_807<row.length){_807++;if(row.length==_807){this.moveToLineEnd();_807=-1;break;}c=row[_807];_806=c.charCodeAt(0);if((_806<65)||(_806>122)){break;}}}if(_807!=-1){this.moveCursor({col:_807});}}return {oldPos:_803,newPos:bespin.editor.utils.copyPos(this.position)};},moveCursor:function(_809){if(!_809){return;}if(_809.col===undefined){_809.col=this.position.col;}if(_809.row===undefined){_809.row=this.position.row;}this.virtualCol=0;var _80a=this.position;var row=Math.min(_809.row,this.editor.model.getRowCount()-1);if(row<0){row=0;}var _80c=this.isInvalidCursorPosition(row,_809.col);if(_80c){if(_80a.row!=_809.row){_809.col=_80c.right;}else{if(_80a.col<_809.col){_809.col=_80c.right;}else{if(_80a.col>_809.col){_809.col=_80c.left;}else{_809.col=_80c.right;}}}}this.position={row:row,col:_809.col};var _80d=bespin.get("editor").ui;_80d.showCursor=true;_80d.toggleCursorAllowed=false;},isInvalidCursorPosition:function(row,col){var _810=this.editor.model.getRowArray(row);var _811=0;for(var i=0;i<_810.length;i++){if(_810[i].charCodeAt(0)==9){var _813=this.editor.getTabSize()-(_811%this.editor.getTabSize());if((col>_811)&&(col<(_811+_813))){return {left:_811,right:_811+_813,half:_813/2};}_811+=_813-1;}_811++;}return undefined;}});}if(!dojo._hasResource["bespin.editor.editor"]){dojo._hasResource["bespin.editor.editor"]=true;dojo.provide("bespin.editor.editor");dojo.declare("bespin.editor.Scrollbar",null,{HORIZONTAL:"horizontal",VERTICAL:"vertical",MINIMUM_HANDLE_SIZE:20,constructor:function(ui,_815,rect,_817,min,max,_81a){this.ui=ui;this.orientation=_815;this.rect=rect;this.value=_817;this.min=min;this.max=max;this.extent=_81a;this.mousedownScreenPoint;this.mousedownValue;},getHandleBounds:function(){var sx=(this.isH())?this.rect.x:this.rect.y;var sw=(this.isH())?this.rect.w:this.rect.h;var _81d=this.extent/(this.max+this.extent);var asw=_81d*sw;if(asw<this.MINIMUM_HANDLE_SIZE){asw=this.MINIMUM_HANDLE_SIZE;}sx+=(sw-asw)*(this.value/(this.max-this.min));return (this.isH())?new bespin.editor.Rect(Math.floor(sx),this.rect.y,asw,this.rect.h):new bespin.editor.Rect(this.rect.x,sx,this.rect.w,asw);},isH:function(){return (!(this.orientation==this.VERTICAL));},fixValue:function(_81f){if(_81f<this.min){_81f=this.min;}if(_81f>this.max){_81f=this.max;}return _81f;},onmousewheel:function(e){var _821=dojo.byId("command_output");var _822=e.target||e.originalTarget;if(_821&&(_822.id=="command_output"||bespin.util.contains(_821,_822))){return;}if(!this.ui.editor.focus){return;}var _823=bespin.util.mousewheelevent.wheel(e);var axis=bespin.util.mousewheelevent.axis(e);if(this.orientation==this.VERTICAL&&axis==this.VERTICAL){this.setValue(this.value+(_823*this.ui.lineHeight));}else{if(this.orientation==this.HORIZONTAL&&axis==this.HORIZONTAL){this.setValue(this.value+(_823*this.ui.charWidth));}}},onmousedown:function(e){var _826=e.clientY-this.ui.getTopOffset();var _827=e.clientX-this.ui.getLeftOffset();var bar=this.getHandleBounds();if(bar.contains({x:_827,y:_826})){this.mousedownScreenPoint=(this.isH())?e.screenX:e.screenY;this.mousedownValue=this.value;}else{var p=(this.isH())?_827:_826;var b1=(this.isH())?bar.x:bar.y;var b2=(this.isH())?bar.x2:bar.y2;if(p<b1){this.setValue(this.value-=this.extent);}else{if(p>b2){this.setValue(this.value+=this.extent);}}}},onmouseup:function(e){this.mousedownScreenPoint=null;this.mousedownValue=null;if(this.valueChanged){this.valueChanged();}},onmousemove:function(e){if(this.mousedownScreenPoint){var diff=((this.isH())?e.screenX:e.screenY)-this.mousedownScreenPoint;var _82f=diff/(this.isH()?this.rect.w:this.rect.h);this.setValue(this.mousedownValue+Math.floor(((this.max+this.extent)-this.min)*_82f));}},setValue:function(_830){this.value=this.fixValue(_830);if(this.valueChanged){this.valueChanged();}}});dojo.declare("bespin.editor.Rect",null,{constructor:function(x,y,w,h){this.x=x;this.y=y;this.w=w;this.h=h;this.x2=x+w;this.y2=y+h;},contains:function(_835){if(!this.x){return false;}return ((this.x<=_835.x)&&((this.x+this.w)>=_835.x)&&(this.y<=_835.y)&&((this.y+this.h)>=_835.y));}});dojo.declare("bespin.editor.SelectionHelper",null,{constructor:function(_836){this.editor=_836;},getRowSelectionPositions:function(_837){var _838;var _839;var _83a=this.editor.getSelection();if(!_83a){return undefined;}if((_83a.endPos.row<_837)||(_83a.startPos.row>_837)){return undefined;}_838=(_83a.startPos.row<_837)?0:_83a.startPos.col;_839=(_83a.endPos.row>_837)?-1:_83a.endPos.col;return {startCol:_838,endCol:_839};}});dojo.mixin(bespin.editor,{utils:{buildArgs:function(_83b){return {pos:bespin.editor.utils.copyPos(_83b||bespin.get("editor").getCursorPos())};},changePos:function(args,pos){return {pos:bespin.editor.utils.copyPos(oldPos||bespin.get("editor").getCursorPos())};},copyPos:function(_83e){return {row:_83e.row,col:_83e.col};},posEquals:function(pos1,pos2){if(pos1==pos2){return true;}if(!pos1||!pos2){return false;}return (pos1.col==pos2.col)&&(pos1.row==pos2.row);},diffObjects:function(o1,o2){var _843={};if(!o1||!o2){return undefined;}for(var key in o1){if(o2[key]){if(o1[key]!=o2[key]){_843[key]=o1[key]+" => "+o2[key];}}else{_843[key]="o1: "+key+" = "+o1[key];}}for(var key2 in o2){if(!o1[key2]){_843[key2]="o2: "+key2+" = "+o2[key2];}}return _843;}}});dojo.declare("bespin.editor.DefaultEditorKeyListener",null,{constructor:function(_846){this.editor=_846;this.actions=_846.ui.actions;this.skipKeypress=false;this.defaultKeyMap={};this.keyMap=this.defaultKeyMap;this.keyMapDescriptions={};},bindKey:function(_847,_848,_849,_84a,_84b,_84c,name){this.defaultKeyMap[[_847,_848,_849,_84a,_84b]]=(typeof _84c=="string")?function(){var _84e=bespin.events.toFire(_84c);bespin.publish(_84e.name,_84e.args);}:dojo.hitch(this.actions,_84c);if(name){this.keyMapDescriptions[[_847,_848,_849,_84a,_84b]]=name;}},bindKeyForPlatform:function(_84f,_850,name,_852){var _853=bespin.util.getOS();var _854=_84f[_853]||_84f["WINDOWS"];if(!_854){return;}var args=bespin.util.keys.fillArguments(_854);var _856=(_852)?"bindKeyStringSelectable":"bindKeyString";this[_856](args.modifiers,bespin.util.keys.toKeyCode(args.key),_850,name);},bindKeyString:function(_857,_858,_859,name){var _85b=(_857.toUpperCase().indexOf("CTRL")!=-1);var _85c=(_857.toUpperCase().indexOf("ALT")!=-1);var _85d=(_857.toUpperCase().indexOf("META")!=-1)||(_857.toUpperCase().indexOf("APPLE")!=-1);var _85e=(_857.toUpperCase().indexOf("SHIFT")!=-1);if(_857.toUpperCase().indexOf("CMD")!=-1){if(bespin.util.isMac()){_85d=true;}else{_85b=true;}}return this.bindKey(_858,_85d,_85b,_85c,_85e,_859,name);},bindKeyStringSelectable:function(_85f,_860,_861,name){this.bindKeyString(_85f,_860,_861,name);this.bindKeyString("SHIFT "+_85f,_860,_861);},getPrintableChar:function(e){if(e.charCode>255){return false;}if(e.charCode<32){return false;}if((e.altKey||e.metaKey||e.ctrlKey)&&(e.charCode>65&&e.charCode<123)){return false;}return String.fromCharCode(e.charCode);},onkeydown:function(e){if(!this.editor.focus){return;}var args={event:e,pos:bespin.editor.utils.copyPos(this.editor.cursorManager.getCursorPosition())};this.skipKeypress=false;this.returnValue=false;var _866=this.keyMap[[e.keyCode,e.metaKey,e.ctrlKey,e.altKey,e.shiftKey]];var _867=false;if(dojo.isFunction(_866)){_867=true;try{_866(args);}catch(e){console.log("Action caused an error! ",e);}this.lastAction=_866;}if(e.metaKey||e.ctrlKey||e.altKey){this.skipKeypress=true;this.returnValue=true;}if(_867||!bespin.util.keys.passThroughToBrowser(e)){dojo.stopEvent(e);}},onkeypress:function(e){if(!this.editor.focus){return;}if((e.metaKey||e.ctrlKey)&&e.charCode>=48&&e.charCode<=57){return;}var _869=this.getPrintableChar(e);if(_869){this.skipKeypress=false;}else{if(this.skipKeypress){if(!bespin.util.keys.passThroughToBrowser(e)){dojo.stopEvent(e);}return this.returnValue;}}var args={event:e,pos:bespin.editor.utils.copyPos(this.editor.cursorManager.getCursorPosition())};var _86b=this.editor.ui.actions;if(_869){args.newchar=String.fromCharCode(e.charCode);_86b.insertCharacter(args);}else{var _86c=this.keyMap[[e.keyCode,e.metaKey,e.ctrlKey,e.altKey,e.shiftKey]];if(this.lastAction==_86c){delete this.lastAction;}else{if(typeof _86c=="function"){_86c(args);}}}dojo.stopEvent(e);}});dojo.declare("bespin.editor.UI",null,{constructor:function(_86d){this.editor=_86d;this.model=this.editor.model;var _86e=bespin.get("settings");this.syntaxModel=bespin.syntax.Resolver.setEngine("simple").getModel();this.selectionHelper=new bespin.editor.SelectionHelper(_86d);this.actions=new bespin.editor.Actions(_86d);this.rowLengthCache=[];this.searchString=null;this.toggleCursorFullRepaintCounter=0;this.toggleCursorFrequency=250;this.toggleCursorAllowed=true;this.horizontalScrollCanvas=dojo.create("canvas");this.verticalScrollCanvas=dojo.create("canvas");this.gutterWidth=54;this.LINE_HEIGHT=23;this.BOTTOM_SCROLL_AFFORDANCE=30;this.GUTTER_INSETS={top:0,left:6,right:10,bottom:6};this.LINE_INSETS={top:0,left:5,right:0,bottom:6};this.FALLBACK_CHARACTER_WIDTH=10;this.NIB_WIDTH=15;this.NIB_INSETS={top:Math.floor(this.NIB_WIDTH/2),left:Math.floor(this.NIB_WIDTH/2),right:Math.floor(this.NIB_WIDTH/2),bottom:Math.floor(this.NIB_WIDTH/2)};this.NIB_ARROW_INSETS={top:3,left:3,right:3,bottom:5};this.DEBUG_GUTTER_WIDTH=18;this.DEBUG_GUTTER_INSETS={top:2,left:2,right:2,bottom:2};this.xoffset=0;this.yoffset=0;this.showCursor=true;this.overXScrollBar=false;this.overYScrollBar=false;this.hasFocus=false;var _86f=this.editor.container;this.globalHandles=[];dojo.connect(_86f,"mousemove",this,"handleMouse");dojo.connect(_86f,"mouseout",this,"handleMouse");dojo.connect(_86f,"click",this,"handleMouse");dojo.connect(_86f,"mousedown",this,"handleMouse");dojo.connect(_86f,"oncontextmenu",dojo.stopEvent);dojo.connect(_86f,"mousedown",this,"mouseDownSelect");this.globalHandles.push(dojo.connect(window,"mousemove",this,"mouseMoveSelect"));this.globalHandles.push(dojo.connect(window,"mouseup",this,"mouseUpSelect"));this.lastLineCount=0;this.lastCursorPos=null;this.lastxoffset=0;this.lastyoffset=0;var _870=_86d.opts.actsAsComponent?_86d.canvas:window;this.xscrollbar=new bespin.editor.Scrollbar(this,"horizontal");this.xscrollbar.valueChanged=dojo.hitch(this,function(){this.xoffset=-this.xscrollbar.value;this.editor.paint();});this.globalHandles.push(dojo.connect(window,"mousemove",this.xscrollbar,"onmousemove"));this.globalHandles.push(dojo.connect(window,"mouseup",this.xscrollbar,"onmouseup"));this.globalHandles.push(dojo.connect(_870,(!dojo.isMozilla?"onmousewheel":"DOMMouseScroll"),this.xscrollbar,"onmousewheel"));this.yscrollbar=new bespin.editor.Scrollbar(this,"vertical");this.yscrollbar.valueChanged=dojo.hitch(this,function(){this.yoffset=-this.yscrollbar.value;this.editor.paint();});this.globalHandles.push(dojo.connect(window,"mousemove",this.yscrollbar,"onmousemove"));this.globalHandles.push(dojo.connect(window,"mouseup",this.yscrollbar,"onmouseup"));this.globalHandles.push(dojo.connect(_870,(!dojo.isMozilla?"onmousewheel":"DOMMouseScroll"),this.yscrollbar,"onmousewheel"));setTimeout(dojo.hitch(this,function(){this.toggleCursor(this);}),this.toggleCursorFrequency);},convertClientPointToCursorPoint:function(pos){var _872=bespin.get("settings");var x,y;if(pos.y<0){y=0;}else{if(pos.y>=(this.lineHeight*this.editor.model.getRowCount())){y=this.editor.model.getRowCount()-1;}else{var ty=pos.y;y=Math.floor(ty/this.lineHeight);}}if(pos.x<=(this.gutterWidth+this.LINE_INSETS.left)){x=-1;}else{var tx=pos.x-this.gutterWidth-this.LINE_INSETS.left;x=Math.round(tx/this.charWidth);if((_872&&_872.isSettingOn("strictlines"))){var _877=this.getRowScreenLength(y);if(x>=_877){x=this.getRowScreenLength(y);}}}return {row:y,col:x};},mouseDownSelect:function(e){if(!this.editor.focus){return;}if(e.button==2){dojo.stopEvent(e);return false;}var _879=e.clientY-this.getTopOffset();var _87a=e.clientX-this.getLeftOffset();if(this.overXScrollBar||this.overYScrollBar){return;}if(this.editor.debugMode){if(_87a<this.DEBUG_GUTTER_WIDTH){console.log("Clicked in debug gutter");var _87b={x:_87a,y:_879};_87b.y+=Math.abs(this.yoffset);var p=this.convertClientPointToCursorPoint(_87b);var _87d=bespin.get("editSession");if(p&&_87d){bespin.getComponent("breakpoints",function(_87e){_87e.toggleBreakpoint({project:_87d.project,path:_87d.path,lineNumber:p.row});this.editor.paint(true);},this);}return;}}this.selectMouseDetail=e.detail;if(e.shiftKey){this.selectMouseDownPos=(this.editor.selection)?this.editor.selection.startPos:this.editor.getCursorPos();this.setSelection(e);}else{var _87b={x:_87a,y:_879};if((this.xscrollbar.rect.contains(_87b))||(this.yscrollbar.rect.contains(_87b))){return;}_87b.x+=Math.abs(this.xoffset);_87b.y+=Math.abs(this.yoffset);this.selectMouseDownPos=this.convertClientPointToCursorPoint(_87b);}},mouseMoveSelect:function(e){if(!this.editor.focus){return;}this.setSelection(e);},mouseUpSelect:function(e){if(!this.editor.focus){return;}this.setSelection(e);this.selectMouseDownPos=undefined;this.selectMouseDetail=undefined;},setSelection:function(e){var _882=e.clientY-this.getTopOffset();var _883=e.clientX-this.getLeftOffset();if(!this.selectMouseDownPos){return;}var down=bespin.editor.utils.copyPos(this.selectMouseDownPos);var _885={x:_883,y:_882};_885.x+=Math.abs(this.xoffset);_885.y+=Math.abs(this.yoffset);var up=this.convertClientPointToCursorPoint(_885);if(down.col==-1){down.col=0;var _887=bespin.get("parser").getLineMarkers()[down.row+1];if(_887){bespin.get("commandLine").showHint(_887.msg);}}if(up.col==-1){up.col=0;}var _888=this.editor.getModelPos(down);var _889=this.editor.getModelPos(up);var _88a=false;if(_889.row<_888.row||(_889.row==_888.row&&_889.col<_888.col)){_88a=true;var temp=_888;_888=_889;_889=temp;}if(!this.editor.model.hasRow(_888.row)){_888.row=this.editor.model.getRowCount()-1;}if(!this.editor.model.hasRow(_889.row)){_889.row=this.editor.model.getRowCount()-1;}var _88c=this.selectMouseDetail;if(_88c==1){if(bespin.editor.utils.posEquals(_888,_889)){this.editor.setSelection(undefined);}else{this.editor.setSelection({startPos:this.editor.getCursorPos(_88a?_889:_888),endPos:this.editor.getCursorPos(_88a?_888:_889)});}this.editor.moveCursor(this.editor.getCursorPos(_88a?_888:_889));}else{if(_88c==2){var row=this.editor.model.rows[_888.row];var _88e=row[_888.col];var _88f=function(item){var _891=["="," ","\t",">","<",".","(",")","{","}",":","\"","'",";"];if(_891.indexOf(item)>-1){return true;}return false;};if(!_88e){this.editor.setSelection({startPos:this.editor.getCursorPos({row:_888.row,col:0}),endPos:this.editor.getCursorPos({row:_888.row,col:row.length})});}else{if(_88f(_88e.charAt(0))){var _892=function(_893){if(_88f(_893)){return false;}return true;};var _894=this.editor.model.findBefore(_888.row,_888.col,_892);var _895=this.editor.model.findAfter(_889.row,_889.col,_892);this.editor.setSelection({startPos:this.editor.getCursorPos(_88a?_895:_894),endPos:this.editor.getCursorPos(_88a?_894:_895)});this.editor.moveCursor(this.editor.getCursorPos(_88a?_894:_895));}else{var _892=function(_896){if(_88f(_896)){return true;}return false;};var _894=this.editor.model.findBefore(_888.row,_888.col,_892);var _895=this.editor.model.findAfter(_889.row,_889.col,_892);this.editor.setSelection({startPos:this.editor.getCursorPos(_88a?_895:_894),endPos:this.editor.getCursorPos(_88a?_894:_895)});this.editor.moveCursor(this.editor.getCursorPos(_88a?_894:_895));}}}else{if(_88c>2){var _894={row:_888.row,col:0};var _895={row:_889.row,col:0};if(this.editor.model.hasRow(_895.row+1)){_895.row=_895.row+1;}else{_895.col=this.editor.model.getRowArray(_895.row).length;}_894=this.editor.getCursorPos(_894);_895=this.editor.getCursorPos(_895);this.editor.setSelection({startPos:_88a?_895:_894,endPos:_88a?_894:_895});this.editor.moveCursor(_88a?_894:_895);}}}if(_882<0){this.yoffset=Math.min(1,this.yoffset+(-_882));}else{if(_882>=this.getHeight()){var _897=this.lineHeight*this.editor.model.getRowCount();this.yoffset=Math.max(-(_897-this.getHeight()-this.BOTTOM_SCROLL_AFFORDANCE),this.yoffset-_882-this.getHeight());}}this.editor.paint();},toggleCursor:function(ui){if(ui.toggleCursorAllowed){ui.showCursor=!ui.showCursor;}else{ui.toggleCursorAllowed=true;}if(++this.toggleCursorFullRepaintCounter>0){this.toggleCursorFullRepaintCounter=0;ui.editor.paint(true);}else{ui.editor.paint();}setTimeout(function(){ui.toggleCursor(ui);},ui.toggleCursorFrequency);},ensureCursorVisible:function(_899){if((!this.lineHeight)||(!this.charWidth)){return;}if(bespin.get("settings")){var _89a=parseFloat(bespin.get("settings").get("pagescroll"))||0;}else{var _89a=0;}_89a=(!_899?Math.max(0,Math.min(1,_89a)):0.25);var y=this.lineHeight*this.editor.cursorManager.getCursorPosition().row;var x=this.charWidth*this.editor.cursorManager.getCursorPosition().col;var _89d=this.getHeight();var _89e=this.getWidth()-this.gutterWidth;if(Math.abs(this.yoffset)>y){this.yoffset=Math.min(-y+_89d*_89a,0);}else{if((Math.abs(this.yoffset)+_89d)<(y+this.lineHeight)){this.yoffset=-((y+this.lineHeight)-_89d*(1-_89a));this.yoffset=Math.max(this.yoffset,_89d-this.lineHeight*this.model.getRowCount());}}if(Math.abs(this.xoffset)>x){this.xoffset=-x;}else{if((Math.abs(this.xoffset)+_89e)<(x+(this.charWidth*2))){this.xoffset=-((x+(this.charWidth*2))-_89e);}}},handleFocus:function(e){this.editor.model.clear();this.editor.model.insertCharacters({row:0,col:0},e.type);},handleMouse:function(e){if(e.button==2){bespin.getComponent("piemenu",function(_8a1){_8a1.show(null,false,e.clientX,e.clientY);});dojo.stopEvent(e);return false;}var _8a2=e.clientY-this.getTopOffset();var _8a3=e.clientX-this.getLeftOffset();var oldX=this.overXScrollBar;var oldY=this.overYScrollBar;var _8a6=false;var w=this.editor.container.clientWidth;var h=this.editor.container.clientHeight;var sx=w-this.NIB_WIDTH-this.NIB_INSETS.right;var sy=h-this.NIB_WIDTH-this.NIB_INSETS.bottom;var p={x:_8a3,y:_8a2};if(e.type=="mousedown"){if((this.xscrollbar)&&(this.xscrollbar.rect.contains(p))){this.xscrollbar.onmousedown(e);}else{if((this.yscrollbar)&&(this.yscrollbar.rect.contains(p))){this.yscrollbar.onmousedown(e);}}}if(e.type=="mouseout"){this.overXScrollBar=false;this.overYScrollBar=false;}if((e.type=="mousemove")||(e.type=="click")){this.overYScrollBar=(p.x>sx)&&this.yscrollbarVisible;this.overXScrollBar=(p.y>sy)&&this.xscrollbarVisible;}if(e.type=="click"){if((typeof e.button!="undefined")&&(e.button==0)){var _8ac;if(this.nibup.contains(p)){_8ac="up";}else{if(this.nibdown.contains(p)){_8ac="down";}else{if(this.nibleft.contains(p)){_8ac="left";}else{if(this.nibright.contains(p)){_8ac="right";}}}}if(_8ac=="up"){this.yoffset+=this.lineHeight;_8a6=true;}else{if(_8ac=="down"){this.yoffset-=this.lineHeight;_8a6=true;}else{if(_8ac=="left"){this.xoffset+=this.charWidth*2;_8a6=true;}else{if(_8ac=="right"){this.xoffset-=this.charWidth*2;_8a6=true;}}}}}}if((oldX!=this.overXScrollBar)||(oldY!=this.overYScrollBar)||_8a6){this.editor.paint(true);}},installKeyListener:function(_8ad){var Key=bespin.util.keys.Key;if(this.oldkeydown){dojo.disconnect(this.oldkeydown);}if(this.oldkeypress){dojo.disconnect(this.oldkeypress);}this.oldkeydown=dojo.hitch(_8ad,"onkeydown");this.oldkeypress=dojo.hitch(_8ad,"onkeypress");var _8af=this.editor.opts.actsAsComponent?this.editor.canvas:window;dojo.connect(_8af,"keydown",this,"oldkeydown");dojo.connect(_8af,"keypress",this,"oldkeypress");_8ad.bindKeyStringSelectable("",Key.LEFT_ARROW,this.actions.moveCursorLeft,"Move Cursor Left");_8ad.bindKeyStringSelectable("",Key.RIGHT_ARROW,this.actions.moveCursorRight,"Move Cursor Right");_8ad.bindKeyStringSelectable("",Key.UP_ARROW,this.actions.moveCursorUp,"Move Cursor Up");_8ad.bindKeyStringSelectable("",Key.DOWN_ARROW,this.actions.moveCursorDown,"Move Cursor Down");_8ad.bindKeyForPlatform({MAC:"ALT LEFT_ARROW",WINDOWS:"CTRL LEFT_ARROW"},this.actions.moveWordLeft,"Move Word Left",true);_8ad.bindKeyForPlatform({MAC:"ALT RIGHT_ARROW",WINDOWS:"CTRL RIGHT_ARROW"},this.actions.moveWordRight,"Move Word Right",true);_8ad.bindKeyStringSelectable("",Key.HOME,this.actions.moveToLineStart,"Move to start of line");_8ad.bindKeyForPlatform({MAC:"APPLE LEFT_ARROW",WINDOWS:"ALT LEFT_ARROW"},this.actions.moveToLineStart,"Move to start of line",true);_8ad.bindKeyStringSelectable("",Key.END,this.actions.moveToLineEnd,"Move to end of line");_8ad.bindKeyForPlatform({MAC:"APPLE RIGHT_ARROW",WINDOWS:"ALT RIGHT_ARROW"},this.actions.moveToLineEnd,"Move to end of line",true);_8ad.bindKeyString("CTRL",Key.K,this.actions.killLine,"Kill entire line");_8ad.bindKeyString("CMD",Key.L,this.actions.gotoLine,"Goto Line");_8ad.bindKeyString("CTRL",Key.L,this.actions.moveCursorRowToCenter,"Move cursor to center of page");_8ad.bindKeyStringSelectable("",Key.BACKSPACE,this.actions.backspace,"Backspace");_8ad.bindKeyStringSelectable("CTRL",Key.BACKSPACE,this.actions.deleteWordLeft,"Delete a word to the left");_8ad.bindKeyString("",Key.DELETE,this.actions.deleteKey,"Delete");_8ad.bindKeyString("CTRL",Key.DELETE,this.actions.deleteWordRight,"Delete a word to the right");_8ad.bindKeyString("",Key.ENTER,this.actions.newline,"Insert newline");_8ad.bindKeyString("CMD",Key.ENTER,this.actions.newlineBelow,"Insert newline at end of current line");_8ad.bindKeyString("",Key.TAB,this.actions.insertTab,"Indent / insert tab");_8ad.bindKeyString("SHIFT",Key.TAB,this.actions.unindent,"Unindent");_8ad.bindKeyString("CMD",Key.SQUARE_BRACKET_CLOSE,this.actions.indent,"Indent");_8ad.bindKeyString("CMD",Key.SQUARE_BRACKET_OPEN,this.actions.unindent,"Unindent");_8ad.bindKeyString("",Key.ESCAPE,this.actions.escape,"Clear fields and dialogs");_8ad.bindKeyString("CMD",Key.A,this.actions.selectAll,"Select All");_8ad.bindKeyString("CMD",Key.I,this.actions.toggleQuickopen,"Toggle Quickopen");_8ad.bindKeyString("CMD",Key.J,this.actions.focusCommandline,"Open Command line");_8ad.bindKeyString("CMD",Key.O,this.actions.focusFileBrowser,"Open File Browser");_8ad.bindKeyString("CMD",Key.F,this.actions.cmdFilesearch,"Search in this file");_8ad.bindKeyString("CMD",Key.G,this.actions.findNext,"Find Next");_8ad.bindKeyString("SHIFT CMD",Key.G,this.actions.findPrev,"Find Previous");_8ad.bindKeyString("CTRL",Key.M,this.actions.togglePieMenu,"Open Pie Menu");_8ad.bindKeyString("CMD",Key.Z,this.actions.undo,"Undo");_8ad.bindKeyString("SHIFT CMD",Key.Z,this.actions.redo,"Redo");_8ad.bindKeyString("CMD",Key.Y,this.actions.redo,"Redo");_8ad.bindKeyStringSelectable("CMD",Key.UP_ARROW,this.actions.moveToFileTop,"Move to top of file");_8ad.bindKeyStringSelectable("CMD",Key.DOWN_ARROW,this.actions.moveToFileBottom,"Move to bottom of file");_8ad.bindKeyStringSelectable("CMD",Key.HOME,this.actions.moveToFileTop,"Move to top of file");_8ad.bindKeyStringSelectable("CMD",Key.END,this.actions.moveToFileBottom,"Move to bottom of file");_8ad.bindKeyStringSelectable("",Key.PAGE_UP,this.actions.movePageUp,"Move a page up");_8ad.bindKeyStringSelectable("",Key.PAGE_DOWN,this.actions.movePageDown,"Move a page down");_8ad.bindKeyStringSelectable("ALT",Key.UP_ARROW,this.actions.movePageUp,"Move up a block");_8ad.bindKeyStringSelectable("ALT",Key.DOWN_ARROW,this.actions.movePageDown,"Move down a block");_8ad.bindKeyString("CMD ALT",Key.LEFT_ARROW,this.actions.previousFile);_8ad.bindKeyString("CMD ALT",Key.RIGHT_ARROW,this.actions.nextFile);},getWidth:function(){return parseInt(dojo.style(this.editor.canvas.parentNode,"width"));},getHeight:function(){return parseInt(dojo.style(this.editor.canvas.parentNode,"height"));},getTopOffset:function(){return dojo.coords(this.editor.canvas.parentNode).y||this.editor.canvas.parentNode.offsetTop;},getLeftOffset:function(){return dojo.coords(this.editor.canvas.parentNode).x||this.editor.canvas.parentNode.offsetLeft;},getCharWidth:function(ctx){if(ctx.measureText){return ctx.measureText("M").width;}else{return this.FALLBACK_CHARACTER_WIDTH;}},getLineHeight:function(ctx){var lh=-1;if(ctx.measureText){var t=ctx.measureText("M");if(t.ascent){lh=Math.floor(t.ascent*2.8);}}if(lh==-1){lh=this.LINE_HEIGHT;}return lh;},resetCanvas:function(){dojo.attr(dojo.byId(this.editor.canvas),{width:this.getWidth(),height:this.getHeight()});},fillText:function(ctx,text,x,y){ctx.fillText(text,x,y);},fillTextWithTransparency:function(ctx,text,x,y){ctx.globalAlpha=0.3;ctx.fillText(text,x,y);ctx.globalAlpha=1;},paint:function(ctx,_8bd){var ed=this.editor;var c=dojo.byId(ed.canvas);var _8c0=ed.theme;var x,y;var cy;var _8c4;var _8c5;var Rect=bespin.editor.Rect;var _8c7=_8bd;if(!_8c7){_8c7=(this.selectMouseDownPos);}if(!_8c7){_8c7=(this.lastLineCount!=ed.model.getRowCount());}this.lastLineCount=ed.model.getRowCount();ctx.font=_8c0.editorTextFont;this.charWidth=this.getCharWidth(ctx);this.lineHeight=this.getLineHeight(ctx);var _8c8=this.getWidth();var _8c9=this.getHeight();if(this.xoffset>0){this.xoffset=0;}if(this.yoffset>0){this.yoffset=0;}this.visibleRows=Math.ceil(_8c9/this.lineHeight);this.firstVisibleRow=Math.floor(Math.abs(this.yoffset/this.lineHeight));_8c5=this.firstVisibleRow+this.visibleRows;if(_8c5>(ed.model.getRowCount()-1)){_8c5=ed.model.getRowCount()-1;}var _8ca=this.lineHeight*ed.model.getRowCount();var _8cb=this.charWidth*(Math.max(this.getMaxCols(this.firstVisibleRow,_8c5),ed.cursorManager.getCursorPosition().col)+2);this.gutterWidth=this.GUTTER_INSETS.left+this.GUTTER_INSETS.right;this.gutterWidth+=(""+_8c5).length*this.charWidth;if(this.editor.debugMode){this.gutterWidth+=this.DEBUG_GUTTER_WIDTH;}if(this.xoffset<0){if((Math.abs(this.xoffset))>(_8cb-(_8c8-this.gutterWidth))){this.xoffset=(_8c8-this.gutterWidth)-_8cb;}}if(this.yoffset<0){if((Math.abs(this.yoffset))>(_8ca-(_8c9-this.BOTTOM_SCROLL_AFFORDANCE))){this.yoffset=_8c9-(_8ca-this.BOTTOM_SCROLL_AFFORDANCE);}}if((this.xoffset!=this.lastxoffset)||(this.yoffset!=this.lastyoffset)){_8c7=true;this.lastxoffset=this.xoffset;this.lastyoffset=this.yoffset;}var _8cc=((_8c8-this.gutterWidth)<_8cb);var _8cd=(_8c9<_8ca);var _8ce=_8c8-this.NIB_WIDTH-this.NIB_INSETS.right-2;var _8cf=_8c9-this.NIB_WIDTH-this.NIB_INSETS.bottom-2;var _8d0=(_8cc&&(this.xoffset!=0));var _8d1=(_8cc&&(this.xoffset>((_8c8-this.gutterWidth)-_8cb)));var _8d2=(_8cd&&(this.yoffset!=0));var _8d3=(_8cd&&(this.yoffset>(_8c9-_8ca)));if(((dojo.attr(c,"width"))!=_8c8)||(dojo.attr(c,"height")!=_8c9)){_8c7=true;dojo.attr(c,{width:_8c8,height:_8c9});}var _8d4={};var _8d5=bespin.get("parser").getLineMarkers();if(this.editor.debugMode&&bespin.get("editSession")){bespin.getComponent("breakpoints",function(_8d6){var _8d7=_8d6.getBreakpoints(bespin.get("editSession").project,bespin.get("editSession").path);dojo.forEach(_8d7,function(_8d8){_8d4[_8d8.lineNumber]=_8d8;});delete _8d7;});}if(!_8c7){var _8d9=ed.model.getDirtyRows();if((this.lastCursorPos)&&(this.lastCursorPos.row!=ed.cursorManager.getCursorPosition().row)){_8d9[this.lastCursorPos.row]=true;}_8d9[ed.cursorManager.getCursorPosition().row]=true;}this.lastCursorPos=bespin.editor.utils.copyPos(ed.cursorManager.getCursorPosition());if(_8c7){ctx.fillStyle=_8c0.backgroundStyle;ctx.fillRect(0,0,c.width,c.height);ctx.fillStyle=_8c0.gutterStyle;ctx.fillRect(0,0,this.gutterWidth,c.height);}ctx.save();ctx.translate(0,Math.round(this.yoffset));if(_8c7){if(bespin.get("parser")){for(_8c4=this.firstVisibleRow;_8c4<=_8c5;_8c4++){if(_8d5[_8c4]){y=this.lineHeight*(_8c4-1);cy=y+(this.lineHeight-this.LINE_INSETS.bottom);ctx.fillStyle=this.editor.theme["lineMarker"+_8d5[_8c4].type+"Color"];ctx.fillRect(0,y,this.gutterWidth,this.lineHeight);}}}y=(this.lineHeight*this.firstVisibleRow);for(_8c4=this.firstVisibleRow;_8c4<=_8c5;_8c4++){x=0;if(this.editor.debugMode){if(_8d4[_8c4]){var bpx=x+this.DEBUG_GUTTER_INSETS.left;var bpy=y+this.DEBUG_GUTTER_INSETS.top;var bpw=this.DEBUG_GUTTER_WIDTH-this.DEBUG_GUTTER_INSETS.left-this.DEBUG_GUTTER_INSETS.right;var bph=this.lineHeight-this.DEBUG_GUTTER_INSETS.top-this.DEBUG_GUTTER_INSETS.bottom;var _8de=bpx+parseInt(bpw/2);var _8df=bpy+parseInt(bph/2);ctx.strokeStyle="rgb(128, 0, 0)";ctx.fillStyle="rgb(255, 102, 102)";ctx.beginPath();ctx.arc(_8de,_8df,bpw/2,0,Math.PI*2,true);ctx.closePath();ctx.fill();ctx.stroke();}x+=this.DEBUG_GUTTER_WIDTH;}x+=this.GUTTER_INSETS.left;cy=y+(this.lineHeight-this.LINE_INSETS.bottom);ctx.fillStyle=_8c0.lineNumberColor;ctx.font=this.editor.theme.lineNumberFont;ctx.fillText(_8c4+1,x,cy);y+=this.lineHeight;}}ctx.save();ctx.beginPath();ctx.rect(this.gutterWidth,-this.yoffset,_8c8-this.gutterWidth,_8c9);ctx.closePath();ctx.translate(this.xoffset,0);ctx.clip();var _8e0=Math.floor(Math.abs(this.xoffset/this.charWidth));var _8e1=_8e0+(Math.ceil((_8c8-this.gutterWidth)/this.charWidth));y=(this.lineHeight*this.firstVisibleRow);var cc;var ce;var ri;var _8e5;var tx,tw,tsel;var _8e9=bespin.get("settings");var _8ea=(this.searchString?this.searchString.length:-1);for(_8c4=this.firstVisibleRow;_8c4<=_8c5;_8c4++){x=this.gutterWidth;if(!_8c7){if(!_8d9[_8c4]){y+=this.lineHeight;continue;}ctx.save();ctx.beginPath();ctx.rect(x+(Math.abs(this.xoffset)),y,_8c8,this.lineHeight);ctx.closePath();ctx.clip();if((_8c4%2)==1){ctx.fillStyle=_8c0.backgroundStyle;ctx.fillRect(x+(Math.abs(this.xoffset)),y,_8c8,this.lineHeight);}}if((_8e9&&_8e9.isSettingOn("highlightline"))&&(_8c4==ed.cursorManager.getCursorPosition().row)){ctx.fillStyle=_8c0.highlightCurrentLineColor;ctx.fillRect(x+(Math.abs(this.xoffset)),y,_8c8,this.lineHeight);}else{if((_8c4%2)==0){ctx.fillStyle=_8c0.zebraStripeColor;ctx.fillRect(x+(Math.abs(this.xoffset)),y,_8c8,this.lineHeight);}}x+=this.LINE_INSETS.left;cy=y+(this.lineHeight-this.LINE_INSETS.bottom);var _8eb=this.selectionHelper.getRowSelectionPositions(_8c4);if(_8eb){tx=x+(_8eb.startCol*this.charWidth);tw=(_8eb.endCol==-1)?(_8e1-_8e0)*this.charWidth:(_8eb.endCol-_8eb.startCol)*this.charWidth;ctx.fillStyle=_8c0.editorSelectedTextBackground;ctx.fillRect(tx,y,tw,this.lineHeight);}var _8ec=this.model.getRowMetadata(_8c4);var _8ed=_8ec.lineText;var _8ee=_8ec.searchIndices;var _8ef=this.syntaxModel.getSyntaxStylesPerLine(_8ed,_8c4,this.editor.language);var _8f0=ed.readonly?this.fillTextWithTransparency:this.fillText;for(ri=0;ri<_8ef.regions.length;ri++){var _8f1=_8ef.regions[ri];for(var _8f2 in _8f1){if(!_8f1.hasOwnProperty(_8f2)){continue;}var _8f3="";var _8f4=_8f1[_8f2];var _8f5=0;for(var si=0;si<_8f4.length;si++){var _8f7=_8f4[si];for(;_8f5<_8f7.start;_8f5++){_8f3+=" ";}_8f3+=_8ef.text.substring(_8f7.start,_8f7.stop);_8f5=_8f7.stop;}ctx.fillStyle=this.editor.theme[_8f2]||"white";ctx.font=this.editor.theme.editorTextFont;_8f0(ctx,_8f3,x,cy);}}if(_8ee){if(_8eb){tsel={startCol:0,endCol:_8ed.length};if(_8eb.startCol!=-1){tsel.startCol=_8eb.startCol;}if(_8eb.endCol!=-1){tsel.endCol=_8eb.endCol;}}else{tsel=false;}for(var i=0;i<_8ee.length;i++){var _8f9=ed.cursorManager.getCursorPosition({col:_8ee[i],row:_8c4}).col;tx=x+_8f9*this.charWidth;ctx.fillStyle=this.editor.theme.searchHighlight;ctx.fillRect(tx,y,_8ea*this.charWidth,this.lineHeight);if(tsel){var _8fa=_8f9;var _8fb=_8f9+_8ea;if(tsel.startCol<_8fb&&tsel.endCol>_8fa){_8fa=Math.max(_8fa,tsel.startCol);_8fb=Math.min(_8fb,tsel.endCol);ctx.fillStyle=this.editor.theme.searchHighlightSelected;ctx.fillRect(x+_8fa*this.charWidth,y,(_8fb-_8fa)*this.charWidth,this.lineHeight);}}ctx.fillStyle=this.editor.theme.editorTextColor||"white";ctx.fillText(_8ed.substring(_8f9,_8f9+_8ea),tx,cy);}}if(_8e9&&(_8e9.isSettingOn("tabarrow")||_8e9.isSettingOn("tabshowspace"))){if(_8ec.tabExpansions.length>0){for(var i=0;i<_8ec.tabExpansions.length;i++){var _8fc=_8ec.tabExpansions[i];var lx=x+(_8fc.start*this.charWidth);var _8fe=_8e9&&_8e9.isSettingOn("tabshowspace");if(_8fe){var sw=(_8fc.end-_8fc.start)*this.charWidth;ctx.fillStyle=this.editor.theme["tabSpace"]||"white";ctx.fillRect(lx,y,sw,this.lineHeight);}var _900=_8e9&&_8e9.isSettingOn("tabarrow");if(_900){var cy=y+(this.lineHeight/2);var cx=lx+(this.charWidth/2);var tw=4;var th=6;var tx=parseInt(cx-(tw/2));var ty=parseInt(cy-(th/2));ctx.globalAlpha=0.3;ctx.beginPath();ctx.fillStyle=this.editor.theme["plain"]||"white";ctx.moveTo(tx,ty);ctx.lineTo(tx,ty+th);ctx.lineTo(tx+tw,ty+parseInt(th/2));ctx.closePath();ctx.fill();ctx.globalAlpha=1;}}}}if(!_8c7){ctx.drawImage(this.verticalScrollCanvas,_8ce+Math.abs(this.xoffset),Math.abs(this.yoffset));ctx.restore();}y+=this.lineHeight;}if(this.editor.focus){if(this.showCursor){if(ed.theme.cursorType=="underline"){x=this.gutterWidth+this.LINE_INSETS.left+ed.cursorManager.getCursorPosition().col*this.charWidth;y=(ed.getCursorPos().row*this.lineHeight)+(this.lineHeight-5);ctx.fillStyle=ed.theme.cursorStyle;ctx.fillRect(x,y,this.charWidth,3);}else{x=this.gutterWidth+this.LINE_INSETS.left+ed.cursorManager.getCursorPosition().col*this.charWidth;y=(ed.cursorManager.getCursorPosition().row*this.lineHeight);ctx.fillStyle=ed.theme.cursorStyle;ctx.fillRect(x,y,1,this.lineHeight);}}}else{x=this.gutterWidth+this.LINE_INSETS.left+ed.cursorManager.getCursorPosition().col*this.charWidth;y=(ed.cursorManager.getCursorPosition().row*this.lineHeight);ctx.fillStyle=ed.theme.unfocusedCursorFillStyle;ctx.strokeStyle=ed.theme.unfocusedCursorStrokeStyle;ctx.fillRect(x,y,this.charWidth,this.lineHeight);ctx.strokeRect(x,y,this.charWidth,this.lineHeight);}var _904=bespin.get("editSession");var self=this;if(_904){var _906=_904.getUserEntries();if(_906){_906.forEach(function(_907){if(!_907.clientData.isMe){x=self.gutterWidth+self.LINE_INSETS.left+_907.clientData.cursor.start.col*self.charWidth;y=_907.clientData.cursor.start.row*self.lineHeight;ctx.fillStyle="#ee8c00";ctx.fillRect(x,y,1,self.lineHeight);var _908=ctx.font;ctx.font="6pt Monaco, Lucida Console, monospace";ctx.fillText(_907.handle,x+3,y+self.lineHeight+4);ctx.font=_908;}});}}ctx.restore();ctx.restore();if(!_8c7){return;}if(this.horizontalScrollCanvas.width!=_8c8){this.horizontalScrollCanvas.width=_8c8;}if(this.horizontalScrollCanvas.height!=this.NIB_WIDTH+4){this.horizontalScrollCanvas.height=this.NIB_WIDTH+4;}if(this.verticalScrollCanvas.height!=_8c9){this.verticalScrollCanvas.height=_8c9;}if(this.verticalScrollCanvas.width!=this.NIB_WIDTH+4){this.verticalScrollCanvas.width=this.NIB_WIDTH+4;}var hctx=this.horizontalScrollCanvas.getContext("2d");hctx.clearRect(0,0,this.horizontalScrollCanvas.width,this.horizontalScrollCanvas.height);hctx.save();var vctx=this.verticalScrollCanvas.getContext("2d");vctx.clearRect(0,0,this.verticalScrollCanvas.width,this.verticalScrollCanvas.height);vctx.save();var _90b=(this.overYScrollBar)||(this.yscrollbar.mousedownValue!=null)?{n:ed.theme.fullNibStyle,a:ed.theme.fullNibArrowStyle,s:ed.theme.fullNibStrokeStyle}:{n:ed.theme.partialNibStyle,a:ed.theme.partialNibArrowStyle,s:ed.theme.partialNibStrokeStyle};var _90c=(this.overXScrollBar)||(this.xscrollbar.mousedownValue!=null)?{n:ed.theme.fullNibStyle,a:ed.theme.fullNibArrowStyle,s:ed.theme.fullNibStrokeStyle}:{n:ed.theme.partialNibStyle,a:ed.theme.partialNibArrowStyle,s:ed.theme.partialNibStrokeStyle};var _90d=Math.floor(this.NIB_WIDTH/2);this.nibup=new Rect(_8c8-this.NIB_INSETS.right-this.NIB_WIDTH,this.NIB_INSETS.top,this.NIB_WIDTH,this.NIB_WIDTH);this.nibdown=new Rect(_8c8-this.NIB_INSETS.right-this.NIB_WIDTH,_8c9-(this.NIB_WIDTH*2)-(this.NIB_INSETS.bottom*2),this.NIB_INSETS.top,this.NIB_WIDTH,this.NIB_WIDTH);this.nibleft=new Rect(this.gutterWidth+this.NIB_INSETS.left,_8c9-this.NIB_INSETS.bottom-this.NIB_WIDTH,this.NIB_WIDTH,this.NIB_WIDTH);this.nibright=new Rect(_8c8-(this.NIB_INSETS.right*2)-(this.NIB_WIDTH*2),_8c9-this.NIB_INSETS.bottom-this.NIB_WIDTH,this.NIB_WIDTH,this.NIB_WIDTH);vctx.translate(-_8ce,0);hctx.translate(0,-_8cf);if(_8cc&&((this.overXScrollBar)||(this.xscrollbar.mousedownValue!=null))){hctx.save();hctx.beginPath();hctx.rect(this.nibleft.x+_90d+2,0,this.nibright.x-this.nibleft.x-1,_8c9);hctx.closePath();hctx.clip();hctx.fillStyle=ed.theme.scrollTrackFillStyle;hctx.fillRect(this.nibleft.x,this.nibleft.y-1,this.nibright.x2-this.nibleft.x,this.nibleft.h+1);hctx.strokeStyle=ed.theme.scrollTrackStrokeStyle;hctx.strokeRect(this.nibleft.x,this.nibleft.y-1,this.nibright.x2-this.nibleft.x,this.nibleft.h+1);hctx.restore();}if(_8cd&&((this.overYScrollBar)||(this.yscrollbar.mousedownValue!=null))){vctx.save();vctx.beginPath();vctx.rect(0,this.nibup.y+_90d+2,_8c8,this.nibdown.y-this.nibup.y-1);vctx.closePath();vctx.clip();vctx.fillStyle=ed.theme.scrollTrackFillStyle;vctx.fillRect(this.nibup.x-1,this.nibup.y,this.nibup.w+1,this.nibdown.y2-this.nibup.y);vctx.strokeStyle=ed.theme.scrollTrackStrokeStyle;vctx.strokeRect(this.nibup.x-1,this.nibup.y,this.nibup.w+1,this.nibdown.y2-this.nibup.y);vctx.restore();}if(_8cd){if((_8d2)||(this.overYScrollBar)||(this.yscrollbar.mousedownValue!=null)){vctx.save();vctx.translate(this.nibup.x+_90d,this.nibup.y+_90d);this.paintNib(vctx,_90b.n,_90b.a,_90b.s);vctx.restore();}if((_8d3)||(this.overYScrollBar)||(this.yscrollbar.mousedownValue!=null)){vctx.save();vctx.translate(this.nibdown.x+_90d,this.nibdown.y+_90d);vctx.rotate(Math.PI);this.paintNib(vctx,_90b.n,_90b.a,_90b.s);vctx.restore();}}if(_8cc){if((_8d0)||(this.overXScrollBar)||(this.xscrollbar.mousedownValue!=null)){hctx.save();hctx.translate(this.nibleft.x+_90d,this.nibleft.y+_90d);hctx.rotate(Math.PI*1.5);this.paintNib(hctx,_90c.n,_90c.a,_90c.s);hctx.restore();}if((_8d1)||(this.overXScrollBar)||(this.xscrollbar.mousedownValue!=null)){hctx.save();hctx.translate(this.nibright.x+_90d,this.nibright.y+_90d);hctx.rotate(Math.PI*0.5);this.paintNib(hctx,_90c.n,_90c.a,_90c.s);hctx.restore();}}var sx=this.nibleft.x2+4;var sw=this.nibright.x-this.nibleft.x2-9;this.xscrollbar.rect=new Rect(sx,this.nibleft.y-1,sw,this.nibleft.h+1);this.xscrollbar.value=-this.xoffset;this.xscrollbar.min=0;this.xscrollbar.max=_8cb-(_8c8-this.gutterWidth);this.xscrollbar.extent=_8c8-this.gutterWidth;if(_8cc){var _90f=(((this.overXScrollBar)&&(_8cb>_8c8))||((this.xscrollbar)&&(this.xscrollbar.mousedownValue!=null)));if(!_90f){hctx.globalAlpha=0.3;}this.paintScrollbar(hctx,this.xscrollbar);hctx.globalAlpha=1;}var sy=this.nibup.y2+4;var sh=this.nibdown.y-this.nibup.y2-9;this.yscrollbar.rect=new Rect(this.nibup.x-1,sy,this.nibup.w+1,sh);this.yscrollbar.value=-this.yoffset;this.yscrollbar.min=0;this.yscrollbar.max=_8ca-(_8c9-this.BOTTOM_SCROLL_AFFORDANCE);this.yscrollbar.extent=_8c9;if(_8cd){var _912=((this.overYScrollBar)&&(_8ca>_8c9))||((this.yscrollbar)&&(this.yscrollbar.mousedownValue!=null));if(!_912){vctx.globalAlpha=0.3;}this.paintScrollbar(vctx,this.yscrollbar);vctx.globalAlpha=1;}ctx.drawImage(this.verticalScrollCanvas,_8ce,0);ctx.drawImage(this.horizontalScrollCanvas,0,_8cf);hctx.restore();vctx.restore();if(!_8d2){this.nibup=new Rect();}if(!_8d3){this.nibdown=new Rect();}if(!_8d0){this.nibleft=new Rect();}if(!_8d1){this.nibright=new Rect();}this.xscrollbarVisible=_8cc;this.yscrollbarVisible=_8cd;},paintScrollbar:function(ctx,_914){var bar=_914.getHandleBounds();var _916=(ctx.globalAlpha)?ctx.globalAlpha:1;if(!_914.isH()){ctx.save();ctx.translate(bar.x+Math.floor(bar.w/2),bar.y+Math.floor(bar.h/2));ctx.rotate(Math.PI*1.5);ctx.translate(-(bar.x+Math.floor(bar.w/2)),-(bar.y+Math.floor(bar.h/2)));bar=new bespin.editor.Rect(bar.x-Math.floor(bar.h/2)+Math.floor(bar.w/2),bar.y+Math.floor(bar.h/2)-Math.floor(bar.w/2),bar.h,bar.w);}var _917=bar.h/2;ctx.beginPath();ctx.arc(bar.x+_917,bar.y+_917,_917,Math.PI/2,3*(Math.PI/2),false);ctx.arc(bar.x2-_917,bar.y+_917,_917,3*(Math.PI/2),Math.PI/2,false);ctx.lineTo(bar.x+_917,bar.y+bar.h);ctx.closePath();var _918=ctx.createLinearGradient(bar.x,bar.y,bar.x,bar.y+bar.h);_918.addColorStop(0,this.editor.theme.scrollBarFillGradientTopStart.replace(/%a/,_916));_918.addColorStop(0.4,this.editor.theme.scrollBarFillGradientTopStop.replace(/%a/,_916));_918.addColorStop(0.41,this.editor.theme.scrollBarFillStyle.replace(/%a/,_916));_918.addColorStop(0.8,this.editor.theme.scrollBarFillGradientBottomStart.replace(/%a/,_916));_918.addColorStop(1,this.editor.theme.scrollBarFillGradientBottomStop.replace(/%a/,_916));ctx.fillStyle=_918;ctx.fill();ctx.save();ctx.clip();ctx.fillStyle=this.editor.theme.scrollBarFillStyle.replace(/%a/,_916);ctx.beginPath();ctx.moveTo(bar.x+(_917*0.4),bar.y+(_917*0.6));ctx.lineTo(bar.x+(_917*0.9),bar.y+(bar.h*0.4));ctx.lineTo(bar.x,bar.y+(bar.h*0.4));ctx.closePath();ctx.fill();ctx.beginPath();ctx.moveTo(bar.x+bar.w-(_917*0.4),bar.y+(_917*0.6));ctx.lineTo(bar.x+bar.w-(_917*0.9),bar.y+(bar.h*0.4));ctx.lineTo(bar.x+bar.w,bar.y+(bar.h*0.4));ctx.closePath();ctx.fill();ctx.restore();ctx.beginPath();ctx.arc(bar.x+_917,bar.y+_917,_917,Math.PI/2,3*(Math.PI/2),false);ctx.arc(bar.x2-_917,bar.y+_917,_917,3*(Math.PI/2),Math.PI/2,false);ctx.lineTo(bar.x+_917,bar.y+bar.h);ctx.closePath();ctx.strokeStyle=this.editor.theme.scrollTrackStrokeStyle;ctx.stroke();if(!_914.isH()){ctx.restore();}},paintNib:function(ctx,_91a,_91b,_91c){var _91d=Math.floor(this.NIB_WIDTH/2);ctx.fillStyle=_91a;ctx.beginPath();ctx.arc(0,0,Math.floor(this.NIB_WIDTH/2),0,Math.PI*2,true);ctx.closePath();ctx.fill();ctx.strokeStyle=_91c;ctx.stroke();ctx.fillStyle=_91b;ctx.beginPath();ctx.moveTo(0,-_91d+this.NIB_ARROW_INSETS.top);ctx.lineTo(-_91d+this.NIB_ARROW_INSETS.left,_91d-this.NIB_ARROW_INSETS.bottom);ctx.lineTo(_91d-this.NIB_ARROW_INSETS.right,_91d-this.NIB_ARROW_INSETS.bottom);ctx.closePath();ctx.fill();},getRowString:function(row){return this.model.getRowMetadata(row).lineText;},getRowScreenLength:function(row){return this.getRowString(row).length;},getMaxCols:function(_920,_921){var cols=0;for(var i=_920;i<=_921;i++){cols=Math.max(cols,this.getRowScreenLength(i));}return cols;},setSearchString:function(str){if(str&&str!=""){this.searchString=str;}else{delete this.searchString;}this.model.searchStringChanged(this.searchString);this.editor.paint(true);},dispose:function(){for(var i=0;i<this.globalHandles.length;i++){dojo.disconnect(this.globalHandles[i]);}}});dojo.declare("bespin.editor.API",null,{constructor:function(_926,opts){this.opts=opts||{};this.debugMode=false;this.container=dojo.byId(_926);this.model=new bespin.editor.DocumentModel(this);this.container.innerHTML="<canvas id=\"canvas\" moz-opaque=\"true\" tabindex=\"-1\"></canvas>";this.canvas=this.container.firstChild;while(this.canvas&&this.canvas.nodeType!=1){this.canvas=this.canvas.nextSibling;}this.cursorManager=new bespin.editor.CursorManager(this);this.ui=new bespin.editor.UI(this);this.theme=bespin.themes["default"];this.editorKeyListener=new bespin.editor.DefaultEditorKeyListener(this);this.historyManager=new bespin.editor.HistoryManager(this);this.customEvents=new bespin.editor.Events(this);this.ui.installKeyListener(this.editorKeyListener);this.model.insertCharacters({row:0,col:0}," ");dojo.connect(this.canvas,"blur",dojo.hitch(this,function(e){this.setFocus(false);}));dojo.connect(this.canvas,"focus",dojo.hitch(this,function(e){this.setFocus(true);}));bespin.editor.clipboard.setup(this);this.paint();if(!this.opts.dontfocus){this.setFocus(true);}},getSelection:function(_92a){_92a=(_92a!=undefined)?_92a:this.selection;if(!_92a){return undefined;}var _92b=_92a.startPos;var _92c=_92a.endPos;if((_92c.row<_92b.row)||((_92c.row==_92b.row)&&(_92c.col<_92b.col))){var foo=_92b;_92b=_92c;_92c=foo;}return {startPos:bespin.editor.utils.copyPos(_92b),endPos:bespin.editor.utils.copyPos(_92c),startModelPos:this.getModelPos(_92b),endModelPos:this.getModelPos(_92c)};},getCursorPos:function(_92e){return this.cursorManager.getCursorPosition(_92e);},getModelPos:function(pos){return this.cursorManager.getModelPosition(pos);},moveCursor:function(pos){this.cursorManager.moveCursor(pos);},resetView:function(data){this.cursorManager.moveCursor(data.cursor);this.setSelection(data.selection);this.ui.yoffset=data.offset.y;this.ui.xoffset=data.offset.x;},basicView:function(){this.cursorManager.moveCursor({row:0,col:0});this.setSelection(undefined);this.ui.yoffset=0;this.ui.xoffset=0;},getCurrentView:function(){return {cursor:this.getCursorPos(),offset:{x:this.ui.xoffset,y:this.ui.yoffset},selection:this.selection};},getState:function(){return {cursor:this.getCursorPos(),selection:this.getSelection()};},setState:function(data){this.cursorManager.moveCursor(data.cursor);this.setSelection(data.selection);this.ui.ensureCursorVisible();this.paint(false);},getTabSize:function(){var _933=bespin.get("settings");var size=bespin.defaultTabSize;if(_933){var _935=parseInt(_933.get("tabsize"));if(_935>0){size=_935;}}return size;},getSelectionAsText:function(){var _936="";var _937=this.getSelection();if(_937){_936=this.model.getChunk(_937);}return _936;},setSelection:function(_938){this.selection=_938;},paint:function(_939){var ctx=bespin.util.canvas.fix(this.canvas.getContext("2d"));this.ui.paint(ctx,_939);},changeKeyListener:function(_93b){this.ui.installKeyListener(_93b);this.editorKeyListener=_93b;},setFocus:function(_93c){this.focus=_93c;if(_93c){this.canvas.focus();}},setReadOnly:function(_93d){this.readonly=_93d;},dispose:function(){bespin.editor.clipboard.uninstall();this.ui.dispose();},bindKey:function(_93e,_93f,_940){console.warn("Use of editor.bindKey(",_93e,_93f,_940,") seems doomed to fail");var _941=bespin.util.keys.fillArguments(_93f);var key=_941.key;var _943=_941.modifiers;if(!key){return;}var _944=bespin.util.keys.toKeyCode(key);var _945="Execute command: '"+_93e+"'";var _93e=this.ui.actions[_93e]||function(){bespin.get("commandLine").executeCommand(command,true);};if(_944&&_93e){if(_940){this.editorKeyListener.bindKeyStringSelectable(_943,_944,_93e,_945);}else{this.editorKeyListener.bindKeyString(_943,_944,_93e,_945);}}},bindCommand:function(_946,_947){var _948=bespin.util.keys.fillArguments(_947);var _949=bespin.util.keys.toKeyCode(_948.key);var _94a=function(){bespin.getComponent("commandLine",function(cli){cli.executeCommand(_946,true);});};var _94c="Execute command: '"+_946+"'";this.editorKeyListener.bindKeyString(_948.modifiers,_949,_94a,_94c);},moveAndCenter:function(row){if(!row){return;}var _94e=row-1;this.cursorManager.moveCursor({row:_94e,col:0});if((_94e<this.ui.firstVisibleRow)||(_94e>=this.ui.firstVisibleRow+this.ui.visibleRows)){this.ui.actions.moveCursorRowToCenter();}},newFile:function(_94f,path,_951){_94f=_94f||bespin.get("editSession").project;path=path||"new.txt";var self=this;var _953=function(){if(bespin.get("settings").isSettingOff("collaborate")){self.model.insertDocument(_951||"");self.cursorManager.moveCursor({row:0,col:0});self.setFocus(true);}bespin.publish("editor:openfile:opensuccess",{project:_94f,file:{name:path,content:_951||"",timestamp:new Date().getTime()}});bespin.publish("editor:dirty");};bespin.get("files").newFile(_94f,path,_953);},saveFile:function(_954,_955,_956,_957){_954=_954||bespin.get("editSession").project;_955=_955||bespin.get("editSession").path;dojo.cookie("viewData_"+_954+"_"+_955.split("/").join("_"),dojo.toJson(bespin.get("editor").getCurrentView()),{expires:7});var file={name:_955,content:this.model.getDocument(),timestamp:new Date().getTime()};var _959=function(){document.title=_955+" - editing with Bespin";var _95a=bespin.get("commandLine");if(_95a){_95a.showHint("Saved file: "+file.name);}bespin.publish("editor:clean");if(dojo.isFunction(_956)){_956();}};var _95b=function(xhr){var _95d=bespin.get("commandLine");if(_95d){_95d.showHint("Save failed: "+xhr.responseText);}if(dojo.isFunction(_957)){_957();}};bespin.publish("editor:savefile:before",{filename:_955});bespin.get("files").saveFile(_954,file,_959,_95b);},openFile:function(_95e,_95f,_960){var _961=bespin.get("editSession");var _962=bespin.get("commandLine");var self=this;var _95e=_95e||_961.project;var _95f=_95f||_961.path;var _960=_960||{};var _964=_960.fromFileHistory||false;if(_961.checkSameFile(_95e,_95f)&&!_960.reload){if(_960.line){_962.executeCommand("goto "+_960.line,true);}return;}if(this.dirty&&!_961.shouldCollaborate()){var _965=function(xhr){_962.showHint("Trying to save current file. Failed: "+xhr.responseText);};var _967=function(){self.openFile(_95e,_95f,_960);};this.saveFile(null,null,_967,_965);return;}if(_960.force){bespin.get("files").whenFileDoesNotExist(_95e,_95f,{execute:function(){self.newFile(_95e,_95f,_960.content||"");},elseFailed:function(){_960.force=false;self.openFile(_95e,_95f,_960);}});return;}var _965=function(){bespin.publish("editor:openfile:openfail",{project:_95e,filename:_95f});};var _967=function(file){if(!file){_965();return;}if(file.content!==undefined){self.model.insertDocument(file.content);self.cursorManager.moveCursor({row:0,col:0});self.setFocus(true);}_961.setProjectPath(_95e,_95f);if(_960.line){_962.executeCommand("goto "+_960.line,true);}self._addHistoryItem(_95e,_95f,_964);bespin.publish("editor:openfile:opensuccess",{project:_95e,file:file});};bespin.publish("editor:openfile:openbefore",{project:_95e,filename:_95f});bespin.get("files").editFile(_95e,_95f,_967,_965);},_addHistoryItem:function(_969,_96a,_96b){var _96c=bespin.get("settings");var _96d=_96c.getObject("_lastused");if(!_96d){_96d=[];}var _96e={project:_969,filename:_96a};if(!_96b){bespin.get("editSession").addFileToHistory(_96e);}var _96f=[];dojo.forEach(_96d,function(item){if(item.project!=_96e.project||item.filename!=_96e.filename){_96f.unshift(item);}});_96f.unshift(_96e);_96d=_96f;if(_96d.length>10){_96d=_96d.slice(0,10);}_96c.setObject("_lastused",_96d);}});bespin.subscribe("extension:loaded:bespin.debugger",function(ext){var _972=bespin.get("settings");if(_972&&_972.get("debugmode")){ext.load();}});}if(!dojo._hasResource["bespin.editor.events"]){dojo._hasResource["bespin.editor.events"]=true;dojo.provide("bespin.editor.events");dojo.declare("bespin.editor.Events",null,{constructor:function(_973){bespin.subscribe("editor:openfile:opensuccess",function(_974){var _975=_974.project||bespin.get("editSession").project;var _976=_974.file.name;try{var data=dojo.cookie("viewData_"+_975+"_"+_976.split("/").join("_"));if(data){bespin.get("editor").resetView(dojo.fromJson(data));}else{bespin.get("editor").basicView();}}catch(e){console.log("Error setting in the view: ",e);}document.title=_976+" - editing with Bespin";bespin.publish("url:change",{project:_975,path:_976});});bespin.subscribe("url:change",function(_978){var _979=dojo.queryToObject(location.hash.substring(1));_979.project=_978.project;_979.path=_978.path;var _97a=[];for(var name in _979){var _97c=_979[name];_97a.push(name+"="+_97c);}window.location.hash=_97a.join("&");});bespin.subscribe("url:changed",function(_97d){_973.openFile(null,_97d.now.get("path"));});bespin.subscribe("cmdline:focus",function(_97e){_973.setFocus(false);});bespin.subscribe("cmdline:blur",function(_97f){_973.setFocus(true);});bespin.subscribe("editor:document:changed",function(_980){bespin.publish("editor:dirty");});bespin.subscribe("editor:dirty",function(_981){_973.dirty=true;});bespin.subscribe("editor:clean",function(_982){_973.dirty=false;});}});}if(!dojo._hasResource["bespin.editor.model"]){dojo._hasResource["bespin.editor.model"]=true;dojo.provide("bespin.editor.model");dojo.declare("bespin.editor.DocumentModel",null,{constructor:function(_983){this.editor=_983;this.clear();},addHistoryItem:function(func,data){this.history.length=this.historyIndex+1;this.history.push({func:func,data:data});this.historyIndex++;},performHistoryItem:function(item){var func=item.func;var data=item.data;switch(func){case "deleteCharacters":this.deleteCharacters(data.pos,data.characters.length,true);break;case "insertCharacters":this.insertCharacters(data.pos,data.characters,true);break;case "deleteChunk":this.deleteChunk(data.selection,data.chunk,true);break;case "insertChunk":this.insertChunk(data.selection.startModelPos,data.chunk,true);break;case "joinRow":this.joinRow(data.selection.startModelPos.row,true);break;case "replaceRow":this.replaceRow(data.row,item.undo?data.oldline:data.newline,true);break;}},unperformHistoryItem:function(item){var func=item.func;var data=item.data;switch(func){case "deleteCharacters":func="insertCharacters";break;case "insertCharacters":func="deleteCharacters";break;case "deleteChunk":func="insertChunk";break;case "insertChunk":func="deleteChunk";break;case "joinRow":func="insertChunk";break;}this.performHistoryItem({func:func,data:data,undo:true});},applyState:function(_98c){if(_98c>=this.history.length||_98c<-1){return;}else{if(_98c==this.historyIndex){return;}}if(_98c>this.historyIndex){for(var i=this.historyIndex+1;i<=_98c;i++){var _98e=this.history[i];this.performHistoryItem(_98e);}}else{for(var i=this.historyIndex;i>_98c;i--){var _98e=this.history[i];this.unperformHistoryItem(_98e);}}this.historyIndex=_98c;},getState:function(){return this.historyIndex;},isEmpty:function(){if(this.rows.length>1){return false;}if(this.rows.length==1&&this.rows[0].length>0){return false;}return true;},getDirtyRows:function(){var dr=(this.dirtyRows)?this.dirtyRows:[];this.dirtyRows=null;return dr;},setRowDirty:function(row){if(!this.dirtyRows){this.dirtyRows=new Array(this.rows.length);}this.dirtyRows[row]=true;},isRowDirty:function(row){if(!this.dirtyRows){return true;}return this.dirtyRows[row];},setRowArray:function(_992,row){if(!dojo.isArray(row)){row=row.split("");}this.rows[_992]=row;},getRowArray:function(_994){while(this.rows.length<=_994){this.rows.push([]);}return this.rows[_994];},hasRow:function(_995){return (this.rows[_995]);},insertCharacters:function(_996,_997,_998){var row=this.getRowArray(_996.row);while(row.length<_996.col){row.push(" ");}var _99a=(_996.col>0)?row.splice(0,_996.col):[];_99a=_99a.concat(_997.split(""));this.rows[_996.row]=_99a.concat(row);this.setRowDirty(_996.row);this.editor.ui.syntaxModel.invalidateCache(_996.row);if(!_998){this.addHistoryItem("insertCharacters",{pos:bespin.editor.utils.copyPos(_996),characters:_997});}},getDocument:function(){var file=[];for(var x=0;x<this.getRowCount();x++){file[x]=this.getRowArray(x).join("");}return file.join("\n");},insertDocument:function(_99d){this.clear();var rows=_99d.split("\n");for(var x=0;x<rows.length;x++){this.insertCharacters({row:x,col:0},rows[x],true);}},changeEachRow:function(_9a0){for(var x=0;x<this.getRowCount();x++){var row=this.getRowArray(x);row=_9a0(row);this.setRowArray(x,row);}},replace:function(_9a3,_9a4){var _9a5=new RegExp(_9a3,"g");for(var x=0;x<this.getRowCount();x++){var line=this.getRowArray(x).join("");var _9a8=line.replace(_9a5,_9a4);if(_9a8!=line){this.replaceRow(x,_9a8);}}},replaceRow:function(row,_9aa,_9ab){var _9ac=this.getRowArray(row).join("");this.rows[row]=_9aa.split("");if(!_9ab){this.addHistoryItem("replaceRow",{row:row,oldline:_9ac,newline:_9aa});}},deleteCharacters:function(_9ad,_9ae,_9af){var row=this.getRowArray(_9ad.row);var diff=(_9ad.col+_9ae-1)-row.length;if(diff>0){_9ae-=diff;}if(_9ae>0){this.setRowDirty(_9ad.row);this.editor.ui.syntaxModel.invalidateCache(_9ad.row);var _9b2=row.splice(_9ad.col,_9ae).join("");if(!_9af){this.addHistoryItem("deleteCharacters",{pos:bespin.editor.utils.copyPos(_9ad),characters:_9b2});}return _9b2;}return "";},clear:function(){this.rows=[];this.cacheRowMetadata=[];this.history=[];this.historyIndex=-1;},deleteRows:function(row,_9b4){var diff=(row+_9b4-1)-this.rows.length;if(diff>0){_9b4-=diff;}if(_9b4>0){this.rows.splice(row,_9b4);this.cacheRowMetadata.splice(row,_9b4);}},splitRow:function(_9b6){this.editor.ui.syntaxModel.invalidateCache(_9b6.row);this.setRowDirty(_9b6.row);var row=this.getRowArray(_9b6.row);var _9b8=[];if(_9b6.col<row.length){_9b8=_9b8.concat(row.splice(_9b6.col));}if(_9b6.row==(this.rows.length-1)){this.rows.push(_9b8);}else{var _9b9=this.rows.splice(0,_9b6.row+1);_9b9.push(_9b8);_9b9=_9b9.concat(this.rows);this.rows=_9b9;var _9ba=this.cacheRowMetadata.splice(0,_9b6.row+1);_9ba.push(undefined);this.cacheRowMetadata=_9ba.concat(this.cacheRowMetadata);}},joinRow:function(_9bb,_9bc){this.editor.ui.syntaxModel.invalidateCache(_9bb);this.setRowDirty(_9bb);if(_9bb>=this.rows.length-1){return;}var row=this.getRowArray(_9bb);var _9be=this.rows[_9bb+1];var _9bf=row.length;this.rows[_9bb]=row.concat(_9be);this.rows.splice(_9bb+1,1);this.cacheRowMetadata.splice(_9bb+1,1);if(!_9bc){var pos={row:_9bb,col:_9bf};this.addHistoryItem("joinRow",{selection:{startModelPos:pos,endModelPos:pos},chunk:"\n"});}},getRowCount:function(){return this.rows.length;},getChunk:function(_9c1){var _9c2=_9c1.startModelPos;var _9c3=_9c1.endModelPos;var _9c4,_9c5;var _9c6="";_9c4=_9c2.col;var row=this.getRowArray(_9c2.row);_9c5=(_9c3.row==_9c2.row)?_9c3.col:row.length;if(_9c5>row.length){_9c5=row.length;}_9c6+=row.join("").substring(_9c4,_9c5);for(var i=_9c2.row+1;i<_9c3.row;i++){_9c6+="\n";_9c6+=this.getRowArray(i).join("");}if(_9c2.row!=_9c3.row){_9c4=0;_9c5=_9c3.col;row=this.getRowArray(_9c3.row);if(_9c5>row.length){_9c5=row.length;}_9c6+="\n"+row.join("").substring(_9c4,_9c5);}return _9c6;},deleteChunk:function(_9c9,_9ca){var _9cb=this.getChunk(_9c9);var _9cc=_9c9.startModelPos;var _9cd=_9c9.endModelPos;this.editor.ui.syntaxModel.invalidateCache(_9cc.row);var _9ce,_9cf;_9ce=_9cc.col;var row=this.getRowArray(_9cc.row);_9cf=(_9cd.row==_9cc.row)?_9cd.col:row.length;if(_9cf>row.length){_9cf=row.length;}this.deleteCharacters({row:_9cc.row,col:_9ce},_9cf-_9ce,true);if(_9cc.row!=_9cd.row){_9ce=0;_9cf=_9cd.col;row=this.getRowArray(_9cd.row);if(_9cf>row.length){_9cf=row.length;}this.deleteCharacters({row:_9cd.row,col:_9ce},_9cf-_9ce,true);}if((_9cd.row-_9cc.row)>1){this.deleteRows(_9cc.row+1,_9cd.row-_9cc.row-1);}if(_9cd.row!=_9cc.row){this.joinRow(_9cc.row,true);}if(!_9ca){this.addHistoryItem("deleteChunk",{selection:{startModelPos:bespin.editor.utils.copyPos(_9c9.startModelPos),endModelPos:bespin.editor.utils.copyPos(_9c9.endModelPos)},chunk:_9cb});}return _9cb;},insertChunk:function(_9d1,_9d2,_9d3){this.editor.ui.syntaxModel.invalidateCache(_9d1.row);var _9d4=_9d2.split("\n");var _9d5=bespin.editor.utils.copyPos(_9d1);for(var i=0;i<_9d4.length;i++){this.insertCharacters(_9d5,_9d4[i],true);_9d5.col=_9d5.col+_9d4[i].length;if(i<_9d4.length-1){this.splitRow(_9d5);_9d5.col=0;_9d5.row=_9d5.row+1;}}if(!_9d3){this.addHistoryItem("insertChunk",{selection:{startModelPos:bespin.editor.utils.copyPos(_9d1),endModelPos:bespin.editor.utils.copyPos(_9d5)},chunk:_9d2});}return _9d5;},getStringIndicesInRow:function(row,str){str=str.toLowerCase();var row=this.getRowArray(row).join("").toLowerCase();if(row.indexOf(str)==-1){return false;}var _9d9=new Array();var _9da=0;var _9db=row.indexOf(str);do{_9d9.push(_9db);_9db=row.indexOf(str,_9db+1);}while(_9db!=-1);return _9d9;},getCountOfString:function(str){var _9dd=0;var line;var _9df;for(var x=0;x<this.getRowCount();x++){_9df=this.getStringIndicesInRow(x,str);if(_9df){_9dd+=_9df.length;}}return _9dd;},searchStringChanged:function(str){for(var row=0;row<this.cacheRowMetadata.length;row++){if(this.cacheRowMetadata[row]){if(str){this.cacheRowMetadata[row].searchIndices=this.getStringIndicesInRow(row,str);}else{this.cacheRowMetadata[row].searchIndices=false;}}}},findPrev:function(row,col,str){var _9e6;var _9e7=str.length;for(var x=row;x>-1;x--){_9e6=this.getStringIndicesInRow(x,str);if(!_9e6){continue;}for(var y=_9e6.length-1;y>-1;y--){if(_9e6[y]<(col-_9e7)||row!=x){return {startPos:{col:_9e6[y],row:x},endPos:{col:_9e6[y]+_9e7,row:x}};}}}return false;},findNext:function(row,col,str){var _9ed;for(var x=row;x<this.getRowCount();x++){_9ed=this.getStringIndicesInRow(x,str);if(!_9ed){continue;}for(var y=0;y<_9ed.length;y++){if(_9ed[y]>col||row!=x){return {startPos:{col:_9ed[y],row:x},endPos:{col:_9ed[y]+str.length,row:x}};}}}return false;},findBefore:function(row,col,_9f2){var line=this.getRowArray(row);if(!dojo.isFunction(_9f2)){_9f2=function(_9f4){if(_9f4.charAt(0)==" "){return true;}var _9f5=_9f4.charCodeAt(0);return (_9f5<48)||(_9f5>122);};}if(col>=line.length){col=Math.max(line.length-1,0);}while(col>0){var _9f6=line[col];if(!_9f6){continue;}if(_9f2(_9f6)){col++;break;}col--;}return {row:row,col:col};},findAfter:function(row,col,_9f9){var line=this.getRowArray(row);if(!dojo.isFunction(_9f9)){_9f9=function(_9fb){if(_9fb.charAt(0)==" "){return true;}var _9fc=_9fb.charCodeAt(0);return (_9fc<48)||(_9fc>122);};}while(col<line.length){col++;var _9fd=line[col];if(!_9fd){continue;}if(_9f9(_9fd)){break;}}return {row:row,col:col};},getRowMetadata:function(row){if(!this.isRowDirty(row)&&this.cacheRowMetadata[row]){return this.cacheRowMetadata[row];}var meta={tabExpansions:[]};var _a00=this.editor.model.getRowArray(row);var _a01=_a00.join("");var _a02=this.editor.getTabSize();meta.lineTextWithoutTabExpansion=_a01;meta.lineLengthWithoutTabExpansion=_a00.length;for(var ti=0;ti<_a01.length;ti++){if(_a01.charCodeAt(ti)==9){var _a04=_a02-(ti%_a02);var _a05="";for(var si=1;si<_a04;si++){_a05+=" ";}var left=(ti==0)?"":_a01.substring(0,ti);var _a08=(ti<_a01.length-1)?_a01.substring(ti+1):"";_a01=left+" "+_a05+_a08;meta.tabExpansions.push({start:left.length,end:left.length+_a05.length+1});ti+=_a04-1;}}meta.lineText=_a01;meta.lineLength=meta.lineText.length;if(this.editor.ui.searchString){meta.searchIndices=this.getStringIndicesInRow(row,this.editor.ui.searchString);}else{meta.searchIndices=false;}this.cacheRowMetadata[row]=meta;return meta;}});}if(!dojo._hasResource["bespin.editor.toolbar"]){dojo._hasResource["bespin.editor.toolbar"]=true;dojo.provide("bespin.editor.toolbar");dojo.declare("bespin.editor.Toolbar",null,{DEFAULT_TOOLBAR:["collaboration","filepopup","commandline","target_browsers","save","close","preview","fontsize"],showCollab:false,showFiles:false,showTarget:false,showCollabHotCounter:0,constructor:function(_a09,opts){this.editor=_a09||bespin.get("editor");if(opts.setupDefault){this.setupDefault();}bespin.publish("toolbar:init",{toolbar:this});},setup:function(type,el,_a0d){if(dojo.isFunction(_a0d)){this.addComponent(type,_a0d);}if(dojo.isFunction(this.components[type])){this.components[type](this,el);}},setupDefault:function(){dojo.forEach(this.DEFAULT_TOOLBAR,dojo.hitch(this,function(item){var _a0f=dojo.byId("toolbar_"+item);if(_a0f){this.setup(item,_a0f);}}));},addComponent:function(type,_a11){this.components[type]=_a11;},components:{collaboration:function(_a12,el){var _a14=dojo.byId(el)||dojo.byId("toolbar_collaboration");dojo.connect(_a14,"click",function(){_a12.showCollab=!_a12.showCollab;bespin.page.editor.recalcLayout();});},filepopup:function(_a15,el){var _a17=dojo.byId(el)||dojo.byId("toolbar_popup");dojo.connect(_a17,"click",function(){_a15.editor.ui.actions.focusFileBrowser();});dojo.connect(_a17,"mouseover",function(){_a17.style.cursor="pointer";_a17.src="images/icn_filepopup_on.png";});dojo.connect(_a17,"mouseout",function(){_a17.style.cursor="default";_a17.src="images/icn_filepopup.png";});},commandline:function(_a18,el){var _a1a=dojo.byId(el)||dojo.byId("toolbar_commandline");dojo.connect(_a1a,"click",function(){_a18.editor.ui.actions.focusCommandline();});dojo.connect(_a1a,"mouseover",function(){_a1a.style.cursor="pointer";_a1a.src="images/icn_command_on.png";});dojo.connect(_a1a,"mouseout",function(){_a1a.style.cursor="default";_a1a.src="images/icn_command.png";});},target_browsers:function(_a1b,el){var _a1d=dojo.byId(el)||dojo.byId("toolbar_target_browsers");dojo.connect(_a1d,"click",function(){_a1b._showTarget=!_a1b._showTarget;_a1d.src="images/"+((_a1b._showTarget)?"icn_target_on.png":"icn_target_off.png");bespin.page.editor.recalcLayout();});dojo.connect(_a1d,"mouseover",function(){_a1d.style.cursor="pointer";_a1d.src="images/icn_target_on.png";});dojo.connect(_a1d,"mouseout",function(){_a1d.style.cursor="default";_a1d.src="images/icn_target_off.png";});},save:function(_a1e,el){var save=dojo.byId(el)||dojo.byId("toolbar_save");dojo.connect(save,"mouseover",function(){save.src="images/icn_save_on.png";});dojo.connect(save,"mouseout",function(){save.src="images/icn_save.png";});dojo.connect(save,"click",function(){bespin.get("editor").saveFile();});},close:function(_a21,el){var _a23=dojo.byId(el)||dojo.byId("toolbar_close");dojo.connect(_a23,"mouseover",function(){_a23.src="images/icn_close_on.png";});dojo.connect(_a23,"mouseout",function(){_a23.src="images/icn_close.png";});dojo.connect(_a23,"click",function(){bespin.get("commandLine").executeCommand("closefile",true);});},undo:function(_a24,el){var undo=dojo.byId(el)||dojo.byId("toolbar_undo");dojo.connect(undo,"mouseover",function(){undo.src="images/icn_undo_on.png";});dojo.connect(undo,"mouseout",function(){undo.src="images/icn_undo.png";});dojo.connect(undo,"click",function(){_a24.editor.ui.actions.undo();});},redo:function(_a27,el){var redo=dojo.byId(el)||dojo.byId("toolbar_undo");dojo.connect(redo,"mouseover",function(){redo.src="images/icn_redo_on.png";});dojo.connect(redo,"mouseout",function(){redo.src="images/icn_redo.png";});dojo.connect(redo,"click",function(){_a27.editor.ui.actions.redo();});},preview:function(_a2a,el){var _a2c=dojo.byId(el)||dojo.byId("toolbar_preview");dojo.connect(_a2c,"mouseover",function(){_a2c.src="images/icn_preview_on.png";});dojo.connect(_a2c,"mouseout",function(){_a2c.src="images/icn_preview.png";});dojo.connect(_a2c,"click",function(){bespin.preview.show();});},fontsize:function(_a2d,el){var _a2f=dojo.byId(el)||dojo.byId("toolbar_fontsize");dojo.connect(_a2f,"mouseover",function(){_a2f.src="images/icn_fontsize_on.png";});dojo.connect(_a2f,"mouseout",function(){_a2f.src="images/icn_fontsize.png";});(function(){var _a30=2;var _a31={1:8,2:10,3:14};dojo.connect(_a2f,"click",function(){_a30=(_a30>2)?1:_a30+1;bespin.publish("settings:set:fontsize",[{value:_a31[_a30]}]);});})();}}});}if(!dojo._hasResource["bespin.editor.history"]){dojo._hasResource["bespin.editor.history"]=true;dojo.provide("bespin.editor.history");dojo.declare("bespin.editor.HistoryManager",null,{constructor:function(_a32){this.clear();bespin.subscribe("editor:openfile:opensuccess",function(){bespin.get("editor").historyManager.clear();});},clear:function(){this.history=[];this.historyPosition=-1;this.disableAdding=false;},getRange:function(_a33,end){},replaceRange:function(_a35,end,_a37){this.history.splice(_a35,end-_a35+1,_a37);},truncate:function(_a38){this.history.length=_a38+1;this.historyPosition=Math.min(this.historyPosition,this.history.length-1);},getCurrent:function(){return this.historyPosition;},undo:function(){if(this.historyPosition<0){return;}var _a39=this.history[this.historyPosition];this.disableAdding=true;try{_a39.undo();}catch(e){console.error("There was an error in an undo action: ");console.error(e);}this.disableAdding=false;this.historyPosition--;},redo:function(){if(this.historyPosition>=this.history.length-1){return;}var next=this.history[this.historyPosition+1];this.disableAdding=true;try{next.redo();}catch(e){console.error("There was an error in an undo action: ");console.error(e);}this.disableAdding=false;this.historyPosition++;},add:function(item){if(this.disableAdding){return;}this.history.length=this.historyPosition+1;this.history.push(item);this.historyPosition++;},canUndo:function(){return this.historyPosition>-1;},canRedo:function(){return this.historyPosition<this.history.length-1;}});dojo.declare("bespin.editor.HistoryItem",null,{constructor:function(){},undo:function(){},redo:function(){}});}if(!dojo._hasResource["bespin.editor.quickopen"]){dojo._hasResource["bespin.editor.quickopen"]=true;dojo.provide("bespin.editor.quickopen");dojo.declare("bespin.editor.quickopen.API",null,{constructor:function(){this.requestFinished=true;this.preformNewRequest=false;this.projects;this.currentProject;this.currentProjectInclude;var _a3c=this.scene=new th.WindowScene({canvasOrId:document.getElementById("quickopen"),createFocusManager:true,isVisible:false,isDraggable:true,title:"Find Files"});var bus=_a3c.bus;var _a3e=this.focusManager=_a3c.focusManager;var _a3f=this.input=_a3c.byId("input");_a3f.selectAll();var _a40=this.inputProject=_a3c.byId("project");var list=this.list=_a3c.byId("list");list.items=["Loading..."];list.remove(list.renderer);list.renderer=new th.HtmlLabel();list.add(list.renderer);list.renderer.addCss("padding","2px 5px");this.label=_a3c.byId("label");_a3e.subscribe(_a40);_a3e.subscribe(_a3f);_a3c.render();_a3c.center();_a3f.bindKey("",_a3f.ARROW_UP,list.moveSelectionUp,list);_a3f.bindKey("",_a3f.ARROW_DOWN,list.moveSelectionDown,list);_a3f.bindKey("",_a3f.ESCAPE,function(){bespin.publish("ui:escape");},this);_a3f.bindKey("",_a3f.ENTER,this.openFile,this);_a40.bindKey("",_a40.ENTER,function(){_a3f.focusManager.focus(_a3f);});_a40.bindKey("",_a3f.ESCAPE,function(){bespin.publish("ui:escape");},this);bus.bind("dblclick",list,this.openFile,this);bus.bind("itemselected",list,function(e){this.label.text=e.item.filename;this.label.repaint();},this);bus.bind("text:changed",_a3f,function(){if(!this.currentProject){return;}if(this.requestFinished){this.requestFinished=false;bespin.get("server").searchFiles(this.currentProject,this.input.text,this.currentProjectInclude,this.displayResult);}else{this.preformNewRequest=true;}},this);bus.bind("text:changed:newChar",_a40,function(){if(!this.inputProject.text==""){var _a43=this.inputProject.text.toLowerCase();for(var i=0;i<this.projects.length;i++){if(this.projects[i].toLowerCase().indexOf(_a43)==0){this.inputProject.setText(this.inputProject.text+this.projects[i].substring(_a43.length),true);this.inputProject.setSelection(_a43.length,this.inputProject.text.length);}}}},this);bus.bind("focus:lost",_a40,function(){var _a45=this.inputProject.text.toLowerCase();for(var i=0;i<this.projects.length;i++){if(this.projects[i].toLowerCase()==_a45){this.setProject(this.projects[i]);if(this.input.text=="no such project"){this.input.setText("",true);}this.showFiles([]);this.label.text="Loading List...";bespin.get("server").searchFiles(this.currentProject,this.input.text,this.currentProjectInclude,this.displayResult);return;}}this.input.setText("no such project",true);this.list.items=[];delete this.list.selected;this.label.text="";this.scene.render();},this);bus.bind("focus:received",_a40,function(){this.selectAll();},_a40);bus.bind("focus:received",_a3f,function(){this.selectAll();},_a3f);bespin.subscribe("ui:escape",dojo.hitch(this,function(){if(this.scene.isVisible){this.toggle();bespin.get("editor").setFocus(true);}}));},toggle:function(){if(!this.scene.isVisible){dojo.style("quickopenContainer","display","block");}this.scene.toggle();if(!this.scene.isVisible){this.focusManager.removeFocus();}else{this.focusManager.focus(this.input);this.setProject(bespin.get("editSession").project);this.input.setText("");this.loadProjects();}},openFile:function(){var item=this.list.selected;if(!item){return;}var _a48=bespin.get("editor");_a48.saveFile();_a48.openFile(this.currentProject,item.filename);this.toggle();_a48.setFocus(true);},highlightText:function(text,_a4a){if(_a4a==""){return text;}var _a4b=0,_a4c=-1;var _a4d=text.toLowerCase();_a4a=_a4a.toLowerCase();var _a4e="";for(var i=0;i<_a4a.length;i++){_a4b=_a4c;_a4c=_a4d.indexOf(_a4a[i],_a4c);if(_a4c==-1){break;}_a4e+=text.substring(_a4b+1,_a4c)+"<#000000>"+text[_a4c]+"</#000000>";}_a4e+=text.substring(_a4c+1);return _a4e.replace(/<\/#000000><#000000>/g,"");},showFiles:function(_a50,_a51){_a51=_a51||false;var _a52=new Array();var _a53=new Array();var _a54=bespin.get("quickopen");var _a55=bespin.get("settings");var _a56;var name;var path;var _a59;var file;if(_a50===undefined||_a50.length==0){_a54.list.items=[];delete _a54.list.selected;_a54.label.text="No File was found!";_a54.scene.render();return;}for(var x=0;x<_a50.length;x++){file=_a50[x];_a59=file.lastIndexOf("/");path=(_a59==-1)?"":file.substring(0,_a59);name=(_a59==-1)?file:file.substring(_a59+1);if(_a55&&_a55.isSettingOff("dotmode")&&name[0]=="."){continue;}_a56=false;for(var y=_a52.length-1;y!=-1;y--){if(_a52[y].name==name){if(!_a52[y].lastFolder){_a56=_a52[y].filename.split("/");_a52[y].lastFolder=(_a56.length>1?_a56[_a56.length-2]:"");}_a56=file.split("/");_a56=(_a56.length>1?_a56[_a56.length-2]:"");break;}}_a52.push({filename:file,lastFolder:_a56,name:name});}_a52=_a52.slice(0,13);if(_a51){_a52.sort(function(a,b){try{var x=a.text.toLowerCase();var y=b.text.toLowerCase();return ((x<y)?-1:((x>y)?1:0));}catch(e){return 0;}});}for(var i=0;i<_a52.length;i++){_a52[i].text=_a54.highlightText(_a52[i].name,_a54.input.text)+(_a52[i].lastFolder==false?"":" - "+_a52[i].lastFolder);}_a54.list.items=_a52;if(_a52.length!=0){_a54.list.selected=_a52[0];_a54.label.text=_a52[0].filename;}_a54.scene.render();},displayResult:function(_a62){var _a63=bespin.get("quickopen");_a63.showFiles(_a62);_a63.requestFinished=true;if(_a63.preformNewRequest){_a63.requestFinished=false;_a63.preformNewRequest=false;_a63.requestText=_a63.input.text;bespin.get("server").searchFiles(_a63.currentProject,_a63.input.text,_a63.currentProjectInclude,_a63.displayResult);}},loadProjects:function(){bespin.get("server").list(null,null,dojo.hitch(this,function(_a64){this.projects=[];for(var i=0;i<_a64.length;i++){this.projects.push(_a64[i].name.substring(0,_a64[i].name.length-1));}this.projects.sort(function(a,b){var x=a.toLowerCase();var y=b.toLowerCase();return ((x<y)?-1:((x>y)?1:0));});}));},setProject:function(name){this.inputProject.setText(name,true);this.currentProject=name;this.currentProjectInclude=[];var _a6b=bespin.get("settings");if(_a6b){var _a6c=_a6b.getObject("quickopenInclude");if(_a6c){if(_a6c[name]){this.currentProjectInclude=_a6c[name];}}}}});bespin.command.store.addCommand({name:"quickopen",takes:["task","project","path"],preview:"list, add or remove a folder from the list quickopen uses to search in for files",usage:"[add|remove] [project] [path to be added or removed]",execute:function(_a6d,args){var _a6f=bespin.get("settings");if(!args.task){_a6d.addOutput(this.preview);_a6d.addUsageOutput(this);_a6d.error=false;var _a70=_a6f.getObject("quickopenInclude");if(_a70===undefined){return;}output="<br/>";for(projects in _a70){if(_a70[projects].length==0){continue;}output+="<u><b>Project: "+projects+"</b></u>";output+="<ul>";for(var i=0;i<_a70[projects].length;i++){output+="<li>"+_a70[projects][i]+"</li>";}output+="</ul><br/>";}_a6d.addOutput(output);return;}if(!args.path||!args.project){_a6d.addUsageOutput(this);return;}if(args.task=="add"){var _a70=_a6f.getObject("quickopenInclude");if(_a70===undefined){_a70={};}if(_a70[args.project]===undefined){_a70[args.project]=[];}_a70[args.project].push(args.path);_a6f.setObject("quickopenInclude",_a70);}else{if(args.task=="remove"){var _a70=_a6f.getObject("quickopenInclude");if(_a70===undefined){return;}if(_a70[args.project]===undefined){return;}if(_a70[args.project].indexOf(args.path)==-1){return;}_a70[args.project].splice(_a70[args.project].indexOf(args.path),1);_a6f.setObject("quickopenInclude",_a70);}}}});}if(!dojo._hasResource["bespin.editor.formatter"]){dojo._hasResource["bespin.editor.formatter"]=true;dojo.provide("bespin.editor.formatter");bespin.subscribe("component:register:actions",function(e){var _a73=bespin.get("actions");_a73["formatCode"]=dojo.hitch(_a73,function(args){var sel=this.editor.getSelection();var _a76;var _a77=null;var _a78=this.editor.cursorManager.getCursorPosition();var code=this.editor.model.getDocument();if(sel){sel.startPos.col=0;if(sel.endPos.col>0){sel.endPos.row+=1;sel.endPos.col=0;}this.editor.setSelection(sel);_a77={start:sel.startPos.row,end:sel.endPos.row};}var _a7a=bespin.get("formatter")||(function(){return bespin.register("formatter",new bespin.editor.formatter.API());})();_a7a.setLanguage(this.editor.language);var _a7b=(function(_a7c){var _a7d="";for(x=0;x<_a7c;x++){_a7d+=" ";}return _a7d;})(this.editor.getTabSize());_a76=_a7a.indent(code,_a7b,_a77);if(!sel){this.selectAll({});}this.insertChunk({chunk:_a76});if(!sel){this.editor.setSelection(undefined);this.editor.cursorManager.moveCursor(_a78);this.repaint();}});});bespin.command.store.addCommand({name:"format",withKey:"CMD SHIFT F",preview:"format source code or selection",description:"Use this to indent the selected fragment of your code.  The entire source is indented if nothing is selected.",execute:function(self){bespin.get("editor").ui.actions.formatCode();}});dojo.declare("bespin.editor.formatter.API",null,{setLanguage:function(_a7f){if(dojo.isString(_a7f)){_a7f=_a7f.toLowerCase();}switch(_a7f){case "css":case "javascript":case "js":case "java":case "ecmascript":this.implementation=new bespin.editor.formatter.C();break;case "html":case "xhtml":case "shtml":case "xml":case "fbml":this.implementation=new bespin.editor.formatter.ML();break;default:console.log("Error!!! unknown language type: "+_a7f);this.implementation=new bespin.editor.formatter.Unknown();break;}},constructor:function(){},indent:function(_a80,pad,_a82){return this.implementation.indent(_a80,pad,_a82);}});dojo.declare("bespin.editor.formatter.Base",null,{calculateOffset:function(_a83,_a84){if(!_a84){_a84=_a83.length-1;}var _a85={row:0,offset:""};var _a86=/(^\s*)(\S+)\s*/;for(var i=_a84-1;i>0;i--){var m=_a86.exec(_a83[i]);if(m){_a85.offset=m[1];_a85.row=i;break;}}return _a85;},indent:function(_a89,pad,_a8b){var _a8c=_a89.split("\n");var _a8d=0;var _a8e="";var _a8f=false;if(!_a8b){_a8f=true;_a8b={start:0,end:_a8c.length-1};}else{_a8d=_a8b.start;var r=this.calculateOffset(_a8c,_a8b.start);_a8e=r.offset;_a8b.start=r.row;_a8f=_a8b.end>=_a8c.length-1;}var _a91={level:0,nextLevel:0,comment:false};var _a92=_a8e;for(var i=_a8b.start;i<_a8b.end;i++){_a8c[i]=_a8c[i].replace(/^\s+/,"").replace(/\s+$/,"");if(this.processLine(_a8c[i],_a91)!=0){var pads=[_a8e];for(var j=0;j<_a91.level;j++){pads.push(pad);}_a92=pads.join("");}_a8c[i]=_a92+_a8c[i];}if(_a8b.end<(_a8c.length-1)){_a8c.splice(_a8b.end,_a8c.length-1);}if(_a8d>0){_a8c.splice(0,_a8d);}if(!_a8f){_a8c.push("");}return _a8c.join("\n");}});dojo.declare("bespin.editor.formatter.C",bespin.editor.formatter.Base,{constructor:function(){this.scopeChanges={"{":1,"(":1,"[":1,"]":-1,"}":-1,")":-1};this.COND_START="$";this.ML_COMMENT_START="%";this.ML_COMMENT_END="@";this.COMMENT="#";this.CASE_START="<";this.CASE_END=">";},calculateOffset:function(_a96,_a97){var l=_a96.slice(0,_a97);var _a99=false;var i=0;while(i<_a97){var pos;if(_a99){pos=l[i].indexOf("*/");if(pos>=0){l[i]=l[i].substr(pos1+2);_a99=false;i--;}}else{pos=l[i].indexOf("/*");if(pos>=0){var s=l[i].substr(0,pos);var pos1=l[i].indexOf("*/",pos+2);if(pos1>=0){s+=l[i].substr(pos1+2);_a99=false;l[i]=s;i--;}else{_a99=true;l[i]=s;}}}i++;}var _a9e=[l,_a97];_a9e.callee=arguments.callee;return this.inherited(_a9e);},processLine:function(line,_aa0){var _aa1=0;var _aa2=_aa0.level;var _aa3=0;line=this.normalize(line,0,_aa0.comment);_aa0.condLevel=_aa0.condLevel||0;_aa0.condState=_aa0.condState||0;for(var i=0;i<line.length;i++){switch(line[i]){case "{":_aa1+=1;if(_aa0.condState==3){_aa0.condState=0;}if(_aa0.inCase){_aa0.caseLevel++;}break;case this.CASE_START:if(!_aa0.inCase){_aa1+=1;}else{_aa3-=1;}_aa0.inCase=true;_aa0.caseLevel=0;break;case "}":_aa1-=1;if(_aa0.inCase){if(_aa0.caseLevel>0){_aa0.caseLevel-=1;}else{_aa1-=1;_aa0.inCase=false;}}_aa3=(_aa3<_aa1)?_aa3:_aa1;break;case this.CASE_END:_aa1-=1;_aa3=(_aa3<_aa1)?_aa3:_aa1;_aa0.inCase=false;break;case "[":_aa1+=1;break;case "]":_aa1-=1;_aa3=(_aa3<_aa1)?_aa3:_aa1;break;case "(":switch(_aa0.condState){case 1:_aa0.condState=2;break;case 2:_aa0.parentInCondition++;break;default:break;}_aa1+=1;break;case ")":_aa1-=1;if(_aa0.condState==2){if(_aa0.parenInCondition>0){_aa0.parentInCondition--;}else{_aa0.condState=3;}}_aa3=(_aa3<_aa1)?_aa3:_aa1;break;case this.ML_COMMENT_START:_aa0.comment=true;break;case this.ML_COMMENT_END:_aa0.comment=false;break;case this.COND_START:_aa0.condState=1;_aa0.parenInCondition=0;break;case ";":if(_aa0.condState==3){_aa0.condState=0;}break;default:break;}}_aa0.level=_aa0.nextLevel+_aa3;var _aa5=0;if(_aa0.condState==3){_aa0.condLevel++;_aa0.condState=4;_aa5=1;}else{if(_aa0.condState==4){_aa5=-_aa0.condLevel;_aa0.condLevel=0;_aa0.condState=0;}}_aa0.nextLevel+=_aa1+_aa5;if(_aa0.nextLevel<0){_aa0.nextLevel=0;}return (_aa2!=_aa0.level)||_aa3;},normalize:function(s,_aa7,_aa8){if(!s){return {escaped:s,comment:_aa8};}s=s.replace(/\\"/g,"").replace(/\\'/g,"").replace(/[@#$%<>]/g,"").replace(/\bif\b/g,this.COND_START).replace(/\belse\b/g,this.COND_START).replace(/\bfor\b/g,this.COND_START).replace(/\bwhile\b/g,this.COND_START).replace(/\bcase\b/g,this.CASE_START).replace(/\bdefault\b/g,this.CASE_START).replace(/\bbreak\b/g,this.CASE_END).replace(/\/\*/g,this.ML_COMMENT_START).replace(/\*\//g,this.ML_COMMENT_END).replace(/\/\//g,this.COMMENT).replace(/[\w\s]/g,"");var out=[];var _aaa=null;var _aab=false,_aac=false;for(var i=_aa7;i<s.length;i++){var c=s[i];if(_aac){continue;}else{if(_aa8){if(s[i]==this.ML_COMMENT_END){_aa8=false;}else{continue;}}else{if(_aab){if(s[i]==_aaa){_aab=false;_aaa=null;}else{continue;}}else{if(s[i]==this.COMMENT){_aac=true;}else{if(s[i]=="'"||s[i]=="\""){_aab=true;_aaa=s[i];}else{if(s[i]==this.ML_COMMENT_START){_aa8=true;}}}}}}out.push(c);}s=out.join("");return s;}});dojo.declare("bespin.editor.formatter.ML",bespin.editor.formatter.Base,{constructor:function(){this.emptyElements=["area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param"];},indent:function(_aaf,pad,_ab1){_aaf=_aaf.replace(/<BR>/,"<BR/>").replace(/<br>/,"<br/>");var _ab2=[_aaf,pad,_ab1];_ab2.callee=arguments.callee;return this.inherited(_ab2);},processLine:function(line,_ab4){var s=line;var _ab6=0;var _ab7=0;var _ab8=0;var _ab9=_ab4.level;_ab4.lonelyCloser=false;var _aba=_ab4.scriptlet;var _abb=false;var _abc=_ab4.inTag;var _abd=_ab4.inEmptyTag;var _abe=false;var _abf=_ab4.comment;var _ac0;for(var i=0;i<line.length;i++){if(_abb){if(s[i]==_ac0&&(i==_ab8||s[i-1]!="\\")){_abb=false;}}else{if(_aba){if(i>_ab8&&s[i]==">"&&s[i-1]=="%"){_aba=false;_ab6-=1;_ab7=(_ab7<_ab6)?_ab7:_ab6;}}else{if(_abf){if(i>_ab8+1&&s[i]==">"&&s[i-1]=="-"&&s[i-2]=="-"){_abf=false;_ab6-=1;_ab7=(_ab7<_ab6)?_ab7:_ab6;}}else{if(_abc){if(s[i]==">"){if(!_abd&&i>_ab8&&s[i-1]=="/"){_ab6-=1;}_abc=false;}}else{if(_abe){if(s[i]==">"){_abe=false;if(!_abd){_ab6-=1;_ab7=(_ab7<_ab6)?_ab7:_ab6;}}}else{if(i<line.length-3&&s[i]=="<"&&s[i+1]=="!"&&s[i+2]=="-"&&s[i+3]=="-"){_abf=true;_ab6+=1;}else{if(s[i]=="'"||s[i]=="\""){_ac0=s[i];_abb=true;}else{if(s[i]=="<"){if(i<line.length-1&&s[i+1]=="/"){_abd=this.isEmptyTag(line,i+2);_abe=true;}else{if(i<line.length-1&&s[i+1]=="%"){_aba=true;_ab6+=1;}else{_abd=this.isEmptyTag(line,i+1);if(!_abd){_ab6+=1;}_abc=true;}}}}}}}}}}}_ab4.level=_ab4.nextLevel+_ab7;_ab4.nextLevel+=_ab6;_ab4.inTag=_abc;_ab4.inEmptyTag=_abd;_ab4.comment=_abf;_ab4.scriptlet=_aba;return (_ab9!=_ab4.level)||_ab7;},isEmptyTag:function(line,_ac3){var _ac4="";for(var j=_ac3;j<line.length;j++){if(/[\s>]/.test(line[j])){break;}else{_ac4+=line[j];}}_ac4=_ac4.toLowerCase();for(var i=0;i<this.emptyElements.length;i++){if(_ac4==this.emptyElements[i]){return true;}}return false;}});dojo.declare("bespin.editor.formatter.Unknown",null,{constructor:function(){},indent:function(_ac7,pad,_ac9){return _ac7;}});}if(!dojo._hasResource["bespin.editor.codecompletion"]){dojo._hasResource["bespin.editor.codecompletion"]=true;dojo.provide("bespin.editor.codecompletion");dojo.declare("bespin.editor.codecompletion.Suggester",null,{constructor:function(){},complete:function(_aca,row){var self=this;var _acd=_aca.col-1;var _ace="";var find=function(){if(_ace.length>=1){self.findCompletion(_ace);}};for(var i=_acd;i>=0;--i){var ch=row[i];if(this.charMarksStartOfIdentifier(ch)){find();return;}else{_ace=ch+_ace;}}find();},findInArray:function(_ad2,_ad3,_ad4){for(var i=0,len=_ad4.length;i<len;++i){var name=_ad4[i].name;if(name){if(name.indexOf(_ad3)===0&&_ad3!==name&&name!=="constructor"){_ad2.push(name);}}}},findCompletion:function(_ad8){var self=this;var _ada=[];if(self.currentMetaInfo){if(self.currentMetaInfo.outline){this.findInArray(_ada,_ad8,self.currentMetaInfo.outline);}if(self.currentMetaInfo.idents){var _adb=[];for(var i in self.currentMetaInfo.idents){_adb.push({name:i});}this.findInArray(_ada,_ad8,_adb);}}if(_ada.length>0){bespin.publish("codecomplete:showsuggestion",{candidates:_ada});}},charMarksStartOfIdentifier:function(ch){return ch===" "||ch==="\t"||ch=="\""||ch=="'";},initialize:function(){var self=this;bespin.subscribe("parser:metainfo",function(evt){self.currentMetaInfo=evt.info;});bespin.subscribe("codecomplete:suggest",function(evt){self.complete(evt.cursorPos,evt.row);});}});(function(){var _ae1=new bespin.worker.WorkerFacade(new bespin.editor.codecompletion.Suggester());if(!_ae1.__hasWorkers__){_ae1.initialize();}var _ae2;bespin.subscribe("codecomplete:showsuggestion",function(e){bespin.get("commandLine").showHint("Code Completions<br><br>"+e.candidates.join("<br>"));});bespin.subscribe("settings:set:codecomplete",function(data){if(bespin.get("settings").isOn(data.value)){_ae2=bespin.subscribe("editor:document:changed",function(){var _ae5=bespin.get("editor");var pos=_ae5.getCursorPos();var row=_ae5.model.getRowArray(pos.row);bespin.publish("codecomplete:suggest",{cursorPos:pos,row:row});},400);}else{bespin.unsubscribe(_ae2);}});})();}if(!dojo._hasResource["bespin.themes.default"]){dojo._hasResource["bespin.themes.default"]=true;dojo.provide("bespin.themes.default");bespin.themes.coffee={backgroundStyle:"#2A211C",gutterStyle:"#4c4a41",lineNumberColor:"#e5c138",lineNumberFont:"10pt Monaco, Lucida Console, monospace",lineMarkerErrorColor:"#CC4444",lineMarkerWarningColor:"#B8860B",lineMarkerMessageColor:"green",zebraStripeColor:"#2A211C",highlightCurrentLineColor:"#3a312b",editorTextFont:"10pt Monaco, Lucida Console, monospace",editorTextColor:"rgb(230, 230, 230)",editorSelectedTextColor:"rgb(240, 240, 240)",editorSelectedTextBackground:"#526DA5",cursorStyle:"#879aff",cursorType:"ibeam",unfocusedCursorStrokeStyle:"#FF0033",unfocusedCursorFillStyle:"#73171E",partialNibStyle:"rgba(100, 100, 100, 0.3)",partialNibArrowStyle:"rgba(255, 255, 255, 0.3)",partialNibStrokeStyle:"rgba(150, 150, 150, 0.3)",fullNibStyle:"rgb(100, 100, 100)",fullNibArrowStyle:"rgb(255, 255, 255)",fullNibStrokeStyle:"rgb(150, 150, 150)",scrollTrackFillStyle:"rgba(50, 50, 50, 0.8)",scrollTrackStrokeStyle:"rgb(150, 150, 150)",scrollBarFillStyle:"rgba(0, 0, 0, %a)",scrollBarFillGradientTopStart:"rgba(90, 90, 90, %a)",scrollBarFillGradientTopStop:"rgba(40, 40, 40, %a)",scrollBarFillGradientBottomStart:"rgba(22, 22, 22, %a)",scrollBarFillGradientBottomStop:"rgba(44, 44, 44, %a)",tabSpace:"#392A25",searchHighlight:"#B55C00",searchHighlightSelected:"#FF9A00",plain:"#bdae9d",keyword:"#42a8ed",string:"#039a0a",comment:"#666666","c-comment":"#666666",punctuation:"#888888",attribute:"#BF9464",test:"rgb(255,0,0)",cdata:"#bdae9d","attribute-value":"#039a0a",tag:"#46a8ed",color:"#c4646b","tag-name":"#46a8ed",value:"#039a0a",important:"#990000",sizes:"#990000",cssclass:"#BF9464",cssid:"#46a8ed",atom:"#aa4444",variable:"#00cccc",variabledef:"#4422cc",localvariable:"#cc2277",property:"#66bb33",operator:"#88bbff",error:"#FF0000",processing:"#999999",entity:"#AA2222",text:"#00BB00","compile-time-constant":"#776088","predefined-constant":"#33CC33","reserved-language-construct":"#00FF00","predefined-function":"#22FF22","predefined-class":"#22FF22",literal:"#DD4411",identifier:"#22FF22",func:"#2200FF",type:"#8822FF",decorator:"#2222FF"};bespin.themes.coffeezebra={};dojo.mixin(bespin.themes.coffeezebra,bespin.themes.coffee);bespin.themes.coffeezebra.zebraStripeColor="#FFFFFF";bespin.themes["default"]=bespin.themes.coffee;}if(!dojo._hasResource["bespin.syntax.base"]){dojo._hasResource["bespin.syntax.base"]=true;dojo.provide("bespin.syntax.base");dojo.declare("bespin.syntax.Model",null,{language:"",lineCache:[],invalidateCache:function(_ae8){delete this.lineCache[_ae8];},invalidateEntireCache:function(){this.lineCache=[];},addToCache:function(_ae9,line){this.lineCache[_ae9]=line;},getFromCache:function(_aeb){return this.lineCache[_aeb];},mergeSyntaxResults:function(_aec){var base=0;for(var i=0;i<_aec.length;i++){var _aef=_aef[i];}},getSyntaxStylesPerLine:function(_af0,_af1,_af2){return {regions:{plain:[{start:0,stop:_af0.length}]}};},getSyntaxStyles:function(rows,_af4,_af5,_af6){var _af7={};for(var i=_af4;i<=_af5;i++){_af7[i]=this.getSyntaxStylesPerLine(rows[i],i,_af6);}return _af7;}});bespin.syntax.Resolver=(function(){var _af9,_afa;return {setEngine:function(name){var _afc=bespin.syntax[name];if(name==_af9){return this;}if(_afc){_af9=name;if(_afa){delete _afa;}if(_afc.worker){_afa=new bespin.worker.WorkerFacade(bespin.syntax[name].Model());_afa.workerEnabled=true;}else{_afa=new bespin.syntax[name].Model();_afa.workerEnabled=false;}}else{console.log("no such engine: ",name);}return this;},getModel:function(){return _afa;}};})();}if(!dojo._hasResource["bespin.syntax.simple._base"]){dojo._hasResource["bespin.syntax.simple._base"]=true;dojo.provide("bespin.syntax.simple._base");dojo.declare("bespin.syntax.simple.Model",bespin.syntax.Model,{lineMetaInfo:[],setLineMetaInfo:function(_afd,meta){this.lineMetaInfo[_afd]=meta;},getLineMetaInfo:function(_aff){return this.lineMetaInfo[_aff];},getSyntaxStylesPerLine:function(_b00,_b01,_b02){if(!this.language||(this.language!=_b02)){this.engine=bespin.syntax.simple.Resolver.resolve(_b02);this.language=_b02;}var _b03={text:_b00,regions:[]};var meta;if(typeof this.engine["innertypes"]=="function"){var _b05=this.engine.innertypes(_b00);for(var i=0;i<_b05.length;i++){var type=_b05[i];meta={inMultiLineComment:this.inMultiLineComment(),offset:type.start};var _b08=[];var _b09=bespin.syntax.simple.Resolver.highlight(type.type,_b00.substring(type.start,type.stop),meta);if(_b09.meta&&(i==_b05.length-1)){this.setLineMetaInfo(_b01,_b09.meta);}_b08.push(_b09);}_b03.regions.push(this.mergeSyntaxResults(_b08));}else{meta=(_b01>0)?this.getLineMetaInfo(_b01-1):{};var _b0a=this.engine.highlight(_b00,meta);this.setLineMetaInfo(_b01,_b0a.meta);_b03.regions.push(_b0a.regions);}return _b03;}});bespin.syntax.simple.Resolver=new function(){var _b0b={};var _b0c={};var _b0d={highlight:function(line,meta){return {regions:{plain:[{start:0,stop:line.length}]}};}};return {highlight:function(type,line,meta,_b13){this.resolve(type).highlight(line,meta,_b13);},register:function(type,_b15,_b16){if(_b16){_b0b[type]=_b16;}for(var i=0;i<_b15.length;i++){_b0c[_b15[i]]=type;}},resolve:function(_b18){if(!_b18||_b18=="off"||!_b0c[_b18]){return _b0d;}var type=_b0c[_b18];if(!_b0b[type]||(typeof _b0b[type]==="string"&&_b0b[type]!="LOADING")){_b0b[type]="LOADING";var dr=dojo.require;dr.call(dojo,"bespin.syntax.simple."+type.toLowerCase());if(bespin.syntax.simple[type]){_b0b[type]=new bespin.syntax.simple[type]();}}return _b0b[type]||_b0d;}};}();bespin.syntax.simple.Resolver.register("JavaScript",["js","javascript","ecmascript","jsm","java"]);bespin.syntax.simple.Resolver.register("Arduino",["pde"]);bespin.syntax.simple.Resolver.register("C",["c","h"]);bespin.syntax.simple.Resolver.register("CSharp",["cs"]);bespin.syntax.simple.Resolver.register("CSS",["css"]);bespin.syntax.simple.Resolver.register("HTML",["html","htm","xml","xhtml","shtml"]);bespin.syntax.simple.Resolver.register("PHP",["php","php3","php4","php5"]);bespin.syntax.simple.Resolver.register("Python",["py","python"]);bespin.syntax.simple.Resolver.register("Ruby",["rb","ruby"]);}if(!dojo._hasResource["bespin.parser.parser"]){dojo._hasResource["bespin.parser.parser"]=true;dojo.provide("bespin.parser.parser");dojo.declare("bespin.parser.CodeInfo",null,{constructor:function(_b1b){var self=this;this._started=false;this._running=false;this.currentMetaInfo;this.messages=[];this.foldPoints=[];bespin.subscribe("parser:showoutline",function(){var html=self.currentMetaInfo?self.currentMetaInfo.html:"Outline not yet available";bespin.get("commandLine").addOutput(html);});bespin.subscribe("parser:gotofunction",function(_b1e){var _b1f=_b1e.functionName;if(!_b1f){bespin.get("commandLine").addErrorOutput("Please pass me a valid function name.");return;}var _b20=dojo.filter(self.foldPoints,function(func){return func["(name)"]==_b1f;});if(_b20.length===0){bespin.get("commandLine").addErrorOutput("Unable to find the function "+_b1f+" in this file.");}else{bespin.get("editor").moveAndCenter(_b20[0].row);}});bespin.subscribe("parser:engine:parseDone",function(_b22){var data=_b22.info;self.foldPoints=data.foldPoints;var _b24=bespin.get("settings")&&bespin.get("settings").get("syntaxmarkers");self.messages=dojo.filter(data.messages,function(_b25){if(_b24==="all"){return true;}return ((_b25.type+"s").toLowerCase()===_b24);});if(data.metaInfo){self.currentMetaInfo=data.metaInfo;bespin.publish("parser:metainfo",{info:data.metaInfo});}self._running=false;});bespin.subscribe("parser:stop",function(){self.messages=[];self.foldPoints=[];});},start:function(){var self=this;var _b27=bespin.get("editor");if(!self._started){self._started=true;self.run_timeout;var _b28=400;var _b29=function(){if(self.run_timeout){clearTimeout(self.run_timeout);}self.run_timeout=setTimeout(function(){self.fetch();},_b28);};var _b2a=bespin.subscribe("editor:document:changed",_b29);bespin.subscribe("settings:set:syntaxmarkers",_b29);bespin.subscribe("settings:set:jslint",_b29);bespin.subscribe("parser:stop",function(){bespin.unsubscribe(_b2a);self._started=false;});_b29();}},fetch:function(){var self=this;if(bespin.parser.AsyncEngineResolver.__hasWorkers__){var _b2c=bespin.get("editor");var type=_b2c.language;var _b2e=bespin.get("settings")&&bespin.get("settings").getObject("jslint");if(type){var _b2f=_b2c.model.getDocument();self._running=true;bespin.publish("parser:engine:parse",{type:type,source:_b2f,parseOptions:_b2e});}}},getLineMarkers:function(){var _b30={};dojo.forEach(this.messages,function(_b31){if(!_b30[_b31.line]){_b30[_b31.line]={type:_b31.type,msg:""};}_b30[_b31.line].msg+="<p>Syntax "+_b31.type+(isFinite(_b31.line)?" at line "+_b31.line+" character "+(_b31.character+1):" ")+": "+_b31.reason+"<p>"+(_b31.evidence&&(_b31.evidence.length>80?_b31.evidence.slice(0,77)+"...":_b31.evidence).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"));if(_b31.type==="Error"||(_b31.type==="Warning"&&_b30[_b31.line].type==="Message")){_b30[_b31.line].type=_b31.type;}});return _b30;},getFunctions:function(){return this.foldPoints||[];}});dojo.declare("bespin.parser.JavaScript",null,{constructor:function(){},name:"Narcissus",walk:function(tree,_b33){var _b34=[];var _b35=[];var top=function(){if(this.length==0){return null;}return this[this.length-1];};_b34.top=top;_b35.top=top;this._walk(_b33,tree,_b34,_b35);},_visitNode:function(_b37,node,_b39,_b3a){_b37.call(this,node,_b39,_b3a);if(node.length){this._walk(_b37,node,_b39,_b3a);}if(node.expression){this._walk(_b37,node.expression,_b39,_b3a);}if(node.body){this._walk(_b37,node.body,_b39,_b3a);}if(node.value){this._walk(_b37,node.value,_b39,_b3a);}},_walk:function(_b3b,tree,_b3d,_b3e){if(typeof tree=="string"){return;}if(tree.length){_b3d.push(tree);for(var i=0;i<tree.length;++i){var node=tree[i];_b3e.push(i);this._visitNode(_b3b,node,_b3d,_b3e);_b3e.pop();}_b3d.pop();}else{this._visitNode(_b3b,tree,_b3d,_b3e);}},getMetaInfo:function(tree){var _b42=[];var _b43={};var info=[];var _b45=this.getCodePatterns();for(var type in _b45){if(_b45.hasOwnProperty(type)){try{var ns=_b45[type].declaration.split(".");var _b48=ns.pop();_b45[type]._indicator=_b48;_b45[type]._ns=ns;}catch(e){console.log("Weird FF3b3 error "+e);}}}var _b49=74;var _b4a=56;var _b4b=56;this.walk(tree,function(node,_b4d,_b4e){var _b4f=_b4d.length;var tree=_b4d.top();var _b51=_b4e.top();var row=node.lineno-1;var _b53=[];if(node.type==_b4b&&_b51>0){_b53.push(node.value);for(var i=_b51-1;i>=0;--i){var n=tree[i];if(n&&n.type==_b4b){_b53.unshift(n.value);}}}_b43[_b53.join(".")]=true;if(node.type==_b49){var name=node.name;if(name==null&&tree&&_b51>0){var pred=tree[_b51-1];if(pred.type==_b4a){name=pred.value;}}var fn={type:"function",name:name,row:row,depth:_b4f};_b42.push(fn);info.push(fn);}else{var _b59=_b4d[_b4d.length-1];var _b5a=_b4e[_b4e.length-1];var _b5b=function(type,ns,_b5e){if(_b5a>=0){if(node.value==_b5e){for(var i=0;i<ns.length;++i){var ele=ns[i];if(_b59[_b5a-1]&&_b59[_b5a-1].value==ns){_b59=_b4d[_b4d.length-(1+i+1)];_b5a=_b4e[_b4e.length-(1+i+1)];}else{return;}}if(_b59[_b5a+1]&&_b59[_b5a+1][0]){var name=_b59[_b5a+1][0].value;info.push({type:type,name:name,row:row,depth:_b4f});return true;}}}};for(var type in _b45){var _b63=_b45[type];if(_b5b(type,_b63._ns,_b63._indicator)){break;}}}});var html="<u>Outline</u><br/><br/>";html+="<div id=\"outlineInfo\">";for(var i=0;i<info.length;i++){var type=info[i].type;var kind=type;var name=info[i].name;var _b68=_b45[type];if(_b68){if("declaration" in _b68){kind=_b68.declaration;}if("description" in _b68){kind=_b68.description;}}if(typeof name=="undefined"){continue;}var _b69="";for(var j=0;j<info[i].depth;j++){_b69+="&nbsp;";}html+=_b69+kind+": <a href=\"javascript:bespin.get('editor').cursorManager.moveCursor({ row: "+info[i].row+", col: 0 });bespin.get('editor').ui.actions.moveCursorRowToCenter();\">"+name+"</a><br/>";}html+="</div>";return {functions:_b42,idents:_b43,outline:info,html:html};},codePatterns:{dojoClass:{declaration:"dojo.declare",description:"Class"},bespinEventPublish:{declaration:"bespin.publish",description:"Publish"},bespinEventSubscription:{declaration:"bespin.subscribe",description:"Subscribe to"},jooseClass:{declaration:"Class"},jooseModule:{declaration:"Module"},jooseType:{declaration:"Type"},jooseRole:{declaration:"Role"}},getCodePatterns:function(){return this.codePatterns;},initialize:function(){var self=this;bespin.subscribe("parser:js:codePatterns",function(_b6c){for(pattern in _b6c){self.codePatterns[pattern]=_b6c[pattern];}bespin.publish("parser:engine:updatedCodePatterns");});},parse:function(_b6d){var tree;var _b6f=[];try{tree=parse(_b6d);}catch(e){}return {messages:_b6f,metaInfo:tree?this.getMetaInfo(tree):undefined};}});dojo.declare("bespin.parser.JSLint",null,{constructor:function(_b70){},name:"JSLint",parse:function(_b71,type,_b73){if(type==="css"){_b71="@charset \"UTF-8\";\n"+_b71;}var _b74=JSLINT(_b71,_b73);var _b75=[];var _b76=JSLINT.getFunctions();var _b77=JSLINT.errors.length>0&&JSLINT.errors[JSLINT.errors.length-1]===null;for(var i=0;i<JSLINT.errors.length;i++){if(JSLINT.errors[i]){_b75.push({reason:JSLINT.errors[i].reason,line:JSLINT.errors[i].line+(type==="css"?0:1),type:(i===JSLINT.errors.length-2&&_b77)?"Error":"Warning",character:JSLINT.errors[i].character,evidence:JSLINT.errors[i].evidence});}}for(var i=0;i<_b76.length;i++){_b75.push({line:_b76[i].line,type:"Message",character:0,reason:"<br>Function name: "+_b76[i].name+"<br>Unused: "+_b76[i].unused.join(", ")+"<br>Closure: "+_b76[i].closure.join(", ")+"<br>Exception: "+_b76[i].exception.join(", ")+"<br>Vars: "+_b76[i].vars.join(", ")+"<br>Label: "+_b76[i].label.join(", ")+"<br>Outer: "+_b76[i].outer.join(", ")+"<br>Global: "+_b76[i].global.join(", "),evidence:""});}return {result:_b74,messages:_b75,foldPoints:(type==="css"?[]:_b76)};}});bespin.parser.EngineResolver=function(){return {engines:{},parse:function(_b79,type,_b7b){var _b7c={};var _b7d;var _b7e=this.resolve(type);for(var i=0;i<_b7e.length;i++){_b7d=_b7e[i].parse(_b79,type,_b7b);_b7d.messages=_b7d.messages.concat(_b7c.messages||[]);for(var _b80 in _b7d){if(_b7d.hasOwnProperty(_b80)){if(_b7d[_b80]){_b7c[_b80]=_b7d[_b80];_b7c.isSet=true;}}}}return _b7c.isSet?_b7c:{noEngine:true};},register:function(_b81,_b82){for(var i=0;i<_b82.length;i++){if(this.engines[_b82[i]]==null){this.engines[_b82[i]]=[];}this.engines[_b82[i]].push(_b81);}},resolve:function(type){return this.engines[type]||[];},initialize:function(){var _b85=this;bespin.subscribe("parser:engine:parse",function(_b86){var ret=_b85.parse(_b86.source,_b86.type,_b86.parseOptions);bespin.publish("parser:engine:parseDone",{type:_b86.type,info:ret});});for(var type in this.engines){var list=this.engines[type];for(var i=0;i<list.length;i++){var eng=list[i];if(!eng._init){if(eng.initialize){eng.initialize();}eng._init=true;}}}bespin.publish("parser:engine:initialized",{});}};}();bespin.parser.EngineResolver.register(new bespin.parser.JSLint(),["js","css"]);bespin.parser.EngineResolver.register(new bespin.parser.JavaScript(),["js"]);bespin.parser.AsyncEngineResolver=new bespin.worker.WorkerFacade(bespin.parser.EngineResolver,1,["/js/jsparse/jsdefs.js","/js/jsparse/jsparse.js","/js/jsparse/fulljslint.js"]);bespin.subscribe("parser:start",function(){bespin.get("parser").start();});bespin.register("parser",new bespin.parser.CodeInfo());bespin.fireAfter(["settings:language","settings:set:syntaxcheck","parser:engine:initialized"],function(){var _b8c=bespin.get("settings");if(_b8c&&_b8c.isOn(_b8c.get("syntaxcheck"))){var _b8d=bespin.get("editor");if(_b8d.language){bespin.publish("parser:start");}else{bespin.subscribe("settings:language",function(){bespin.publish("parser:start");});}}});bespin.subscribe("settings:language",function(){var _b8e=bespin.get("settings");if(_b8e&&_b8e.isOn(_b8e.get("syntaxcheck"))){bespin.publish("parser:start");}});}if(!dojo._hasResource["bespin.test"]){dojo._hasResource["bespin.test"]=true;dojo.provide("bespin.test");bespin.command.store.addCommand({name:"test",takes:["suite"],preview:"run a test suite or suites",completeText:"suite name, or 'all' to run all tests, or press return to list tests.",execute:function(_b8f,_b90){if(!_b90){if(bespin.util.isEmpty(bespin.test._knownTests)){_b8f.addOutput("No test suites registered. See bespin.test.addTests() to add them.");}else{var msg="Available test targets: all";for(var name in bespin.test._knownTests){msg+=", "+name;}_b8f.addOutput(msg);}}else{if(_b90=="all"){var _b93=[];for(var name in bespin.test._knownTests){_b93.push(name);}bespin.test.run(_b8f,_b93);}else{if(bespin.test._knownTests[_b90]){bespin.test.run(_b8f,[_b90]);}else{_b8f.addErrorOutput("No test suite called: "+_b90);}}}}});dojo.mixin(bespin.test,{addTests:function(name,_b95){if(name=="all"){throw new Error("Test suites can't be called 'all'");}this._knownTests[name]=_b95;},run:function(_b96,_b97){console.log("bespin.test.run",_b97);var _b98=dojo.create("table");_b96.setElement(_b98);var _b99=dojo.create("tbody",{},_b98);var row=dojo.create("tr",{},_b99);dojo.create("th",{innerHTML:"Test Name"},row);dojo.create("th",{innerHTML:"Results"},row);dojo.create("th",{innerHTML:"Action"},row);dojo.create("th",{innerHTML:"Notes"},row);var self=this;_b97.forEach(function(_b9c){row=dojo.create("tr",{},_b99);dojo.create("th",{innerHTML:_b9c},row);dojo.create("td",{},row);var _b9d=dojo.create("td",{},row);var _b9e=dojo.create("td",{},row);var _b9f=self._knownTests[_b9c];var _ba0=true;if(_b9f.setup){try{_b9f.setup();}catch(e){console.error(_b9c+".setup(): ",e);var _ba1=_b9c+".setup() failed: "+e.toString();_b9e.innerHTML=_ba1;_ba0=false;}}if(_ba0){for(var _ba2 in _b9f){var test=_b9f[_ba2];if(_ba2.match(/test/)&&typeof test=="function"){row=dojo.create("tr",{},_b99);dojo.create("td",{innerHTML:self._addSpaces(_ba2),style:"padding-left:30px;"},row);var _ba4=dojo.create("td",{},row);var _ba5=dojo.create("td",{style:"padding:0 3px;"},row);var _ba6=dojo.create("td",{},row);var _ba7=new bespin.test.Assert(_b9c,_b9f,_ba2,test,_ba5,_ba6);dojo.create("button",{innerHTML:"Run",onclick:(function(_ba8){return function(){_ba8._reset();_ba8._runTest();};})(_ba7)},_ba4);_ba7._runTest();}}if(_b9f.tearDown){try{_b9f.tearDown();}catch(e){console.error(_b9c+".tearDown(): ",e);var _ba1="tearDown() failed: "+e.toString();_b9e.innerHTML=_ba1;}}}});},_addSpaces:function(_ba9){_ba9=_ba9.replace(/^test/g,"");_ba9=_ba9.replace(/([a-z0-9])([A-Z])/g,"$1 $2");_ba9=_ba9.replace(/([a-zA-Z])([0-9])/g,"$1 $2");return _ba9;},_knownTests:{}});bespin.test.Status={none:{ord:0,attr:{style:{color:"#000",backgroundColor:"#eee"},innerHTML:"-"}},exec:{ord:1,attr:{style:{color:"#fff",backgroundColor:"#888"},innerHTML:"Exec"}},async:{ord:2,attr:{style:{color:"#000",backgroundColor:"#ffa"},innerHTML:"Wait"}},pass:{ord:3,attr:{style:{color:"#000",backgroundColor:"#8f8"},innerHTML:"Pass"}},fail:{ord:4,attr:{style:{color:"#fff",backgroundColor:"#f00"},innerHTML:"Fail"}}};dojo.declare("bespin.test.Assert",null,{constructor:function(_baa,_bab,_bac,test,_bae,_baf){this._suiteName=_baa;this._suite=_bab;this._test=test;this._testName=_bac;this._resultsTd=_bae;this._notesTd=_baf;this._outstanding=0;this._start=new Date().getTime();this.failFast=false;this.status=bespin.test.Status.none;},isTrue:function(_bb0,_bb1){if(!_bb0){this._fail("isTrue",arguments);}},isFalse:function(_bb2,_bb3){if(_bb2){this._fail("isFalse",arguments);}},isNull:function(_bb4,_bb5){if(_bb4!==null){this._fail("isNull",arguments);}},isNotNull:function(_bb6,_bb7){if(_bb6===null){this._fail("isNotNull",arguments);}},isUndefined:function(_bb8,_bb9){if(_bb8!==undefined){this._fail("isUndefined",arguments);}},isNotUndefined:function(_bba,_bbb){if(_bba===undefined){this._fail("isNotUndefined",arguments);}},isNaN:function(_bbc,_bbd){if(!isNaN(_bbc)){this._fail("isNaN",arguments);}},isNotNaN:function(_bbe,_bbf){if(isNaN(_bbe)){this._fail("isNotNaN",arguments);}},isEqual:function(_bc0,_bc1,_bc2){if(!this._isEqual(_bc0,_bc1)){this._fail("isEqual",arguments);}},isNotEqual:function(_bc3,_bc4,_bc5){if(this._isEqual(_bc3,_bc4)){this._fail("isNotEqual",arguments);}},fail:function(_bc6){this._fail("fail",arguments);},message:function(_bc7){this._addMessage("<strong>"+_bc7+"</strong>");},command:function(type,_bc9){var _bca=bespin.get("commandLine");var _bcb=_bca.executeCommand(type,true);var self=this;var _bcd=function(_bce){if(dojo.isArray(_bc9)){_bc9.forEach(function(_bcf){if(_bce.indexOf(_bcf)==-1){self._fail("command",[type,_bcf],_bce);}});}else{if(_bce!=_bc9){self._fail("command",[type,_bc9],_bce);}}};if(_bcb.element){_bcd(_bcb.element.textContent);}else{if(_bcb.outstanding!=0){_bcb.onOutput(function(){if(_bcb.complete){_bcd(_bcb.output);}});}else{_bcd(_bcb.output);}}},link:function(func,_bd1){this._updateStatus(bespin.test.Status.async);this._outstanding++;var self=this;return function(){try{if(typeof func=="function"){return func.apply(_bd1,arguments);}}catch(e){if(e.toString()!="failFast"){console.error(this._suiteName+"."+this._testName+":link(): ",e);self._addFunctionMessage("link",[e.toString()]);self._updateStatus(bespin.test.Status.fail);}}finally{self._outstanding--;if(self._outstanding==0){self._updateStatus(bespin.test.Status.pass);}}};},createOnError:function(func,_bd4){var self=this;return function(){self._updateStatus(bespin.test.Status.fail);if(typeof func=="function"){self._addMessage("onError handler called");try{return func.apply(_bd4,arguments);}catch(e){if(e.toString()!="failFast"){console.error(this._suiteName+"."+this._testName+":createOnError(): ",e);self._addFunctionMessage("createOnError",[e.toString()]);}}}else{if(typeof func=="string"){self._addFunctionMessage("createOnError",[func]);}else{self._addFunctionMessage("createOnError");}}};},_reset:function(){this.status=bespin.test.Status.none;this._outstanding=0;this._start=new Date().getTime();this._notesTd.innerHTML="";dojo.attr(this._resultsTd,this.status.attr);},_runTest:function(){if(this._suite.setupTest){try{this._suite.setupTest.call(this._suite);}catch(e){console.error("setupTest failure when running: "+this._suiteName+"."+this._testName+"(): ",e);this._addFunctionMessage(this._testName,[e.toString()]);this._updateStatus(bespin.test.Status.fail);return;}}console.log("Running test",this._testName);this._updateStatus(bespin.test.Status.exec);try{this._test.call(this._suite,this);if(this._outstanding==0){this._updateStatus(bespin.test.Status.pass);}}catch(e){if(e!="failFast"){console.error(this._suiteName+"."+this._testName+"(): ",e);this._addFunctionMessage(this._testName,[e.toString()]);this._updateStatus(bespin.test.Status.fail);}}if(this._suite.tearDownTest){try{this._suite.tearDownTest.call(this._suite);}catch(e){console.error("tearDownTest failure when running: "+this._suiteName+"."+this._testName+"(): ",e);this._addFunctionMessage(this._testName,[e.toString()]);this._updateStatus(bespin.test.Status.fail);}}},_fail:function(type,args,_bd8){this._addFunctionMessage(type,args,_bd8);this._updateStatus(bespin.test.Status.fail);if(this.failFast){throw "failFast";}},_addFunctionMessage:function(type,args,_bdb){var _bdc=type+this._argsToString(args);if(_bdb){_bdc+=" = "+dojo.toJson(_bdb);}this._addMessage(_bdc);},_addMessage:function(_bdd){this._notesTd.innerHTML+=_bdd+"<br/>";},_updateStatus:function(_bde){if(this.status.ord<_bde.ord){this.status=_bde;}dojo.attr(this._resultsTd,this.status.attr);var _bdf=(new Date().getTime()-this._start)/1000;this._resultsTd.innerHTML+=" (in "+_bdf+" ms)";},_argsToString:function(args){var _be1="(";if(args!=null){for(var i=0;i<args.length;i++){if(i!=0){_be1+=", ";}_be1+=dojo.toJson(args[i]);}}_be1+=")";return _be1;},_isEqual:function(_be3,_be4,_be5){if(!_be5){_be5=0;}if(_be5>10){return true;}if(_be3==null){if(_be4!=null){console.log("expected: null, actual non-null: "+dojo.toJson(_be4));return false;}return true;}if(typeof (_be3)=="number"&&isNaN(_be3)){if(!(typeof (_be4)=="number"&&isNaN(_be4))){console.log("expected: NaN, actual non-NaN: "+dojo.toJson(_be4));return false;}return true;}if(_be4==null){if(_be3!=null){console.log("actual: null, expected non-null: "+dojo.toJson(_be3));return false;}return true;}if(typeof _be3=="object"){if(!(typeof _be4=="object")){console.log("expected object, actual not an object");return false;}var _be6=0;for(var prop in _be4){if(typeof _be4[prop]!="function"||typeof _be3[prop]!="function"){var nest=this._isEqual(_be4[prop],_be3[prop],_be5+1);if(typeof nest!="boolean"||!nest){console.log("element '"+prop+"' does not match: "+nest);return false;}}_be6++;}var _be9=0;for(prop in _be3){_be9++;}if(_be6!=_be9){console.log("expected object size = "+_be9+", actual object size = "+_be6);return false;}return true;}if(_be4!=_be3){console.log("expected = "+_be3+" (type="+typeof _be3+"), actual = "+_be4+" (type="+typeof _be4+")");return false;}if(_be3 instanceof Array){if(!(_be4 instanceof Array)){console.log("expected array, actual not an array");return false;}if(_be4.length!=_be3.length){console.log("expected array length = "+_be3.length+", actual array length = "+_be4.length);return false;}for(var i=0;i<_be4.length;i++){var _beb=this._isEqual(_be4[i],_be3[i],_be5+1);if(typeof _beb!="boolean"||!_beb){console.log("element "+i+" does not match: "+_beb);return false;}}return true;}return true;}});}if(!dojo._hasResource["bespin.testTest"]){dojo._hasResource["bespin.testTest"]=true;dojo.provide("bespin.testTest");bespin.test.addTests("test",{setup:function(){this.setupRun=true;},testSetup:function(test){test.isTrue(this.setupRun);},testSimple:function(test){test.isTrue(true);test.isFalse(false);test.isNull(null);test.isUndefined(undefined);test.isNaN(NaN);test.isEqual(42,42);test.isNotNull(undefined);test.isNotNull(0);test.isNotNull("null");test.isNotNull(false);test.isNotUndefined(null);test.isNotUndefined(0);test.isNotUndefined("undefined");test.isNotUndefined(false);test.isNotNaN(null);test.isNotNaN(0);test.isNotNaN("NaN");test.isNotNaN(false);test.isNotEqual(42,43);test.isNotEqual(0,"0");},testAsync:function(test){setTimeout(test.link(function(){test.isTrue(true);test.isEqual(["a"],["a"]);}),10);},testFailures:function(test){test.message("It is important that this test fails in exactly 11 places");setTimeout(test.link(function(){test.isNull(100,"#7");test.isNotNull(null,"#8");}),10);setTimeout(test.link(function(){test.isNull(100,"#9");}),20);setTimeout(test.createOnError(function(){test.fail("#10");}),30);setTimeout(test.createOnError(function(){test.fail("#11");}),40);test.isTrue(false,"#1");test.isFalse(true,"#2");test.isEqual(42,43,"#3");test.isEqual("a","aa","#4");test.isEqual(["a"],["aa"],"#5");test.fail("Die Die Die","#6");},testFailFast:function(test){test.failFast=true;test.fail("This should fail only once");test.fail("If this happens we are broken");},testSlowDeath:function(test){test.message("This only works if we get a 'Delayed failure' message");setTimeout(test.createOnError(function(){test.message("Delayed failure");}),1000);},testSlowPass:function(test){setTimeout(test.link(function(){test.message("Delayed success");}),1000);},testCommand:function(test){test.command("testoutput wibble","wibble");}});bespin.command.store.addCommand({name:"testoutput",takes:["message ..."],preview:"A test echo command",execute:function(_bf4,args){_bf4.addOutput(args);}});}if(!dojo._hasResource["bespin.plugins"]){dojo._hasResource["bespin.plugins"]=true;dojo.provide("bespin.plugins");dojo.declare("bespin.plugins.Extension",null,{constructor:function(_bf6,_bf7,_bf8,meta){this._pluginName=_bf7;this._pluginCollection=_bf6;this._resolver=_bf8;dojo.mixin(this,meta);},load:function(_bfa){var self=this;var _bfc=this.pointer.split(":");var _bfd=this._resolver(_bfc[0]);var _bfe=bespin.plugins.loader.modules[_bfd];if(!_bfe){bespin.plugins.loader.loadScript(_bfd,{callback:function(_bff){if(!_bff._used_by_plugins){_bff._used_by_plugins={};}_bff._used_by_plugins[self._pluginName]=self._pluginCollection;_bff._resolver=self._resolver;if(_bff.activate){_bff.activate();}if(_bfa){if(_bfc[1]){_bfa(_bff[_bfc[1]]);}else{_bfa(_bff);}}},resolver:this._resolver});return;}if(_bfa){if(_bfc[1]){_bfa(_bfe[_bfc[1]]);}else{_bfa(_bfe);}}},getIfLoaded:function(){var _c00=this.pointer.split(":");var _c01=this._resolver(_c00[0]);var _c02=bespin.plugins.loader.modules[_c01];if(_c00[1]){return _c02[_c00[1]];}else{return _c02;}}});dojo.mixin(bespin.plugins,{metadata:{},builtins:{},extensionPoints:{},unregisterExtensionPoints:function(_c03,_c04){if(!_c04){_c04=bespin.plugins.metadata;}var _c05=bespin.plugins.extensionPoints;var info=_c04[_c03];if(!info){return;}var _c07=info.provides;if(!_c07){return;}for(var i=0;i<_c07.length;i++){var ep=_c07[i];var name=ep[0];var meta=ep[1];var _c0c=_c05[name];if(!_c0c){continue;}for(var j=0;j<_c0c.length;j++){var ext=_c0c[j];if(ext._pluginName==_c03){_c0c.splice(j,1);bespin.publish("extension:removed:"+name,ext);j--;}}}},sameFileResolver:function(name){return this.location;},multiFileResolver:function(name){if(name.charAt(0)!="/"){if(this.location.charAt(this.location.length-1)=="/"){name=this.location+name+".js";}else{name=this.location+"/"+name+".js";}}return name;},registerExtensionPoints:function(_c11,_c12,_c13){var _c14=bespin.plugins.extensionPoints;var _c15=bespin.plugins.Extension;if(!_c12){_c12=bespin.plugins.metadata;}var info=_c12[_c11];var _c17=info.provides;if(!_c17){return;}if(!_c13){_c13=bespin.plugins.multiFileResolver;}_c13=dojo.hitch(info,_c13);for(var i=0;i<_c17.length;i++){var ep=_c17[i];var name=ep[0];var meta=ep[1];var _c1c=_c14[name];if(!_c1c){_c1c=_c14[name]=[];}var ext=new _c15(_c12,_c11,_c13,meta);_c1c.push(ext);bespin.publish("extension:loaded:"+name,ext);}},get:function(_c1e){return bespin.plugins.extensionPoints[_c1e]||[];},loadOne:function(_c1f,_c20){var _c21=bespin.plugins.extensionPoints[_c1f];if(!_c21||!_c21[0]){return false;}_c21[0].load(_c20);return true;},getLoadedOne:function(_c22){var _c23=bespin.plugins.extensionPoints[_c22];if(!_c23||!_c23[0]){return undefined;}return _c23[0].getIfLoaded();},remove:function(_c24,_c25){if(!_c25){_c25=bespin.plugins.metadata;}var info=_c25[_c24];if(info){var _c27=bespin.plugins.loader.modules[info.location];}else{var _c27=undefined;}bespin.plugins.unregisterExtensionPoints(_c24);if(_c27&&_c27.deactivate){_c27.deactivate();}delete _c25[_c24];if(_c25==bespin.plugins.metadata){bespin.get("files").saveFile("BespinSettings",{name:"plugins.json",content:dojo.toJson(bespin.plugins.metadata)});}},_removeLink:function(node){bespin.get("commandLine").executeCommand("plugin remove \""+node.getAttribute("name")+"\"");},installSingleFilePlugin:function(url){var _c2a=bespin.plugins.loader.modules[url];bespin.plugins.loader.loadScript(url,{callback:function(_c2b){if(!_c2b.info){instruction.addError("Plugin module does not have info!");}var name=_c2b.info.name;if(!name){name=filename;}bespin.plugins.unregisterExtensionPoints(name);if(_c2a&&_c2a.deactivate){_c2a.deactivate();}_c2b.info.location=url;bespin.plugins.metadata[name]=_c2b.info;bespin.plugins.registerExtensionPoints(name,bespin.plugins.metadata,bespin.plugins.sameFileResolver);if(_c2b.activate){_c2b.activate();}bespin.get("files").saveFile("BespinSettings",{name:"plugins.json",content:dojo.toJson(bespin.plugins.metadata)});},force:true});},reloadByName:function(_c2d){var info=bespin.plugins.metadata[_c2d];if(!info||!info.location){return;}bespin.plugins.installSingleFilePlugin(info.location);},_reloadLink:function(node){bespin.get("commandLine").executeCommand("plugin reload \""+node.getAttribute("name")+"\"");},_computeModulesToReload:function(_c30,mod,_c32,_c33){_c32[_c30]=true;var _c34=mod._used_by_plugins;for(var _c35 in _c34){_c33[_c35]=_c34[_c35];}for(var _c36 in mod._depended_on_by){var _c37=bespin.plugins.loader.modules[_c36];this._computeModulesToReload(_c36,_c37,_c32,_c33);}}});bespin.plugins.commands=new bespin.command.Store(bespin.command.store,{name:"plugin",preview:"manage Bespin plugins",subcommanddefault:"help"});bespin.plugins.commands.addCommand({name:"install",takes:["name"],execute:function(_c38,name){var _c3a=bespin.get("editSession");var _c3b=_c3a.path;var _c3c=_c3a.project;var url="/getscript/file/at/"+_c3c+"/"+_c3b;bespin.plugins.installSingleFilePlugin(url);_c38.addOutput("Plugin installed.");}});bespin.plugins.commands.addCommand({name:"list",execute:function(_c3e){var _c3f="<h2>Installed plugins:</h2>";_c3f+="<table>";for(var name in bespin.plugins.metadata){_c3f+="<tr><td>"+name+"</td><td><a onclick=\"bespin.plugins._removeLink(this)\" name=\""+name+"\">Remove</a></td><td><a onclick=\"bespin.plugins._reloadLink(this)\" name=\""+name+"\">Reload</a></td></tr>";}_c3f+="</table>";_c3e.addOutput(_c3f);}});bespin.plugins.commands.addCommand({name:"remove",takes:["name"],execute:function(_c41,name){name=name.substring(1,name.length-1);bespin.plugins.remove(name);_c41.addOutput("Plugin removed");}});bespin.plugins.commands.addCommand({name:"reload",takes:["name"],execute:function(_c43,name){name=name.substring(1,name.length-1);bespin.plugins.reloadByName(name);_c43.addOutput("Plugin reloaded");}});bespin.subscribe("bespin:editor:initialized",function(){bespin.get("files").loadContents("BespinSettings","plugins.json",function(info){var data=dojo.fromJson(info.content);bespin.plugins.metadata=data;for(var name in data){bespin.plugins.registerExtensionPoints(name);}});bespin.get("server").request("GET","/js/bespin/builtins.json",null,{evalJSON:true,onSuccess:function(data){bespin.plugins.builtins=data;for(var name in data){bespin.plugins.registerExtensionPoints(name,bespin.plugins.builtins,bespin.plugins.multiFileResolver);}bespin.getComponent("commandLine",function(){});bespin.getComponent("popup",function(){});}});});bespin.subscribe("file:saved",function(e){var _c4b=bespin.get("settings");var _c4c="/getscript/file/at/"+e.project+"/"+e.path;if(_c4b){var _c4d=_c4b.get("editbespin");if(_c4d==e.project){_c4c="/getscript/"+e.path.substring(9);}}var mod=bespin.plugins.loader.modules[_c4c];if(!mod){return;}var _c4f={};var _c50={};bespin.plugins._computeModulesToReload(_c4c,mod,_c4f,_c50);for(var _c51 in _c50){bespin.plugins.unregisterExtensionPoints(_c51,_c50[_c51]);}for(var _c52 in _c4f){delete bespin.plugins.loader.modules[_c52];}for(var _c51 in _c50){bespin.plugins.registerExtensionPoints(_c51,_c50[_c51]);}});}if(!dojo._hasResource["bespin.plugins.loader"]){dojo._hasResource["bespin.plugins.loader"]=true;dojo.provide("bespin.plugins.loader");dojo.mixin(bespin.plugins.loader,{modules:{},loadQueue:{},moduleLoaded:function(_c53,_c54){console.log(_c53+" module has arrived");var _c55=bespin.util.isEmpty;var _c56=_c54.toString();var _c57=bespin.plugins.loader.modules;var _c58=bespin.plugins.loader.loadQueue;var _c59=_c58[_c53];var _c5a=_c59.resolver;var _c5b=_c59.force;_c59.moduleFactory=_c54;var _c5c=/require\s*\(('|")([\w\W]*?)('|")\)/mg;var deps=_c59.deps={};var _c5e=_c59.dependsOn={};var _c5f;while((_c5f=_c5c.exec(_c56))!=null){var _c60=_c5f[2];var _c61=_c5a?_c5a(_c60):_c60;_c5e[_c61]=true;if(_c57[_c61]!==undefined&&!_c5b){continue;}deps[_c61]=true;if(!_c58[_c61]){bespin.plugins.loader.loadScript(_c60,{resolver:_c5a,force:_c5b});}}console.log("Module: ",_c53," depends on ",deps);if(_c55(deps)){bespin.plugins.loader._loaded(_c53,_c58,_c59);}},_loaded:function(_c62){var _c63=bespin.util.isEmpty;var _c64=bespin.plugins.loader.modules;var _c65=bespin.plugins.loader.loadQueue;var _c66=_c65[_c62];var _c67=_c66.resolver;delete _c65[_c62];var _c68=_c66.moduleFactory(function(_c69){if(_c67){_c69=_c67(_c69);}return bespin.plugins.loader.modules[_c69];},{});_c68._name=_c62;_c68._depends_on=_c66.dependsOn;_c68._depended_on_by={};for(var _c6a in _c68._depends_on){_c64[_c6a]._depended_on_by[_c62]=true;}_c64[_c62]=_c68;if(_c66.callback){_c66.callback(_c68);}for(var _c6b in _c65){console.log("Checking ",_c6b," in loadQueue");var qi=_c65[_c6b];console.log("qi deps: ",qi.deps);if(qi.deps&&qi.deps[_c62]){delete qi.deps[_c62];if(_c63(qi.deps)){bespin.plugins.loader._loaded(_c6b);}}}},loadScript:function(_c6d,opts){opts=opts||{};var _c6f=bespin.plugins.loader.loadQueue;if(opts.resolver){_c6d=opts.resolver(_c6d);}if(_c6f[_c6d]&&!opts.force&&!opts.reload){return;}console.log("Queued "+_c6d+" for load");setTimeout(function(){if(_c6f[_c6d]){console.error("Unable to load before timeout: "+_c6d);}},2000);_c6f[_c6d]={factory:null,name:_c6d,callback:opts.callback,resolver:opts.resolver,force:opts.force};bespin.plugins.loader._addScriptTag(_c6d);},_addScriptTag:function(_c70){var s=document.createElement("script");var _c72=new Date().getTime();s.setAttribute("src",_c70+"?"+_c72);document.getElementsByTagName("head")[0].appendChild(s);}});}if(!dojo._hasResource["bespin.plugins.loaderTest"]){dojo._hasResource["bespin.plugins.loaderTest"]=true;dojo.provide("bespin.plugins.loaderTest");bespin.test.addTests("loader",{setup:function(){this.oldAddScriptTag=bespin.plugins.loader._addScriptTag;bespin.plugins.loader._addScriptTag=this._addScriptTag;},tearDown:function(){console.log("teardown was called");bespin.plugins.loader._addScriptTag=this._addScriptTag;},setupTest:function(){this.scriptsLoaded=[];this.reset();},_addScriptTag:function(){console.log("Script tag WOULD HAVE been added if this were not a test");},reset:function(){console.log("reset called");bespin.plugins.loader.modules=[];bespin.plugins.loader.loadQueue=[];},resolver:function(name){if(name.charAt(0)!="/"){name="/js/"+name;}if(!bespin.util.endsWith(name,"\\.js")){name=name+".js";}name="/getscript"+name;return name;},testQueueUpAModule:function(test){bespin.plugins.loader.loadScript("bespin/nonModule",{resolver:this.resolver});var lq=bespin.plugins.loader.loadQueue;test.isNotUndefined(lq["/getscript/js/bespin/nonModule.js"],"Expected to find module in load queue");},testModuleWithNoDeps:function(test){var lq=bespin.plugins.loader.loadQueue;loadCheck={didLoad:false};var _c78="/getscript/js/bespin/nonModule.js";lq[_c78]={resolver:this.resolver};bespin.plugins.loader.moduleLoaded(_c78,function(_c79,_c7a){loadCheck.didLoad=true;_c7a.secretValue=27;return _c7a;});test.isTrue(loadCheck.didLoad);test.isUndefined(lq[_c78],"Module should be gone from the queue");test.isNotUndefined(bespin.plugins.loader.modules[_c78],"Was module object saved?");var _c7b=bespin.plugins.loader.modules[_c78];test.isEqual(27,_c7b.secretValue);},testModuleWithSingleDep:function(test){var lq=bespin.plugins.loader.loadQueue;loadCheck={didLoad:false,otherDidLoad:false};var _c7e="/getscript/js/bespin/nonModule.js";var _c7f="/getscript/js/bespin/depModule.js";bespin.plugins.loader.loadScript("bespin/nonModule",{resolver:this.resolver});bespin.plugins.loader.moduleLoaded(_c7e,function(_c80,_c81){var _c82=_c80("bespin/depModule");loadCheck.didLoad=true;_c81.secretValue=_c82.secretValue;return _c81;});test.isFalse(loadCheck.didLoad);test.isNotUndefined(lq[_c7e],"main module should be in the queue");test.isNotUndefined(lq[_c7f],"dependent module should be in queue");test.isNotUndefined(lq[_c7f].resolver);bespin.plugins.loader.moduleLoaded(_c7f,function(_c83,_c84){loadCheck.otherDidLoad=true;_c84.secretValue=192;return _c84;});test.isTrue(loadCheck.didLoad,"Main module should load");test.isTrue(loadCheck.otherDidLoad,"Module it depended on should load");console.dir(bespin.plugins.loader.modules);var mod=bespin.plugins.loader.modules[_c7e];test.isNotUndefined(mod,"The main module should be requireable");test.isEqual(192,mod.secretValue,"secret value should have been set");test.isEqual(_c7e,mod._name);var _c86={};_c86[_c7f]=true;test.isEqual(mod._depends_on,_c86);var _c87=bespin.plugins.loader.modules[_c7f];test.isEqual(_c7f,_c87._name);var _c88={};_c88[_c7e]=true;test.isEqual(_c87._depended_on_by,_c88);},testModuleLoadOrderShouldNotMatter:function(test){var _c8a=bespin.plugins.loader;var lq=_c8a.loadQueue;var _c8c={};_c8a.loadScript("A",{resolver:this.resolver});_c8a.moduleLoaded("/getscript/js/A.js",function(_c8d,_c8e){_c8c.A=true;var B=_c8d("B");var C=_c8d("C");return _c8e;});test.isUndefined(_c8c.A,"A should not have been loaded yet");test.isNotUndefined(lq["/getscript/js/B.js"],"B should be queued up");test.isNotUndefined(lq["/getscript/js/C.js"],"C should be queued up");_c8a.moduleLoaded("/getscript/js/B.js",function(_c91,_c92){_c8c.B=true;var D=_c91("D");return _c92;});test.isUndefined(_c8c.A,"A should not have been loaded");test.isUndefined(_c8c.B,"B should not have been loaded");_c8a.moduleLoaded("/getscript/js/D.js",function(_c94,_c95){_c8c.D=true;return _c95;});test.isTrue(_c8c.D,"D should *now* have been loaded");test.isTrue(_c8c.B,"B should *now* have been loaded");test.isUndefined(_c8c.A,"A should not have been loaded");_c8a.moduleLoaded("/getscript/js/C.js",function(_c96,_c97){_c8c.C=true;var D=_c96("D");return _c97;});test.isTrue(_c8c.C,"C should *now* have been loaded");test.isTrue(_c8c.A,"A should *now* have been loaded");},testDependenciesAreForceReloadedToo:function(test){var _c9a=bespin.plugins.loader;var lq=_c9a.loadQueue;var _c9c={};_c9a.loadScript("A",{resolver:this.resolver});var _c9d=function(_c9e,_c9f){_c9c.A=true;var B=_c9e("B");return _c9f;};_c9a.moduleLoaded("/getscript/js/A.js",_c9d);test.isUndefined(_c9c.A,"A should not have been loaded yet");test.isNotUndefined(lq["/getscript/js/B.js"],"B should be queued up");var _ca1=function(_ca2,_ca3){_c9c.B=true;return _ca3;};_c9a.moduleLoaded("/getscript/js/B.js",_ca1);test.isNotUndefined(_c9c.A,"A should be loaded");test.isNotUndefined(_c9c.B,"B should be loaded");delete _c9c.A;delete _c9c.B;_c9a.loadScript("A",{resolver:this.resolver,force:true});_c9a.moduleLoaded("/getscript/js/A.js",_c9d);test.isUndefined(_c9c.A,"A should not have been reloaded yet");test.isNotUndefined(lq["/getscript/js/B.js"],"B should be queued up");}});}if(!dojo._hasResource["bespin.syntax.simple.javascript"]){dojo._hasResource["bespin.syntax.simple.javascript"]=true;dojo.provide("bespin.syntax.simple.javascript");bespin.syntax.JavaScriptConstants={C_STYLE_COMMENT:"c-comment",LINE_COMMENT:"comment",STRING:"string",KEYWORD:"keyword",PUNCTUATION:"punctuation",OTHER:"plain"};dojo.declare("bespin.syntax.simple.JavaScript",null,{keywords:" abstract boolean break byte case catch char class const continue debugger "+"default delete do double else enum export extends false final finally float "+"for function goto if implements import in instanceof int interface let long native "+"new null package private protected public return short static super switch "+"synchronized this throw throws transient true try typeof var void volatile while with ",punctuation:"{ } > < / + - % * . , ; ( ) ? : = \" '".split(" "),highlight:function(line,meta){if(!meta){meta={};}var K=bespin.syntax.JavaScriptConstants;var _ca7={};var _ca8=(meta.inMultilineComment)?K.C_STYLE_COMMENT:undefined;var _ca9={};var _caa="";var _cab="";var _cac=meta.inMultilineComment;for(var i=0;i<line.length;i++){var c=line.charAt(i);if(_ca8==K.C_STYLE_COMMENT){if(c=="/"&&/\*$/.test(_caa)){_ca9.stop=i+1;this.addRegion(_ca7,_ca8,_ca9);_ca9={};_ca8=undefined;_cac=false;_caa="";}else{if(_caa==""){_ca9={start:i};}_caa+=c;}continue;}if(this.isWhiteSpaceOrPunctuation(c)){if(_ca8==K.STRING){if(!(c==_cab&&!/\\$/.test(_caa))){if(_caa==""){_ca9={start:i};}_caa+=c;continue;}}if(_caa!=""){_ca9.stop=i;if(_ca8!=K.STRING){if(this.keywords.indexOf(" "+_caa+" ")>-1){_ca8=K.KEYWORD;}else{_ca8=K.OTHER;}}this.addRegion(_ca7,_ca8,_ca9);_ca9={};_cab="";_caa="";}if(this.isPunctuation(c)){if(c=="*"&&i>0&&(line.charAt(i-1)=="/")){_ca7[K.PUNCTUATION].pop();_cac=true;_ca8=K.C_STYLE_COMMENT;_ca9={start:i-1};_caa="/*";continue;}if(c=="/"&&i>0&&(line.charAt(i-1)=="/")){_ca9={start:i-1,stop:line.length};_ca8=K.LINE_COMMENT;this.addRegion(_ca7,_ca8,_ca9);_caa="";_ca8=undefined;_ca9={};break;}this.addRegion(_ca7,K.PUNCTUATION,{start:i,stop:i+1});}if((c=="'"||c=="\"")&&(_ca8!=K.STRING)){_ca8=K.STRING;_cab=c;}else{_ca8=undefined;}continue;}if(_caa==""){_ca9={start:i};}_caa+=c;}if(_caa!=""){if(!_ca8){_ca8=K.OTHER;}_ca9.stop=line.length;this.addRegion(_ca7,_ca8,_ca9);}var _caf={inMultilineComment:_cac};if(meta.inJavaScript){_caf.inJavaScript=meta.inJavaScript;}return {regions:_ca7,meta:_caf};},addRegion:function(_cb0,type,data){if(!_cb0[type]){_cb0[type]=[];}_cb0[type].push(data);},isWhiteSpaceOrPunctuation:function(ch){return this.isPunctuation(ch)||this.isWhiteSpace(ch);},isPunctuation:function(ch){return this.punctuation.indexOf(ch)!=-1;},isWhiteSpace:function(ch){return ch==" ";}});}if(!dojo._hasResource["bespin.editor.dependencies"]){dojo._hasResource["bespin.editor.dependencies"]=true;dojo.provide("bespin.editor.dependencies");}if(!dojo._hasResource["bespin.client.settings"]){dojo._hasResource["bespin.client.settings"]=true;dojo.provide("bespin.client.settings");dojo.declare("bespin.client.settings.Core",null,{constructor:function(_cb6){this.browserOverrides={};this.fromURL=new bespin.client.settings.URL();this.customEvents=new bespin.client.settings.Events(this);this.loadStore(_cb6);},loadSession:function(){var _cb7=bespin.get("editSession");var path=this.fromURL.get("path")||_cb7.path;var _cb9=this.fromURL.get("project")||_cb7.project;bespin.publish("settings:init",{path:path,project:_cb9});},defaultSettings:function(){return {"tabsize":"4","tabmode":"off","tabarrow":"on","fontsize":"10","consolefontsize":"11","autocomplete":"off","closepairs":"off","collaborate":"off","language":"auto","strictlines":"on","syntaxcheck":"off","syntaxengine":"simple","syntaxmarkers":"all","preview":"window","smartmove":"on","jslint":{}};},isOn:function(_cba){return _cba=="on"||_cba=="true";},isOff:function(_cbb){return _cbb=="off"||_cbb=="false"||_cbb===undefined;},isSettingOn:function(key){return this.isOn(this.get(key));},isSettingOff:function(key){return this.isOff(this.get(key));},loadStore:function(_cbe){this.store=new (_cbe||bespin.client.settings.ServerFile)(this);},toList:function(){var _cbf=[];var _cc0=this.store.settings;for(var prop in _cc0){if(_cc0.hasOwnProperty(prop)){_cbf.push({"key":prop,"value":_cc0[prop]});}}return _cbf;},set:function(key,_cc3){this.store.set(key,_cc3);bespin.publish("settings:set:"+key,{value:_cc3});},setObject:function(key,_cc5){this.set(key,dojo.toJson(_cc5));},get:function(key){var _cc7=this.fromURL.get(key);if(_cc7){return _cc7;}return this.store.get(key);},getObject:function(key){try{return dojo.fromJson(this.get(key));}catch(e){console.log("Error in getObject: "+e);return {};}},unset:function(key){this.store.unset(key);},list:function(){if(typeof this.store["list"]=="function"){return this.store.list();}else{return this.toList();}},publishValues:function(){for(var _cca in dojo._topics){var _ccb="bespin:settings:set:";if(_cca.indexOf(_ccb)==0){var _ccc=_cca.substring(_ccb.length);bespin.publish("settings:set:"+_ccc,{value:this.get(_ccc)});}}}});dojo.declare("bespin.client.settings.InMemory",null,{constructor:function(_ccd){this.parent=_ccd;this.settings=this.parent.defaultSettings();bespin.publish("settings:loaded");},set:function(key,_ccf){this.settings[key]=_ccf;},get:function(key){return this.settings[key];},unset:function(key){delete this.settings[key];}});dojo.declare("bespin.client.settings.Cookie",null,{constructor:function(_cd2){var _cd3=1;this.cookieSettings={expires:_cd3/24,path:"/"};var _cd4=dojo.fromJson(dojo.cookie("settings"));if(_cd4){this.settings=_cd4;}else{this.settings={"tabsize":"2","fontsize":"10","autocomplete":"off","collaborate":"off"};dojo.cookie("settings",dojo.toJson(this.settings),this.cookieSettings);}bespin.publish("settings:loaded");},set:function(key,_cd6){this.settings[key]=_cd6;dojo.cookie("settings",dojo.toJson(this.settings),this.cookieSettings);},get:function(key){return this.settings[key];},unset:function(key){delete this.settings[key];dojo.cookie("settings",dojo.toJson(this.settings),this.cookieSettings);}});dojo.declare("bespin.client.settings.ServerAPI",null,{constructor:function(_cd9){this.parent=_cd9;this.server=bespin.get("server");this.settings=this.parent.defaultSettings();this.server.listSettings(dojo.hitch(this,function(_cda){this.settings=_cda;if(_cda["tabsize"]===undefined){this.settings=this.parent.defaultSettings();this.server.setSettings(this.settings);}bespin.publish("settings:loaded");}));},set:function(key,_cdc){this.settings[key]=_cdc;this.server.setSetting(key,_cdc);},get:function(key){return this.settings[key];},unset:function(key){delete this.settings[key];this.server.unsetSetting(key);}});dojo.declare("bespin.client.settings.ServerFile",null,{constructor:function(_cdf){this.parent=_cdf;this.server=bespin.get("server");this.settings=this.parent.defaultSettings();this.loaded=false;this._load();},set:function(key,_ce1){this.settings[key]=_ce1;if(key[0]!="_"){this._save();}},get:function(key){return this.settings[key];},unset:function(key){delete this.settings[key];this._save();},_save:function(){if(!this.loaded){return;}var _ce4="";for(var key in this.settings){if(this.settings.hasOwnProperty(key)){_ce4+=key+" "+this.settings[key]+"\n";}}bespin.get("files").saveFile(bespin.userSettingsProject,{name:"settings",content:_ce4,timestamp:new Date().getTime()});},_load:function(){var self=this;var _ce7=function(){if(!self.loaded){self.loaded=true;bespin.publish("settings:loaded");}};var _ce8=function(file){dojo.forEach(file.content.split(/\n/),function(_cea){if(_cea.match(/^\s*#/)){return;}if(_cea.match(/\S+\s+\S+/)){var _ceb=_cea.split(/\s+/);self.settings[dojo.trim(_ceb[0])]=dojo.trim(_ceb[1]);}});self.parent.publishValues();_ce7();};bespin.fireAfter(["authenticated"],function(){bespin.get("files").loadContents(bespin.userSettingsProject,"settings",_ce8,_ce7);});}});dojo.declare("bespin.client.settings.URL",null,{constructor:function(_cec){this.results=dojo.queryToObject(this.stripHash(_cec||window.location.hash));},get:function(key){return this.results[key];},set:function(key,_cef){this.results[key]=_cef;},stripHash:function(url){var tobe=url.split("");tobe.shift();return tobe.join("");}});dojo.declare("bespin.client.settings.Events",null,{constructor:function(_cf2){var _cf3=bespin.get("editSession");var _cf4=bespin.get("editor");bespin.subscribe("settings:set",function(_cf5){var key=_cf5.key;var _cf7=_cf5.value;_cf2.set(key,_cf7);});bespin.subscribe("editor:openfile:opensuccess",function(_cf8){if(_cf8.file.name==null){throw new Error("event.file.name falsy");}if(_cf8.project){_cf3.project=_cf8.project;}_cf3.path=_cf8.file.name;var _cf9=bespin.util.path.fileType(_cf8.file.name);if(_cf9){bespin.publish("settings:language",{language:_cf9});}});(function(){var _cfa={"BespinSettings/config":"js"};bespin.subscribe("editor:openfile:opensuccess",function(_cfb){var _cfc=_cfb.project||bespin.get("editSession").project;var _cfd=_cfb.file.name;var _cfe=_cfc+"/"+_cfd;if(_cfa[_cfe]){bespin.publish("settings:language",{language:_cfa[_cfe]});}});}());bespin.subscribe("settings:set:language",function(_cff){bespin.publish("settings:language",{language:_cff.value,fromCommand:true});});bespin.subscribe("settings:language",function(_d00){var _d01=_d00.language;var _d02=_d00.fromCommand;var _d03=_cf2.get("language")||"auto";if(_d01==_cf4.language){return;}if(bespin.util.include(["auto","on"],_d01)){var path=_cf2.fromURL.get("path");if(path){var _d05=bespin.util.path.fileType(path);if(_d05){_cf4.language=_d05;}}}else{if(bespin.util.include(["auto","on"],_d03)||_d02){_cf4.language=_d01;}else{if(_d03=="off"){_cf4.language="off";}}}});bespin.subscribe("settings:set:fontsize",function(_d06){var _d07=parseInt(_d06.value);_cf4.theme.editorTextFont=_cf4.theme.editorTextFont.replace(/[0-9]{1,}pt/,_d07+"pt");_cf4.theme.lineNumberFont=_cf4.theme.lineNumberFont.replace(/[0-9]{1,}pt/,_d07+"pt");});bespin.subscribe("settings:set:theme",function(_d08){var _d09=_d08.value;var _d0a=function(){var _d0b=bespin.themes[_d09];if(_d0b){if(_d0b!=_cf4.theme){_cf4.theme=_d0b;bespin.publish("settings:set:fontsize",{value:_cf2.get("fontsize")});}return true;}return false;};if(_d09){if(_d0a()){return true;}try{var dr=dojo.require;dr.call(dojo,"bespin.themes."+_d09);if(_d0a()){return true;}}catch(e){console.log("Unable to load theme: "+_d09,e);}bespin.get("files").loadContents(bespin.userSettingsProject,"/themes/"+_d09+".js",dojo.hitch(this,function(file){try{eval(file.content);}catch(e){console.log("Error with theme loading: ",e);}if(!_d0a()){bespin.get("commandLine").addErrorOutput("Sorry old chap. No theme called '"+_d09+"'. Fancy making it?");}}),function(){bespin.get("commandLine").addErrorOutput("Sorry old chap. No theme called '"+_d09+"'. Fancy making it?");});}});bespin.subscribe("settings:set:keybindings",function(_d0e){if(_d0e.value=="emacs"){_cf4.bindKey("moveCursorLeft","ctrl b");_cf4.bindKey("moveCursorRight","ctrl f");_cf4.bindKey("moveCursorUp","ctrl p");_cf4.bindKey("moveCursorDown","ctrl n");_cf4.bindKey("moveToLineStart","ctrl a");_cf4.bindKey("moveToLineEnd","ctrl e");}});bespin.subscribe("settings:set:debugmode",function(_d0f){_cf4.debugMode=_cf2.isOn(_d0f.value);if(_cf4.debugMode){bespin.plugins.loadOne("bespin.debugger",function(_d10){_d10.loadBreakpoints(function(){_cf4.paint(true);});});}else{_cf4.paint(true);}});bespin.subscribe("settings:set:cursorblink",function(_d11){var ms=parseInt(_d11.value);if(ms){_cf4.ui.toggleCursorFrequency=ms;}});var _d13;bespin.subscribe("settings:set:trimonsave",function(_d14){if(_cf2.isOn(_d14.value)){_d13=bespin.subscribe("editor:savefile:before",function(_d15){bespin.get("commandLine").executeCommand("trim",true);});}else{bespin.unsubscribe(_d13);}});bespin.subscribe("settings:set:syntaxcheck",function(data){if(_cf2.isOff(data.value)){bespin.publish("parser:stop");}else{bespin.publish("parser:start");}});bespin.subscribe("settings:init",function(_d17){if(!_cf2.isSettingOn("hidewelcomescreen")&&bespin.wizard){bespin.wizard.show(null,"newuser",false);}if(_d17.path){_cf4.openFile(_d17.project,_d17.path);}else{var _d18=_cf2.getObject("_lastused");if(!_d18){_cf4.openFile("SampleProject","readme.txt");}else{_cf4.openFile(_d18[0].project,_d18[0].filename,_d18[0]);}}});bespin.subscribe("settings:init",function(){if(_cf2.isOff(_cf2.get("autoconfig"))){return;}try{bespin.get("files").evalFile(bespin.userSettingsProject,"config");}catch(e){console.log("Error in user config: ",e);}});}});}if(!dojo._hasResource["bespin.editor.component"]){dojo._hasResource["bespin.editor.component"]=true;dojo.provide("bespin.editor.component");dojo.declare("bespin.editor.Component",null,{constructor:function(_d19,opts){opts.actsAsComponent=true;var _d1b;if(opts.loadfromdiv){if(dojo.byId("BESPIN_EDITOR_CODE")){var code=dojo.byId("BESPIN_EDITOR_CODE");_d1b=code.value;}else{_d1b=dojo.byId(_d19).innerHTML;}}else{if(opts.content){_d1b=opts.content;}}this.editor=bespin.register("editor",opts.editor||new bespin.editor.API(_d19,opts));bespin.register("settings",opts.settings||new bespin.client.settings.Core(bespin.client.settings.InMemory));if(opts.jetpack){var _d1d=dojo.create("div",{id:"jetpacktoolbar"},dojo.byId(_d19));_d1d.innerHTML="<div class=\"button\"><button id=\"install\" onclick=\"_editorComponent.executeCommand('jetpack install yourfirstjetpack')\">&uarr; Install This JetPack Feature</button></div>            <div>Hey, <a href=\"https://jetpack.mozillalabs.com/\">install JetPack first</a>.</div>            <style type=\"text/css\">                #jetpacktoolbar {                    position: relative;                    top: -15px;                    left: 0;                    height: 40px;                    background-image: url(https://bespin.mozilla.com/images/footer_bg.png);                    background-repeat: repeat-x;                    color: white;                    font-family: Helvetica, Arial, sans-serif;                    font-size: 11px;                }                #jetpacktoolbar div {                    padding: 17px 12px;                    float: left;                }                #jetpacktoolbar div.button {                    float: right;                    padding: 13px 0;                }                #jetpacktoolbar button {                    margin:0 7px 0 0;                }                #jetpacktoolbar a {                    color: #eee;                }            </style>";}dojo.connect(window,"resize",opts.resize||dojo.hitch(this,function(){this.editor.paint();}));if(_d1b){this.setContent(_d1b);}if(opts.language){bespin.publish("settings:language",{language:opts.language});}if(!opts.dontstealfocus){this.editor.canvas.focus();}if(opts.set){for(var key in opts.set){if(opts.set.hasOwnProperty(key)){this.set(key,opts.set[key]);}}}},getContent:function(){return this.editor.model.getDocument();},setContent:function(_d1f){return this.editor.model.insertDocument(_d1f);},setFocus:function(bool){return this.editor.setFocus(bool);},setLineNumber:function(_d21){bespin.get("editor").moveAndCenter(_d21);},set:function(key,_d23){bespin.publish("settings:set",{key:key,value:_d23});},onchange:function(_d24){bespin.subscribe("editor:document:changed",_d24);},bindKey:function(opts){bespin.get("editor").bindKey(opts.action,opts.modifiers+" "+opts.key);},executeCommand:function(_d26){try{this.commandLine.executeCommand(_d26);}catch(e){}},dispose:function(){this.editor.dispose();}});}if(dojo.config.afterOnLoad&&dojo.isBrowser){window.setTimeout(dojo._loadInit,1000);}})();
