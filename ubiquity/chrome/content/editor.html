<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
  <title>Ubiquity Command Editor</title>
  <script type="text/javascript" src="prefcommands.js"></script>
  <script type="application/javascript;version=1.7"
          src="utils.js"></script>
  <script type="application/javascript;version=1.7"
          src="codesource.js"></script>
  <script type="application/javascript;version=1.7"
          src="linkrel_codesource.js"></script>
  <script type="text/javascript"
          src="resource://ubiquity-scripts/jquery-1.2.3.min.js"></script>
  <script type="application/javascript;version=1.7"
          src="editor.js"></script>
  <script type="application/javascript;version=1.7"
          src="resource://ubiquity-scripts/codemirror/js/codemirror.js"></script>
  <script type="text/javascript"> 
   function initialize() { 
       document.getElementById('editor').value = PrefCommands.getCode(); 
   } 
   var file; 
   var lastModifiedTime = 0; 
   function launch() { 
       file = Editor.launchEditor(document.getElementById('editor').editor.editor.getCode()); 
       if(file != null && file.exists()){ 
          lastModifiedTime = file.lastModifiedTime; 
          setTimeout(watchFile, 500) 
       } 
   } 
   function watchFile(){ 
      if(file != null && file.exists()){ 
        time = file.lastModifiedTime; 
        if(time > lastModifiedTime){
           document.getElementById('editor').editor.setCode(Editor.readFile(file)); 
           PrefCommands.setCode(document.getElementById('editor').editor.editor.getCode()); 
           lastModifiedTime = time;
        }
        setTimeout(watchFile, 500);
      }
   }
   function highlight(){
      var textarea = document.getElementById("editor");
      var editor = new CodeMirror(CodeMirror.replace(textarea), {
         height: textarea.clientHeight,
         content: textarea.value,
         parserfile: ["tokenizejavascript.js", "parsejavascript.js"],
         stylesheet: "resource://ubiquity-scripts/codemirror/css/jscolors.css",
         path: "resource://ubiquity-scripts/codemirror/js/",
         autoMatchParens: true
      });
      var iframe = document.getElementsByTagName("iframe")[0];
      iframe.setAttribute("id", "editor");
      iframe.editor = editor;
      highlightWatcher();
   }
   function highlightWatcher(){
      var editor = document.getElementById("editor");
      if (editor && editor.editor && editor.editor.editor && editor.editor.editor.keyUp) {
          editor.editor.editor._keyUp = editor.editor.editor.keyUp;
          editor.editor.editor.keyUp = function(e) {
              editor.editor.editor._keyUp(e);
              PrefCommands.setCode(editor.editor.editor.getCode());
          };
          editor.contentWindow.focus();
          editor.editor.editor.jumpToLine(1);
      } else window.setTimeout(function(){highlightWatcher()}, 100);
   }
  </script>
  <link rel="stylesheet" href="web-content.css" type="text/css">
  <link rel="shortcut icon" href="chrome://ubiquity/skin/icons/favicon.ico" type="image/x-icon" />
</head>

<body onload="initialize();Editor.onLoad();highlight()">
  <div class="head left">
    <red>ubiquity</red> the command <em>editor</em></span>
  </div>
  
  
  <div id="nav-container">
    <ul id="nav">
      <li><a href="about:ubiquity">Home</a></li>
      <li><a href="chrome://ubiquity/content/cmdlist.html">Your Commands</a></li>
    <li><a href="chrome://ubiquity/content/editor.html">Command Editor</a></li>
      <!-- <li><a href="chrome://ubiquity/content/skinlist.html">Your Skins</a></li> -->
      <li><a href="https://wiki.mozilla.org/Labs/Ubiquity/Ubiquity_0.1_User_Tutorial">Tutorial</a></li>
      <li><a href="https://labs.toolness.com/ubiquity-herd/">Find New Commands</a></li>
    </ul>  
  </div>

  <br clear="all"/>
    
<h1>Ubiquity Command Editor</h1>
<p id="notification-bar" class="notification" style="display:none"></p>

<div class="col-three">
  <p><strong>Enter new commands</strong> in the area below.  They will automatically be saved as you type, and will
  be able to be instantly used from the command entry mode.</p>  
</div>  

<div class="col-three">
  <p><strong>Read the <a href="https://wiki.mozilla.org/Labs/Ubiquity/Ubiquity_0.1_Author_Tutorial">command authoring tutorial</a></strong> to learn more. For examples of built-in commands, look <a href="chrome://ubiquity/content/builtincmds.js">here</a>,
    for information on available utility functions for use in commands, look <a href="chrome://ubiquity/content/cmdutils.js">here</a>.</p>
</div>

<div class="col-two">
  <p><b>Get involved</b>. Learn how by visiting the
  <a href="http://wiki.mozilla.org/Labs/Ubiquity">Ubiquity Wiki</a>.</p> 
</div>

<br clear="all"/>
<div id="editor-actions">
  <div id="save-as-div" class="col-three">
    <b><a href="javascript:void(saveAs())">Save</a> to file </b>
  </div>
  
  <div id="import-template-div" class="col-three">
    <b><a href="javascript:void(importTemplate())">Import</a> command template.<b>
  </div>

  <div id="external-editor-div" class="col-three">
    <b><a href="javascript:void(launch())">Launch</a> an external editor.</b>
    <br/>Your editor is
    <input id="editorInputBox" type="file" size="20" 
           style="cursor:pointer" 
           onchange="Editor.onSave()"/>
  </div>

  <div id="paste-as-div" class="col-two">
    <b><a href="javascript:void(paste())">Share</a></b>
  </div>
</div>

<div id="editor-div">
  <textarea id="editor" rows="40" style="width:900px"
            onkeyup="PrefCommands.setCode(this.value);"></textarea>
</div>


</body></html>
