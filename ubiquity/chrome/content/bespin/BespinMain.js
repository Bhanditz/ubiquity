bespin.tiki.register("::text_editor",{name:"text_editor",dependencies:{completion:"0.0.0",undomanager:"0.0.0",settings:"0.0.0",canon:"0.0.0",rangeutils:"0.0.0",traits:"0.0.0",theme_manager:"0.0.0",keyboard:"0.0.0",edit_session:"0.0.0",syntax_manager:"0.0.0"}});
bespin.tiki.module("text_editor:commands/editing",function(q,n){var m=q("settings").settings,l=q("environment").env,e=q("rangeutils:utils/range");n.backspace=function(){l.view.performBackspaceOrDelete(true)};n.deleteCommand=function(){l.view.performBackspaceOrDelete(false)};n.deleteLines=function(){if(!l.model.readOnly)if(l.model.lines.length!=1){var b=l.view;b.groupChanges(function(){var a=b.getSelectedRange(),h=l.model.lines,g=h.length-1,f;f=a.start.row==g?{col:h[g-1].length,row:g-1}:{col:0,row:a.start.row};
b.replaceCharacters({start:f,end:a.end.row==g?{col:h[g].length,row:g}:{col:0,row:a.end.row+1}},"");b.moveCursorTo(f)})}};var d=function(b,a){var h=a.getSelectedRange().start;b=/^\s*/.exec(b.lines[h.row].substring(0,h.col));a.insertText("\n"+b)};n.insertText=function(b){l.view.insertText(b.text)};n.newline=function(){d(l.model,l.view)};n.joinLines=function(){var b=l.model;if(!b.readOnly){var a=l.view,h=a.getSelectedRange(),g=b.lines,f=h.end.row;g.length!=f&&a.groupChanges(function(){a.replaceCharacters({start:{col:g[f].length,
row:f},end:{col:/^\s*/.exec(g[f+1])[0].length,row:f+1}},"")})}};n.openLine=function(){if(!l.model.readOnly){var b=l.model,a=l.view,h=a.getSelectedRange().end.row;a.moveCursorTo({row:h,col:b.lines[h].length});d(b,a)}};n.tab=function(){var b=l.view;b.groupChanges(function(){var a=m.get("tabstop"),h=b.getSelectedRange(),g="";if(e.isZeroLength(h)){var f=l.model.lines[h.start.row].substring(h.start.col).match(/^\s*/)[0].length;a=a-(h.start.col+f)%a;for(var i=0;i<a;i++)g+=" ";b.replaceCharacters({start:h.start,
end:h.start},g);b.moveCursorTo({col:h.start.col+a+f,row:h.end.row})}else{for(i=0;i<a;i++)g+=" ";for(i=h.start.row-1;i++<h.end.row;){f=i==h.start.row?h.start.col:0;b.replaceCharacters({start:{row:i,col:f},end:{row:i,col:f}},g)}b.setSelection({start:h.start,end:{col:h.end.col+a,row:h.end.row}})}}.bind(this))};n.untab=function(){var b=l.view;b.groupChanges(function(){var a=m.get("tabstop"),h=b.getSelectedRange(),g=l.model.lines,f=0;if(e.isZeroLength(h)){f=Math.min(g[h.start.row].substring(0,h.start.col).match(/\s*$/)[0].length,
(h.start.col-a)%a||a);b.replaceCharacters({start:{col:h.start.col-f,row:h.start.row},end:h.start},"");b.moveCursorTo({row:h.start.row,col:h.end.col-f})}else{for(var i,j=h.start.row-1;j++<h.end.row;){i=j==h.start.row?h.start.col:0;f=Math.min(g[j].substring(i).match(/^\s*/)[0].length,a);b.replaceCharacters({start:{row:j,col:i},end:{row:j,col:i+f}},"")}b.setSelection({start:{row:h.start.row,col:h.start.col},end:{row:h.end.row,col:h.end.col-f}})}}.bind(this))}});
bespin.tiki.module("text_editor:commands/editor",function(q,n){q("bespin:plugins");var m=q("settings").settings,l=q("environment").env;n.findNextCommand=function(){var d=l.view,b=d.editor.searchController,a=d.getSelectedRange();if(b=b.findNext(a.end,true)){d.setSelection(b,true);d.focus()}};n.findPrevCommand=function(){var d=l.view,b=d.editor.searchController,a=d.getSelectedRange();if(b=b.findPrevious(a.start,true)){d.setSelection(b,true);d.focus()}};var e=function(d){var b=l.view,a=b.getSelectedCharacters();
d=d(a);b=b.getSelectedRange();l.model.replaceCharacters(b,d)};n.replaceCommand=function(d){e(function(b){return b.replace(d.search+"/g",d.replace)})};n.entabCommand=function(){tabstop=m.get("tabstop");e(function(d){return d.replace(" {"+tabstop+"}","\t")})};n.detabCommand=function(){tabstop=m.get("tabstop");e(function(d){return d.replace("\t",(new Array(tabstop+1)).join(" "))})};n.trimCommand=function(d){e(function(b){b=b.split("\n");b=b.map(function(a){if(d.side==="left"||d.side==="both")a=a.replace(/^\s+/,
"");if(d.side==="right"||d.side==="both")a=a.replace(/\s+$/,"");return a});return b.join("\n")})};n.ucCommand=function(){e(function(d){return d.toUpperCase()})};n.lcCommand=function(){e(function(d){return d.toLowerCase()})}});
bespin.tiki.module("text_editor:commands/movement",function(q,n){q("rangeutils:utils/range");var m=q("environment").env;n.moveDown=function(){m.view.moveDown()};n.moveLeft=function(){m.view.moveLeft()};n.moveRight=function(){m.view.moveRight()};n.moveUp=function(){m.view.moveUp()};n.selectDown=function(){m.view.selectDown()};n.selectLeft=function(){m.view.selectLeft()};n.selectRight=function(){m.view.selectRight()};n.selectUp=function(){m.view.selectUp()};var l=function(h,g){var f=m.view,i=m.model.lines,
j=f.getSelectedRange(true);g=g?j.end.row:i.length-1;f.moveCursorTo({row:g,col:i[g].length},h)};n.moveLineEnd=function(){l(false,true)};n.selectLineEnd=function(){l(true,true)};n.moveDocEnd=function(){l(false,false)};n.selectDocEnd=function(){l(true,false)};var e=function(h,g){var f=m.view,i=f.getSelectedRange(true);f.moveCursorTo({row:g?i.end.row:0,col:0},h)};n.moveLineStart=function(){e(false,true)};n.selectLineStart=function(){e(true,true)};n.moveDocStart=function(){e(false,false)};n.selectDocStart=
function(){e(true,false)};var d=function(h,g,f,i,j){var k=0,r=false;if(i<0){f--;if(j)k=1}for(;f<g.length&&f>-1;){if(j=h.isDelimiter(g[f]))k++;else r=true;if((j||k>1)&&r)break;f+=i}i<0&&f++;return f},b=function(h){var g=m.view,f=m.model.lines,i=g.getSelectedRange(true).end,j=i.row;i=i.col;var k=f[j],r=false;if(i>=k.length){j++;r=true;if(j<f.length){i=0;k=f[j]}else k=""}i=d(g,k,i,1,r);g.moveCursorTo({row:j,col:i},h)},a=function(h){var g=m.view,f=m.model.lines,i=g.getSelectedRange(true).end,j=i.row;
i=i.col;var k=f[j],r=false;if(i>k.length)i=k.length;else if(i==0){j--;r=true;if(j>-1){k=f[j];i=k.length}else k=""}i=d(g,k,i,-1,r);g.moveCursorTo({row:j,col:i},h)};n.moveNextWord=function(){b(false)};n.selectNextWord=function(){b(true)};n.movePreviousWord=function(){a(false)};n.selectPreviousWord=function(){a(true)};n.selectAll=function(){m.view.selectAll()}});
bespin.tiki.module("text_editor:commands/scrolling",function(q,n){var m=q("environment").env;n.scrollDocStart=function(){m.view.scrollToPosition({col:0,row:0})};n.scrollDocEnd=function(){m.view.scrollToPosition(m.model.range.end)};n.scrollPageDown=function(){m.view.scrollPageDown()};n.scrollPageUp=function(){m.view.scrollPageUp()}});
bespin.tiki.module("text_editor:controllers/layoutmanager",function(q,n){var m=q("bespin:util/util"),l=q("events").Event;q("rangeutils:utils/range");var e=q("syntax_manager").SyntaxManager,d=q("models/textstorage").TextStorage,b=q("bespin:plugins").catalog,a=q("settings").settings,h=q("bespin:util/scratchcanvas"),g={};q=function(){var f=a.get("fontsize"),i=a.get("fontface");i=f+"px "+i;for(var j=h.get(),k="",r=0;r<100;r++)k+="M";i=j.measureStringWidth(i,k)/100;g.characterWidth=i;g.lineHeight=Math.floor(f*
1.6);g.lineAscent=Math.floor(f*1.3)};q();b.registerExtension("settingChange",{match:"font[size|face]",pointer:q});n.LayoutManager=function(f){this.changedTextAtRow=new l;this.invalidatedRects=new l;this.fontDimension=g;if(f.textStorage){f._textStorage=f.textStorage;delete f.textStorage}else this._textStorage=new d;m.mixin(this,f);this._textStorage.changed.add(this.textStorageChanged.bind(this));this.textLines=[{characters:"",colors:[{start:0,end:0,color:"plain"}]}];this.syntaxManager=f=new e(this);
f.attrsChanged.add(this._attrsChanged.bind(this));this._size={width:0,height:0};this.sizeChanged=new l;this._height=0;this._recomputeEntireLayout()};n.LayoutManager.prototype={_maximumWidth:0,_textStorage:null,_size:null,sizeChanged:null,_theme:{},margin:{left:5,bottom:6,top:0,right:12},pluginCatalog:b,syntaxManager:null,textLines:null,_attrsChanged:function(f,i){this.updateTextRows(f,i);this.invalidatedRects(this,this.rectsForRange({start:{row:f,col:0},end:{row:i,col:0}}))},_computeInvalidRects:function(f,
i){var j=this.characterRectForPosition(f.start),k={x:j.x,y:j.y,width:Number.MAX_VALUE,height:j.height};return f.end.row===i.end.row?[k]:[k,{x:0,y:j.y+g.lineHeight,width:Number.MAX_VALUE,height:Number.MAX_VALUE}]},_lastCharacterPosition:function(){return{row:this.textLines.length-1,col:this._maximumWidth}},_recalculateMaximumWidth:function(){var f=0;this.textLines.forEach(function(i){i=i.characters.length;if(f<i)f=i});this._maximumWidth=f;this.size={width:f,height:this.textLines.length}},_recomputeEntireLayout:function(){var f=
this._textStorage.range;this._recomputeLayoutForRanges(f,f)},_recomputeLayoutForRanges:function(f,i){for(var j=f.start.row,k=f.end.row,r=i.end.row,p=r-j+1,u=this._textStorage.lines,t=this._theme.plain,w=[],o=0;o<p;o++)w[o]={characters:u[j+o],colors:[{start:0,end:null,color:t}]};this.textLines=m.replace(this.textLines,j,k-j+1,w);this._recalculateMaximumWidth();k=this.textLines.length;p=this.syntaxManager;if(this._height!==k)this._height=k;p.invalidateRow(j);this.updateTextRows(j,r+1);this.changedTextAtRow(this,
j);this.invalidatedRects(this,this._computeInvalidRects(f,i))},boundingRect:function(){return this.rectsForRange({start:{row:0,col:0},end:{row:this.textLines.length-1,col:this._maximumWidth}})[0]},characterAtPoint:function(f){var i=this.margin,j=f.x-i.left,k=g.characterWidth,r=this._textStorage;f=r.clampPosition({row:Math.floor((f.y-i.top)/g.lineHeight),col:Math.floor(j/k)});r=r.lines[f.row].length;f.partialFraction=j<0||f.col===r?0:j%k/k;return f},characterRangeForBoundingRect:function(f){var i=
g.lineHeight,j=g.characterWidth,k=this.margin,r=f.x-k.left;k=f.y-k.top;return{start:{row:Math.max(Math.floor(k/i),0),col:Math.max(Math.floor(r/j),0)},end:{row:Math.floor((k+f.height-1)/i),col:Math.floor((r+f.width-1)/j)+1}}},characterRectForPosition:function(f){return this.rectsForRange({start:f,end:{row:f.row,col:f.col+1}})[0]},lineRectForRow:function(f){return this.rectsForRange({start:{row:f,col:0},end:{row:f,col:this._maximumWidth}})[0]},rectForPosition:function(f){var i=this.margin,j=g.characterWidth,
k=g.lineHeight;return{x:i.left+j*f.col,y:i.top+k*f.row,width:j,height:k}},rectsForRange:function(f){var i=g.characterWidth,j=g.lineHeight,k=this._maximumWidth,r=this.margin,p=f.start,u=f.end;f=p.row;var t=p.col;p=u.row;u=u.col;if(f===p)return[{x:r.left+i*t,y:r.top+j*f,width:i*(u-t),height:j}];var w=[],o;if(t===0)o=f;else{o=f+1;w.push({x:r.left+i*t,y:r.top+j*f,width:99999,height:j})}if(u===0)k=p-1;else if(u===k)k=p;else{k=p-1;w.push({x:r.left,y:r.top+j*p,width:i*u,height:j})}w.push({x:r.left,y:r.top+
j*o,width:99999,height:j*(k-o+1)});return w},textStorageChanged:function(f,i){this._recomputeLayoutForRanges(f,i)},updateTextRows:function(f,i){var j=this.textLines;i=this.syntaxManager.getAttrsForRows(f,i);for(var k=0;k<i.length;k++)j[f+k].colors=i[k]}};Object.defineProperties(n.LayoutManager.prototype,{size:{set:function(f){if(f.width!==this._size.width||f.height!==this._size.height){this.sizeChanged(f);this._size=f}},get:function(){return this._size}},textStorage:{get:function(){return this._textStorage}}})});
bespin.tiki.module("text_editor:controllers/search",function(q,n){var m=q("bespin:util/util");q("rangeutils:utils/range");q("bespin:console");n.EditorSearchController=function(l){this.editor=l};n.EditorSearchController.prototype={editor:null,_escapeString:/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g,_findMatchesInString:function(l){var e=[],d=this.searchRegExp,b;for(d.lastIndex=0;;){b=d.exec(l);if(b===null)break;e.push(b);d.lastIndex=b.index+b[0].length}return e},_makeRange:function(l,e){return{start:{row:e,
col:l.index},end:{row:e,col:l.index+l[0].length}}},isRegExp:null,searchRegExp:null,searchText:null,setSearchText:function(l,e){this.searchRegExp=e?new RegExp(l):new RegExp(l.replace(this._escapeString,"\\$1"),"gi");this.isRegExp=e;this.searchText=l},findNext:function(l,e){var d=this.searchRegExp;if(m.none(d))return null;l=l||this.editor.textView.getSelectedRange().end;var b=this.editor.layoutManager.textStorage.lines,a;d.lastIndex=l.col;var h;for(h=l.row;h<b.length;h++){a=d.exec(b[h]);if(!m.none(a))return this._makeRange(a,
h)}if(!e)return null;for(h=0;h<=l.row;h++){a=d.exec(b[h]);if(!m.none(a))return this._makeRange(a,h)}return null},findPrevious:function(l,e){if(m.none(this.searchRegExp))return null;l=l||this.editor.textView.getSelectedRange().start;var d=this.editor.buffer.layoutManager.textStorage.lines,b;b=this._findMatchesInString(d[l.row].substring(0,l.col));if(b.length!==0)return this._makeRange(b[b.length-1],l.row);var a;for(a=l.row-1;a!==-1;a--){b=this._findMatchesInString(d[a]);if(b.length!==0)return this._makeRange(b[b.length-
1],a)}if(!e)return null;for(a=d.length-1;a>=l.row;a--){b=this._findMatchesInString(d[a]);if(b.length!==0)return this._makeRange(b[b.length-1],a)}return null}}});
bespin.tiki.module("text_editor:controllers/undo",function(q,n){var m=q("bespin:console").console,l=q("environment").env;n.EditorUndoController=function(e){this.editor=e;e=this.textView=e.textView;e.beganChangeGroup.add(function(d,b){this._beginTransaction();this._record.selectionBefore=b}.bind(this));e.endedChangeGroup.add(function(d,b){this._record.selectionAfter=b;this._endTransaction()}.bind(this));e.replacedCharacters.add(function(d,b,a){if(!this._inTransaction)throw new Error("UndoController.textViewReplacedCharacters() called outside a transaction");
this._record.patches.push({oldCharacters:this._deletedCharacters,oldRange:b,newCharacters:a,newRange:this.editor.layoutManager.textStorage.resultingRangeForReplacement(b,a.split("\n"))});this._deletedCharacters=null}.bind(this));e.willReplaceRange.add(function(d,b){if(!this._inTransaction)throw new Error("UndoController.textViewWillReplaceRange() called outside a transaction");this._deletedCharacters=this.editor.layoutManager.textStorage.getCharacters(b)}.bind(this))};n.EditorUndoController.prototype=
{_inTransaction:false,_record:null,textView:null,_beginTransaction:function(){if(this._inTransaction){m.trace();throw new Error("UndoController._beginTransaction() called with a transaction already in place");}this._inTransaction=true;this._record={patches:[]}},_endTransaction:function(){if(!this._inTransaction)throw new Error("UndoController._endTransaction() called without a transaction in place");this.editor.buffer.undoManager.registerUndo(this,this._record);this._record=null;this._inTransaction=
false},_tryApplyingPatches:function(e){var d=this.editor.layoutManager.textStorage;e.forEach(function(b){d.replaceCharacters(b.oldRange,b.newCharacters)});return true},_undoOrRedo:function(e,d){if(this._inTransaction)throw new Error("UndoController._undoOrRedo() called while in a transaction");if(!this._tryApplyingPatches(e))return false;this.textView.setSelection(d,true);return true},redo:function(e){var d=e.patches.concat();d.reverse();return this._undoOrRedo(d,e.selectionAfter)},undo:function(e){return this._undoOrRedo(e.patches.map(function(d){return{oldCharacters:d.newCharacters,
oldRange:d.newRange,newCharacters:d.oldCharacters,newRange:d.oldRange}}),e.selectionBefore)}};n.undoManagerCommand=function(e,d){l.editor.buffer.undoManager[d.commandExt.name]()}});
bespin.tiki.module("text_editor:models/buffer",function(q,n){var m=q("environment").env,l=q("bespin:util/util"),e=q("bespin:promise").Promise,d=q("models/textstorage").TextStorage,b=q("controllers/layoutmanager").LayoutManager,a=q("undomanager").UndoManager;n.Buffer=function(h,g){this._file=h;this._model=new d(g);this._layoutManager=new b({textStorage:this._model});this.undoManager=new a;if(h)this.reload().then(function(){this._updateSyntaxManagerInitialContext()}.bind(this));else{this.loadPromise=
new e;this.loadPromise.resolve()}g=m.session?m.session.history:null;var f,i,j;if(g&&h&&(f=g.getHistoryForPath(h.path))){i=f.selection;j=f.scroll}this._selectedRange=i||{start:{row:0,col:0},end:{row:0,col:0}};this._scrollOffset=j||{x:0,y:0}};n.Buffer.prototype={undoManager:null,loadPromise:null,_scrollOffset:null,_selectedRange:null,_selectedRangeEndVirtual:null,_layoutManager:null,_file:null,_model:null,save:function(){return this._file.saveContents(this._model.value)},saveAs:function(h){var g=new e;
h.saveContents(this._model.value).then(function(){this._file=h;this._updateSyntaxManagerInitialContext();g.resolve()}.bind(this),function(f){g.reject(f)});return g},reload:function(){var h=this,g;return this.loadPromise=g=this._file.loadContents().then(function(f){h._model.value=f})},_updateSyntaxManagerInitialContext:function(){var h=this._file.extension();this._layoutManager.syntaxManager.setSyntaxFromFileExt(h===null?"":h)},untitled:function(){return l.none(this._file)}};Object.defineProperties(n.Buffer.prototype,
{layoutManager:{get:function(){return this._layoutManager}},syntaxManager:{get:function(){}},file:{get:function(){return this._file}},model:{get:function(){return this._model}}})});
bespin.tiki.module("text_editor:models/textstorage",function(q,n){var m=q("events").Event,l=q("bespin:util/util");q=function(e){this._lines=e!==null&&e!==undefined?e.split("\n"):[""];this.changed=new m;return this};q.prototype={_lines:null,readOnly:false,clampPosition:function(e){var d=this._lines,b=e.row;if(b<0)return{row:0,col:0};else if(b>=d.length)return this.range.end;e=Math.max(0,Math.min(e.col,d[b].length));return{row:b,col:e}},clampRange:function(e){var d=this.clampPosition(e.start);e=this.clampPosition(e.end);
return{start:d,end:e}},deleteCharacters:function(e){this.replaceCharacters(e,"")},displacePosition:function(e,d){var b=d>0,a=this._lines,h=a.length;for(d=Math.abs(d);d!==0;d--)if(b){var g=a[e.row].length;if(e.row===h-1&&e.col===g)return e;e=e.col===g?{row:e.row+1,col:0}:{row:e.row,col:e.col+1}}else{if(e.row===0&&e.col==0)return e;if(e.col===0){a=this._lines;e={row:e.row-1,col:a[e.row-1].length}}else e={row:e.row,col:e.col-1}}return e},getCharacters:function(e){var d=this._lines,b=e.start,a=e.end,
h=b.row;e=a.row;var g=b.col;b=a.col;if(h===e)return d[h].substring(g,b);a=d[h].substring(g);h=d.slice(h+1,e);d=d[e].substring(0,b);return[a].concat(h,d).join("\n")},getLines:function(){return this._lines},getRange:function(){var e=this._lines,d=e.length-1;return{start:{row:0,col:0},end:{row:d,col:e[d].length}}},getValue:function(){return this._lines.join("\n")},insertCharacters:function(e,d){this.replaceCharacters({start:e,end:e},d)},replaceCharacters:function(e,d){if(this.readOnly)throw new Error("Attempt to modify a read-only text storage object");
var b=d.split("\n"),a=b.length,h=this.resultingRangeForReplacement(e,b),g=e.start,f=e.end,i=g.row,j=f.row,k=this._lines;b[0]=k[i].substring(0,g.col)+b[0];b[a-1]+=k[j].substring(f.col);this._lines=l.replace(k,i,j-i+1,b);this.changed(e,h,d)},resultingRangeForReplacement:function(e,d){var b=d.length;e=e.start;return{start:e,end:{row:e.row+b-1,col:(b===1?e.col:0)+d[b-1].length}}},setLines:function(e){this.setValue(e.join("\n"))},setValue:function(e){this.replaceCharacters(this.range,e)}};n.TextStorage=
q;Object.defineProperties(n.TextStorage.prototype,{lines:{get:function(){return this.getLines()},set:function(e){return this.setLines(e)}},range:{get:function(){return this.getRange()}},value:{get:function(){return this.getValue()},set:function(e){this.setValue(e)}}})});
bespin.tiki.module("text_editor:utils/rect",function(q,n){n._distanceFromBounds=function(m,l,e){if(m<l)return m-l;if(m>=e)return m-e;return 0};n.merge=function(m){var l;do{l=false;for(var e=[],d=0;d<m.length;d++){var b=m[d];e.push(b);for(var a=d+1;a<m.length;a++){var h=m[a];if(n.rectsSideBySide(b,h)||n.rectsIntersect(b,h)){m.splice(a,1);e[e.length-1]=n.unionRects(b,h);l=true;break}}}m=e}while(l);return m};n.offsetFromRect=function(m,l){return{x:n._distanceFromBounds(l.x,m.x,n.maxX(m)),y:n._distanceFromBounds(l.y,
m.y,n.maxY(m))}};n.rectsIntersect=function(m,l){m=n.intersectRects(m,l);return m.width!==0&&m.height!==0};n.rectsSideBySide=function(m,l){if(m.x==l.x&&m.width==l.width)return m.y<l.y?m.y+m.height==l.y:l.y+l.height==m.y;else if(m.y==l.y&&m.height==l.height)return m.x<l.x?m.x+m.width==l.x:l.x+l.width==m.x;return false};n.intersectRects=function(m,l){m={x:Math.max(n.minX(m),n.minX(l)),y:Math.max(n.minY(m),n.minY(l)),width:Math.min(n.maxX(m),n.maxX(l)),height:Math.min(n.maxY(m),n.maxY(l))};m.width=Math.max(0,
m.width-m.x);m.height=Math.max(0,m.height-m.y);return m};n.minX=function(m){return m.x||0};n.maxX=function(m){return(m.x||0)+(m.width||0)};n.minY=function(m){return m.y||0};n.maxY=function(m){return(m.y||0)+(m.height||0)};n.pointInRect=function(m,l){return m.x>=n.minX(l)&&m.y>=n.minY(l)&&m.x<=n.maxX(l)&&m.y<=n.maxY(l)};n.unionRects=function(m,l){m={x:Math.min(n.minX(m),n.minX(l)),y:Math.min(n.minY(m),n.minY(l)),width:Math.max(n.maxX(m),n.maxX(l)),height:Math.max(n.maxY(m),n.maxY(l))};m.width=Math.max(0,
m.width-m.x);m.height=Math.max(0,m.height-m.y);return m};n.rectsEqual=function(m,l,e){if(!m||!l)return m==l;if(!e&&e!==0)e=0.1;if(m.y!=l.y&&Math.abs(m.y-l.y)>e)return false;if(m.x!=l.x&&Math.abs(m.x-l.x)>e)return false;if(m.width!=l.width&&Math.abs(m.width-l.width)>e)return false;if(m.height!=l.height&&Math.abs(m.height-l.height)>e)return false;return true}});
bespin.tiki.module("text_editor:views/canvas",function(q,n){var m=q("bespin:util/util"),l=q("utils/rect"),e=q("events").Event;n.CanvasView=function(d,b,a){if(d){this._preventDownsize=b||false;this._clearOnFullInvalid=a||false;this._clippingFrame=this._frame={x:0,y:0,width:0,height:0};this._invalidRects=[];b=document.createElement("canvas");b.setAttribute("style","position: absolute");b.innerHTML="canvas tag not supported by your browser";d.appendChild(b);this.domNode=b;this.clippingChanged=new e;
this.clippingChanged.add(this.clippingFrameChanged.bind(this))}};n.CanvasView.prototype={domNode:null,clippingChanged:null,_canvasContext:null,_canvasId:null,_invalidRects:null,_lastRedrawTime:null,_redrawTimer:null,_clippingFrame:null,_preventDownsize:false,_clearOnFullInvalid:false,_frame:null,_getContext:function(){if(this._canvasContext===null)this._canvasContext=this.domNode.getContext("2d");return this._canvasContext},computeWithClippingFrame:function(d,b){var a=this.clippingFrame;return{x:d+
a.x,y:b+a.y}},minimumRedrawDelay:1E3/30,clippingFrameChanged:function(){this.invalidate()},drawRect:function(){},render:function(){if(!(this._renderTimer||this._redrawTimer))this._renderTimer=setTimeout(this._tryRedraw.bind(this),0)},invalidate:function(){this._invalidRects="all";this.render()},invalidateRect:function(d){var b=this._invalidRects;if(b!=="all"){b.push(d);this.render()}},_tryRedraw:function(){this._renderTimer=null;var d=(new Date).getTime(),b=this._lastRedrawTime,a=this.minimumRedrawDelay;
if(b===null||d-b>=a)this._redraw();else if(this._redrawTimer===null)this._redrawTimer=window.setTimeout(this._redraw.bind(this),a)},_redraw:function(){var d=this.clippingFrame;d={x:Math.round(d.x),y:Math.round(d.y),width:d.width,height:d.height};var b=this._getContext();b.save();b.translate(-d.x,-d.y);var a=this._invalidRects;if(a==="all"){this._clearOnFullInvalid&&b.clearRect(0,0,this.domNode.width,this.domNode.height);this.drawRect(d,b)}else l.merge(a).forEach(function(h){h=l.intersectRects(h,d);
if(h.width!==0&&h.height!==0){b.save();var g=h.x,f=h.y,i=h.width,j=h.height;b.beginPath();b.moveTo(g,f);b.lineTo(g+i,f);b.lineTo(g+i,f+j);b.lineTo(g,f+j);b.closePath();b.clip();this.drawRect(h,b);b.restore()}},this);b.restore();this._invalidRects=[];this._redrawTimer=null;this._lastRedrawTime=(new Date).getTime()}};Object.defineProperties(n.CanvasView.prototype,{clippingFrame:{get:function(){return this._clippingFrame},set:function(d){d=m.mixin(m.clone(this._clippingFrame),d);if(this._clippingFrame===
null||!l.rectsEqual(d,this._clippingFrame)){this._clippingFrame=d;this.clippingChanged()}}},frame:{get:function(){return this._frame},set:function(d){var b=this.domNode,a=b.style,h=this._preventDownsize,g=b.width,f=b.height;a=b.style;a.left=d.x+"px";a.top=d.y+"px";var i,j;if(d.width!==g)if(d.width<g)h||(i=true);else i=true;if(d.height!==f)if(d.height<f)h||(j=true);else j=true;if(i)this.domNode.width=d.width;if(j)this.domNode.height=d.height;this._frame=d;this.clippingFrame={width:d.width,height:d.height}}}})});
bespin.tiki.module("text_editor:views/editor",function(q,n){function m(o){var s=p.plugins.text_editor.provides,v=s.length,x={};if(o){o=o.themestyles;if(o.currentThemeVariables&&o.currentThemeVariables.text_editor)x=o.currentThemeVariables.text_editor}for(;v--;)if(s[v].ep==="themevariable"){o=d.mixin(d.clone(s[v].defaultValue),x[s[v].name]);switch(s[v].name){case "gutter":case "editor":case "scroller":case "highlighter":w[s[v].name]=o}}}var l=q("rangeutils:utils/range"),e=q("views/scroller"),d=q("bespin:util/util"),
b=q("models/buffer").Buffer,a=q("completion:controller").CompletionController,h=q("controllers/search").EditorSearchController,g=q("controllers/undo").EditorUndoController,f=q("events").Event,i=q("views/gutter").GutterView;q("controllers/layoutmanager");var j=e.ScrollerCanvasView,k=q("views/text").TextView,r=q("underscore")._,p=q("bespin:plugins").catalog,u=q("keyboard:keyboard").keyboardManager,t=q("settings").settings,w={};m();p.registerExtension("themeChange",{pointer:m});n.EditorView=function(o){this.elementAppended=
new f;var s=this.element=this.container=document.createElement("div");s.style.overflow="visible";s.style.position="relative";this.scrollOffsetChanged=new f;this.willChangeBuffer=new f;this.selectionChanged=new f;this.textChanged=new f;this.gutterView=new i(s,this);this.textView=new k(s,this);var v=new j(this,e.LAYOUT_VERTICAL),x=new j(this,e.LAYOUT_HORIZONTAL);this.verticalScroller=v;this.horizontalScroller=x;this.completionController=new a(this);this.editorUndoController=new g(this);this.searchController=
new h(this);this._textViewSize=this._oldSize={width:0,height:0};this._themeData=w;this.buffer=new b(null,o);this.elementAppended.add(function(){var y=t.get("fontsize"),E=t.get("fontface");this._font=y+"px "+E;p.registerExtension("themeChange",{pointer:this._themeVariableChange.bind(this)});p.registerExtension("settingChange",{match:"font[size|face]",pointer:this._fontSettingChanged.bind(this)});p.registerExtension("dimensionsChanged",{pointer:this.dimensionsChanged.bind(this)});this._dontRecomputeLayout=
false;this._recomputeLayout();s.addEventListener(d.isMozilla?"DOMMouseScroll":"mousewheel",this._onMouseWheel.bind(this),false);v.valueChanged.add(function(B){this.scrollOffset={y:B}}.bind(this));x.valueChanged.add(function(B){this.scrollOffset={x:B}}.bind(this));this.scrollOffsetChanged.add(function(B){this._updateScrollOffsetChanged(B)}.bind(this))}.bind(this))};n.EditorView.prototype={elementAppended:null,textChanged:null,selectionChanged:null,scrollOffsetChanged:null,willChangeBuffer:null,_textViewSize:null,
_textLinesCount:0,_gutterViewWidth:0,_oldSize:null,_buffer:null,_dontRecomputeLayout:true,_themeData:null,_layoutManagerSizeChanged:function(o){var s=this.layoutManager.fontDimension;this._textViewSize={width:o.width*s.characterWidth,height:o.height*s.lineHeight};if(this._textLinesCount!==o.height){this.gutterView.computeWidth()!==this._gutterViewWidth?this._recomputeLayout(true):this.gutterView.invalidate();this._textLinesLength=o.height}this._updateScrollers();this.scrollOffset={}},_updateScrollers:function(){if(!this._dontRecomputeLayout){var o=
this.textViewPaddingFrame,s=this._textViewSize.width,v=this._textViewSize.height,x=this.scrollOffset,y=this.verticalScroller,E=this.horizontalScroller;if(v<o.height)y.isVisible=false;else{y.isVisible=true;y.proportion=o.height/v;y.maximum=v-o.height;y.value=x.y}if(s<o.width)E.isVisible=false;else{E.isVisible=true;E.proportion=o.width/s;E.maximum=s-o.width;E.value=x.x}}},_onMouseWheel:function(o){var s=0;if(o.wheelDelta)s=-o.wheelDelta;else if(o.detail)s=o.detail*40;var v=true;if(o.axis){if(o.axis==
o.HORIZONTAL_AXIS)v=false}else if(o.wheelDeltaY||o.wheelDeltaX){if(o.wheelDeltaX==o.wheelDelta)v=false}else if(o.shiftKey)v=false;v?this.scrollBy(0,s):this.scrollBy(s*5,0);d.stopEvent(o)},scrollTo:function(o){this.scrollOffset=o},scrollBy:function(o,s){this.scrollOffset={x:this.scrollOffset.x+o,y:this.scrollOffset.y+s}},_recomputeLayout:function(o){if(!this._dontRecomputeLayout){var s=this.container.offsetWidth,v=this.container.offsetHeight;if(!(!o&&s==this._oldSize.width&&v==this._oldSize.height)){this._oldSize=
{width:s,height:v};this._gutterViewWidth=o=this.gutterView.computeWidth();this.gutterView.frame={x:0,y:0,width:o,height:v};this.textView.frame={x:o,y:0,width:s-o,height:v};var x=this._themeData.scroller.padding,y=this._themeData.scroller.thickness;this.horizontalScroller.frame={x:o+x,y:v-(y+x),width:s-(o+2*x+y),height:y};this.verticalScroller.frame={x:s-(x+y),y:x,width:y,height:v-(2*x+y)};this.scrollOffset={};this._updateScrollers();this.gutterView.invalidate();this.textView.invalidate();this.verticalScroller.invalidate();
this.horizontalScroller.invalidate()}}},dimensionsChanged:function(){this._recomputeLayout()},_font:null,_fontSettingChanged:function(){var o=t.get("fontsize"),s=t.get("fontface");this._font=o+"px "+s;this.layoutManager._recalculateMaximumWidth();this._layoutManagerSizeChanged(this.layoutManager.size);this.textView.invalidate()},_themeVariableChange:function(){this._recomputeLayout(true)},_updateScrollOffsetChanged:function(o){this.verticalScroller.value=o.y;this.horizontalScroller.value=o.x;this.textView.clippingFrame=
{x:o.x,y:o.y};this.gutterView.clippingFrame={y:o.y};this._updateScrollers();this.gutterView.invalidate();this.textView.invalidate()},processKeyEvent:function(o,s,v){v=r(v).clone();v.completing=this.completionController.isCompleting();return u.processKeyEvent(o,s,v)},convertTextViewPoint:function(o){var s=this.scrollOffset;return{x:o.x-s.x+this._gutterViewWidth,y:o.y-s.y}},replace:function(o,s,v){if(!l.isRange(o))throw new Error('replace(): expected range but found "'+o+"'");if(!d.isString(s))throw new Error('replace(): expected text string but found "'+
text+'"');var x=l.normalizeRange(o),y=this.textView,E=y.getSelectedRange(false);return y.groupChanges(function(){y.replaceCharacters(x,s);if(v)y.setSelection(E);else{var B=s.split("\n");B=B.length>1?{row:o.start.row+B.length-1,col:B[B.length-1].length}:l.addPositions(o.start,{row:0,col:s.length});y.moveCursorTo(B)}})},getText:function(o){if(!l.isRange(o))throw new Error('getText(): expected range but found "'+o+'"');return this.layoutManager.textStorage.getCharacters(l.normalizeRange(o))},setLineNumber:function(o){if(!d.isNumber(o))throw new Error("setLineNumber(): lineNumber must be a number");
this.textView.moveCursorTo({row:o-1,col:0})},setCursor:function(o){if(!l.isPosition(o))throw new Error('setCursor(): expected position but found "'+o+'"');this.textView.moveCursorTo(o)},changeGroup:function(o){return this.textView.groupChanges(function(){o(this)}.bind(this))},addTags:function(o){this.completionController.tags.add(o)}};Object.defineProperties(n.EditorView.prototype,{themeData:{get:function(){return this._themeData},set:function(){throw new Error("themeData can't be changed directly. Use themeManager.");
}},font:{get:function(){return this._font},set:function(){throw new Error("font can't be changed directly. Use settings fontsize and fontface.");}},buffer:{set:function(o){if(o!==this._buffer){if(!o.loadPromise.isResolved())throw new Error("buffer.set(): the new buffer must first be loaded!");if(this._buffer!==null){this.layoutManager.sizeChanged.remove(this);this.layoutManager.textStorage.changed.remove(this);this.textView.selectionChanged.remove(this)}this.willChangeBuffer(o);p.publish(this,"editorChange",
"buffer",o);this.layoutManager=o.layoutManager;this._buffer=o;var s=this.layoutManager,v=this.textView;s.sizeChanged.add(this,this._layoutManagerSizeChanged.bind(this));s.textStorage.changed.add(this,this.textChanged.bind(this));v.selectionChanged.add(this,this.selectionChanged.bind(this));this.textView.setSelection(o._selectedRange,false);this.scrollOffsetChanged(o._scrollOffset);this.layoutManager.sizeChanged(this.layoutManager.size);this._recomputeLayout()}},get:function(){return this._buffer}},
frame:{get:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},textViewPaddingFrame:{get:function(){var o=d.clone(this.textView.frame),s=this.textView.padding;o.width-=s.left+s.right;o.height-=s.top+s.bottom;return o}},scrollOffset:{set:function(o){if(o.x===undefined)o.x=this.scrollOffset.x;if(o.y===undefined)o.y=this.scrollOffset.y;var s=this.textViewPaddingFrame;if(o.y<0)o.y=0;else if(this._textViewSize.height<s.height)o.y=0;else if(o.y+s.height>this._textViewSize.height)o.y=
this._textViewSize.height-s.height;if(o.x<0)o.x=0;else if(this._textViewSize.width<s.width)o.x=0;else if(o.x+s.width>this._textViewSize.width)o.x=this._textViewSize.width-s.width;if(!(o.x===this.scrollOffset.x&&o.y===this.scrollOffset.y)){this.buffer._scrollOffset=o;this.scrollOffsetChanged(o);p.publish(this,"editorChange","scrollOffset",o)}},get:function(){return this.buffer._scrollOffset}},readOnly:{get:function(){return this._buffer.model.readOnly},set:function(o){this._buffer.model.readOnly=o}},
focus:{get:function(){return this.textView.hasFocus},set:function(o){if(!d.isBoolean(o))throw new Error('set focus: expected boolean but found "'+o+'"');this.textView.hasFocus=o}},selection:{get:function(){return d.clone(this.textView.getSelectedRange(false))},set:function(o){if(!l.isRange(o))throw new Error("set selection: position/selection must be supplied");this.textView.setSelection(o)}},selectedText:{get:function(){return this.getText(this.selection)},set:function(o){if(!d.isString(o))throw new Error('set selectedText: expected string but found "'+
o+'"');return this.replace(this.selection,o)}},value:{get:function(){return this.layoutManager.textStorage.value},set:function(o){if(!d.isString(o))throw new Error('set value: expected string but found "'+o+'"');return this.replace(this.layoutManager.textStorage.range,o,false)}},syntax:{get:function(){return this.layoutManager.syntaxManager.getSyntax()},set:function(o){if(!d.isString(o))throw new Error('set syntax: expected string but found "'+newValue+'"');return this.layoutManager.syntaxManager.setSyntax(o)}}})});
bespin.tiki.module("text_editor:views/gutter",function(q,n){var m=q("bespin:util/util"),l=q("views/canvas").CanvasView;n.GutterView=function(e,d){l.call(this,e,true);this.editor=d};n.GutterView.prototype=new l;m.mixin(n.GutterView.prototype,{drawRect:function(e,d){var b=this.editor.themeData.gutter;d.fillStyle=b.backgroundColor;d.fillRect(e.x,e.y,e.width,e.height);d.save();d.translate(b.paddingLeft,0);var a=this.editor.layoutManager,h=a.characterRangeForBoundingRect(e);e=Math.min(h.end.row,a.textLines.length-
1);var g=a.fontDimension.lineAscent;d.fillStyle=b.color;d.font=this.editor.font;for(b=h.start.row;b<=e;b++)d.fillText(""+(b+1),-0.5,a.lineRectForRow(b).y+g-0.5);d.restore()},computeWidth:function(){var e=this.editor.themeData.gutter,d=this.editor.layoutManager;return d.fontDimension.characterWidth*(""+d.textLines.length).length+(e.paddingLeft+e.paddingRight)}})});
bespin.tiki.module("text_editor:views/scroller",function(q,n){var m=q("bespin:util/util"),l=q("events").Event,e=q("bespin:console").console,d=q("utils/rect"),b=q("views/canvas").CanvasView,a=n.LAYOUT_HORIZONTAL=0,h=n.LAYOUT_VERTICAL=1;n.ScrollerCanvasView=function(g,f){b.call(this,g.container,false,true);this.editor=g;this.layoutDirection=f;g=function(i,j,k){k=k||this.domNode;k.addEventListener(i,function(r){j.call(this,r);m.stopEvent(r)}.bind(this),false)}.bind(this);g("mouseover",this.mouseEntered);
g("mouseout",this.mouseExited);g("mousedown",this.mouseDown);g("mouseup",this.mouseUp,window);g("mousemove",this.mouseMove,window);this.valueChanged=new l};n.ScrollerCanvasView.prototype=new b;m.mixin(n.ScrollerCanvasView.prototype,{lineHeight:20,proportion:0,layoutDirection:h,_isVisible:false,_maximum:0,_value:0,valueChanged:null,padding:{left:0,bottom:0,top:0,right:0},_mouseDownScreenPoint:null,_mouseDownValue:null,_isMouseOver:false,_scrollTimer:null,_mouseEventPosition:null,_mouseOverHandle:false,
_drawNib:function(g){var f=this.editor.themeData.scroller,i,j;i=f.nibStyle;j=f.nibArrowStyle;f=f.nibStrokeStyle;var k=Math.floor(7.5);g.fillStyle=i;g.beginPath();g.arc(0,0,Math.floor(7.5),0,Math.PI*2,true);g.closePath();g.fill();g.strokeStyle=f;g.stroke();g.fillStyle=j;g.beginPath();g.moveTo(0,-k+3);g.lineTo(-k+3,k-5);g.lineTo(k-3,k-5);g.closePath();g.fill()},_drawNibs:function(g,f){var i=this._getClientThickness(),j=this._value,k=this._maximum,r=this._isHighlighted();if(r||j!==0){g.save();g.translate(8,
i/2);g.rotate(Math.PI*1.5);g.moveTo(0,0);this._drawNib(g,f);g.restore()}if(r||j!==k){g.save();g.translate(this._getClientLength()-8,i/2);g.rotate(Math.PI*0.5);g.moveTo(0,0);this._drawNib(g,f);g.restore()}},_getClientFrame:function(){var g=this.frame,f=this.padding;return{x:f.left,y:f.top,width:g.width-(f.left+f.right),height:g.height-(f.top+f.bottom)}},_getClientLength:function(){var g=this._getClientFrame();switch(this.layoutDirection){case a:return g.width;case h:return g.height;default:e.error("unknown layout direction");
return null}},_getClientThickness:function(){var g=this.padding,f=this.editor.themeData.scroller.thickness;switch(this.layoutDirection){case h:return f-(g.left+g.right);case a:return f-(g.top+g.bottom);default:e.error("unknown layout direction");return null}},_getFrameLength:function(){switch(this.layoutDirection){case a:return this.frame.width;case h:return this.frame.height;default:e.error("unknown layout direction");return null}},_getGutterFrame:function(){var g=this._getClientFrame(),f=this._getClientThickness();
switch(this.layoutDirection){case h:return{x:g.x,y:g.y+15,width:f,height:Math.max(0,g.height-30)};case a:return{x:g.x+15,y:g.y,width:Math.max(0,g.width-30),height:f};default:e.error("unknown layout direction");return null}},_getGutterLength:function(){var g=this._getGutterFrame(),f;switch(this.layoutDirection){case a:f=g.width;break;case h:f=g.height;break;default:e.error("unknown layout direction");break}return f},_getHandleFrame:function(){var g=this._getGutterFrame(),f=this._getHandleOffset(),
i=this._getHandleLength();switch(this.layoutDirection){case h:return{x:g.x,y:g.y+f,width:g.width,height:i};case a:return{x:g.x+f,y:g.y,width:i,height:g.height}}},_getHandleLength:function(){var g=this._getGutterLength();return Math.max(g*this.proportion,20)},_getHandleOffset:function(){var g=this._maximum;if(g===0)return 0;var f=this._getGutterLength(),i=this._getHandleLength();return(f-i)*this._value/g},_isHighlighted:function(){return this._isMouseOver===true||this._mouseDownScreenPoint!==null},
_segmentForMouseEvent:function(g){g={x:g.layerX,y:g.layerY};var f=this._getClientFrame(),i=this.padding;if(!d.pointInRect(g,f))return null;var j=this.layoutDirection;switch(j){case a:if(g.x-i.left<15)return"nib-start";else if(g.x>=f.width-15)return"nib-end";break;case h:if(g.y-i.top<15)return"nib-start";else if(g.y>=f.height-15)return"nib-end";break;default:e.error("unknown layout direction");break}i=this._getHandleFrame();if(d.pointInRect(g,i))return"handle";switch(j){case a:if(g.x<i.x)return"gutter-before";
else if(g.x>=i.x+i.width)return"gutter-after";break;case h:if(g.y<i.y)return"gutter-before";else if(g.y>=i.y+i.height)return"gutter-after";break;default:e.error("unknown layout direction");break}e.error("_segmentForMouseEvent: point ",g," outside view with handle frame ",i," and client frame ",f);return null},adjustFrame:function(){var g=this.frame;this.set("layout",{left:0,top:0,width:g.width,height:g.height})},drawRect:function(g,f){if(this._isVisible){var i=this._isHighlighted();g=this.editor.themeData.scroller;
var j=i?g.fullAlpha:g.particalAlpha,k=this.frame;f.clearRect(0,0,k.width,k.height);f.save();k=this.padding;f.translate(k.left,k.top);this._getHandleFrame();k=this._getGutterLength();var r=this._getClientThickness(),p=r/2,u=this.layoutDirection,t=this._getHandleOffset()+15,w=this._getHandleLength();if(u===h){f.translate(r+1,0);f.rotate(Math.PI*0.5)}if(!(k<=w)){f.globalAlpha=j;if(i){i=this._getClientLength();f.fillStyle=g.trackFillStyle;f.fillRect(8.5,0.5,i-16,r-1);f.strokeStyle=g.trackStrokeStyle;
f.strokeRect(8.5,0.5,i-16,r-1)}i=function(){f.beginPath();f.arc(t+p+0.5,p,p-0.5,Math.PI/2,3*Math.PI/2,false);f.arc(t+w-p-0.5,p,p-0.5,3*Math.PI/2,Math.PI/2,false);f.lineTo(t+p+0.5,r-0.5);f.closePath()};i();k=f.createLinearGradient(t,0,t,r);k.addColorStop(0,g.barFillGradientTopStart);k.addColorStop(0.4,g.barFillGradientTopStop);k.addColorStop(0.41,g.barFillStyle);k.addColorStop(0.8,g.barFillGradientBottomStart);k.addColorStop(1,g.barFillGradientBottomStop);f.fillStyle=k;f.fill();f.save();f.clip();f.fillStyle=
g.barFillStyle;f.beginPath();f.moveTo(t+p*0.4,p*0.6);f.lineTo(t+p*0.9,r*0.4);f.lineTo(t,r*0.4);f.closePath();f.fill();f.beginPath();f.moveTo(t+w-p*0.4,0+p*0.6);f.lineTo(t+w-p*0.9,0+r*0.4);f.lineTo(t+w,0+r*0.4);f.closePath();f.fill();f.restore();f.save();i();f.strokeStyle=g.trackStrokeStyle;f.stroke();f.restore();this._drawNibs(f,j);f.restore()}}},_repeatAction:function(g,f){if(g()!==false){var i=function(){this._repeatAction(g,100)}.bind(this);this._scrollTimer=setTimeout(i,f)}},_scrollByDelta:function(g){this.value=
this._value+g},_scrollUpOneLine:function(){this._scrollByDelta(-this.lineHeight);return true},_scrollDownOneLine:function(){this._scrollByDelta(this.lineHeight);return true},_scrollPage:function(){switch(this._segmentForMouseEvent(this._mouseEventPosition)){case "gutter-before":this._scrollByDelta(this._getGutterLength()*-1);break;case "gutter-after":this._scrollByDelta(this._getGutterLength());break;case null:break;default:return false}return true},mouseDown:function(g){this._mouseEventPosition=
g;this._mouseOverHandle=false;this._getGutterLength();switch(this._segmentForMouseEvent(g)){case "nib-start":this._repeatAction(this._scrollUpOneLine.bind(this),500);break;case "nib-end":this._repeatAction(this._scrollDownOneLine.bind(this),500);break;case "gutter-before":this._repeatAction(this._scrollPage.bind(this),500);break;case "gutter-after":this._repeatAction(this._scrollPage.bind(this),500);break;case "handle":break;default:e.error("_segmentForMouseEvent returned an unknown value");break}switch(this.layoutDirection){case a:this._mouseDownScreenPoint=
g.pageX;break;case h:this._mouseDownScreenPoint=g.pageY;break;default:e.error("unknown layout direction");break}},mouseMove:function(g){if(this._mouseDownScreenPoint!==null){if(this._segmentForMouseEvent(g)=="handle"||this._mouseOverHandle===true){this._mouseOverHandle=true;if(this._scrollTimer!==null){clearTimeout(this._scrollTimer);this._scrollTimer=null}var f;switch(this.layoutDirection){case a:f=g.pageX;break;case h:f=g.pageY;break;default:e.error("unknown layout direction");break}var i=f-this._mouseDownScreenPoint,
j=this._maximum,k=this._value,r=this._getGutterLength(),p=this._getHandleLength();this.value=k+j*i/(r-p);this._mouseDownScreenPoint=f}this._mouseEventPosition=g}},mouseEntered:function(){this._isMouseOver=true;this.invalidate()},mouseExited:function(){this._isMouseOver=false;this.invalidate()},mouseUp:function(){this._mouseDownValue=this._mouseDownScreenPoint=null;if(this._scrollTimer){clearTimeout(this._scrollTimer);this._scrollTimer=null}this.invalidate()}});Object.defineProperties(n.ScrollerCanvasView.prototype,
{isVisible:{set:function(g){if(this._isVisible!==g){this._isVisible=g;this.domNode.style.display=g?"block":"none";g&&this.invalidate()}}},maximum:{set:function(g){if(this._value>this._maximum)this._value=this._maximum;if(g!==this._maximum){this._maximum=g;this.invalidate()}}},value:{set:function(g){if(g<0)g=0;else if(g>this._maximum)g=this._maximum;if(g!==this._value){this._value=g;this.valueChanged(g);this.invalidate()}}}})});
bespin.tiki.module("text_editor:views/text",function(q,n){var m=q("bespin:plugins").catalog,l=q("bespin:util/util"),e=q("events").Event,d=q("views/canvas").CanvasView;q("controllers/layoutmanager");var b=q("rangeutils:utils/range"),a=q("utils/rect"),h=q("views/textinput").TextInput,g=q("bespin:console").console,f=q("settings").settings;n.TextView=function(i,j){d.call(this,i,true);this.editor=j;this.textInput=new h(i,this);this.padding={top:0,bottom:30,left:0,right:30};this.clippingChanged.add(this.clippingFrameChanged.bind(this));
i=this.domNode;i.style.cursor="text";i.addEventListener("mousedown",this.mouseDown.bind(this),false);i.addEventListener("mousemove",this.mouseMove.bind(this),false);window.addEventListener("mouseup",this.mouseUp.bind(this),false);j.willChangeBuffer.add(this.editorWillChangeBuffer.bind(this));this.selectionChanged=new e;this.beganChangeGroup=new e;this.endedChangeGroup=new e;this.willReplaceRange=new e;this.replacedCharacters=new e};n.TextView.prototype=new d;l.mixin(n.TextView.prototype,{_dragPoint:null,
_dragTimer:null,_enclosingScrollView:null,_inChangeGroup:false,_insertionPointBlinkTimer:null,_insertionPointVisible:true,_keyBuffer:"",_keyMetaBuffer:"",_keyState:"start",_hasFocus:false,_mouseIsDown:false,selectionChanged:null,beganChangeGroup:null,endedChangeGroup:null,willReplaceRange:null,replacedCharacters:null,editorWillChangeBuffer:function(i){if(this.editor.layoutManager){var j=this.editor.layoutManager;j.invalidatedRects.remove(this);j.changedTextAtRow.remove(this)}j=i.layoutManager;j.invalidatedRects.add(this,
this.layoutManagerInvalidatedRects.bind(this));j.changedTextAtRow.add(this,this.layoutManagerChangedTextAtRow.bind(this))},didFocus:function(){this._setFocus(true,true)},didBlur:function(){this._setFocus(false,true)},_drag:function(){var i=this._dragPoint,j=a.offsetFromRect(this.clippingFrame,i);this.moveCursorTo(this._selectionPositionForPoint({x:i.x-j.x,y:i.y-j.y}),true)},_drawInsertionPoint:function(i,j){if(this._insertionPointVisible){var k=this.editor.layoutManager.characterRectForPosition(this.editor.buffer._selectedRange.start);
i=Math.floor(k.x);var r=k.y,p=Math.ceil(k.width);k=k.height;j.save();var u=this.editor.themeData.editor;if(this._hasFocus){j.strokeStyle=u.cursorColor;j.beginPath();j.moveTo(i+0.5,r);j.lineTo(i+0.5,r+k);j.closePath();j.stroke()}else{j.fillStyle=u.unfocusedCursorBackgroundColor;j.fillRect(i+0.5,r,p-0.5,k);j.strokeStyle=u.unfocusedCursorColor;j.strokeRect(i+0.5,r+0.5,p-1,k-1)}j.restore()}},_drawLines:function(i,j){var k=this.editor.layoutManager,r=k.textLines,p=k.fontDimension.lineAscent,u=this.editor.themeData.highlighter;
j.save();j.font=this.editor.font;var t=k.characterRangeForBoundingRect(i),w=t.start;t=t.end;for(var o=t.row,s=w.row;s<=o;s++){var v=r[s];if(!l.none(v)){var x=v.characters,y=x.length,E=Math.min(t.col,y),B=w.col;if(!(B>=y)){v=v.colors;if(v==null)v=[];for(y=0;y<v.length&&B<v[y].start;)y++;for(var G=y<v.length?v[y].start:B;G<E;){i=v[y];B=i!=null?i.end:E;i=i!=null?i.tag:"plain";i=u.hasOwnProperty(i)?u[i]:"red";j.fillStyle=i;i=k.characterRectForPosition({row:s,col:G});G=x.substring(G,B);j.fillText(G,i.x,
i.y+p);G=B;y++}}}}j.restore()},_drawSelectionHighlight:function(i,j){i=this.editor.themeData.editor;i=this._hasFocus?i.selectedTextBackgroundColor:i.unfocusedCursorBackgroundColor;var k=this.editor.layoutManager;j.save();var r=b.normalizeRange(this.editor.buffer._selectedRange);j.fillStyle=i;k.rectsForRange(r).forEach(function(p){j.fillRect(p.x,p.y,p.width,p.height)});j.restore()},_drawSelection:function(i,j){this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?this._drawInsertionPoint(i,
j):this._drawSelectionHighlight(i,j)},_getVirtualSelection:function(i){var j=this.editor.buffer._selectedRange,k=this.editor.buffer._selectedRangeEndVirtual;return{start:i&&k?k:j.start,end:k||j.end}},_invalidateSelection:function(){var i=function(r){return{x:r.x-1,y:r.y,width:r.width+2,height:r.height}},j=this.editor.layoutManager,k=b.normalizeRange(this.editor.buffer._selectedRange);if(this._rangeIsInsertionPoint(k)){j=j.characterRectForPosition(k.start);this.invalidateRect(i(j))}else j.rectsForRange(k).forEach(function(r){this.invalidateRect(i(r))},
this)},_isReadOnly:function(){return this.editor.layoutManager.textStorage.readOnly},_keymappingChanged:function(){this._keyBuffer="";this._keyState="start"},_performVerticalKeyboardSelection:function(i){var j=this.editor.buffer._selectedRangeEndVirtual;this.moveCursorTo(b.addPositions(j!==null?j:this.editor.buffer._selectedRange.end,{row:i,col:0}),true,true)},_rangeIsInsertionPoint:function(i){return b.isZeroLength(i)},_rearmInsertionPointBlinkTimer:function(){this._insertionPointVisible||this.blinkInsertionPoint();
this._insertionPointBlinkTimer!==null&&clearInterval(this._insertionPointBlinkTimer);this._insertionPointBlinkTimer=setInterval(this.blinkInsertionPoint.bind(this),750)},_repositionSelection:function(){var i=this.editor.layoutManager.textLines,j=i.length,k=this.editor.buffer._selectedRange,r=Math.min(k.start.row,j-1);j=Math.min(k.end.row,j-1);var p=i[j];this.setSelection({start:{row:r,col:Math.min(k.start.col,i[r].characters.length)},end:{row:j,col:Math.min(k.end.col,p.characters.length)}})},_scrollPage:function(i){this.editor.scrollBy(0,
(this.clippingFrame.height+this.editor.layoutManager.fontDimension.lineAscent)*(i?-1:1))},_scrollWhileDragging:function(){var i=this._dragPoint;i=this.computeWithClippingFrame(i.layerX,i.layerY);l.mixin(this._dragPoint,i);this._drag()},_selectionPositionForPoint:function(i){i=this.editor.layoutManager.characterAtPoint(i);return i.partialFraction<0.5?i:b.addPositions(i,{row:0,col:1})},_syntaxManagerUpdatedSyntaxForRows:function(i,j){if(i!==j){var k=this.editor.layoutManager;k.updateTextRows(i,j);k.rectsForRange({start:{row:i,
col:0},end:{row:j,col:0}}).forEach(this.invalidateRect,this)}},blinkInsertionPoint:function(){this._insertionPointVisible=!this._insertionPointVisible;this._invalidateSelection()},copy:function(){return this.getSelectedCharacters()},cut:function(){var i=this.getSelectedCharacters();i!=""&&this.performBackspaceOrDelete(false);return i},drawRect:function(i,j){j.fillStyle=this.editor.themeData.editor.backgroundColor;j.fillRect(i.x,i.y,i.width,i.height);this._drawSelection(i,j);this._drawLines(i,j)},
focus:function(){this.textInput.focus()},getInsertionPointPosition:function(){var i=this.editor;i=i.layoutManager.characterRectForPosition(i.buffer._selectedRange.start);return{x:i.x,y:i.y}},getSelectedCharacters:function(){return this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?"":this.editor.layoutManager.textStorage.getCharacters(b.normalizeRange(this.editor.buffer._selectedRange))},getSelectedRange:function(i){return i?this.editor.buffer._selectedRange:b.normalizeRange(this.editor.buffer._selectedRange)},
groupChanges:function(i){if(this._isReadOnly())return false;if(this._inChangeGroup){i();return true}this._inChangeGroup=true;this.beganChangeGroup(this,this.editor.buffer._selectedRange);try{i()}catch(j){g.error("Error in groupChanges(): "+j);this._inChangeGroup=false;this.endedChangeGroup(this,this.editor.buffer._selectedRange);return false}finally{this._inChangeGroup=false;this.endedChangeGroup(this,this.editor.buffer._selectedRange);return true}},insertText:function(i){if(this._isReadOnly())return false;
this.groupChanges(function(){var j=b.normalizeRange(this.editor.buffer._selectedRange);this.replaceCharacters(j,i);var k=i.split("\n");this.moveCursorTo(k.length>1?{row:j.start.row+k.length-1,col:k[k.length-1].length}:b.addPositions(j.start,{row:0,col:i.length}))}.bind(this));return true},isDelimiter:function(i){return"\"',;.!~@#$%^&*?[]<>():/\\-+ \t".indexOf(i)!==-1},keyDown:function(i){if(i.charCode===0||i._charCode===0)return this.editor.processKeyEvent(i,this,{isTextView:true});else if(i.keyCode===
9)i.preventDefault();else return false},layoutManagerChangedTextAtRow:function(){this._repositionSelection()},layoutManagerInvalidatedRects:function(i,j){j.forEach(this.invalidateRect,this)},mouseDown:function(i){l.stopEvent(i);this._mouseIsDown=this.hasFocus=true;var j=this.computeWithClippingFrame(i.layerX,i.layerY);l.mixin(j,{layerX:i.layerX,layerY:i.layerY});switch(i.detail){case 1:var k=this._selectionPositionForPoint(j);this.moveCursorTo(k,i.shiftKey);break;case 2:k=this._selectionPositionForPoint(j);
var r=this.editor.layoutManager.textStorage.lines[k.row];if(r.length===0)return true;k.col-=k.col==r.length?1:0;var p=!this.isDelimiter(r[k.col]),u=this,t=function(w,o){for(;w>-1&&w<r.length;w+=o)if(u.isDelimiter(r[w])===p)break;return w+(o==1?0:1)};i=t(k.col,-1);t=t(k.col,1);this.moveCursorTo({row:k.row,col:i});this.moveCursorTo({row:k.row,col:t},true);break;case 3:i=this.editor.layoutManager.textStorage.lines;k=this._selectionPositionForPoint(j);this.setSelection({start:{row:k.row,col:0},end:{row:k.row,
col:i[k.row].length}});break}this._dragPoint=j;this._dragTimer=setInterval(this._scrollWhileDragging.bind(this),100)},mouseMove:function(i){if(this._mouseIsDown){this._dragPoint=this.computeWithClippingFrame(i.layerX,i.layerY);l.mixin(this._dragPoint,{layerX:i.layerX,layerY:i.layerY});this._drag()}},mouseUp:function(){this._mouseIsDown=false;if(this._dragTimer!==null){clearInterval(this._dragTimer);this._dragTimer=null}},moveCursorTo:function(i,j,k){var r=this.editor.layoutManager.textStorage,p=r.clampPosition(i);
this.setSelection({start:j?this.editor.buffer._selectedRange.start:p,end:p});if(k){j=r.lines.length;k=i.row;r=i.col;this.editor.buffer._selectedRangeEndVirtual=k>0&&k<j?i:{row:k<1?0:j-1,col:r}}else this.editor.buffer._selectedRangeEndVirtual=null;this.scrollToPosition(this.editor.buffer._selectedRange.end)},moveDown:function(){var i=this._getVirtualSelection();i=b.normalizeRange(i);i=this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?i.end:{row:i.end.row,col:i.start.col};i=b.addPositions(i,
{row:1,col:0});this.moveCursorTo(i,false,true)},moveLeft:function(){var i=b.normalizeRange(this.editor.buffer._selectedRange);this._rangeIsInsertionPoint(i)?this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(i.start,-1)):this.moveCursorTo(i.start)},moveRight:function(){var i=b.normalizeRange(this.editor.buffer._selectedRange);this._rangeIsInsertionPoint(i)?this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(i.end,1)):this.moveCursorTo(i.end)},moveUp:function(){var i=
b.normalizeRange(this._getVirtualSelection(true));position=b.addPositions({row:i.start.row,col:this._getVirtualSelection().end.col},{row:-1,col:0});this.moveCursorTo(position,false,true)},parentViewFrameChanged:function(){arguments.callee.base.apply(this,arguments);this._resize()},replaceCharacters:function(i,j){if(this._isReadOnly())return false;this.groupChanges(function(){i=b.normalizeRange(i);this.willReplaceRange(this,i);this.editor.layoutManager.textStorage.replaceCharacters(i,j);this.replacedCharacters(this,
i,j)}.bind(this));return true},performBackspaceOrDelete:function(i){if(this._isReadOnly())return false;var j=this.editor.layoutManager.textStorage,k=j.lines,r="";r=0;var p=f.get("tabstop"),u=this.getSelectedRange();if(b.isZeroLength(u))if(i){i=u.start;r=k[i.row];r=r.substring(0,i.col).match(/\s*$/)[0].length<p||(i.col-p)%p!=0?1:p;u={start:j.displacePosition(i,r*-1),end:u.end}}else{i=u.end;r=k[i.row];r=r.substring(i.col).match(/^\s*/)[0].length<p?1:p;u={start:u.start,end:j.displacePosition(u.end,r)}}this.groupChanges(function(){this.replaceCharacters(u,
"");this.moveCursorTo(u.start)}.bind(this));return true},resetKeyBuffers:function(){this._keyMetaBuffer=this._keyBuffer=""},scrollPageDown:function(){this._scrollPage(false)},scrollPageUp:function(){this._scrollPage(true)},scrollToPosition:function(i){var j=this.editor.layoutManager.characterRectForPosition(i);i=j.x;var k=j.y,r=j.width;j=j.height;var p=this.clippingFrame,u=p.x,t=p.y,w=this.padding,o=p.width-w.right;p=p.height-w.bottom;this.editor.scrollTo({x:i>=u+30&&i+r<u+o?u:i-o/2+r/2,y:k>=t&&k+
j<t+p?t:k-p/2+j/2})},selectAll:function(){var i=this.editor.layoutManager.textStorage.lines,j=i.length-1;this.setSelection({start:{row:0,col:0},end:{row:j,col:i[j].length}})},selectDown:function(){this._performVerticalKeyboardSelection(1)},selectLeft:function(){this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(this.editor.buffer._selectedRange.end,-1),true)},selectRight:function(){this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(this.editor.buffer._selectedRange.end,
1),true)},selectUp:function(){this._performVerticalKeyboardSelection(-1)},setSelection:function(i,j){var k=this.editor.layoutManager.textStorage;i=k.clampRange(i);if(!b.equal(i,this.editor.buffer._selectedRange)){this._invalidateSelection();this.editor.buffer._selectedRange=i=k.clampRange(i);this._invalidateSelection();this._hasFocus&&this._rearmInsertionPointBlinkTimer();j&&this.scrollToPosition(i.end);this.selectionChanged(i);m.publish(this.editor,"editorChange","selection",i)}},textInserted:function(i){if(i!==
"\n")if(!this.editor.processKeyEvent(i,this,{isTextView:true,isCommandKey:false})){this.insertText(i);this.resetKeyBuffers()}},_setFocus:function(i,j){if(i!=this._hasFocus)if(this._hasFocus=i){this._rearmInsertionPointBlinkTimer();this._invalidateSelection();j||this.textInput.focus()}else{if(this._insertionPointBlinkTimer){clearInterval(this._insertionPointBlinkTimer);this._insertionPointBlinkTimer=null}this._insertionPointVisible=true;this._invalidateSelection();j||this.textInput.blur()}}});Object.defineProperties(n.TextView.prototype,
{hasFocus:{get:function(){return this._hasFocus},set:function(i){this._setFocus(i,false)}}})});
bespin.tiki.module("text_editor:views/textinput",function(q,n){var m=q("bespin:util/util");q("events");var l=q("keyboard:keyutil");n.TextInput=function(e,d){var b=this.domNode=document.createElement("textarea");b.setAttribute("style","position: absolute; z-index: -99999; width: 0px; height: 0px; margin: 0px; outline: none; border: 0;");e.appendChild(b);this.delegate=d;this._attachEvents()};n.TextInput.prototype={_composing:false,domNode:null,delegate:null,_textFieldChanged:function(){if(!(this._composing||
this._ignore)){var e=this.domNode,d=e.value;if(d!=""){e.value="";this._textInserted(d)}}},_copy:function(){var e=false,d=this.delegate;if(d&&d.copy)e=d.copy();return e},_cut:function(){var e=false,d=this.delegate;if(d&&d.cut)e=d.cut();return e},_textInserted:function(e){var d=this.delegate;d&&d.textInserted&&d.textInserted(e)},_setValueAndSelect:function(e){var d=this.domNode;d.value=e;d.select()},focus:function(){this.domNode.focus()},blur:function(){this.domNode.blur()},_attachEvents:function(){var e=
this.domNode,d=this;e.addEventListener("focus",function(){d.delegate&&d.delegate.didFocus&&d.delegate.didFocus()},false);e.addEventListener("blur",function(){d.delegate&&d.delegate.didBlur&&d.delegate.didBlur()},false);l.addKeyDownListener(e,function(f){return d.delegate&&d.delegate.keyDown?d.delegate.keyDown(f):false});if(m.isWebKit){m.isChrome||e.addEventListener("compositionend",function(f){d._textInserted(f.data)},false);e.addEventListener("textInput",function(f){d._textInserted(f.data)},false);
e.addEventListener("paste",function(f){d._textInserted(f.clipboardData.getData("text/plain"));f.preventDefault()},false)}else{var b=d._textFieldChanged.bind(d);e.addEventListener("keydown",function(){window.setTimeout(b,0)},false);e.addEventListener("keypress",b,false);e.addEventListener("keyup",b,false);e.addEventListener("compositionstart",function(){d._composing=true},false);e.addEventListener("compositionend",function(){d._composing=false;d._textFieldChanged()},false);e.addEventListener("paste",
function(){d._setValueAndSelect("");window.setTimeout(function(){d._textFieldChanged()},0)},false)}var a=function(f){f=f.type.indexOf("copy")!=-1?d._copy():d._cut();d._setValueAndSelect(f)};if(m.isWebKit&&!m.isChrome&&m.isMac){var h=(new Date).getTime(),g=function(f){var i=f.type.indexOf("cut")!=-1;if(!(i&&(new Date).getTime()-h<10)){a(f);if(i)h=(new Date).getTime()}};e.addEventListener("beforecopy",g,false);e.addEventListener("beforecut",g,false)}else{g=false;if(m.isMozilla)g=function(f){a(f);d._ignore=
true;window.setTimeout(function(){d._setValueAndSelect("");d._ignore=false},0)};e.addEventListener("copy",g||a,false);e.addEventListener("cut",g||a,false)}}}});bespin.tiki.module("text_editor:index",function(){});bespin.tiki.register("::less",{name:"less",dependencies:{}});
bespin.tiki.module("less:index",function(q,n){function m(b){if(b instanceof d.Dimension)return parseFloat(b.unit=="%"?b.value/100:b.value);else if(typeof b==="number")return b;else throw{error:"RuntimeError",message:"color functions take numbers as parameters"};}function l(b){return Math.min(1,Math.max(0,b))}if(!Array.isArray)Array.isArray=function(b){return Object.prototype.toString.call(b)==="[object Array]"||b instanceof Array};if(!Array.prototype.forEach)Array.prototype.forEach=function(b,a){for(var h=
this.length>>>0,g=0;g<h;g++)g in this&&b.call(a,this[g],g,this)};if(!Array.prototype.map)Array.prototype.map=function(b,a){for(var h=this.length>>>0,g=new Array(h),f=0;f<h;f++)if(f in this)g[f]=b.call(a,this[f],f,this);return g};if(!Array.prototype.filter)Array.prototype.filter=function(b,a){for(var h=[],g=0;g<this.length;g++)b.call(a,this[g])&&h.push(this[g]);return h};if(!Array.prototype.reduce)Array.prototype.reduce=function(b){var a=this.length>>>0,h=0;if(a===0&&arguments.length===1)throw new TypeError;
if(arguments.length>=2)var g=arguments[1];else{do{if(h in this){g=this[h++];break}if(++h>=a)throw new TypeError;}while(1)}for(;h<a;h++)if(h in this)g=b.call(null,g,this[h],h,this);return g};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(b,a){var h=this.length;a=a||0;if(!h)return-1;if(a>=h)return-1;if(a<0)a+=h;for(;a<h;a++)if(Object.prototype.hasOwnProperty.call(this,a))if(b===this[a])return a;return-1};if(!Object.keys)Object.keys=function(b){var a=[];for(var h in b)Object.prototype.hasOwnProperty.call(b,
h)&&a.push(h);return a};if(!String.prototype.trim)String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")};if(typeof q!=="undefined")var e=n,d={};else e=d={};e.Parser=function(b){function a(o){var s,v,x;if(o instanceof Function)return o.call(p.parsers);else if(typeof o==="string"){s=g.charAt(f)===o?o:null;v=1}else{if(f>=r+k[i].length&&i<k.length-1)r+=k[i++].length;o.lastIndex=x=f-r;if(s=o.exec(k[i])){v=s[0].length;if(o.lastIndex-v!==x)return}}if(s){f+=v;for(v=
r+k[i].length;f<=v;){o=g.charCodeAt(f);if(!(o===32||o===10||o===9))break;f++}return typeof s==="string"?s:s.length===1?s[0]:s}}function h(o){var s;if(typeof o==="string")return g.charAt(f)===o;else{o.lastIndex=f;if((s=o.exec(g))&&o.lastIndex-s[0].length===f)return s}}var g,f,i,j,k,r,p,u=this,t=function(){},w=this.imports={paths:b&&b.paths||[],queue:[],files:{},push:function(o,s){var v=this;this.queue.push(o);e.Parser.importer(o,this.paths,function(x){v.queue.splice(v.queue.indexOf(o),1);v.files[o]=
x;s(x);v.queue.length===0&&t()})}};this.env=b||{};this.optimization="optimization"in this.env?this.env.optimization:1;return p={imports:w,parse:function(o,s){var v,x,y=null;f=i=r=j=0;k=[];g=o.replace(/\r\n/g,"\n");if(u.optimization>0){g=g.replace(/\/\*(?:[^*]|\*+[^\/*])*\*+\//g,function(G){return u.optimization>1?"":G.replace(/\n(\s*\n)+/g,"\n")});k=g.split(/^(?=\n)/mg)}else k=[g];v=new d.Ruleset([],a(this.parsers.primary));v.root=true;v.toCSS=function(G){var I,J;return function(){try{return G.call(this)}catch(K){J=
g.split("\n");I=(g.slice(0,K.index).match(/\n/g)||"").length+1;for(var L=K.index,M=-1;L>=0&&g.charAt(L)!=="\n";L--)M++;throw{name:"NameError",message:K.message,line:I,column:M,extract:[J[I-2],J[I-1],J[I]]};}}}(v.toCSS);if(f<g.length-1){f=j;x=g.split("\n");o=(g.slice(0,f).match(/\n/g)||"").length+1;for(var E=f,B=-1;E>=0&&g.charAt(E)!=="\n";E--)B++;y={name:"ParseError",message:"Syntax Error on line "+o,filename:b.filename,line:o,column:B,extract:[x[o-2],x[o-1],x[o]]}}if(this.imports.queue.length>0)t=
function(){s(y,v)};else s(y,v)},parsers:{primary:function(){for(var o,s=[];o=a(this.mixin.definition)||a(this.rule)||a(this.ruleset)||a(this.mixin.call)||a(this.comment)||a(/[\n\s]+/g)||a(this.directive);)s.push(o);return s},comment:function(){var o;if(g.charAt(f)==="/")return(o=a(/\/\*(?:[^*]|\*+[^\/*])*\*+\/\n?/g))?new d.Comment(o):a(/\/\/.*/g)},entities:{quoted:function(){var o;if(!(g.charAt(f)!=='"'&&g.charAt(f)!=="'"))if(o=a(/"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'/g))return new d.Quoted(o[0],
o[1]||o[2])},keyword:function(){var o;if(o=a(/[A-Za-z-]+/g))return new d.Keyword(o)},call:function(){var o,s;if(o=a(/([a-zA-Z0-9_-]+|%)\(/g)){if(o[1].toLowerCase()==="alpha")return a(this.alpha);s=a(this.entities.arguments);if(a(")"))if(o)return new d.Call(o[1],s)}},arguments:function(){for(var o=[],s;s=a(this.expression);){o.push(s);if(!a(","))break}return o},literal:function(){return a(this.entities.dimension)||a(this.entities.color)||a(this.entities.quoted)},url:function(){var o;if(!(g.charAt(f)!==
"u"||!a(/url\(/g))){o=a(this.entities.quoted)||a(/[-a-zA-Z0-9_%@$\/.&=:;#+?]+/g);if(!a(")"))throw new Error("missing closing ) for url()");return new d.URL(o.value?o:new d.Anonymous(o))}},variable:function(){var o,s=f;if(g.charAt(f)==="@"&&(o=a(/@[a-zA-Z0-9_-]+/g)))return new d.Variable(o,s)},color:function(){var o;if(g.charAt(f)==="#"&&(o=a(/#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})/g)))return new d.Color(o[1])},dimension:function(){var o;o=g.charCodeAt(f);if(!(o>57||o<45||o===47))if(o=a(/(-?[0-9]*\.?[0-9]+)(px|%|em|pc|ex|in|deg|s|ms|pt|cm|mm)?/g))return new d.Dimension(o[1],
o[2])}},variable:function(){var o;if(g.charAt(f)==="@"&&(o=a(/(@[a-zA-Z0-9_-]+)\s*:/g)))return o[1]},shorthand:function(){var o,s;if(h(/[@\w.-]+\/[@\w.-]+/g))if((o=a(this.entity))&&a("/")&&(s=a(this.entity)))return new d.Shorthand(o,s)},mixin:{call:function(){for(var o=[],s,v,x,y=f;s=a(/[#.][a-zA-Z0-9_-]+/g);){o.push(new d.Element(v,s));v=a(">")}a("(")&&(x=a(this.entities.arguments))&&a(")");if(o.length>0&&(a(";")||h("}")))return new d.mixin.Call(o,x,y)},definition:function(){var o,s=[],v,x;if(!(g.charAt(f)!==
"."||h(/[^{]*(;|})/g)))if(o=a(/([#.][a-zA-Z0-9_-]+)\s*\(/g)){for(o=o[1];v=a(/@[\w-]+/g)||a(this.entities.literal)||a(this.entities.keyword);){if(v[0]==="@")if(a(":"))if(x=a(this.expression))s.push({name:v,value:x});else throw new Error("Expected value");else s.push({name:v});else s.push({value:v});if(!a(","))break}if(!a(")"))throw new Error("Expected )");if(v=a(this.block))return new d.mixin.Definition(o,s,v)}}},entity:function(){return a(this.entities.literal)||a(this.entities.variable)||a(this.entities.url)||
a(this.entities.call)||a(this.entities.keyword)},end:function(){return a(";")||h("}")},alpha:function(){var o;if(a(/opacity=/gi))if(o=a(/[0-9]+/g)||a(this.entities.variable)){if(!a(")"))throw new Error("missing closing ) for alpha()");return new d.Alpha(o)}},element:function(){var o;c=a(this.combinator);if(o=a(/[.#:]?[a-zA-Z0-9_-]+/g)||a("*")||a(this.attribute)||a(/\([^)@]+\)/g))return new d.Element(c,o)},combinator:function(){var o;return(o=a(/[+>~]/g)||a("&")||a(/::/g))?new d.Combinator(o):new d.Combinator(g.charAt(f-
1)===" "?" ":null)},selector:function(){for(var o,s=[];o=a(this.element);)s.push(o);if(s.length>0)return new d.Selector(s)},tag:function(){return a(/[a-zA-Z][a-zA-Z-]*[0-9]?/g)||a("*")},attribute:function(){var o="",s,v,x;if(a("[")){if(s=a(/[a-z-]+/g)||a(this.entities.quoted))o=(x=a(/[|~*$^]?=/g))&&(v=a(this.entities.quoted)||a(/[\w-]+/g))?[s,x,v.toCSS?v.toCSS():v].join(""):s;if(a("]"))if(o)return"["+o+"]"}},block:function(){var o;if(a("{")&&(o=a(this.primary))&&a("}"))return o},ruleset:function(){var o=
[],s,v,x=f;if(s=h(/([a-z.#: _-]+)[\s\n]*\{/g)){f+=s[0].length-1;o=[new d.Selector([new d.Element(null,s[1])])]}else{for(;s=a(this.selector);){o.push(s);if(!a(","))break}s&&a(this.comment)}if(o.length>0&&(v=a(this.block)))return new d.Ruleset(o,v);else{j=f;f=x}},rule:function(){var o,s=f;if(name=a(this.property)||a(this.variable)){if(name.charAt(0)!="@"&&(match=h(/([^@+\/*(;{}-]*);/g))){f+=match[0].length-1;o=new d.Anonymous(match[1])}else o=name==="font"?a(this.font):a(this.value);if(a(this.end))return new d.Rule(name,
o,s);else{j=f;f=s}}},"import":function(){var o;if(a(/@import\s+/g)&&(o=a(this.entities.quoted)||a(this.entities.url))&&a(";"))return new d.Import(o,w)},directive:function(){var o,s,v;if(g.charAt(f)==="@")if(s=a(this["import"]))return s;else if(o=a(/@media|@page/g)){v=a(/[^{]+/g).trim();if(s=a(this.block))return new d.Directive(o+" "+v,s)}else if(o=a(/@[-a-z]+/g))if(o==="@font-face"){if(s=a(this.block))return new d.Directive(o,s)}else if((s=a(this.entity))&&a(";"))return new d.Directive(o,s)},font:function(){for(var o=
[],s=[],v;v=a(this.shorthand)||a(this.entity);)s.push(v);o.push(new d.Expression(s));if(a(","))for(;v=a(this.expression);){o.push(v);if(!a(","))break}return new d.Value(o,a(this.important))},value:function(){for(var o,s=[];o=a(this.expression);){s.push(o);if(!a(","))break}o=a(this.important);if(s.length>0)return new d.Value(s,o)},important:function(){return a(/!\s*important/g)},sub:function(){var o;if(a("(")&&(o=a(this.expression))&&a(")"))return o},multiplication:function(){var o,s,v,x;if(o=a(this.operand)){for(;(v=
a(/[\/*]/g))&&(s=a(this.operand));)x=new d.Operation(v,[x||o,s]);return x||o}},addition:function(){var o,s,v,x;if(o=a(this.multiplication)){for(;(v=a(/[-+]\s+/g)||g.charAt(f-1)!=" "&&a(/[-+]/g))&&(s=a(this.multiplication));)x=new d.Operation(v,[x||o,s]);return x||o}},operand:function(){return a(this.sub)||a(this.entities.dimension)||a(this.entities.color)||a(this.entities.variable)},expression:function(){for(var o,s=[];o=a(this.addition)||a(this.entity);)s.push(o);if(s.length>0)return new d.Expression(s)},
property:function(){var o;if(o=a(/(\*?-?[-a-z_0-9]+)\s*:/g))return o[1]}}}};e.Parser.importer=null;d.functions={rgb:function(b,a,h){return this.rgba(b,a,h,1)},rgba:function(b,a,h,g){b=[b,a,h].map(function(f){return m(f)});g=m(g);return new d.Color(b,g)},hsl:function(b,a,h){return this.hsla(b,a,h,1)},hsla:function(b,a,h,g){function f(k){k=k<0?k+1:k>1?k-1:k;return k*6<1?j+(i-j)*k*6:k*2<1?i:k*3<2?j+(i-j)*(2/3-k)*6:j}b=(m(b)%360+360)%360/360;a=m(a);h=m(h);g=m(g);var i=h<=0.5?h*(a+1):h+a-h*a,j=h*2-i;return this.rgba(f(b+
1/3)*255,f(b)*255,f(b-1/3)*255,g)},opacity:function(b,a){m(a);return new d.Color(b.rgb,m(a))},saturate:function(b,a){b=b.toHSL();b.s+=a.value/100;b.s=l(b.s);return this.hsl(b.h,b.s,b.l)},desaturate:function(b,a){b=b.toHSL();b.s-=a.value/100;b.s=l(b.s);return this.hsl(b.h,b.s,b.l)},lighten:function(b,a){b=b.toHSL();b.l*=1+a.value/100;b.l=l(b.l);return this.hsl(b.h,b.s,b.l)},darken:function(b,a){b=b.toHSL();b.l*=1-a.value/100;b.l=l(b.l);return this.hsl(b.h,b.s,b.l)},greyscale:function(b){return this.desaturate(b,
new d.Dimension(100))},e:function(b){return new d.Anonymous(b)},"%":function(b){for(var a=Array.prototype.slice.call(arguments,1),h=b.content,g=0;g<a.length;g++)h=h.replace(/%s/,a[g].content).replace(/%[da]/,a[g].toCSS());h=h.replace(/%%/g,"%");return new d.Quoted('"'+h+'"',h)}};d.Alpha=function(b){this.value=b};d.Alpha.prototype={toCSS:function(){return"alpha(opacity="+this.value.toCSS()+")"},eval:function(){return this}};d.Anonymous=function(b){this.value=b.content||b};d.Anonymous.prototype={toCSS:function(){return this.value},
eval:function(){return this}};d.Call=function(b,a){this.name=b;this.args=a};d.Call.prototype={eval:function(b){var a=this.args.map(function(h){return h.eval(b)});return this.name in d.functions?d.functions[this.name].apply(d.functions,a):new d.Anonymous(this.name+"("+a.map(function(h){return h.toCSS()}).join(", ")+")")},toCSS:function(b){return this.eval(b).toCSS()}};d.Color=function(b,a){if(Array.isArray(b)){this.rgb=b;this.alpha=a}else this.rgb=b.length==6?b.match(/.{2}/g).map(function(h){return parseInt(h,
16)}):b.split("").map(function(h){return parseInt(h+h,16)})};d.Color.prototype={eval:function(){return this},toCSS:function(){return this.alpha&&this.alpha<1?"rgba("+this.rgb.concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(b){b=Math.round(b);b=(b>255?255:b<0?0:b).toString(16);return b.length===1?"0"+b:b}).join("")},operate:function(b,a){var h=[];a instanceof d.Color||(a=a.toColor());for(var g=0;g<3;g++)h[g]=d.operate(b,this.rgb[g],a.rgb[g]);return new d.Color(h)},toHSL:function(){var b=
this.rgb[0]/255,a=this.rgb[1]/255,h=this.rgb[2]/255,g=Math.max(b,a,h),f=Math.min(b,a,h),i,j=(g+f)/2,k=g-f;if(g===f)i=f=0;else{f=j>0.5?k/(2-g-f):k/(g+f);switch(g){case b:i=(a-h)/k+(a<h?6:0);break;case a:i=(h-b)/k+2;break;case h:i=(b-a)/k+4;break}i/=6}return{h:i*360,s:f,l:j}}};d.Comment=function(b){this.value=b};d.Comment.prototype={toCSS:function(){return this.value}};d.Dimension=function(b,a){this.value=parseFloat(b);this.unit=a||null};d.Dimension.prototype={eval:function(){return this},toColor:function(){return new d.Color([this.value,
this.value,this.value])},toCSS:function(){return this.value+this.unit},operate:function(b,a){return new d.Dimension(d.operate(b,this.value,a.value),this.unit||a.unit)}};d.Directive=function(b,a){this.name=b;if(Array.isArray(a))this.ruleset=new d.Ruleset([],a);else this.value=a};d.Directive.prototype={toCSS:function(b,a){if(this.ruleset){this.ruleset.root=true;return this.name+" {\n  "+this.ruleset.toCSS(b,a).trim().replace(/\n/g,"\n  ")+"\n}\n"}else return this.name+" "+this.value.toCSS()+";\n"},
eval:function(b){b.frames.unshift(this);this.ruleset&&this.ruleset.evalRules(b);b.frames.shift();return this},variable:function(b){return d.Ruleset.prototype.variable.call(this.ruleset,b)},find:function(){return d.Ruleset.prototype.find.apply(this.ruleset,arguments)},rulesets:function(){return d.Ruleset.prototype.rulesets.apply(this.ruleset)}};d.Element=function(b,a){this.combinator=b instanceof d.Combinator?b:new d.Combinator(b);this.value=a.trim()};d.Element.prototype.toCSS=function(){return this.combinator.toCSS()+
this.value};d.Combinator=function(b){this.value=b===" "?" ":b?b.trim():""};d.Combinator.prototype.toCSS=function(){switch(this.value){case "":return"";case " ":return" ";case "&":return"";case ":":return" :";case "::":return"::";case "+":return" + ";case "~":return" ~ ";case ">":return" > "}};d.Expression=function(b){this.value=b};d.Expression.prototype={eval:function(b){return this.value.length>1?new d.Expression(this.value.map(function(a){return a.eval(b)})):this.value[0].eval(b)},toCSS:function(){return this.value.map(function(b){return b.toCSS()}).join(" ")}};
d.Import=function(b,a){var h=this;this._path=b;this.path=b instanceof d.Quoted?/\.(le?|c)ss$/.test(b.content)?b.content:b.content+".less":b.value.content||b.value;(this.css=/css$/.test(this.path))||a.push(this.path,function(g){h.root=g})};d.Import.prototype={toCSS:function(){return this.css?"@import "+this._path.toCSS()+";\n":""},eval:function(){if(this.css)return this;else{for(var b=0;b<this.root.rules.length;b++)this.root.rules[b]instanceof d.Import&&Array.prototype.splice.apply(this.root.rules,
[b,1].concat(this.root.rules[b].eval()));return this.root.rules}}};d.Keyword=function(b){this.value=b};d.Keyword.prototype={eval:function(){return this},toCSS:function(){return this.value}};d.mixin={};d.mixin.Call=function(b,a,h){this.selector=new d.Selector(b);this.arguments=a;this.index=h};d.mixin.Call.prototype={eval:function(b){for(var a,h=[],g=false,f=0;f<b.frames.length;f++)if((a=b.frames[f].find(this.selector)).length>0){for(f=0;f<a.length;f++)if(a[f].match(this.arguments,b))try{Array.prototype.push.apply(h,
a[f].eval(this.arguments,b).rules);g=true}catch(i){throw{message:i.message,index:this.index};}if(g)return h;else throw{message:"No matching definition was found for `"+this.selector.toCSS().trim()+"("+this.arguments.map(function(j){return j.toCSS()}).join(", ")+")`",index:this.index};}throw{message:this.selector.toCSS().trim()+" is undefined",index:this.index};}};d.mixin.Definition=function(b,a,h){this.name=b;this.selectors=[new d.Selector([new d.Element(null,b)])];this.params=a;this.arity=a.length;
this.rules=h;this._lookups={};this.required=a.reduce(function(g,f){return f.name&&!f.value?g+1:g},0)};d.mixin.Definition.prototype={toCSS:function(){return""},variable:function(b){return d.Ruleset.prototype.variable.call(this,b)},find:function(){return d.Ruleset.prototype.find.apply(this,arguments)},rulesets:function(){return d.Ruleset.prototype.rulesets.apply(this)},eval:function(b,a){for(var h=new d.Ruleset(null,[]),g=0,f;g<this.params.length;g++)if(this.params[g].name)if(f=b&&b[g]||this.params[g].value)h.rules.unshift(new d.Rule(this.params[g].name,
f.eval(a)));else throw{message:"wrong number of arguments for "+this.name+" ("+b.length+" for "+this.arity+")"};return(new d.Ruleset(null,this.rules)).evalRules({frames:[this,h].concat(a.frames)})},match:function(b,a){var h=b&&b.length||0;if(h<this.required)return false;for(var g=0;g<Math.min(h,this.arity);g++)if(!this.params[g].name)if(!b[g].wildcard)if(b[g].eval(a).toCSS()!=this.params[g].value.eval(a).toCSS())return false;return true}};d.Operation=function(b,a){this.op=b.trim();this.operands=a};
d.Operation.prototype.eval=function(b){var a=this.operands[0].eval(b);b=this.operands[1].eval(b);var h;if(a instanceof d.Dimension&&b instanceof d.Color)if(this.op==="*"||this.op==="+"){h=b;b=a;a=h}else throw{name:"OperationError",message:"Can't substract or divide a color from a number"};return a.operate(this.op,b)};d.operate=function(b,a,h){switch(b){case "+":return a+h;case "-":return a-h;case "*":return a*h;case "/":return a/h}};d.Quoted=function(b,a){this.value=b;this.content=a};d.Quoted.prototype=
{toCSS:function(){return this.value},eval:function(){return this}};d.Rule=function(b,a,h){this.name=b;this.value=a instanceof d.Value?a:new d.Value([a]);this.index=h;this.variable=b.charAt(0)==="@"?true:false};d.Rule.prototype.toCSS=function(){return this.variable?"":this.name+": "+this.value.toCSS()+";"};d.Rule.prototype.eval=function(b){return new d.Rule(this.name,this.value.eval(b))};d.Value=function(b){this.value=b;this.is="value"};d.Value.prototype={eval:function(b){return this.value.length===
1?this.value[0].eval(b):new d.Value(this.value.map(function(a){return a.eval(b)}))},toCSS:function(){return this.value.map(function(b){return b.toCSS()}).join(", ")}};d.Shorthand=function(b,a){this.a=b;this.b=a};d.Shorthand.prototype={toCSS:function(b){return this.a.toCSS(b)+"/"+this.b.toCSS(b)},eval:function(){return this}};d.Ruleset=function(b,a){this.selectors=b;this.rules=a;this._lookups={}};d.Ruleset.prototype={eval:function(){return this},evalRules:function(b){var a=[];this.rules.forEach(function(h){if(h.evalRules)a.push(h.evalRules(b));
else h instanceof d.mixin.Call?Array.prototype.push.apply(a,h.eval(b)):a.push(h.eval(b))});this.rules=a;return this},match:function(b){return!b||b.length===0},variable:function(b){return this._variables?this._variables[b]:(this._variables=this.rules.reduce(function(a,h){if(h instanceof d.Rule&&h.variable===true)a[h.name]=h;return a},{}))[b]},rulesets:function(){return this._rulesets?this._rulesets:(this._rulesets=this.rules.filter(function(b){if(b instanceof d.Ruleset||b instanceof d.mixin.Definition)return b}))},
find:function(b,a){a=a||this;var h=[],g=b.toCSS();if(g in this._lookups)return this._lookups[g];this.rulesets().forEach(function(f){if(f!==a)for(var i=0;i<f.selectors.length;i++)if(b.match(f.selectors[i])){b.elements.length>1?Array.prototype.push.apply(h,f.find(new d.Selector(b.elements.slice(1)),a)):h.push(f);break}});return this._lookups[g]=h},toCSS:function(b,a){var h=[],g=[],f=[],i=[];if(this.root){b=[];a={frames:[]};for(var j=0;j<this.rules.length;j++)this.rules[j]instanceof d.Import&&Array.prototype.splice.apply(this.rules,
[j,1].concat(this.rules[j].eval(a)))}else if(b.length===0)i=this.selectors.map(function(r){return[r]});else for(j=0;j<this.selectors.length;j++)for(var k=0;k<b.length;k++)i.push(b[k].concat([this.selectors[j]]));a.frames.unshift(this);for(j=0;j<this.rules.length;j++)this.rules[j]instanceof d.mixin.Call&&Array.prototype.splice.apply(this.rules,[j,1].concat(this.rules[j].eval(a)));for(j=0;j<this.rules.length;j++){b=this.rules[j];if(b instanceof d.Directive)f.push(b.eval(a).toCSS(i,a));else if(b.rules)f.push(b.toCSS(i,
a));else if(b instanceof d.Comment)this.root?f.push(b.toCSS()):g.push(b.toCSS());else if(b.toCSS&&!b.variable)g.push(b.eval(a).toCSS());else b.value&&!b.variable&&g.push(b.value.toString())}f=f.join("");if(this.root)h.push(g.join("\n"));else if(g.length>0){i=i.map(function(r){return r.map(function(p){return p.toCSS()}).join("").trim()}).join(i.length>3?",\n":", ");h.push(i," {\n  "+g.join("\n  ")+"\n}\n")}h.push(f);a.frames.shift();return h.join("")}};d.Selector=function(b){this.elements=b;if(this.elements[0].combinator.value===
"")this.elements[0].combinator.value=" "};d.Selector.prototype.match=function(b){return this.elements[0].value===b.elements[0].value?true:false};d.Selector.prototype.toCSS=function(){if(this._css)return this._css;return this._css=this.elements.map(function(b){return typeof b==="string"?" "+b.trim():b.toCSS()}).join("")};d.URL=function(b){this.value=b};d.URL.prototype={toCSS:function(){return"url("+this.value.toCSS()+")"},eval:function(){return this}};d.Variable=function(b,a){this.name=b;this.index=
a};d.Variable.prototype={eval:function(b){var a,h,g=this.name;if(a=d.find(b.frames,function(f){if(h=f.variable(g))return h.value.eval(b)}))return a;else throw{message:"variable "+this.name+" is undefined",index:this.index};}};d.find=function(b,a){for(var h=0,g;h<b.length;h++)if(g=a.call(b,b[h]))return g;return null};(function(){function b(p){for(var u=0;u<k.length;u++)a(k[u],p)}function a(p,u){var t=typeof localStorage!=="undefined"&&localStorage.getItem(p.href),w=t&&JSON.parse(t);g(p.href,function(o,
s){if(w&&(new Date(s)).valueOf()===(new Date(w.timestamp)).valueOf()){h(w.css,p);u(null,p,{local:true})}else(new e.Parser({optimization:3})).parse(o,function(v,x){if(v)return j(v,p.href);try{u(x,p,{local:false,lastModified:s})}catch(y){j(y,p.href)}})},function(o){throw new Error("Couldn't load "+p.href+" ("+o+")");})}function h(p,u,t){var w=document.createElement("style");w.type="text/css";w.media="screen";w.title="less-sheet";if(u){w.title=u.title||u.href.match(/(?:^|\/)([-\w]+)\.[a-z]+$/i)[1];t&&
typeof localStorage!=="undefined"&&localStorage.setItem(u.href,JSON.stringify({timestamp:t,css:p}))}if(w.styleSheet)w.styleSheet.cssText=p;else w.appendChild(document.createTextNode(p));document.getElementsByTagName("head")[0].appendChild(w)}function g(p,u,t){var w=f();if(window.location.protocol==="file:"){w.open("GET",p,false);w.send(null);w.status===0?u(w.responseText):t(w.status)}else{w.open("GET",p,true);w.onreadystatechange=function(){if(w.readyState==4)if(w.status>=200&&w.status<300)u(w.responseText,
w.getResponseHeader("Last-Modified"));else typeof t==="function"&&t(w.status)};w.send(null)}}function f(){if(window.XMLHttpRequest)return new XMLHttpRequest;else try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(p){i("less: browser doesn't support AJAX.");return null}}function i(p){e.env=="development"&&typeof console!=="undefined"&&console.log(p)}function j(p,u){var t=document.createElement("div"),w;t.id="less-error-message";t.innerHTML="<h3>"+(p.message||"There is an error in your .less file")+
'</h3><p><a href="'+u+'">'+u+"</a> on line "+p.line+", column "+(p.column+1)+":</p>"+'<div>\n<pre class="ctx"><span>[-1]</span>{0}</pre>\n<pre><span>[0]</span>{current}</pre>\n<pre class="ctx"><span>[1]</span>{2}</pre>\n</div>'.replace(/\[(-?\d)\]/g,function(o,s){return p.line+parseInt(s)}).replace(/\{(\d)\}/g,function(o,s){return p.extract[parseInt(s)]}).replace(/\{current\}/,p.extract[1].slice(0,p.column)+'<span class="error">'+p.extract[1].slice(p.column)+"</span>");h("#less-error-message span {margin-right: 15px;}#less-error-message pre {color: #ee4444;padding: 4px 0;margin: 0;}#less-error-message pre.ctx {color: #dd7777;}#less-error-message h3 {padding: 15px 0 5px 0;margin: 0;}#less-error-message a {color: #10a}#less-error-message .error {color: red;font-weight: bold;padding-bottom: 2px;border-bottom: 1px dashed red;}");
t.style.cssText="font-family: Arial, sans-serif;border: 1px solid #e00;background-color: #eee;border-radius: 5px;color: #e00;padding: 15px;margin-bottom: 15px";if(e.env=="development")w=setInterval(function(){if(document.body){document.body.insertBefore(t,document.body.childNodes[0]);clearInterval(w)}},10)}var k=[];e.env="production";var r=setInterval(function(){if(document.body){if(!document.querySelectorAll&&typeof jQuery==="undefined")i("No selector method found");else k=(document.querySelectorAll||
jQuery).call(document,'link[rel="stylesheet/less"]');clearInterval(r);b(function(p,u,t){h(p.toCSS(),u,t.lastModified);t.local?i("less: loading "+u.href+" from local storage."):i("less: parsed "+u.href+" successfully.")})}},10);if(e.env==="development")refreshTimer=setInterval(function(){/!refresh/.test(location.hash)&&b(function(p,u,t){h(p.toCSS(),u,t)})},1E3);e.Parser.importer=function(p,u,t){a({href:p,title:p},function(w){t(w)})}})()});
bespin.tiki.register("::theme_manager_base",{name:"theme_manager_base",dependencies:{}});bespin.tiki.module("theme_manager_base:index",function(){});bespin.tiki.register("::canon",{name:"canon",dependencies:{environment:"0.0.0",events:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("canon:history",function(q,n){var m=q("bespin:util/stacktrace").Trace,l=q("bespin:plugins").catalog;n.requests=[];n.addRequestOutput=function(e){for(n.requests.push(e);n.requests.length>100;)n.requests.shiftObject();l.publish(this,"addedRequestOutput",null,e)};n.execute=function(e,d){if(d.command)try{d.command(e,d)}catch(b){var a=new m(b,true);console.group("Error executing command '"+d.typed+"'");console.log("command=",d.commandExt);console.log("args=",e);console.error(b);a.log(3);
console.groupEnd();d.doneWithError(b)}else d.doneWithError("Command not found.")}});
bespin.tiki.module("canon:request",function(q,n){var m=q("events").Event,l=q("canon:history");n.Request=function(e){e=e||{};this.command=e.command;this.commandExt=e.commandExt;this.args=e.args;this.typed=e.typed;this._begunOutput=false;this.start=new Date;this.end=null;this.error=this.completed=false;this.changed=new m};n.Request.prototype._beginOutput=function(){this._begunOutput=true;this.outputs=[];l.addRequestOutput(this)};n.Request.prototype.doneWithError=function(e){this.error=true;this.done(e)};
n.Request.prototype.async=function(){this._begunOutput||this._beginOutput()};n.Request.prototype.output=function(e){this._begunOutput||this._beginOutput();if(typeof e!=="string"&&!(e instanceof Node))e=e.toString();this.outputs.push(e);this.changed();return this};n.Request.prototype.done=function(e){this.completed=true;this.end=new Date;this.duration=this.end.getTime()-this.start.getTime();e?this.output(e):this.changed()}});bespin.tiki.module("canon:index",function(){});
bespin.tiki.register("::traits",{name:"traits",dependencies:{}});
bespin.tiki.module("traits:index",function(q,n){n.Trait=function(){function m(A){var z=function(){throw new Error("Conflicting property: "+A);};B(z.prototype);return B(z)}function l(){return B({value:undefined,enumerable:false,required:true})}function e(A){A=m(A);return o?B({get:A,set:A,enumerable:false,conflict:true}):B({value:A,enumerable:false,conflict:true})}function d(A,z){return A===z?A!==0||1/A===1/z:A!==A&&z!==z}function b(A,z){return A.conflict&&z.conflict?true:A.get===z.get&&A.set===z.set&&
d(A.value,z.value)&&A.enumerable===z.enumerable&&A.required===z.required&&A.conflict===z.conflict}function a(A,z){return B(v(A,z))}function h(A){var z={};E(A,function(C){z[C]=true});return B(z)}function g(A){var z={};E(G(A),function(C){var D=I(A,C);if(D.value===M)D=l(C);else if(typeof D.value==="function"){D.method=true;"prototype"in D.value&&B(D.value.prototype)}else{D.get&&D.get.prototype&&B(D.get.prototype);D.set&&D.set.prototype&&B(D.set.prototype)}z[C]=D});return z}function f(){var A=y(arguments,
0),z={};E(A,function(C){E(G(C),function(D){var F=C[D];if(x(z,D)&&!z[D].required)F.required||b(z[D],F)||(z[D]=e(D));else z[D]=F})});return B(z)}function i(A,z){var C=h(A),D={};E(G(z),function(F){D[F]=!x(C,F)||z[F].required?z[F]:l(F)});return B(D)}function j(){var A=y(arguments,0),z={};E(A,function(C){E(G(C),function(D){var F=C[D];if(!x(z,D)||z[D].required)z[D]=F})});return B(z)}function k(A,z){var C={};E(G(z),function(D){if(x(A,D)&&!z[D].required){var F=A[D];C[F]=x(C,F)&&!C[F].required?e(F):z[D];x(C,
D)||(C[D]=l(D))}else if(x(C,D))z[D].required||(C[D]=e(D));else C[D]=z[D]});return B(C)}function r(A,z){var C={},D=[];for(var F in A)if(x(A,F))if(A[F])C[F]=A[F];else D.push(F);return k(C,i(D,z))}function p(A,z){var C=L(A),D={};E(G(z),function(F){var H=z[F];if(H.required&&!(F in A))throw new Error("Missing required property: "+F);else if(H.conflict)throw new Error("Remaining conflicting property: "+F);else D[F]="value"in H?H.method?{value:a(H.value,C),enumerable:H.enumerable,configurable:H.configurable,
writable:H.writable}:H:{get:H.get?a(H.get,C):undefined,set:H.set?a(H.set,C):undefined,enumerable:H.enumerable,configurable:H.configurable,writable:H.writable}});K(C,D);return B(C)}function u(A,z){return p(Object.prototype,g(A),z)}function t(A,z){var C=G(A),D=G(z);if(C.length!==D.length)return false;for(var F=0;F<C.length;F++){D=C[F];if(!z[D]||!b(A[D],z[D]))return false}return true}function w(A){return g(A)}var o=!!Object.defineProperty,s=Function.prototype.call,v=Function.prototype.bind?function(A,
z){return Function.prototype.bind.call(A,z)}:function(A,z){function C(){return A.apply(z,arguments)}return C},x=v(s,Object.prototype.hasOwnProperty),y=v(s,Array.prototype.slice),E=Array.prototype.forEach?v(s,Array.prototype.forEach):function(A,z){for(var C=0,D=A.length;C<D;C++)z(A[C])},B=Object.freeze||function(A){return A},G=Object.getOwnPropertyNames||function(A){var z=[];for(var C in A)x(A,C)&&z.push(C);return z},I=Object.getOwnPropertyDescriptor||function(A,z){return{value:A[z],enumerable:true,
writable:true,configurable:true}},J=Object.defineProperty||function(A,z,C){A[z]=C.value},K=Object.defineProperties||function(A,z){for(var C in z)x(z,C)&&J(A,C,z[C])},L=Object.create||function(A,z){function C(){}C.prototype=A||Object.prototype;A=new C;z&&K(A,z);return A};s=Object.getOwnProperties||function(A){var z={};E(G(A),function(C){z[C]=I(A,C)});return z};var M=B({toString:function(){return"<Trait.required>"}});if(!Object.create)Object.create=L;if(!Object.getOwnProperties)Object.getOwnProperties=
s;w.required=B(M);w.compose=B(f);w.resolve=B(r);w.override=B(j);w.create=B(p);w.eqv=B(t);w.object=B(u);return B(w)}()});bespin.tiki.register("::keyboard",{name:"keyboard",dependencies:{canon:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("keyboard:keyboard",function(q,n){var m=q("bespin:plugins").catalog;q("bespin:console");q("bespin:util/stacktrace");var l=q("bespin:util/util"),e=q("settings").settings,d=q("keyboard:keyutil"),b=q("canon:history"),a=q("canon:request").Request,h=q("environment").env;n.buildFlags=function(g){g.context=h.contexts[0];return g};q=function(){};l.mixin(q.prototype,{_customKeymappingCache:{states:{}},processKeyEvent:function(g,f,i){g=d.commandCodes(g,true)[0];if(l.none(g))return false;
n.buildFlags(i);i.isCommandKey=true;return this._matchCommand(g,f,i)},_matchCommand:function(g,f,i){var j=this._findCommandExtension(g,f,i);if(j&&j.commandExt!=="no command"){i.isTextView&&f.resetKeyBuffers();var k=j.commandExt;k.load(function(r){r=new a({command:r,commandExt:k});b.execute(j.args,r)});return true}return j&&j.commandExt==="no command"?true:false},_buildBindingsRegex:function(g){g.forEach(function(f){if(l.none(f.key))if(Array.isArray(f.regex)){f.key=new RegExp("^"+f.regex[1]+"$");f.regex=
new RegExp(f.regex.join("")+"$")}else f.regex=new RegExp(f.regex+"$");else f.key=new RegExp("^"+f.key+"$")})},_buildKeymappingRegex:function(g){for(state in g.states)this._buildBindingsRegex(g.states[state]);g._convertedRegExp=true},_findCommandExtension:function(g,f,i){if(i.isTextView){var j=f._keyState;if(!i.isCommandKey||g.indexOf("alt_")===-1){f._keyBuffer+=g.replace(/ctrl_meta|meta/,"ctrl");f._keyMetaBuffer+=g}var k=[this._customKeymappingCache];k=k.concat(m.getExtensions("keymapping"));for(var r=
0;r<k.length;r++)if(!l.none(k[r].states[j])){l.none(k[r]._convertedRegExp)&&this._buildKeymappingRegex(k[r]);var p=this._bindingsMatch(g,i,f,k[r]);if(!l.none(p))return p}}f=m.getExtensions("command");var u=null;j={};g=g.replace(/ctrl_meta|meta/,"ctrl");f.some(function(t){if(this._commandMatches(t,g,i)){u=t;return true}return false}.bind(this));return l.none(u)?null:{commandExt:u,args:j}},_bindingsMatch:function(g,f,i,j){var k,r=null,p={},u;u=l.none(j.hasMetaKey)?i._keyMetaBuffer:i._keyBuffer;if(g.indexOf("alt_")===
0&&f.isCommandKey)u+=g;j.states[i._keyState].some(function(t){if(t.key&&!t.key.test(g))return false;if(t.regex&&!(k=t.regex.exec(u)))return false;if(t.disallowMatches)for(var w=0;w<t.disallowMatches.length;w++)if(k[t.disallowMatches[w]])return true;if(!n.flagsMatch(t.predicates,f))return false;if(t.exec){r=m.getExtensionByKey("command",t.exec);if(l.none(r))throw new Error("Can't find command "+t.exec+" in state="+i._keyState+", symbolicName="+g);if(t.params){var o;t.params.forEach(function(s){o=!l.none(s.match)&&
!l.none(k)?k[s.match]||s.defaultValue:s.defaultValue;if(s.type==="number")o=parseInt(o);p[s.name]=o})}i.resetKeyBuffers()}if(t.then){i._keyState=t.then;i.resetKeyBuffers()}if(l.none(r))r="no command";return true});if(l.none(r))return null;return{commandExt:r,args:p}},_commandMatches:function(g,f,i){var j=g.key;if(!j)return false;if(!n.flagsMatch(g.predicates,i))return false;if(typeof j==="string"){if(j!=f)return false;return true}if(!Array.isArray(j)){j=[j];g.key=j}for(g=0;g<j.length;g++){var k=j[g];
if(typeof k==="string"){if(k==f)return true}else if(k.key==f)return n.flagsMatch(k.predicates,i)}return false},_customKeymappingChanged:function(){var g=this._customKeymappingCache=JSON.parse(e.get("customKeymapping"));g.states=g.states||{};for(state in g.states)this._buildBindingsRegex(g.states[state]);g._convertedRegExp=true}});n.flagsMatch=function(g,f){if(l.none(g))return true;if(!f)return false;for(var i in g)if(f[i]!==g[i])return false;return true};n.keyboardManager=new q;m.registerExtension("settingChange",
{match:"customKeymapping",pointer:n.keyboardManager._customKeymappingChanged.bind(n.keyboardManager)})});
bespin.tiki.module("keyboard:keyutil",function(q,n){var m=q("bespin:util/util");n.KeyHelper=function(){var e={MODIFIER_KEYS:{16:"shift",17:"ctrl",18:"alt",224:"meta"},FUNCTION_KEYS:{8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"},PRINTABLE_KEYS:{32:" ",
48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'},PRINTABLE_KEYS_CHARCODE:{},KEY:{}};for(var d in e.PRINTABLE_KEYS){var b=e.PRINTABLE_KEYS[d];e.PRINTABLE_KEYS_CHARCODE[b.charCodeAt(0)]=d;if(b.toUpperCase()!=
b)e.PRINTABLE_KEYS_CHARCODE[b.toUpperCase().charCodeAt(0)]=d}for(d in e.FUNCTION_KEYS){b=e.FUNCTION_KEYS[d].toUpperCase();e.KEY[b]=parseInt(d,10)}return e}();var l=function(e){return!!(e.altKey||e.ctrlKey||e.metaKey||e.charCode!==e.which&&n.KeyHelper.FUNCTION_KEYS[e.which])};n.commandCodes=function(e,d){var b=e._keyCode||e.keyCode,a=e._charCode===undefined?e.charCode:e._charCode,h=null,g=null,f="",i=true;if(b===0&&e.which===0)return false;if(a!==0)return false;if(n.KeyHelper.MODIFIER_KEYS[a])return[n.KeyHelper.MODIFIER_KEYS[a],
null];if(b){h=n.KeyHelper.FUNCTION_KEYS[b];if(!h&&(e.altKey||e.ctrlKey||e.metaKey)){h=n.KeyHelper.PRINTABLE_KEYS[b];if(b>47&&b<58)i=e.altKey}if(h){if(e.altKey)f+="alt_";if(e.ctrlKey)f+="ctrl_";if(e.metaKey)f+="meta_"}else if(e.ctrlKey||e.metaKey)return false}if(!h){b=e.which;g=h=String.fromCharCode(b);b=h.toLowerCase();if(e.metaKey){f="meta_";h=b}else h=null}if(e.shiftKey&&h&&i)f+="shift_";if(h)h=f+h;if(!d&&h)h=h.replace(/ctrl_meta|meta/,"ctrl");return[h,g]};n.addKeyDownListener=function(e,d){var b=
function(a){var h=d(a);h&&m.stopEvent(a);return h};e.addEventListener("keydown",function(a){if(m.isMozilla)if(n.KeyHelper.FUNCTION_KEYS[a.keyCode])return true;else if((a.ctrlKey||a.metaKey)&&n.KeyHelper.PRINTABLE_KEYS[a.keyCode])return true;if(l(a))return b(a);return true},false);e.addEventListener("keypress",function(a){if(m.isMozilla)if(n.KeyHelper.FUNCTION_KEYS[a.keyCode])return b(a);else if((a.ctrlKey||a.metaKey)&&n.KeyHelper.PRINTABLE_KEYS_CHARCODE[a.charCode]){a._keyCode=n.KeyHelper.PRINTABLE_KEYS_CHARCODE[a.charCode];
a._charCode=0;return b(a)}if(a.charCode!==undefined&&a.charCode===0)return true;return b(a)},false)}});bespin.tiki.module("keyboard:index",function(){});bespin.tiki.register("::worker_manager",{name:"worker_manager",dependencies:{canon:"0.0.0",events:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("worker_manager:index",function(q,n){function m(f){var i=/^([^#:]+)(?::([^#:]+))?#([^#:]+)$/.exec(f);if(i==null)throw new Error('WorkerSupervisor: invalid pointer specification: "'+f+'"');f=i[1];var j=i[3];i=f+":"+(i[2]!=null?i[2]:"index");var k=bespin!=null&&bespin.base!=null?bespin.base:"";this._packageId=f;this._moduleId=i;this._base=k;this._target=j;this._worker=null;this._currentId=0;this.started=new a}function l(){g.restartAll()}if(window==null)throw new Error('The "worker_manager" plugin can only be loaded in the browser, not a web worker. Use "worker" instead.');
var e=q("bespin:proxy");q("bespin:plugins");var d=q("bespin:console").console,b=q("underscore")._,a=q("events").Event,h=q("bespin:promise").Promise;q("environment");var g={_workers:[],add:function(f){this._workers.push(f)},remove:function(f){this._workers=b(this._workers).without(f)},restartAll:function(){var f=this._workers;b(f).invoke("kill");b(f).invoke("start")}};m.prototype={_onError:function(f){this._worker=null;g.remove(this);d.error("WorkerSupervisor: worker failed at file "+f.filename+":"+
f.lineno+"; fix the worker and use 'worker restart' to restart it")},_onMessage:function(f){f=JSON.parse(f.data);switch(f.op){case "finish":if(f.id===this._currentId){var i=this._promise;this._promise=null;i.resolve(f.result)}break;case "log":d[f.method].apply(d,f.args);break}},_promise:null,started:null,kill:function(){var f=this._promise;if(f!=null){f.reject("killed");this._promise=null}this._worker.terminate();this._worker=null;g.remove(this)},send:function(f,i){var j=this._promise;if(j!=null){j.reject("interrupted");
this._currentId++}j=this._currentId;var k=new h;this._promise=k;this._worker.postMessage(JSON.stringify({op:"invoke",id:j,method:f,args:i}));return k},start:function(){if(this._worker!=null)throw new Error("WorkerSupervisor: worker already started");var f=this._base,i=this._target,j=this._packageId,k=this._moduleId,r=new e.Worker(f+"BespinEmbedded.js");r.onmessage=this._onMessage.bind(this);r.onerror=this._onError.bind(this);r.postMessage(JSON.stringify({op:"load",base:f,pkg:j,module:k,target:i}));
this._worker=r;this._currentId=0;g.add(this);this.started()}};n.WorkerSupervisor=m;n.workerManager=g;n.workerRestartCommand=l});bespin.tiki.register("::diff",{name:"diff",dependencies:{}});
bespin.tiki.module("diff:index",function(q,n){function m(){function e(){for(var d=0,b=1,a=2;b!=a;){d++;b=a;a<<=1}return d}this.Diff_Timeout=1;this.Diff_EditCost=4;this.Diff_DualThreshold=32;this.Match_Threshold=0.5;this.Match_Distance=1E3;this.Patch_DeleteThreshold=0.5;this.Patch_Margin=4;this.Match_MaxBits=e()}function l(){this.diffs=[];this.start2=this.start1=null;this.length2=this.length1=0}m.prototype.diff_main=function(e,d,b){if(e==d)return[[0,e]];if(typeof b=="undefined")b=true;var a=b,h=this.diff_commonPrefix(e,
d);b=e.substring(0,h);e=e.substring(h);d=d.substring(h);h=this.diff_commonSuffix(e,d);var g=e.substring(e.length-h);e=e.substring(0,e.length-h);d=d.substring(0,d.length-h);e=this.diff_compute(e,d,a);b&&e.unshift([0,b]);g&&e.push([0,g]);this.diff_cleanupMerge(e);return e};m.prototype.diff_compute=function(e,d,b){var a;if(!e)return[[1,d]];if(!d)return[[-1,e]];a=e.length>d.length?e:d;var h=e.length>d.length?d:e,g=a.indexOf(h);if(g!=-1){a=[[1,a.substring(0,g)],[0,h],[1,a.substring(g+h.length)]];if(e.length>
d.length)a[0][0]=a[2][0]=-1;return a}if(a=this.diff_halfMatch(e,d)){d=a[1];var f=a[3];e=a[4];a=this.diff_main(a[0],a[2],b);b=this.diff_main(d,f,b);return a.concat([[0,e]],b)}if(b&&(e.length<100||d.length<100))b=false;if(b){f=this.diff_linesToChars(e,d);e=f[0];d=f[1];f=f[2]}(a=this.diff_map(e,d))||(a=[[-1,e],[1,d]]);if(b){this.diff_charsToLines(a,f);this.diff_cleanupSemantic(a);a.push([0,""]);d=e=b=0;for(h=f="";b<a.length;){switch(a[b][0]){case 1:d++;h+=a[b][1];break;case -1:e++;f+=a[b][1];break;case 0:if(e>=
1&&d>=1){f=this.diff_main(f,h,false);a.splice(b-e-d,e+d);b=b-e-d;for(e=f.length-1;e>=0;e--)a.splice(b,0,f[e]);b+=f.length}e=d=0;h=f="";break}b++}a.pop()}return a};m.prototype.diff_linesToChars=function(e,d){function b(g){for(var f="",i=0,j=-1,k=a.length;j<g.length-1;){j=g.indexOf("\n",i);if(j==-1)j=g.length-1;var r=g.substring(i,j+1);i=j+1;if(h.hasOwnProperty?h.hasOwnProperty(r):h[r]!==undefined)f+=String.fromCharCode(h[r]);else{f+=String.fromCharCode(k);h[r]=k;a[k++]=r}}return f}var a=[],h={};a[0]=
"";e=b(e);d=b(d);return[e,d,a]};m.prototype.diff_charsToLines=function(e,d){for(var b=0;b<e.length;b++){for(var a=e[b][1],h=[],g=0;g<a.length;g++)h[g]=d[a.charCodeAt(g)];e[b][1]=h.join("")}};m.prototype.diff_map=function(e,d){var b=(new Date).getTime()+this.Diff_Timeout*1E3,a=e.length,h=d.length,g=a+h-1,f=this.Diff_DualThreshold*2<g,i=[],j=[],k={},r={};k[1]=0;r[1]=0;for(var p,u,t,w={},o=false,s=!!w.hasOwnProperty,v=(a+h)%2,x=0;x<g;x++){if(this.Diff_Timeout>0&&(new Date).getTime()>b)return null;i[x]=
{};for(var y=-x;y<=x;y+=2){p=y==-x||y!=x&&k[y-1]<k[y+1]?k[y+1]:k[y-1]+1;u=p-y;if(f){t=p+","+u;if(v&&(s?w.hasOwnProperty(t):w[t]!==undefined))o=true;v||(w[t]=x)}for(;!o&&p<a&&u<h&&e.charAt(p)==d.charAt(u);){p++;u++;if(f){t=p+","+u;if(v&&(s?w.hasOwnProperty(t):w[t]!==undefined))o=true;v||(w[t]=x)}}k[y]=p;i[x][p+","+u]=true;if(p==a&&u==h)return this.diff_path1(i,e,d);else if(o){j=j.slice(0,w[t]+1);b=this.diff_path1(i,e.substring(0,p),d.substring(0,u));return b.concat(this.diff_path2(j,e.substring(p),
d.substring(u)))}}if(f){j[x]={};for(y=-x;y<=x;y+=2){p=y==-x||y!=x&&r[y-1]<r[y+1]?r[y+1]:r[y-1]+1;u=p-y;t=a-p+","+(h-u);if(!v&&(s?w.hasOwnProperty(t):w[t]!==undefined))o=true;if(v)w[t]=x;for(;!o&&p<a&&u<h&&e.charAt(a-p-1)==d.charAt(h-u-1);){p++;u++;t=a-p+","+(h-u);if(!v&&(s?w.hasOwnProperty(t):w[t]!==undefined))o=true;if(v)w[t]=x}r[y]=p;j[x][p+","+u]=true;if(o){i=i.slice(0,w[t]+1);b=this.diff_path1(i,e.substring(0,a-p),d.substring(0,h-u));return b.concat(this.diff_path2(j,e.substring(a-p),d.substring(h-
u)))}}}}return null};m.prototype.diff_path1=function(e,d,b){for(var a=[],h=d.length,g=b.length,f=null,i=e.length-2;i>=0;i--)for(;;)if(e[i].hasOwnProperty?e[i].hasOwnProperty(h-1+","+g):e[i][h-1+","+g]!==undefined){h--;if(f===-1)a[0][1]=d.charAt(h)+a[0][1];else a.unshift([-1,d.charAt(h)]);f=-1;break}else if(e[i].hasOwnProperty?e[i].hasOwnProperty(h+","+(g-1)):e[i][h+","+(g-1)]!==undefined){g--;if(f===1)a[0][1]=b.charAt(g)+a[0][1];else a.unshift([1,b.charAt(g)]);f=1;break}else{h--;g--;if(f===0)a[0][1]=
d.charAt(h)+a[0][1];else a.unshift([0,d.charAt(h)]);f=0}return a};m.prototype.diff_path2=function(e,d,b){for(var a=[],h=0,g=d.length,f=b.length,i=null,j=e.length-2;j>=0;j--)for(;;)if(e[j].hasOwnProperty?e[j].hasOwnProperty(g-1+","+f):e[j][g-1+","+f]!==undefined){g--;if(i===-1)a[h-1][1]+=d.charAt(d.length-g-1);else a[h++]=[-1,d.charAt(d.length-g-1)];i=-1;break}else if(e[j].hasOwnProperty?e[j].hasOwnProperty(g+","+(f-1)):e[j][g+","+(f-1)]!==undefined){f--;if(i===1)a[h-1][1]+=b.charAt(b.length-f-1);
else a[h++]=[1,b.charAt(b.length-f-1)];i=1;break}else{g--;f--;if(i===0)a[h-1][1]+=d.charAt(d.length-g-1);else a[h++]=[0,d.charAt(d.length-g-1)];i=0}return a};m.prototype.diff_commonPrefix=function(e,d){if(!e||!d||e.charCodeAt(0)!==d.charCodeAt(0))return 0;for(var b=0,a=Math.min(e.length,d.length),h=a,g=0;b<h;){if(e.substring(g,h)==d.substring(g,h))g=b=h;else a=h;h=Math.floor((a-b)/2+b)}return h};m.prototype.diff_commonSuffix=function(e,d){if(!e||!d||e.charCodeAt(e.length-1)!==d.charCodeAt(d.length-
1))return 0;for(var b=0,a=Math.min(e.length,d.length),h=a,g=0;b<h;){if(e.substring(e.length-h,e.length-g)==d.substring(d.length-h,d.length-g))g=b=h;else a=h;h=Math.floor((a-b)/2+b)}return h};m.prototype.diff_halfMatch=function(e,d){function b(i,j,k){for(var r=i.substring(k,k+Math.floor(i.length/4)),p=-1,u="",t,w,o,s;(p=j.indexOf(r,p+1))!=-1;){var v=g.diff_commonPrefix(i.substring(k),j.substring(p)),x=g.diff_commonSuffix(i.substring(0,k),j.substring(0,p));if(u.length<x+v){u=j.substring(p-x,p)+j.substring(p,
p+v);t=i.substring(0,k-x);w=i.substring(k+v);o=j.substring(0,p-x);s=j.substring(p+v)}}return u.length>=i.length/2?[t,w,o,s,u]:null}var a=e.length>d.length?e:d,h=e.length>d.length?d:e;if(a.length<10||h.length<1)return null;var g=this,f=b(a,h,Math.ceil(a.length/4));a=b(a,h,Math.ceil(a.length/2));if(!f&&!a)return null;else f=a?f?f[4].length>a[4].length?f:a:a:f;if(e.length>d.length){e=f[0];d=f[1];a=f[2];h=f[3]}else{a=f[0];h=f[1];e=f[2];d=f[3]}return[e,d,a,h,f[4]]};m.prototype.diff_cleanupSemantic=function(e){for(var d=
false,b=[],a=0,h=null,g=0,f=0,i=0;g<e.length;){if(e[g][0]==0){b[a++]=g;f=i;i=0;h=e[g][1]}else{i+=e[g][1].length;if(h!==null&&h.length<=f&&h.length<=i){e.splice(b[a-1],0,[-1,h]);e[b[a-1]+1][0]=1;a--;a--;g=a>0?b[a-1]:-1;i=f=0;h=null;d=true}}g++}d&&this.diff_cleanupMerge(e);this.diff_cleanupSemanticLossless(e)};m.prototype.diff_cleanupSemanticLossless=function(e){function d(s,v){if(!s||!v)return 5;var x=0;if(s.charAt(s.length-1).match(b)||v.charAt(0).match(b)){x++;if(s.charAt(s.length-1).match(a)||v.charAt(0).match(a)){x++;
if(s.charAt(s.length-1).match(h)||v.charAt(0).match(h)){x++;if(s.match(g)||v.match(f))x++}}}return x}for(var b=/[^a-zA-Z0-9]/,a=/\s/,h=/[\r\n]/,g=/\n\r?\n$/,f=/^\r?\n\r?\n/,i=1;i<e.length-1;){if(e[i-1][0]==0&&e[i+1][0]==0){var j=e[i-1][1],k=e[i][1],r=e[i+1][1],p=this.diff_commonSuffix(j,k);if(p){var u=k.substring(k.length-p);j=j.substring(0,j.length-p);k=u+k.substring(0,k.length-p);r=u+r}p=j;u=k;for(var t=r,w=d(j,k)+d(k,r);k.charAt(0)===r.charAt(0);){j+=k.charAt(0);k=k.substring(1)+r.charAt(0);r=
r.substring(1);var o=d(j,k)+d(k,r);if(o>=w){w=o;p=j;u=k;t=r}}if(e[i-1][1]!=p){if(p)e[i-1][1]=p;else{e.splice(i-1,1);i--}e[i][1]=u;if(t)e[i+1][1]=t;else{e.splice(i+1,1);i--}}}i++}};m.prototype.diff_cleanupEfficiency=function(e){for(var d=false,b=[],a=0,h="",g=0,f=false,i=false,j=false,k=false;g<e.length;){if(e[g][0]==0){if(e[g][1].length<this.Diff_EditCost&&(j||k)){b[a++]=g;f=j;i=k;h=e[g][1]}else{a=0;h=""}j=k=false}else{if(e[g][0]==-1)k=true;else j=true;if(h&&(f&&i&&j&&k||h.length<this.Diff_EditCost/
2&&f+i+j+k==3)){e.splice(b[a-1],0,[-1,h]);e[b[a-1]+1][0]=1;a--;h="";if(f&&i){j=k=true;a=0}else{a--;g=a>0?b[a-1]:-1;j=k=false}d=true}}g++}d&&this.diff_cleanupMerge(e)};m.prototype.diff_cleanupMerge=function(e){e.push([0,""]);for(var d=0,b=0,a=0,h="",g="",f;d<e.length;)switch(e[d][0]){case 1:a++;g+=e[d][1];d++;break;case -1:b++;h+=e[d][1];d++;break;case 0:if(b!==0||a!==0){if(b!==0&&a!==0){f=this.diff_commonPrefix(g,h);if(f!==0){if(d-b-a>0&&e[d-b-a-1][0]==0)e[d-b-a-1][1]+=g.substring(0,f);else{e.splice(0,
0,[0,g.substring(0,f)]);d++}g=g.substring(f);h=h.substring(f)}f=this.diff_commonSuffix(g,h);if(f!==0){e[d][1]=g.substring(g.length-f)+e[d][1];g=g.substring(0,g.length-f);h=h.substring(0,h.length-f)}}if(b===0)e.splice(d-b-a,b+a,[1,g]);else a===0?e.splice(d-b-a,b+a,[-1,h]):e.splice(d-b-a,b+a,[-1,h],[1,g]);d=d-b-a+(b?1:0)+(a?1:0)+1}else if(d!==0&&e[d-1][0]==0){e[d-1][1]+=e[d][1];e.splice(d,1)}else d++;b=a=0;g=h="";break}e[e.length-1][1]===""&&e.pop();b=false;for(d=1;d<e.length-1;){if(e[d-1][0]==0&&e[d+
1][0]==0)if(e[d][1].substring(e[d][1].length-e[d-1][1].length)==e[d-1][1]){e[d][1]=e[d-1][1]+e[d][1].substring(0,e[d][1].length-e[d-1][1].length);e[d+1][1]=e[d-1][1]+e[d+1][1];e.splice(d-1,1);b=true}else if(e[d][1].substring(0,e[d+1][1].length)==e[d+1][1]){e[d-1][1]+=e[d+1][1];e[d][1]=e[d][1].substring(e[d+1][1].length)+e[d+1][1];e.splice(d+1,1);b=true}d++}b&&this.diff_cleanupMerge(e)};m.prototype.diff_xIndex=function(e,d){var b=0,a=0,h=0,g=0,f;for(f=0;f<e.length;f++){if(e[f][0]!==1)b+=e[f][1].length;
if(e[f][0]!==-1)a+=e[f][1].length;if(b>d)break;h=b;g=a}if(e.length!=f&&e[f][0]===-1)return g;return g+(d-h)};m.prototype.diff_prettyHtml=function(e){for(var d=[],b=0,a=0;a<e.length;a++){var h=e[a][0],g=e[a][1],f=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&para;<BR>");switch(h){case 1:d[a]='<INS STYLE="background:#E6FFE6;" TITLE="i='+b+'">'+f+"</INS>";break;case -1:d[a]='<DEL STYLE="background:#FFE6E6;" TITLE="i='+b+'">'+f+"</DEL>";break;case 0:d[a]='<SPAN TITLE="i='+
b+'">'+f+"</SPAN>";break}if(h!==-1)b+=g.length}return d.join("")};m.prototype.diff_text1=function(e){for(var d=[],b=0;b<e.length;b++)if(e[b][0]!==1)d[b]=e[b][1];return d.join("")};m.prototype.diff_text2=function(e){for(var d=[],b=0;b<e.length;b++)if(e[b][0]!==-1)d[b]=e[b][1];return d.join("")};m.prototype.diff_levenshtein=function(e){for(var d=0,b=0,a=0,h=0;h<e.length;h++){var g=e[h][1];switch(e[h][0]){case 1:b+=g.length;break;case -1:a+=g.length;break;case 0:d+=Math.max(b,a);a=b=0;break}}d+=Math.max(b,
a);return d};m.prototype.diff_toDelta=function(e){for(var d=[],b=0;b<e.length;b++)switch(e[b][0]){case 1:d[b]="+"+encodeURI(e[b][1]);break;case -1:d[b]="-"+e[b][1].length;break;case 0:d[b]="="+e[b][1].length;break}return d.join("\t").replace(/\x00/g,"%00").replace(/%20/g," ")};m.prototype.diff_fromDelta=function(e,d){var b=[],a=0,h=0;d=d.replace(/%00/g,"\u0000");d=d.split(/\t/g);for(var g=0;g<d.length;g++){var f=d[g].substring(1);switch(d[g].charAt(0)){case "+":try{b[a++]=[1,decodeURI(f)]}catch(i){throw new Error("Illegal escape in diff_fromDelta: "+
f);}break;case "-":case "=":var j=parseInt(f,10);if(isNaN(j)||j<0)throw new Error("Invalid number in diff_fromDelta: "+f);f=e.substring(h,h+=j);if(d[g].charAt(0)=="=")b[a++]=[0,f];else b[a++]=[-1,f];break;default:if(d[g])throw new Error("Invalid diff operation in diff_fromDelta: "+d[g]);}}if(h!=e.length)throw new Error("Delta length ("+h+") does not equal source text length ("+e.length+").");return b};m.prototype.match_main=function(e,d,b){b=Math.max(0,Math.min(b,e.length));return e==d?0:e.length?
e.substring(b,b+d.length)==d?b:this.match_bitap(e,d,b):-1};m.prototype.match_bitap=function(e,d,b){function a(s,v){s=s/d.length;v=Math.abs(b-v);if(!g.Match_Distance)return v?1:s;return s+v/g.Match_Distance}if(d.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var h=this.match_alphabet(d),g=this,f=this.Match_Threshold,i=e.indexOf(d,b);if(i!=-1)f=Math.min(a(0,i),f);i=e.lastIndexOf(d,b+d.length);if(i!=-1)f=Math.min(a(0,i),f);var j=1<<d.length-1;i=-1;for(var k,r,p=d.length+
e.length,u,t=0;t<d.length;t++){k=0;for(r=p;k<r;){if(a(t,b+r)<=f)k=r;else p=r;r=Math.floor((p-k)/2+k)}p=r;k=Math.max(1,b-r+1);var w=Math.min(b+r,e.length)+d.length;r=Array(w+2);r[w+1]=(1<<t)-1;for(w=w;w>=k;w--){var o=h[e.charAt(w-1)];r[w]=t===0?(r[w+1]<<1|1)&o:(r[w+1]<<1|1)&o|(u[w+1]|u[w])<<1|1|u[w+1];if(r[w]&j){o=a(t,w-1);if(o<=f){f=o;i=w-1;if(i>b)k=Math.max(1,2*b-i);else break}}}if(a(t+1,b)>f)break;u=r}return i};m.prototype.match_alphabet=function(e){for(var d={},b=0;b<e.length;b++)d[e.charAt(b)]=
0;for(b=0;b<e.length;b++)d[e.charAt(b)]|=1<<e.length-b-1;return d};m.prototype.patch_addContext=function(e,d){for(var b=d.substring(e.start2,e.start2+e.length1),a=0;d.indexOf(b)!=d.lastIndexOf(b)&&b.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;){a+=this.Patch_Margin;b=d.substring(e.start2-a,e.start2+e.length1+a)}a+=this.Patch_Margin;(b=d.substring(e.start2-a,e.start2))&&e.diffs.unshift([0,b]);(d=d.substring(e.start2+e.length1,e.start2+e.length1+a))&&e.diffs.push([0,d]);e.start1-=
b.length;e.start2-=b.length;e.length1+=b.length+d.length;e.length2+=b.length+d.length};m.prototype.patch_make=function(e,d,b){var a;if(typeof e=="string"&&typeof d=="string"&&typeof b=="undefined"){a=e;d=this.diff_main(a,d,true);if(d.length>2){this.diff_cleanupSemantic(d);this.diff_cleanupEfficiency(d)}}else if(typeof e=="object"&&typeof d=="undefined"&&typeof b=="undefined"){d=e;a=this.diff_text1(d)}else if(typeof e=="string"&&typeof d=="object"&&typeof b=="undefined"){a=e;d=d}else if(typeof e==
"string"&&typeof d=="string"&&typeof b=="object"){a=e;d=b}else throw new Error("Unknown call format to patch_make.");if(d.length===0)return[];b=[];e=new l;var h=0,g=0,f=0,i=a;a=a;for(var j=0;j<d.length;j++){var k=d[j][0],r=d[j][1];if(!h&&k!==0){e.start1=g;e.start2=f}switch(k){case 1:e.diffs[h++]=d[j];e.length2+=r.length;a=a.substring(0,f)+r+a.substring(f);break;case -1:e.length1+=r.length;e.diffs[h++]=d[j];a=a.substring(0,f)+a.substring(f+r.length);break;case 0:if(r.length<=2*this.Patch_Margin&&h&&
d.length!=j+1){e.diffs[h++]=d[j];e.length1+=r.length;e.length2+=r.length}else if(r.length>=2*this.Patch_Margin)if(h){this.patch_addContext(e,i);b.push(e);e=new l;h=0;i=a;g=f}break}if(k!==1)g+=r.length;if(k!==-1)f+=r.length}if(h){this.patch_addContext(e,i);b.push(e)}return b};m.prototype.patch_deepCopy=function(e){for(var d=[],b=0;b<e.length;b++){var a=e[b],h=new l;h.diffs=[];for(var g=0;g<a.diffs.length;g++)h.diffs[g]=a.diffs[g].slice();h.start1=a.start1;h.start2=a.start2;h.length1=a.length1;h.length2=
a.length2;d[b]=h}return d};m.prototype.patch_apply=function(e,d){if(e.length==0)return[d,[]];e=this.patch_deepCopy(e);var b=this.patch_addPadding(e);d=b+d+b;this.patch_splitMax(e);for(var a=0,h=[],g=0;g<e.length;g++){var f=e[g].start2+a,i=this.diff_text1(e[g].diffs),j,k=-1;if(i.length>this.Match_MaxBits){j=this.match_main(d,i.substring(0,this.Match_MaxBits),f);if(j!=-1){k=this.match_main(d,i.substring(i.length-this.Match_MaxBits),f+i.length-this.Match_MaxBits);if(k==-1||j>=k)j=-1}}else j=this.match_main(d,
i,f);if(j==-1)h[g]=false;else{h[g]=true;a=j-f;f=k==-1?d.substring(j,j+i.length):d.substring(j,k+this.Match_MaxBits);if(i==f)d=d.substring(0,j)+this.diff_text2(e[g].diffs)+d.substring(j+i.length);else{f=this.diff_main(i,f,false);if(i.length>this.Match_MaxBits&&this.diff_levenshtein(f)/i.length>this.Patch_DeleteThreshold)h[g]=false;else{this.diff_cleanupSemanticLossless(f);i=0;var r;for(k=0;k<e[g].diffs.length;k++){var p=e[g].diffs[k];if(p[0]!==0)r=this.diff_xIndex(f,i);if(p[0]===1)d=d.substring(0,
j+r)+p[1]+d.substring(j+r);else if(p[0]===-1)d=d.substring(0,j+r)+d.substring(j+this.diff_xIndex(f,i+p[1].length));if(p[0]!==-1)i+=p[1].length}}}}}d=d.substring(b.length,d.length-b.length);return[d,h]};m.prototype.patch_addPadding=function(e){for(var d="",b=1;b<=this.Patch_Margin;b++)d+=String.fromCharCode(b);for(b=0;b<e.length;b++){e[b].start1+=d.length;e[b].start2+=d.length}b=e[0];var a=b.diffs;if(a.length==0||a[0][0]!=0){a.unshift([0,d]);b.start1-=d.length;b.start2-=d.length;b.length1+=d.length;
b.length2+=d.length}else if(d.length>a[0][1].length){var h=d.length-a[0][1].length;a[0][1]=d.substring(a[0][1].length)+a[0][1];b.start1-=h;b.start2-=h;b.length1+=h;b.length2+=h}b=e[e.length-1];a=b.diffs;if(a.length==0||a[a.length-1][0]!=0){a.push([0,d]);b.length1+=d.length;b.length2+=d.length}else if(d.length>a[a.length-1][1].length){h=d.length-a[a.length-1][1].length;a[a.length-1][1]+=d.substring(0,h);b.length1+=h;b.length2+=h}return d};m.prototype.patch_splitMax=function(e){for(var d=0;d<e.length;d++)if(e[d].length1>
this.Match_MaxBits){var b=e[d];e.splice(d--,1);for(var a=this.Match_MaxBits,h=b.start1,g=b.start2,f="";b.diffs.length!==0;){var i=new l,j=true;i.start1=h-f.length;i.start2=g-f.length;if(f!==""){i.length1=i.length2=f.length;i.diffs.push([0,f])}for(;b.diffs.length!==0&&i.length1<a-this.Patch_Margin;){f=b.diffs[0][0];var k=b.diffs[0][1];if(f===1){i.length2+=k.length;g+=k.length;i.diffs.push(b.diffs.shift());j=false}else if(f===-1&&i.diffs.length==1&&i.diffs[0][0]==0&&k.length>2*a){i.length1+=k.length;
h+=k.length;j=false;i.diffs.push([f,k]);b.diffs.shift()}else{k=k.substring(0,a-i.length1-this.Patch_Margin);i.length1+=k.length;h+=k.length;if(f===0){i.length2+=k.length;g+=k.length}else j=false;i.diffs.push([f,k]);if(k==b.diffs[0][1])b.diffs.shift();else b.diffs[0][1]=b.diffs[0][1].substring(k.length)}}f=this.diff_text2(i.diffs);f=f.substring(f.length-this.Patch_Margin);k=this.diff_text1(b.diffs).substring(0,this.Patch_Margin);if(k!==""){i.length1+=k.length;i.length2+=k.length;if(i.diffs.length!==
0&&i.diffs[i.diffs.length-1][0]===0)i.diffs[i.diffs.length-1][1]+=k;else i.diffs.push([0,k])}j||e.splice(++d,0,i)}}};m.prototype.patch_toText=function(e){for(var d=[],b=0;b<e.length;b++)d[b]=e[b];return d.join("")};m.prototype.patch_fromText=function(e){var d=[];if(!e)return d;e=e.replace(/%00/g,"\u0000");e=e.split("\n");for(var b=0;b<e.length;){var a=e[b].match(/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/);if(!a)throw new Error("Invalid patch string: "+e[b]);var h=new l;d.push(h);h.start1=parseInt(a[1],
10);if(a[2]===""){h.start1--;h.length1=1}else if(a[2]=="0")h.length1=0;else{h.start1--;h.length1=parseInt(a[2],10)}h.start2=parseInt(a[3],10);if(a[4]===""){h.start2--;h.length2=1}else if(a[4]=="0")h.length2=0;else{h.start2--;h.length2=parseInt(a[4],10)}for(b++;b<e.length;){a=e[b].charAt(0);try{var g=decodeURI(e[b].substring(1))}catch(f){throw new Error("Illegal escape in patch_fromText: "+g);}if(a=="-")h.diffs.push([-1,g]);else if(a=="+")h.diffs.push([1,g]);else if(a==" ")h.diffs.push([0,g]);else if(a==
"@")break;else if(a!=="")throw new Error('Invalid patch mode "'+a+'" in: '+g);b++}}return d};l.prototype.toString=function(){for(var e=["@@ -"+(this.length1===0?this.start1+",0":this.length1==1?this.start1+1:this.start1+1+","+this.length1)+" +"+(this.length2===0?this.start2+",0":this.length2==1?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],d,b=0;b<this.diffs.length;b++){switch(this.diffs[b][0]){case 1:d="+";break;case -1:d="-";break;case 0:d=" ";break}e[b+1]=d+encodeURI(this.diffs[b][1])+
"\n"}return e.join("").replace(/\x00/g,"%00").replace(/%20/g," ")};n.diff_match_patch=m;n.DIFF_DELETE=-1;n.DIFF_INSERT=1;n.DIFF_EQUAL=0});bespin.tiki.register("::edit_session",{name:"edit_session",dependencies:{events:"0.0.0"}});
bespin.tiki.module("edit_session:index",function(q,n){q("bespin:promise");q("bespin:plugins");q("bespin:util/util");q("events");n.EditSession=function(){};n.EditSession.prototype={_currentView:null,currentUser:null,history:null,getCompletePath:function(m){if(m==null)m="";if(m==null||m.substring(0,1)!="/"){var l;if(this._currentView&&this._currentView.buffer)l=this._currentView.buffer;var e;if(l)e=l.file;m=e?e.parentdir()+m:"/"+m}return m}};Object.defineProperties(n.EditSession.prototype,{currentView:{set:function(m){if(m!==
this._currentView)this._currentView=m},get:function(){return this._currentView}}});n.createSession=function(m,l){var e=new n.EditSession;if(m)e.currentView=m.textView;if(l)e.currentUser=l;return e}});bespin.tiki.register("::syntax_manager",{name:"syntax_manager",dependencies:{worker_manager:"0.0.0",events:"0.0.0",underscore:"0.0.0",syntax_directory:"0.0.0"}});
bespin.tiki.module("syntax_manager:index",function(q,n){function m(f,i,j,k){for(;f.length<i;)f.push(b(k).clone());i=[i,j.length].concat(j);Array.prototype.splice.apply(f,i);return f}function l(){this._lines=[];this._syms={}}function e(f,i){this._syntaxInfo=f;this._syntaxManager=i;this._invalidRow=0;this._states=[];this._active=false;this.symbols=new l}function d(f){this.layoutManager=f;this.attrsChanged=new a;this.syntaxChanged=new a;this._contextRanges=this._invalidRows=this._context=null;this._attrs=
[];this._symbols=new l;this._syntax="plain";this._reset()}var b=q("underscore")._,a=q("events").Event,h=q("worker_manager").WorkerSupervisor;q("bespin:console");q("rangeutils:utils/range");var g=q("syntax_directory").syntaxDirectory;l.prototype={get:function(f){return this._syms["-"+f]},replaceLine:function(f,i){function j(p){return p.substring(1)}var k=this._lines,r=this._syms;f<k.length&&b(k[f]).isArray()&&b(k[f]).each(function(p){delete r["-"+p]});k[f]=b(i).keys().map(j);b(r).extend(i)}};e.prototype=
{_annotate:function(){if(this._invalidRow==null)throw new Error("syntax_manager.Context: attempt to annotate without any invalid row");if(!this._active)throw new Error("syntax_manager.Context: attempt to annotate while inactive");if(this._worker==null)this._createWorker();else{var f=this._syntaxManager.getTextLines(),i=this._invalidRow,j=i===0?this.getName()+":start":this._states[i],k=Math.min(f.length,i+100);f=f.slice(i,k);var r={start:{row:i,col:0},end:{row:k-1,col:b(f).last().length}};this._worker.send("annotate",
[j,f,r]).then(b(this._annotationFinished).bind(this,i,k))}},_annotationFinished:function(f,i,j){if(this._active){var k=this._syntaxManager;k.mergeAttrs(f,j.attrs);k.mergeSymbols(f,j.symbols);m(this._states,f,j.states);if(i>=this._getRowCount()){this._invalidRow=null;this._active=false}else{this._invalidRow=i;this._annotate()}}},_createWorker:function(){if(this._syntaxInfo==null)return false;var f=new h("syntax_worker#syntaxWorker");this._worker=f;f.started.add(this._workerStarted.bind(this));f.start();
return true},_getRowCount:function(){return this._syntaxManager.getTextLines().length},_workerStarted:function(){this._worker.send("loadSyntax",[this._syntaxInfo.name]);this._active&&this._annotate()},activateAndAnnotate:function(){this._active=true;this._annotate()},contextsAtPosition:function(){var f=this._syntaxInfo;if(f==null)return["plain"];return[f.name]},cut:function(f){var i=this._getRowCount();if(f<0||f>=i)throw new Error("Attempt to cut the context at an invalid row");if(!(this._invalidRow!=
null&&this._invalidRow<f)){this._invalidRow=f;this._active=false}},getName:function(){return this._syntaxInfo.name},kill:function(){var f=this._worker;if(f!=null){f.kill();this._worker=null}}};d.prototype={_getTextStorage:function(){return this.layoutManager.textStorage},_reset:function(){var f=this._context;if(f!=null){f.kill();this._context=null}f=this._syntax;f=f==="plain"?null:g.get(f);this._context=f=new e(f,this);f.activateAndAnnotate()},attrsChanged:null,syntaxChanged:null,contextsAtPosition:function(f){return this._context.contextsAtPosition(f)},
getAttrsForRows:function(f,i){return this._attrs.slice(f,i)},getSymbol:function(f){return this._symbols.get(f)},getSyntax:function(){return this._syntax},getTextLines:function(){return this._getTextStorage().lines},invalidateRow:function(f){var i=this._context;i.cut(f);i.activateAndAnnotate()},mergeAttrs:function(f,i){m(this._attrs,f,i,[]);this.attrsChanged(f,f+i.length)},mergeSymbols:function(f,i){var j=this._symbols;b(i).each(function(k,r){j.replaceLine(f+r,k)})},setSyntax:function(f){this._syntax=
g.hasSyntax(f)?f:"plain";this.syntaxChanged(f);this._reset()},setSyntaxFromFileExt:function(f){return this.setSyntax(g.syntaxForFileExt(f))}};n.SyntaxManager=d});bespin.tiki.register("::completion",{name:"completion",dependencies:{jquery:"0.0.0",ctags:"0.0.0",rangeutils:"0.0.0",canon:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("completion:controller",function(q,n){function m(g){this._editorView=g;g.selectionChanged.add(this._selectionChanged.bind(this));g.willChangeBuffer.add(this._willChangeBuffer.bind(this));this._syntaxChanged=this._syntaxChanged.bind(this);this.tags=new e.Tags;this.ui=new b(g.element)}function l(g){return function(){return h.editor.completionController[g](h)}}var e=q("ctags"),d=q("rangeutils:utils/range"),b=q("completion:ui").CompletionUI,a=q("bespin:plugins").catalog,h=q("environment").env;
m.prototype={_buffer:null,_completionEngine:null,_completions:null,_stem:null,_hideCompletions:function(){this.ui.hide()},_selectionChanged:function(g){var f=this._completionEngine;if(!(f==null||!d.isZeroLength(g))){var i=this._buffer.layoutManager,j=i.syntaxManager,k=g.start;g=k.col;k=i.textStorage.lines[k.row];i=k.substring(0,g);g=k.substring(g);f=f.getCompletions(i,g,j);if(f==null)this._hideCompletions();else{j=f.tags;this._stem=f.stem;this._showCompletions(j)}}},_showCompletions:function(g){var f=
this._editorView,i=f.textView.getInsertionPointPosition();i=f.convertTextViewPoint(i);this.ui.show(g,i,f.layoutManager.fontDimension.lineHeight)},_syntaxChanged:function(g){g=a.getExtensionByKey("completion",g);if(g==null)this._completionEngine=null;else g.load().then(function(f){this._completionEngine=new f(this.tags)}.bind(this))},_willChangeBuffer:function(g){var f=this._buffer;f!=null&&f.layoutManager.syntaxManager.syntaxChanged.remove(this._syntaxChanged);g.layoutManager.syntaxManager.syntaxChanged.add(this._syntaxChanged);
this._buffer=g},cancel:function(){this.ui.hide()},complete:function(g){var f=this.ui,i=f.getCompletion().name;g.view.insertText(i.substring(this._stem.length));f.hide()},isCompleting:function(){return this.ui.visible},moveDown:function(){this.ui.move("down")},moveUp:function(){this.ui.move("up")},tags:null};n.CompletionController=m;n.completeCommand=l("complete");n.completeCancelCommand=l("cancel");n.completeDownCommand=l("moveDown");n.completeUpCommand=l("moveUp")});
bespin.tiki.module("completion:ui",function(q,n){function m(h){var g=e.uniqueId("bespin-completion-panel"),f=document.createElement("div");f.id=g;f.className="bespin-completion-panel";f.style.display="none";f.innerHTML='<div class="bespin-completion-pointer"></div><div class="bespin-completion-bubble-outer"><div class="bespin-completion-bubble-inner"><div class="bespin-completion-highlight"></div><ul></ul></div></div>';l(h).append(f);this.panel=l(f);this.parent=l(h)}var l=q("jquery").$,e=q("underscore")._,
d=e.template('<span class="bespin-completion-container"> &mdash; <%= container %></span>'),b=e.template('<div class="bespin-completion-second-row"><%= type %></div>'),a=e.template('<li><div class="bespin-completion-top-row"><span class="bespin-completion-kind bespin-completion-kind-<%= kind %>"><%= kind %></span><span class="bespin-completion-ident"><%= ident %></span><%= container %></div><%= second_row %></li>');m.prototype={_fromBottom:false,_index:0,_tags:null,_getHighlightDimensions:function(h){var g=
h.position(),f=h.outerHeight()-2;h=h.outerWidth()-2;return{left:g.left,top:g.top,height:f,width:h}},_listItemForIndex:function(h){return this.panel.find("li:eq("+h+")")},_populate:function(){var h=e(this._tags).map(function(g){var f=g["class"],i=g.module,j=g.namespace;f=f!=null?f:j!=null?j:"";if(i!=null)f=i+(f!=""?"#"+f:"");i=f==""?"":d({container:f});f=g.type;f=f==null?"":b({type:f});return a({kind:g.kind,ident:g.name,container:i,second_row:f})});this.panel.find("ul").html(h.join("\n"))},panel:null,
visible:false,getCompletion:function(){return this.visible?this._tags[this._index]:null},hide:function(){if(this.visible){this.panel.fadeOut(100);this.visible=false}},move:function(h){var g=this._index,f=this._listItemForIndex(g),i=h==="up"?f.prev():f.next();if(i.length!==0){this._index=g=h==="up"?g-1:g+1;g=l(f).find(".bespin-completion-top-row");var j=l(f).find(".bespin-completion-second-row");f=l(i).find(".bespin-completion-top-row");var k=l(i).find(".bespin-completion-second-row");j.hide();k.show();
var r=this.panel.find(".bespin-completion-highlight");r.stop(true,true);i=this._getHighlightDimensions(i);r.animate(i,100);k.hide();if(h==="down"){h=j.height();f.css("top",h);f.animate({top:0},100)}else{h=k.height();g.css("top",-h);g.animate({top:0},100)}k.fadeIn()}},show:function(h,g,f){this._tags=h=e(h).clone();this._populate();var i=this.visible,j=this.panel;j.stop(true,true);i||j.show();var k=this.parent.offset(),r=k.left,p=r+g.x,u=k.top+g.y;k=j.outerWidth();var t=j.outerHeight(),w=l(window).width(),
o=l(window).height();this._fromBottom=u=u+t+f>o;if(this._index>=h.length)this._index=h.length-1;if(u){u=j.find(".bespin-completion-pointer");u.removeClass("bespin-completion-pointer-up");u.addClass("bespin-completion-pointer-down");j.css({bottom:-g.y,top:""});this._tags.reverse();this._populate();if(!i)this._index=h.length-1}else{u=j.find(".bespin-completion-pointer");u.removeClass("bespin-completion-pointer-down");u.addClass("bespin-completion-pointer-up");j.css({top:g.y+f,bottom:""});if(!i)this._index=
0}if(!i){if(p+g.x+k>w){u.css({left:"",right:32});j.css("left",Math.min(w-k-r,g.x-k+43))}else{u.css({left:32,right:""});j.css("left",Math.max(r,g.x-43))}j.hide().animate({opacity:"show"},100)}h=j.find(".bespin-completion-highlight");h.stop(true,true);g=this._listItemForIndex(this._index);g.find(".bespin-completion-second-row").show();g=this._getHighlightDimensions(g);h.css(g);this.visible=true}};n.CompletionUI=m});bespin.tiki.module("completion:index",function(){});
bespin.tiki.register("::rangeutils",{name:"rangeutils",dependencies:{}});
bespin.tiki.module("rangeutils:utils/range",function(q,n){var m=q("bespin:util/util");n.addPositions=function(l,e){return{row:l.row+e.row,col:l.col+e.col}};n.cloneRange=function(l){var e=l.start;l=l.end;return{start:{row:e.row,col:e.col},end:{row:l.row,col:l.col}}};n.comparePositions=function(l,e){var d=l.row-e.row;return d===0?l.col-e.col:d};n.equal=function(l,e){return n.comparePositions(l.start,e.start)===0&&n.comparePositions(l.end,e.end)===0};n.extendRange=function(l,e){var d=l.end;return{start:l.start,
end:{row:d.row+e.row,col:d.col+e.col}}};n.intersectRangeSets=function(l,e){l=m.clone(l);e=m.clone(e);for(var d=[];l.length>0&&e.length>0;){var b=l.shift(),a=e.shift(),h=n.comparePositions(b.start,a.start),g=n.comparePositions(b.end,a.end);if(n.comparePositions(b.end,a.start)<0){d.push(b);e.unshift(a)}else if(n.comparePositions(a.end,b.start)<0){d.push(a);l.unshift(b)}else if(h<0){d.push({start:b.start,end:a.start});l.unshift({start:a.start,end:b.end});e.unshift(a)}else if(h===0)if(g<0)e.unshift({start:b.end,
end:a.end});else g>0&&l.unshift({start:a.end,end:b.end});else if(h>0){d.push({start:a.start,end:b.start});l.unshift(b);e.unshift({start:b.start,end:a.end})}}return d.concat(l,e)};n.isZeroLength=function(l){return l.start.row===l.end.row&&l.start.col===l.end.col};n.maxPosition=function(l,e){return n.comparePositions(l,e)>0?l:e};n.normalizeRange=function(l){return this.comparePositions(l.start,l.end)<0?l:{start:l.end,end:l.start}};n.rangeSetBoundaries=function(l){return{start:l[0].start,end:l[l.length-
1].end}};n.toString=function(l){var e=l.start;l=l.end;return"[ "+e.row+", "+e.col+" "+l.row+","+ +l.col+" ]"};n.unionRanges=function(l,e){return{start:l.start.row<e.start.row||l.start.row===e.start.row&&l.start.col<e.start.col?l.start:e.start,end:l.end.row>e.end.row||l.end.row===e.end.row&&l.end.col>e.end.col?l.end:e.end}};n.isPosition=function(l){return!m.none(l)&&!m.none(l.row)&&!m.none(l.col)};n.isRange=function(l){return!m.none(l)&&n.isPosition(l.start)&&n.isPosition(l.end)}});
bespin.tiki.module("rangeutils:index",function(){});bespin.tiki.register("::undomanager",{name:"undomanager",dependencies:{}});
bespin.tiki.module("undomanager:index",function(q,n){var m=q("bespin:util/util");q("environment");n.UndoManager=function(){};m.mixin(n.UndoManager.prototype,{_redoStack:[],_undoStack:[],_undoOrRedo:function(l,e,d){if(e.length===0)return false;e=e.pop();if(!e.target[l](e.context)){this._redoStack=[];this._undoStack=[];return false}d.push(e);return true},redo:function(){return this._undoOrRedo("redo",this._redoStack,this._undoStack)},registerUndo:function(l,e){this._redoStack=[];this._undoStack.push({target:l,
context:e})},undo:function(){return this._undoOrRedo("undo",this._undoStack,this._redoStack)}});n.global=new n.UndoManager;n.undoManagerCommand=function(l,e){n.global[e.commandExt.name]()}});bespin.tiki.register("::command_line",{name:"command_line",dependencies:{templater:"0.0.0",settings:"0.0.0",matcher:"0.0.0",theme_manager_base:"0.0.0",canon:"0.0.0",keyboard:"0.0.0",diff:"0.0.0",types:"0.0.0"}});
bespin.tiki.module("command_line:commands/basic",function(q,n){var m=q("bespin:index"),l=q("bespin:util/util");q("environment");n.evalCommand=function(d,b){var a;d=d.javascript;try{a=eval(d)}catch(h){a="<b>Error: "+h.message+"</b>"}var g="",f="",i;if(l.isFunction(a)){g=(a+"").replace(/\n/g,"<br>").replace(/ /g,"&#160");f="function"}else if(l.isObject(a)){f=Array.isArray(a)?"array":"object";var j=[],k;for(i in a)if(a.hasOwnProperty(i)){k=l.isFunction(a[i])?"[function]":l.isObject(a[i])?"[object]":
a[i];j.push({name:i,value:k})}j.sort(function(r,p){return r.name.toLowerCase()<p.name.toLowerCase()?-1:1});for(i=0;i<j.length;i++)g+="<b>"+j[i].name+"</b>: "+j[i].value+"<br>"}else{g=a;f=typeof a}b.done('Result for eval <b>"'+d+'"</b> (type: '+f+"): <br><br>"+g)};n.versionCommand=function(d,b){b.done("Bespin "+m.versionNumber+" ("+m.versionCodename+")")};var e=["really wants you to trick it out in some way.","is your Web editor.","would love to be like Emacs on the Web.","is written on the Web platform, so you can tweak it."];
n.bespinCommand=function(d,b){d=Math.floor(Math.random()*e.length);b.done("Bespin "+e[d])}});
bespin.tiki.module("command_line:commands/history",function(q,n){q("bespin:plugins");var m=q("canon:history"),l=q("environment").env,e=0;n.historyPreviousCommand=function(){e>0&&e--;l.commandLine.setInput(m.requests[e].typed)};n.historyNextCommand=function(){e<m.requests.length&&e++;l.commandLine.setInput(e===m.requests.length?"":m.requests[e].typed)};n.historyCommand=function(d,b){var a=[];a.push("<table>");var h=1;m.requests.forEach(function(g){a.push("<tr>");a.push("<th>"+h+"</th>");a.push("<td>"+
g.typed+"</td>");a.push("</tr>");h++});a.push("</table>");b.done(a.join(""))};n.addedRequestOutput=function(){e=m.requests.length}});
bespin.tiki.module("command_line:commands/simple",function(q,n){var m=q("bespin:plugins").catalog,l=q("bespin:console").console,e=q("environment").env;n.completeCommand=function(){e.commandLine.complete()};var d=function(a,h){var g=[],f=m.getExtensionByKey("command",a);if(f&&f.pointer)g.push(f.description);else{var i=false;!a&&h&&h.prefix&&g.push(h.prefix);if(f){g.push("<h2>Sub-Commands of "+f.name+"</h2>");g.push("<p>"+f.description+"</p>")}else if(a){if(a=="hidden"){a="";i=true}g.push("<h2>Commands starting with '"+
a+"':</h2>")}else g.push("<h2>Available Commands:</h2>");var j=[];m.getExtensions("command").forEach(function(p){j.push(p.name)});var k=j.sort();g.push("<table>");for(var r=0;r<k.length;r++)if(f=m.getExtensionByKey("command",k[r])){if(!(!i&&f.hidden))if(f.description!==undefined)if(!(a&&f.name.indexOf(a)!==0))if(!(!a&&f.name.indexOf(" ")!=-1))if(!(f&&f.name==a)){g.push("<tr>");g.push('<th class="right">'+f.name+"</th>");g.push("<td>"+f.description+"</td>");g.push("</tr>")}}else l.error("Huh? command ",
f.name," cannot be looked up by name");g.push("</table>");!a&&h&&h.suffix&&g.push(h.suffix)}return g.join("")};n.helpCommand=function(a,h){a=d(a.search,{prefix:"<h2>Welcome to Bespin - Code in the Cloud</h2><ul><li><a href='http://labs.mozilla.com/projects/bespin' target='_blank'>Home Page</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin' target='_blank'>Wiki</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/UserGuide' target='_blank'>User Guide</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/Tips' target='_blank'>Tips and Tricks</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/FAQ' target='_blank'>FAQ</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/DeveloperGuide' target='_blank'>Developers Guide</a></li></ul>",
suffix:"For more information, see the <a href='https://wiki.mozilla.org/Labs/Bespin'>Bespin Wiki</a>."});h.done(a)};var b={aliases:[],commands:[]};n.aliasCommand=function(a,h){var g=b.aliases;if(a.alias)if(a.command===undefined)g[a.alias]?h.done(a.alias+" &#x2192; "+g[a.alias]):h.done("No alias set for '"+a.alias+"'");else{var f=a.alias;a=a.command;var i=a.split(" ")[0];if(b.commands[f])h.done("There is already a command with the name: "+f);else if(b.commands[i]){g[f]=a;h.done("Saving alias: "+f+
" &#x2192; "+a)}else if(g[i]){g[f]=a;h.done("Saving alias: "+f+" &#x2192; "+g[a]+" ("+a+" was an alias itself)")}else h.done("No command or alias with that name.")}else{a="<table>";for(f in g)if(g.hasOwnProperty(f))a+='<tr><td style="text-align:right;">'+f+"</td><td>&#x2192;</td><td>"+g[f]+"</td></tr>";a+="</table>";h.done(a)}}});bespin.tiki.module("command_line:hint",function(q,n){n.Level={Error:3,Incomplete:2,Warning:1,Info:0};n.Hint=function(m,l,e){this.level=m;this.element=l;this.completion=e}});
bespin.tiki.module("command_line:input",function(q,n){var m=q("bespin:plugins").catalog,l=q("bespin:console").console,e=q("bespin:promise").Promise,d=q("bespin:promise").group,b=q("bespin:util/stacktrace").Trace,a=q("bespin:util/util"),h=q("types:types"),g=q("canon:request").Request,f=q("canon:history"),i=q("keyboard:keyboard"),j=q("command_line:hint").Hint,k=q("command_line:hint").Level,r=q("command_line:typehint");n.Input=function(p,u){if(a.none(p))throw new Error("Input requires something 'typed' to work on");
this.typed=p;this.hints=[];this.argsPromise=new e;u=u||{};u.flags=u.flags||i.buildFlags({});this.flags=u.flags;this._parts=[];this._assignments=this._commandExt=this._unparsedArgs=undefined;try{this._tokenize()}catch(t){p=new b(t,true);l.group("Error calling command: "+this.typed);l.error(t);p.log(3);l.groupEnd();this.argsPromise.isComplete()||this.argsPromise.reject(t)}};n.Input.prototype={_tokenize:function(){if(!this.typed||this.typed===""){this.hints.push(new j(k.Incomplete));this.argsPromise.resolve({})}else{for(var p=
this.typed.replace(/^\s\s*/,"").split(/\s+/),u;;){u=p.shift();if(a.none(u))break;if(u[0]=='"'||u[0]=="'"){u=[u.substring(1,u.length)];for(var t;;){t=p.shift();if(!t)break;if(t[t.length-1]=='"'||t[t.length-1]=="'"){u.push(t.substring(0,t.length-1));break}else u.push(t)}this._parts.push(u.join(" "))}else this._parts.push(u)}this._split()}},_split:function(){this._unparsedArgs=this._parts.slice();for(var p=this._unparsedArgs.shift(),u;;){u=m.getExtensionByKey("command",p);if(!u)break;if(!i.flagsMatch(u.predicates,
this.flags)){u=null;break}if(u.pointer)break;p+=" "+this._unparsedArgs.shift()}this._commandExt=u;p=null;var t;if(this._commandExt){var w=new e;u.load().then(function(v){if(v)w.resolve(null);else{t="Failed to load command "+u.name+": Pointer "+u.pluginName+":"+u.pointer+" is null.";w.resolve(new j(k.Error,t))}},function(v){t="Failed to load command "+u.name+": Pointer "+u.pluginName+":"+u.pointer+" failed to load."+v;w.resolve(new j(k.Error,t))});this.hints.push(w);if(this._parts.length===1){var o=
this._commandExt;if(this.typed==o.name||!o.params||o.params.length===0)p=n.documentCommand(o,this.typed)}}else{var s=[];m.getExtensions("command").forEach(function(v){i.flagsMatch(v.predicates,this.flags)&&v.description&&s.push(v)}.bind(this));p={param:{type:{name:"selection",data:s},description:"Commands"},value:this.typed}}p&&this.hints.push(r.getHint(this,p));a.none(this._commandExt)?this.argsPromise.resolve({}):this._assign()},_assign:function(){this._assignments=[];var p=this._commandExt.params,
u=this._unparsedArgs,t;if(!p||p.length===0){var w=0;u.forEach(function(x){x.trim()!==""&&w++});if(w!==0){t=this._commandExt.name+" does not take any parameters";this.hints.push(new j(k.Error,t))}this.argsPromise.resolve({})}else{if(p.length==1&&p[0].type=="text")this._assignments[0]={value:u.length===0?null:u.join(" "),param:p[0]};else{var o=0,s=[];p.forEach(function(x){this._assignParam(x,o++,s)}.bind(this));var v=false;u.forEach(function(x){if(s.indexOf(x)==-1){t="Parameter '"+x+"' makes no sense.";
this.hints.push(new j(k.Error,t));v=true}}.bind(this));if(v){this.argsPromise.resolve({});return}}if(this._parts.length>1){p=this._getAssignmentForLastArg();p.param.type.assignments=this._assignments;p&&this.hints.push(r.getHint(this,p))}this._convertTypes()}},_assignParam:function(p,u,t){for(var w=0;w<this._unparsedArgs.length;w++){var o=this._unparsedArgs[w];if("--"+p.name==o){t.push(o);if(h.equals(p.type,"boolean"))this._assignments[u]={value:true,param:p};else if(w+1<this._unparsedArgs.length){p=
"Missing parameter: "+p.name;this.hints.push(new j(k.Incomplete,p))}else t.push(this._unparsedArgs[w+1]);return}}w=null;if(this._unparsedArgs.length>u){w=this._unparsedArgs[u];t.push(this._unparsedArgs[u])}if(w!==undefined)this._assignments[u]={value:w,param:p};else{this._assignments[u]={param:p};if(p.defaultValue===undefined){p="Missing parameter: "+p.name;this.hints.push(new j(k.Incomplete,p))}}},_getAssignmentForLastArg:function(){var p=null;this._assignments.forEach(function(u){if(!p||!a.none(u.value))p=
u});return p},_convertTypes:function(){if(this._commandExt.params){var p={},u=[];this._assignments.forEach(function(t){t.param.type.assignments=this._assignments;var w=this._convertType(t,p);w.then(function(o){t.converted=o;p[t.param.name]=o},function(o){this.hints.push(new j(k.Error,"Can't convert '"+t.value+"' to a "+param.type+": "+o))}.bind(this));u.push(w)}.bind(this));d(u).then(function(){this.argsPromise.resolve(p)}.bind(this))}else this.argsPromise.resolve({})},_convertType:function(p){return p.value!==
null?h.fromString(p.value,p.param.type):(new e).resolve(p.param.defaultValue)},execute:function(){var p=function(u){var t=new b(u,true);l.group("Error executing: "+this.typed);l.error(u);t.log(3);l.groupEnd()}.bind(this);this.argsPromise.then(function(u){this._commandExt.load().then(function(t){t=new g({command:t,commandExt:this._commandExt,typed:this.typed,args:u});f.execute(u,t)}.bind(this),p)}.bind(this),p)}};n.documentCommand=function(p,u){var t=[];t.push("<h1>"+p.name+"</h1>");t.push("<h2>Summary</h2>");
t.push("<p>"+p.description+"</p>");if(p.manual){t.push("<h2>Description</h2>");t.push("<p>"+p.description+"</p>")}if(p.params&&p.params.length>0){t.push("<h2>Synopsis</h2>");t.push("<pre>");t.push(p.name);var w=0;p.params.forEach(function(o){if(o.defaultValue===undefined){t.push(" <i>");t.push(o.name);t.push("</i>")}else if(o.defaultValue===null){t.push(" <i>[");t.push(o.name);t.push("]</i>")}else w++});if(w>3)t.push(" [options]");else w>0&&p.params.forEach(function(o){if(o.defaultValue){t.push(" [--<i>");
t.push(o.name);h.equals(o.type,"boolean")?t.push("</i>"):t.push("</i> "+h.getSimpleName(o.type));t.push("]")}});t.push("</pre>");t.push("<h2>Parameters</h2>");p.params.forEach(function(o){t.push('<h3 class="cmd_body"><i>'+o.name+"</i></h3>");t.push("<p>"+o.description+"</p>");h.defaultValue&&t.push("<p>Default: "+h.defaultValue+"</p>")})}return{param:{type:"text",description:t.join("")},value:u}}});
bespin.tiki.module("command_line:typehint",function(q,n){function m(j){var k=document.createElement("article");k.innerHTML=j;return new f(i.Info,k)}function l(j,k,r,p,u){var t;try{if(p&&typeof u.getHint==="function")t=u.getHint(k,r,p)}catch(w){a.error("Failed to get hint for ",p," reason: ",w)}t||(t=m(r.param.description));j.resolve(t);return j}function e(j){var k=new h,r=b.getExtensionByKey("typehint",j.name);k.resolve({ext:r,typeSpec:j});return k}function d(j){if(typeof j==="string")return e({name:j});
if(typeof j==="object")if(j.name==="deferred"){var k=new h;g.undeferTypeSpec(j).then(function(r){d(r).then(function(p){k.resolve(p)},function(p){k.reject(p)})});return k}else return e(j);throw new Error("Unknown typeSpec type: "+typeof j);}var b=q("bespin:plugins").catalog,a=q("bespin:console").console,h=q("bespin:promise").Promise,g=q("types:types"),f=q("command_line:hint").Hint,i=q("command_line:hint").Level;n.getHint=function(j,k){var r=new h;d(k.param.type).then(function(p){if(!p.ext)return l(r,
j,k);p.ext.load().then(function(u){typeof u.resolveTypeSpec==="function"?u.resolveTypeSpec(p.ext,p.typeSpec).then(function(){l(r,j,k,p.ext,u)},function(t){r.reject(t)}):l(r,j,k,p.ext,u)},function(){hint=m(k.param.description);r.resolve(hint)})});return r}});
bespin.tiki.module("command_line:views/basic",function(q,n){var m=q("bespin:console").console;q("bespin:promise");var l=q("types:basic"),e=q("matcher:prefix").PrefixMatcher,d=q("command_line:views/menu").Menu,b=q("command_line:views/menu").MatcherMenu;n.selection={getHint:function(a,h,g){if(!g.data){m.error("Missing data for selection type");g.data=[]}var f=new e(h.value||"");g=g.data.map(function(i){if(typeof i==="string")return{name:i};return i});f.addItems(g);return(new b(a,h,f)).hint},resolveTypeSpec:l.selection.resolveTypeSpec};
n.bool={getHint:function(a,h){a=new d(a,h);a.addItems([{name:"true"},{name:"false"}]);return a.hint}}});
bespin.tiki.module("command_line:views/cli",function(q,n){var m=q("diff").diff_match_patch,l=q("bespin:util/util"),e=q("bespin:plugins").catalog;q("bespin:console");var d=q("keyboard:keyutil"),b=q("keyboard:keyboard").keyboardManager;q("canon:history");var a=q("environment").env,h=q("settings").settings,g=q("command_line:hint").Level,f=q("command_line:input").Input,i=q("command_line:templates"),j=q("command_line:views/requestOutput"),k=e.getResourceURL("command_line")+"images",r=new m;n.CliInputView=
function(){this._pinned=this._hasFocus=false;this._completion="";this._input=new f("");this._inputer=this._completer=this._table=this._hints=this._tog=this.element=this._lastOrientation=null;i.cli({cliInputView:this,imagePath:k});d.addKeyDownListener(this._inputer,function(u){a.commandLine=this;var t=b.processKeyEvent(u,this,{isCommandLine:true,isKeyUp:false});if(u.keyCode===d.KeyHelper.KEY.TAB)return true;return t}.bind(this));this._inputer.addEventListener("keyup",function(u){var t=b.processKeyEvent(u,
this,{isCommandLine:true,isKeyUp:true});if(u.keyCode===d.KeyHelper.KEY.RETURN){this._input.execute();this.setInput("")}else{u=this._inputer.value;if(this._input.typed!==u){this._input=new f(u);this.hintUpdated()}}return t}.bind(this),true);e.registerExtension("settingChange",{match:"[min|max]ConsoleHeight",pointer:this.checkSize.bind(this)});var p=j.createHandler(this);e.registerExtension("addedRequestOutput",p)};n.CliInputView.prototype={elementAppended:function(){this.checkSize()},getOrientation:function(){var p=
this.element.className,u=/\bnorth\b/.test(p),t=/\bsouth\b/.test(p),w=/\beast\b/.test(p);p=/\bwest\b/.test(p);if(u&&!t&&!w&&!p)return"north";if(!u&&t&&!w&&!p)return"south";if(!u&&!t&&w&&!p)return"east";if(!u&&!t&&!w&&p)return"west";throw new Error("Ambiguous orientation: north="+u+", south="+t+", east="+w+", west="+p);},checkSize:function(){var p=this.getOrientation();if(p==="north"||p==="south"){p=h.get("minConsoleHeight");if(this._pinned||this._hasFocus)p=h.get("maxConsoleHeight");this._table.style.height=
p+"px";this._tog.style.height=p+"px";this.element.style.height=p+26+"px";e.publish(this,"dimensionsChanged")}},complete:function(){if(this._completion)this._inputer.value=this._completion},setInput:function(p){p=p||"";this._inputer.value=p;this._input=new f(p);this.hintUpdated();this.focus()},focus:function(){this._inputer.focus()},execute:function(p){a.commandLine=this;(new f(p)).execute()},prompt:function(p){this._inputer.value=p},hintUpdated:function(){for(var p=this._input.hints;this._hints.firstChild;)this._hints.removeChild(this._hints.firstChild);
var u=g.Info;this.setCompletion("");var t=function(w,o){if(o)if(o.isPromise)o.then(function(x){t(w,x)}.bind(this));else{if(o.element)if(o.element.addEventListener)w.appendChild(o.element);else{var s=document.createElement("article"),v=o.element.toString();s.appendChild(document.createTextNode(v));w.appendChild(s)}this.setCompletion(o.completion);if(o.level>u)u=o.level;l.setClass(this._inputer,"cmd_error",u==g.Error)}}.bind(this);p.forEach(function(w){t(this._hints,w)}.bind(this));l.setClass(this._inputer,
"cmd_error",u==g.Error)},scrollToBottom:function(){this._table.scrollTop=Math.max(this._table.scrollHeight,this._table.clientHeight)-this._table.clientHeight},_focusCheck:function(p){this._hasFocus=p.type=="focus";this._delayedCheckSize()},_delayedCheckSize:function(){if(this._checkSizeTimeout){window.clearTimeout(this._checkSizeTimeout);this._checkSizeTimeout=null}this._checkSizeTimeout=window.setTimeout(function(){this.checkSize()}.bind(this),100)},_togglePin:function(p){if(/\bchecked\b/.test(p.target.className)){l.removeClass(p.target,
"checked");this._pinned=false}else{l.addClass(p.target,"checked");this._pinned=true}this._delayedCheckSize()},setCompletion:function(p){this._completion=p||"";var u=this._inputer.value;if(p)if(p.indexOf(u)===0)u='<span class="cmd_existing">'+u+"</span>"+p.substring(u.length);else{var t=r.diff_commonPrefix(u,p);p=p.substring(t);u='<span class="cmd_existing">'+u+'</span><span class="cmd_extension">'+p+"</span>"}else u="";this._completer.innerHTML=u}}});
bespin.tiki.module("command_line:views/menu",function(q,n){var m=q("command_line:hint").Hint,l=q("command_line:hint").Level,e=q("environment").env,d;n.activateItemAction=function(a,h){a=parseInt(h.commandExt.key.replace(/[A-Za-z_]/g,""),10);d&&d._itemActions[a]()};var b=function(a,h){for(var g=0;;){if(a.charAt(g).toLocaleLowerCase()!==h.charAt(g).toLocaleLowerCase())return g;if(g>=a.length||g>=h.length)return g;g++}};n.Menu=function(a,h){if(a!=="subclassPrototype"){this.input=a;this.assignment=h;
this._parent=document.createElement("div");this._parent.setAttribute("class","cmd_menu");this._notFound=document.createElement("div");this._notFound.setAttribute("class","cmd_error");this._notFound.innerHTML="No matches for '"+this.input.typed+"'";this._parent.appendChild(this._notFound);this._list=document.createElement("ul");this._parent.appendChild(this._list);this._items=[];this._commonPrefix=null;this._itemActions=[];this._prefix=this.input.typed.substring(0,this.input.typed.length-(this.assignment.value?
this.assignment.value.length:0));this.hint=new m(l.Incomplete,this._parent);d=this}};n.Menu.prototype.addItems=function(a){var h=1,g;a.forEach(function(f){if(this._items.length<10){var i=document.createElement("li");i.appendChild(document.createTextNode(f.name));if(f.description||f.path){var j=document.createElement("dfn");j.appendChild(document.createTextNode(f.description||f.path));i.appendChild(j)}this._itemActions[h]=function(){var k=this._prefix+this._getFullName(f);e.commandLine.setInput(k)}.bind(this);
if(h<11){j=document.createElement("abbr");j.innerHTML="ALT-"+"-1234567890"[h];if(h===1)g=j;i.appendChild(j);h++}this._list.appendChild(i);i.addEventListener("mousedown",function(k){var r=this._prefix+this._getFullName(f);e.commandLine.setInput(r);k.preventDefault()}.bind(this),false)}this._items.length===0&&this._parent.removeChild(this._notFound);this._items.push(f)}.bind(this));a=this._getBestCompletion();this.hint.completion=a.completion;if(a.isFirst&&g)g.innerHTML="TAB"};n.Menu.prototype._getBestCompletion=
function(){if(this._items.length===0)return{completion:undefined,isFirst:false};var a=this._items.length===1,h=this._getFullName(this._items[0]);this._items.length>1&&this._items.forEach(function(i){if(h.length>0){i=this._getFullName(i);i=b(h,i);if(i<h.length)h=h.substring(0,i)}}.bind(this));if(!h||h.length===0){h=this._getFullName(this._items[0]);a=true}var g=this.input.typed.substring(0,this.input.typed.length-(this.assignment.value?this.assignment.value.length:0)),f=g+h;if(f.indexOf(this.input.typed)!=
0||f===this.input.typed){f=g+this._getFullName(this._items[0]);a=true}return{completion:f,isFirst:a}};n.Menu.prototype._getFullName=function(a){return(a.path||"")+a.name};n.MatcherMenu=function(a,h,g,f){n.Menu.call(this,a,h);this.matcher=g;this.loaded=f;this.matcher.addListener({itemsAdded:function(i){this.addItems(i)}.bind(this),itemsCleared:function(){this.clearItems()}.bind(this)});if(this.loaded){this.loaded.then(function(){this._isLoaded=true}.bind(this));this._isLoaded=false}else this._isLoaded=
true};n.MatcherMenu.prototype=new n.Menu("subclassPrototype")});
bespin.tiki.module("command_line:views/requestOutput",function(q,n){var m=q("bespin:util/util"),l=q("bespin:plugins").catalog;q("bespin:console");var e=q("environment").env,d=q("command_line:templates"),b=l.getResourceURL("command_line")+"images";n.RequestOutput=function(a,h){this.request=a;this.cliInputView=h;this.throb=this.typed=this.duration=this.show=this.hide=this.output=this.rowout=this.rowin=null;d.requestOutput({actions:this,imagePath:b});this.cliInputView._table.appendChild(this.rowin);
this.cliInputView._table.appendChild(this.rowout);this.request.changed.add(this.onRequestChange.bind(this))};n.RequestOutput.prototype={copyToInput:function(){this.cliInputView.setInput(this.request.typed)},executeRequest:function(){e.commandLine=this.cliInputView;this.cliInputView._input=new Input(this.request.typed);this.cliInputView._input.execute()},hideOutput:function(a){this.output.style.display="none";m.addClass(this.hide,"cmd_hidden");m.removeClass(this.show,"cmd_hidden");a.stopPropagation()},
showOutput:function(a){this.output.style.display="block";m.removeClass(this.hide,"cmd_hidden");m.addClass(this.show,"cmd_hidden");a.stopPropagation()},remove:function(a){this.cliInputView._table.removeChild(this.rowin);this.cliInputView._table.removeChild(this.rowout);a.stopPropagation()},onRequestChange:function(){this.duration.innerHTML=this.request.duration?"completed in "+this.request.duration/1E3+" sec ":"";this.typed.innerHTML=this.request.typed;this.output.innerHTML="";this.request.outputs.forEach(function(a){var h;
if(typeof a=="string"){h=document.createElement("p");h.innerHTML=a}else h=a;this.output.appendChild(h)},this);this.cliInputView.scrollToBottom();m.setClass(this.output,"cmd_error",this.request.error);this.throb.style.display=this.request.completed?"none":"block"}};n.createHandler=function(a){return{pointer:function(h,g,f){new n.RequestOutput(f,a)}}}});bespin.tiki.module("command_line:index",function(){});
bespin.tiki.module("command_line:templates",function(q,n){q("templater").compileAll({"requestOutput.htmlt":'\n<!-- The div for the input (i.e. what was typed) --\>\n<div class="cmd_rowin" save="${actions.rowin}"\n    onclick="${actions.copyToInput}"\n    ondblclick="${actions.executeRequest}">\n\n  <!-- What the user actually typed --\>\n  <div class="cmd_gt">&gt; </div>\n  <div class="cmd_typed" save="${actions.typed}"></div>\n\n  <!-- The extra details that appear on hover --\>\n  <div class="cmd_duration cmd_hover" save="${actions.duration}"></div>\n  <img class="cmd_hover" onclick="${actions.hideOutput}" save="${actions.hide}"\n      alt="Hide command output" src="${imagePath}/minus.png"/>\n  <img class="cmd_hover cmd_hidden" onclick="${actions.showOutput}" save="${actions.show}"\n      alt="Show command output" src="${imagePath}/plus.png"/>\n  <img class="cmd_hover" onclick="${actions.remove}"\n      alt="Remove this command from the history" src="${imagePath}/closer.png"/>\n\n</div>\n\n<!-- The div for the command output --\>\n<div class="cmd_rowout" save="${actions.rowout}">\n  <div class="cmd_output" save="${actions.output}"></div>\n  <img src="${imagePath}/throbber.gif" save="${actions.throb}"/>\n</div>\n',"cli.htmlt":'\n<div class="cmd_line" save="${cliInputView.element}"\n    onfocus="${cliInputView._focusCheck}" capturefocus="capturefocus"\n    onblur="${cliInputView._focusCheck}" captureblur="captureblur"\n    onclick="${cliInputView.focus}" captureclick="captureclick">\n\n  <!-- The output area that changes height --\>\n  <div class="cmd_tog stack_children" save="${cliInputView._tog}">\n\n    <div class="cmd_top">\n      <!-- Side toolbar --\>\n      <div class="cmd_toolbar">\n        <img src="${imagePath}/dot_clear.gif" class="cmd_pin check"\n            alt="Pin/Unpin the console output"\n            onclick="${cliInputView._togglePin}"/>\n      </div>\n  \n      <!-- CLI output table --\>\n      <div class="cmd_table" save="${cliInputView._table}"></div>\n    </div>\n\n    <!-- A div to hang hints on --\>\n    <div class="cmd_hints" save="${cliInputView._hints}"></div>\n\n  </div>\n\n  <!-- The input area, with fixed height --\>\n  <div class="cmd_cli">\n\n    <!-- The prompt --\>\n    <div class="cmd_prompt cmd_gt">\n      <span class="cmd_brackets">{ }</span> &gt;\n    </div>\n\n    <!-- Where you type commands --\>\n    <div class="cmd_kbd stack_children">\n      <div class="cmd_completion" save="${cliInputView._completer}"></div>\n      <div>\n        <input class="cmd_input" type="text" save="${cliInputView._inputer}"/>\n      </div>\n    </div>\n\n  </div>\n\n</div>\n'},
n)});bespin.tiki.register("::editing_commands",{name:"editing_commands",dependencies:{}});
bespin.tiki.module("editing_commands:index",function(q,n){var m=q("environment").env;n.findCommand=function(l,e){if("value"in l){var d=m.view,b=d.editor.searchController,a=d.getSelectedRange(),h="";b.setSearchText(l.value,false);if(b=b.findNext(a.end,true)){d.setSelection(b,true);d.focus()}else h+="<i>No matches found</i><br>";h+='Searching for "'+l.value+'"';e.done(h)}else m.commandLine.setInput("find ")};n.gotoCommand=function(l){if("line"in l){var e=m.view;e.moveCursorTo({row:l.line-1,col:0});
e.focus()}else m.commandLine.setInput("goto ")}});bespin.tiki.register("::environment",{name:"environment",dependencies:{settings:"0.0.0"}});
bespin.tiki.module("environment:index",function(q,n){var m=q("bespin:util/util"),l=q("bespin:console").console,e=q("bespin:plugins").catalog,d=q("settings").settings;n.Environment=function(){this.commandLine=null;window.addEventListener("resize",this.dimensionsChanged.bind(this),false)};Object.defineProperties(n.Environment.prototype,{settings:{value:{set:function(b,a){if(m.none(b))throw new Error("setSetting(): key must be supplied");if(m.none(a))throw new Error("setSetting(): value must be supplied");
d.set(b,a)},get:function(b){if(m.none(b))throw new Error("getSetting(): key must be supplied");return d.get(b)}}},dimensionsChanged:{value:function(){e.publish(this,"dimensionsChanged")}},session:{get:function(){return e.getObject("session")}},view:{get:function(){if(!this.session)return null;return this.session.currentView}},editor:{get:function(){if(!this.session)return null;return this.session.currentView.editor}},contexts:{get:function(){if(!this.view)return[];var b=this.view.editor.layoutManager.syntaxManager,
a=this.view.getSelectedRange().start;return b.contextsAtPosition(a)}},buffer:{get:function(){if(this.session)return this.view.editor.buffer;else l.error("command attempted to get buffer but there's no session")}},model:{get:function(){if(this.buffer)return this.view.editor.layoutManager.textStorage;else l.error("Session has no current buffer")}},file:{get:function(){if(this.buffer)return this.buffer.file;else l.error("Session has no current buffer")}},files:{get:function(){return e.getObject("files")}}});
n.env=new n.Environment});bespin.tiki.register("::ctags",{name:"ctags",dependencies:{traits:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("ctags:index",function(q,n){var m=q("underscore")._,l=q("./reader").TagReader;q=q("traits").Trait;n.Tags=function(){this.tags=[]};n.Tags.prototype=Object.create(Object.prototype,q.compose(q({_search:function(e,d){var b={name:e};e=this.tags;var a=m(e).sortedIndex(b,function(h){return h.name});for(a=b=a;b>=0&&b<e.length&&d(e[b]);)b--;for(;a>=0&&a<e.length&&d(e[a]);)a++;return e.slice(b+1,a)},add:function(e){var d=this.tags;Array.prototype.push.apply(d,e);d.sort(function(b,a){b=b.name;
a=a.name;if(b<a)return-1;if(b===a)return 0;return 1})},get:function(e){return this._search(e,function(d){return d.name===e})},scan:function(e,d,b){if(b===null||b===undefined)b={};var a=e.split("\n");e=parse(e,d,1);d=new Interpreter(e,d,a,b);d.interpret();this.add(d.tags)},stem:function(e){var d=e.length;return this._search(e,function(b){return b.name.substring(0,d)===e})}}),l))});
bespin.tiki.module("ctags:reader",function(q,n){var m=q("underscore")._;q=q("traits").Trait;n.TagReader=q({readLines:function(l){var e=[];m(l).each(function(d){d=d.split("\t");if(!(d.length<3)){var b=d[0];if(!/^!_TAG_/.test(b)){b={name:b,tagfile:d[1],addr:d[2]};var a;if(d.length>3&&d[3].indexOf(":")===-1){b.kind=d[3];a=4}else a=3;var h={};m(d.slice(a)).each(function(g){g=/^([^:]+):(.*)/.exec(g);h[g[1]]=g[2]});b.fields=h;e.push(b)}}});this.add(e)},readString:function(l){this.readLines(l.split("\n"))}})});
bespin.tiki.register("::templater",{name:"templater",dependencies:{}});
bespin.tiki.module("templater:index",function(q,n){function m(h,g){var f=true;if(h.attributes&&h.attributes.length)for(var i=Array.prototype.slice.call(h.attributes),j=0;j<i.length;j++){var k=i[j].value,r=i[j].name;if(r==="save"){k=e(k);d(k,g,h);h.removeAttribute(r)}else if(r==="if"){k=e(k);try{f=!!b(k,g)}catch(p){console.error("Error with '",k,"'",p);f=false}f||h.parentNode.removeChild(h);h.removeAttribute(r)}else if(r==="foreach"){k=e(k);f=false;try{b(k,g).forEach(function(w){var o=h.cloneNode(true);
h.parentNode.insertBefore(o,h);g.param=w;l(o,g);delete g.param});h.parentNode.removeChild(h)}catch(u){console.error("Error with '",k,"'",u);f=false}h.removeAttribute(r)}else if(r.substring(0,2)==="on"){k=e(k);var t=d(k,g);typeof t!=="function"&&console.error("Expected "+k+" to resolve to a function, but got ",typeof t);h.removeAttribute(r);k=h.hasAttribute("capture"+r.substring(2));h.addEventListener(r.substring(2),t,k)}else{t=k.replace(/\$\{[^}]*\}/,function(w){return b(w.slice(2,-1),g)});if(r.indexOf("_")===
0){h.removeAttribute(r);h.setAttribute(r.substring(1),t)}else if(k!==t)i[j].value=t}}f&&l(h,g);if(h.nodeType===3){k=h.textContent;k=k.replace(/\$\{([^}]*)\}/,"\uf001$$$1\uf002");f=k.split(/\uF001|\uF002/);if(f.length>1){f.forEach(function(w){if(!(!w||w==="")){if(w.charAt(0)==="$")w=b(w.slice(1),g);if(typeof w.cloneNode!=="function")w=document.createTextNode(w.toString());h.parentNode.insertBefore(w,h)}});h.parentNode.removeChild(h)}t=k.replace(/\$\{[^}]*\}/,function(w){return b(w.slice(2,-1),g)});
if(k!==t)h.textContent=t}}function l(h,g){h=Array.prototype.slice.call(h.childNodes);for(var f=0;f<h.length;f++)m(h[f],g)}function e(h){if(!h.match(/\$\{.*\}/)){console.error("Expected "+h+" to match ${...}");return h}return h.slice(2,-1)}function d(h,g,f){if(typeof h==="string")h=h.split(".");var i=g[h[0]];if(h.length===1){if(f!==undefined)g[h[0]]=f;if(typeof i==="function")return i.bind(g);return i}if(!i){console.error("Can't find path=",h," in data=",g);return null}return d(h.slice(1),i,f)}function b(h,
g){with(g)return eval(h)}function a(h){var g=h.lastIndexOf(".");return h.substring(0,g)}n.processTemplate=function(h,g){g=g||{};var f=document.createElement("div");f.innerHTML=h;m(f,g);return f};n.compile=function(h){return function(g){return n.processTemplate(h,g)}};n.compileAll=function(h,g){if("undefined"===typeof g)g={};Object.keys(h).forEach(function(f){g[a(f)]=n.compile(h[f])});return g}});bespin.tiki.register("::matcher",{name:"matcher",dependencies:{}});
bespin.tiki.module("matcher:index",function(q,n){n.Matcher=function(m){if(m!=="subclassPrototype"){this._query=m;this._scoredItems=[];this._listeners=[];this._maxScore=null}};Object.defineProperties(n.Matcher.prototype,{query:{get:function(){return this._query},set:function(m){this._query=m;var l=[];this._scoredItems.forEach(function(e){e.score=this.score(this._query,e.item);e.score>0&&l.push(e.item)},this);this._callListeners("itemsCleared");this._callListeners("itemsAdded",l)}},addItem:{value:function(m){this.addItems([m])}},
addItems:{value:function(m){var l=[],e=false;m.forEach(function(a){a={score:this.score(this._query,a),item:a};a.score>0&&l.push(a);if(a.score>this._maxScore){this._maxScore=a.score;e=true}this._scoredItems.push(a)},this);var d=false;e&&this._scoredItems.forEach(function(a){if(a.score+500<this._maxScore)d=true});m=function(a,h){return h.score-a.score};this._scoredItems.sort(m);l.sort(m);if(d){this._callListeners("itemsCleared");m=this._scoredItems}else m=l;var b=[];m.forEach(function(a){a.score+500>
this._maxScore&&b.push(a.item)}.bind(this));this._callListeners("itemsAdded",b)}},addListener:{value:function(m){this._listeners.push(m);var l=[];this._scoredItems.forEach(function(e){e.score>0&&l.push(e.item)},this);typeof m.itemsAdded==="function"&&m.itemsAdded(l)}},_callListeners:{value:function(){var m=Array.prototype.slice.call(arguments),l=m.shift();this._listeners.forEach(function(e){typeof e[l]==="function"&&e[l].apply(null,m)})}}})});
bespin.tiki.module("matcher:prefix",function(q,n){var m=q("matcher").Matcher;n.PrefixMatcher=function(l){m.call(this,l)};n.PrefixMatcher.prototype=new m("subclassPrototype");n.PrefixMatcher.prototype.score=function(l,e){var d=l.length;if(d>e.name.length)return 0;if(e.name.substring(0,d).toLowerCase()===l.toLowerCase())return 1E3-e.name.length;return 0}});
bespin.tiki.module("matcher:quick",function(q,n){var m=q("matcher").Matcher;n.QuickMatcher=function(l){m.call(this,l)};n.QuickMatcher.prototype=new m("subclassPrototype");n.QuickMatcher.prototype.score=function(l,e){l=l.toLowerCase();var d=e.name.toLowerCase();e=e.path?e.path.toLowerCase():null;if(d.substring(0,l.length)===l)return 5E3-d.length;if(e&&e.substring(0,l.length)===l)return 4E3-e.length;if(d.substring(d.length-l.length,d.length)===l)return 3E3-d.length;if(e)d=e+d;e=l.substring(0,1);for(var b=
0,a=2E3,h=0;h<d.length;h++)if(d.substring(h,h+1)===e){b++;if(b===l.length)return a;e=l.substring(b,b+1)}else b!==0&&a--;return 0}});bespin.tiki.register("::theme_manager",{name:"theme_manager",dependencies:{theme_manager_base:"0.0.0",settings:"0.0.0",events:"0.0.0",less:"0.0.0"}});
bespin.tiki.module("theme_manager:index",function(q,n){q("bespin:promise");var m=q("bespin:plugins").catalog;q("events");var l=q("themestyles"),e=q("settings").settings,d=null,b=null;n.themestyles=l;n.themeSettingChanged=function(a,h,g){var f=m.getExtensionByKey("theme",g);if(g==="standard"||!g||!f){f=null;if(b!==null)f=m.getExtensionByKey("theme",b)}if(f)f.load().then(function(i){d&&l.unregisterThemeStyles(d);l.currentThemeVariables=i();d=f;l.parseGlobalVariables();l.reparse();f.url&&l.registerThemeStyles(f);
m.publish(n,"themeChange")});else if(d){l.unregisterThemeStyles(d);d=null;l.currentThemeVariables=null;l.parseGlobalVariables();l.reparse();m.publish(this,"themeChange")}};m.registerExtension("settingChange",{match:"theme",pointer:n.themeSettingChanged.bind(n)});n.setStandardTheme=function(a){b=a;a!==e.get("theme")&&n.themeSettingChanged(this)};n.setBasePlugin=function(a){l.basePluginName=a};n.startParsing=function(){l.preventParsing=false;return l.reparse()};n.registerTheme=function(a){var h=e.get("theme");
a.name===h&&n.themeSettingChanged(this,"theme",a.name)};n.unregisterTheme=function(a){a.name===e.get("theme")&&n.themeSettingChanged(this)};n.appLaunched=function(){m.publish(n,"themeChange")}});
bespin.tiki.module("theme_manager:themestyles",function(q,n){var m=q("bespin:util/util"),l=q("bespin:plugins").catalog,e=q("bespin:console").console,d=q("bespin:promise").Promise,b=q("bespin:promise").group,a=q("bespin:proxy"),h=new (q("less").Parser)({optimization:3}),g=1;n.currentThemeVariables=null;n.basePluginName=null;n.preventParsing=true;var f="";n.globalThemeVariables={};var i={},j={},k=function(s){var v={},x=[],y=function(E,B){x.push(E);if(typeof B!="object")v[x.join("_")]=B;else for(prop in B)y(prop,
B[prop]);x.pop()};y("global",s);return v},r={},p={font:"arial, lucida, helvetica, sans-serif",font_size:"14px",line_height:"1.8em",color:"#DAD4BA",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",error_color:"#F99",header_color:"white",link_color:"#ACF",control:{color:"#E1B41F",border:"1px solid rgba(0, 0, 0, 0.2)",border_radius:"0.25em",background:"rgba(0, 0, 0, 0.2)",active:{color:"#FF9600",border:"1px solid #E1B41F",inset_color:"#ff9600",background:"rgba(0, 0, 0, 0.2)"}},pane:{h1:{font:"'MuseoSans', Helvetica",
font_size:"2.8em",color:"white"},color:"#DAD4BA",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",link_color:"white",background:"#45443C",border_radius:".5em"},form:{color:"white",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",font:"'Lucida Sans','Lucida Grande',Verdana,Arial,sans-serif",font_size:"@global_font_size",line_height:"@global_line_height"},button:{color:"white",background:"#3E6CB9"},container:{background:"#1E1916",border:"1px solid black"},selectable:{color:"white",border:"0px solid transparent",background:"transparent",
active:{color:"black",border:"0px solid transparent",background:"#FF8E00"},hover:{color:"black",border:"0px solid transparent",background:"#FF8E00"}},hint:{color:"#AAA",active:{color:"black"},hover:{color:"black"}},accelerator:{color:"#996633",active:{color:"black"},hover:{color:"black"}},menu:{border_color:"black",inset_color_right:"#1E1916",inset_color_top_left:"#3E3936",background:"transparent"}};p=k(p);n.getPluginThemeVariables=function(s){var v=l.plugins[s];if(!v)return null;var x={};if(n.currentThemeVariables&&
n.currentThemeVariables[s])x=n.currentThemeVariables[s];v.provides.forEach(function(y){if(y.ep==="themevariable"){var E=y.name;x[E]=x[E]||y.defaultValue}});return x};n.parseGlobalVariables=function(){var s={},v="",x=n.currentThemeVariables;m.mixin(s,p);x&&x.global&&m.mixin(s,k(x.global));n.globalThemeVariables=s;for(prop in s)v+="@"+prop+":"+s[prop]+";";f=v};n.parseGlobalVariables();var u=function(s,v,x){if(i[v])styleElem=document.getElementById("_bespin_theme_style_"+i[v]);else{styleElem=document.createElement("style");
styleElem.setAttribute("id","_bespin_theme_style_"+g);i[v]=g;g++;document.body.appendChild(styleElem)}h.parse(f+x+j[v],function(y,E){if(y){y="Error less parsing "+v+" "+y.message;e.error(y);s.reject(y)}else{try{var B=E.toCSS()}catch(G){y="Error less parsing "+v+" "+G;e.error(y);s.reject(y);return}if(styleElem&&styleElem.firstChild)styleElem.firstChild.textContent=B;else{y=document.createTextNode(B);styleElem.appendChild(y)}s.resolve()}})},t={};n.parsePlugin=function(s){if(n.preventParsing)return(new d).resolve();
var v=l.plugins[s];if(!v)throw"reparsePlugin: plugin "+s+" is not defined!";if(!t[s]){t[s]=new d;setTimeout(function(){var x=n.getPluginThemeVariables(s),y="";for(prop in x)y+="@"+prop+":"+x[prop]+";";x=new d;x.then(function(E){t[this.name].resolve(E);t[this.name]=null}.bind(this),function(){t[this.name].reject(data);t[this.name]=null}.bind(this));u(x,s,y)}.bind(v),0)}return t[s]};var w=function(s,v,x,y){x=x.replace(/url\(['"]*([^'")]*)(['"]*)\)/g,"url("+s+"$1)");j[v]+=x;y&&y.resolve()},o=null;n.registerThemeStyles=
function(s){var v=s.getPluginName(),x=l.getResourceURL(v);if(!(s.url instanceof Array))s.url=[s.url];j[v]="";var y=[],E=n.preventParsing;s.url.forEach(function(B){if(r[v]&&r[v][B])w(x,v,r[v][B]);else{var G=new d;y.push(G);var I=x+B+"?"+(new Date).getTime();a.xhr("GET",I,true,function(J){J.overrideMimeType("text/plain")}).then(function(J){w(x,v,J,G)},function(){e.error("registerLessFile: Could not load "+x+B);G.resolve()})}});if(y.length===0)n.parsePlugin(v);else{E||b(y).then(function(){n.parsePlugin(v)});
if(o!==null)y=y.concat(o);o=b(y)}};n.reparse=function(){var s=new d;if(n.preventParsing)return s.resolve();o?o.then(function(){var v=[],x=n.basePluginName;x!==null&&j[x]&&v.push(n.parsePlugin(x));for(var y in j)y!==x&&v.push(n.parsePlugin(y));b(v).then(s.resolve.bind(s),s.reject.bind(s))},function(v){s.reject(v)}):s.resolve();return s};n.unregisterThemeStyles=function(s){s=s.getPluginName();if(i[s]){var v=document.getElementById("_bespin_theme_style_"+i[s]);v.parentNode.removeChild(v);delete i[s];
delete j[s]}}});bespin.tiki.register("::types",{name:"types",dependencies:{}});
bespin.tiki.module("types:basic",function(q,n){var m=q("bespin:plugins").catalog,l=q("bespin:console").console,e=q("bespin:promise").Promise;n.text={isValid:function(d){return typeof d=="string"},toString:function(d){return d},fromString:function(d){return d}};n.number={isValid:function(d){if(isNaN(d))return false;if(d===null)return false;if(d===undefined)return false;if(d===Infinity)return false;return typeof d=="number"},toString:function(d){if(!d)return null;return""+d},fromString:function(d){if(!d)return null;
var b=parseInt(d,10);if(isNaN(b))throw new Error("Can't convert \""+d+'" to a number.');return b}};n.bool={isValid:function(d){return typeof d=="boolean"},toString:function(d){return""+d},fromString:function(d){if(d===null)return null;if(!d.toLowerCase)return!!d;var b=d.toLowerCase();if(b=="true")return true;else if(b=="false")return false;return!!d}};n.object={isValid:function(d){return typeof d=="object"},toString:function(d){return JSON.stringify(d)},fromString:function(d){return JSON.parse(d)}};
n.selection={isValid:function(d,b){if(typeof d!="string")return false;if(!b.data){l.error("Missing data on selection type extension. Skipping");return true}var a=false;b.data.forEach(function(h){if(d==h)a=true});return a},toString:function(d){return d},fromString:function(d){return d},resolveTypeSpec:function(d,b){var a=new e;if(b.data){d.data=b.data;a.resolve()}else if(b.pointer)m.loadObjectForPropertyPath(b.pointer).then(function(h){h=h(b);if(typeof h.then==="function")h.then(function(g){d.data=
g;a.resolve()});else{d.data=h;a.resolve()}},function(h){a.reject(h)});else{l.warn("Missing data/pointer for selection",b);a.resolve()}return a}}});
bespin.tiki.module("types:types",function(q,n){function m(b){var a=new d,h=e.getExtensionByKey("type",b.name);h?a.resolve({ext:h,typeSpec:b}):a.reject(new Error("Unknown type: "+b.name));return a}function l(b){if(typeof b==="string")return m({name:b});if(typeof b==="object")if(b.name==="deferred"){var a=new d;n.undeferTypeSpec(b).then(function(h){l(h).then(function(g){a.resolve(g)},function(g){a.reject(g)})});return a}else return m(b);throw new Error("Unknown typeSpec type: "+typeof b);}var e=q("bespin:plugins").catalog;
q("bespin:console");var d=q("bespin:promise").Promise;n.getSimpleName=function(b){if(!b)throw new Error("null|undefined is not a valid typeSpec");if(typeof b=="string")return b;if(typeof b=="object"){if(!b.name)throw new Error("Missing name member to typeSpec");return b.name}throw new Error("Not a typeSpec: "+b);};n.equals=function(b,a){return n.getSimpleName(b)==n.getSimpleName(a)};n.undeferTypeSpec=function(b){var a=new d;if(!b.pointer){a.reject(new Error("Missing deferred pointer"));return a}e.loadObjectForPropertyPath(b.pointer).then(function(h){h=
h(b);typeof h.then==="function"?h.then(function(g){a.resolve(g)},function(g){a.reject(g)}):a.resolve(h)},function(h){a.reject(h)});return a};n.resolveType=function(b){var a=new d;l(b).then(function(h){h.ext.load(function(g){typeof g.resolveTypeSpec==="function"?g.resolveTypeSpec(h.ext,h.typeSpec).then(function(){a.resolve({type:g,ext:h.ext})},function(f){a.reject(f)}):a.resolve({type:g,ext:h.ext})})},function(h){a.reject(h)});return a};n.fromString=function(b,a){var h=new d;n.resolveType(a).then(function(g){h.resolve(g.type.fromString(b,
g.ext))});return h};n.toString=function(b,a){var h=new d;n.resolveType(a).then(function(g){h.resolve(g.type.toString(b,g.ext))});return h};n.isValid=function(b,a){var h=new d;n.resolveType(a).then(function(g){h.resolve(g.type.isValid(b,g.ext))});return h}});bespin.tiki.module("types:index",function(){});bespin.tiki.register("::jquery",{name:"jquery",dependencies:{}});bespin.tiki.module("jquery:index",function(q,n){n.$=window.$});
bespin.tiki.register("::embedded",{name:"embedded",dependencies:{theme_manager:"0.0.0",text_editor:"0.0.0",appconfig:"0.0.0",edit_session:"0.0.0",screen_theme:"0.0.0"}});bespin.tiki.module("embedded:index",function(){});bespin.tiki.register("::settings",{name:"settings",dependencies:{types:"0.0.0"}});
bespin.tiki.module("settings:commands",function(q,n){q("bespin:plugins");q("environment");var m=q("settings").settings;n.setCommand=function(l,e){var d;if(l.setting)if(l.value===undefined)d="<strong>"+l.setting+"</strong> = "+m.get(l.setting);else{d="Setting: <strong>"+l.setting+"</strong> = "+l.value;m.set(l.setting,l.value)}else{l=m._list();d="";l.sort(function(b,a){return b.key<a.key?-1:b.key==a.key?0:1});l.forEach(function(b){d+='<a class="setting" href="https://wiki.mozilla.org/Labs/Bespin/Settings#'+
b.key+'" title="View external documentation on setting: '+b.key+'" target="_blank">'+b.key+"</a> = "+b.value+"<br/>"})}e.done(d)};n.unsetCommand=function(l,e){m.resetValue(l.setting);e.done("Reset "+l.setting+" to default: "+m.get(l.setting))}});
bespin.tiki.module("settings:cookie",function(q,n){var m=q("bespin:util/cookie");n.CookiePersister=function(){};n.CookiePersister.prototype={loadInitialValues:function(l){l._loadDefaultValues().then(function(){var e=m.get("settings");l._loadFromObject(JSON.parse(e))}.bind(this))},persistValue:function(l){try{var e={};l._getSettingNames().forEach(function(a){e[a]=l.get(a)});var d=JSON.stringify(e);m.set("settings",d)}catch(b){console.error("Unable to JSONify the settings! "+b)}}}});
bespin.tiki.module("settings:index",function(q,n){var m=q("bespin:plugins").catalog,l=q("bespin:console").console,e=q("bespin:promise").Promise,d=q("bespin:promise").group,b=q("types:types");n.addSetting=function(a){q("settings").settings.addSetting(a)};n.getSettings=function(){return m.getExtensions("setting")};n.getTypeSpecFromAssignment=function(a){var h=a.assignments;a="text";if(h){var g=null;h.forEach(function(f){if(f.param.name==="setting")g=f});if(g)if((h=g.value)&&h!=="")if(h=m.getExtensionByKey("setting",
h))a=h.type}return a};n.MemorySettings=function(){};n.MemorySettings.prototype={_values:{},_deactivated:{},setPersister:function(a){(this._persister=a)&&a.loadInitialValues(this)},get:function(a){return this._values[a]},set:function(a,h){var g=m.getExtensionByKey("setting",a);if(g)if(typeof h=="string"&&g.type=="string")this._values[a]=h;else{var f=false;b.fromString(h,g.type).then(function(i){f=true;this._values[a]=i;m.publish(this,"settingChange",a,i)}.bind(this),function(i){l.error("Error setting",
a,": ",i)});if(!f){l.warn("About to set string version of ",a,"delaying typed set.");this._values[a]=h}}else{l.warn("Setting not defined: ",a,h);this._deactivated[a]=h}this._persistValue(a,h);return this},addSetting:function(a){if(a.name){!a.defaultValue===undefined&&l.error("Setting.defaultValue == undefined",a);b.isValid(a.defaultValue,a.type).then(function(h){h||l.warn("!Setting.isValid(Setting.defaultValue)",a);this.set(a.name,this._deactivated[a.name]||a.defaultValue)}.bind(this),function(h){l.error("Type error ",
h," ignoring setting ",a)})}else l.error("Setting.name == undefined. Ignoring.",a)},resetValue:function(a){var h=m.getExtensionByKey("setting",a);h?this.set(a,h.defaultValue):l.log("ignore resetValue on ",a)},resetAll:function(){this._getSettingNames().forEach(function(a){this.resetValue(a)}.bind(this))},_getSettingNames:function(){var a=[];m.getExtensions("setting").forEach(function(h){a.push(h.name)});return a},_list:function(){var a=[];this._getSettingNames().forEach(function(h){a.push({key:h,
value:this.get(h)})}.bind(this));return a},_persistValue:function(a,h){var g=this._persister;g&&g.persistValue(this,a,h)},_loadInitialValues:function(){var a=this._persister;a?a.loadInitialValues(this):this._loadDefaultValues()},_loadDefaultValues:function(){return this._loadFromObject(this._defaultValues())},_loadFromObject:function(a){var h=[],g=function(r){return function(p){this.set(r,p)}};for(var f in a)if(a.hasOwnProperty(f)){var i=a[f],j=m.getExtensionByKey("setting",f);if(j){i=b.fromString(i,
j.type);j=g(f);i.then(j);h.push(i)}}var k=new e;d(h).then(function(){k.resolve()});return k},_saveToObject:function(){var a=[],h={};this._getSettingNames().forEach(function(f){var i=this.get(f),j=m.getExtensionByKey("setting",f);if(j){i=b.toString(i,j.type);i.then(function(k){h[f]=k});a.push(i)}}.bind(this));var g=new e;d(a).then(function(){g.resolve(h)});return g},_defaultValues:function(){var a={};m.getExtensions("setting").forEach(function(h){a[h.name]=h.defaultValue});return a}};n.settings=new n.MemorySettings});
bespin.tiki.register("::appconfig",{name:"appconfig",dependencies:{jquery:"0.0.0",canon:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("appconfig:index",function(q,n){var m=q("jquery").$,l=q("settings").settings,e=q("bespin:promise").group,d=q("bespin:promise").Promise,b=q("bespin:console").console,a=q("bespin:util/stacktrace").Trace,h=q("bespin:util/util"),g=true;n.launch=function(j){var k=new d;m("#_bespin_loading").remove();var r;if(g){r=bespin.tiki.require;g=false}else r=(new (bespin.tiki.require("bespin:sandbox").Sandbox)).createRequire({id:"index",ownerPackage:bespin.tiki.loader.anonymousPackage});var p=
r("bespin:plugins").catalog;j=j||{};n.normalizeConfig(p,j);var u=j.objects;for(var t in u)p.registerObject(t,u[t]);for(var w in j.settings)l.set(w,j.settings[w]);var o=function(){var v=r("environment").env,x=v.editor;if(x){j.lineNumber&&x.setLineNumber(j.lineNumber);if(j.stealFocus)x.focus=true;if(j.readOnly)x.readOnly=j.readOnly;if(j.syntax)x.syntax=j.syntax}if(x=p.getObject("commandLine"))v.commandLine=x;p.publish(this,"appLaunched");k.resolve(v)}.bind(this),s=new d;s.then(function(){u.loginController?
p.createObject("loginController").then(function(v){v.showLogin().then(function(x){j.objects.session.arguments.push(x);n.launchEditor(p,j).then(o,k.reject.bind(k))})}):n.launchEditor(p,j).then(o,k.reject.bind(k))},function(v){k.reject(v)});p.plugins.theme_manager?bespin.tiki.require.ensurePackage("::theme_manager",function(){var v=r("theme_manager");j.theme.basePlugin&&v.setBasePlugin(j.theme.basePlugin);j.theme.standard&&v.setStandardTheme(j.theme.standard);v.startParsing().then(function(){s.resolve()},
function(x){s.reject(x)})}):s.resolve();return k};n.normalizeConfig=function(j,k){if(k.objects===undefined)k.objects={};if(k.autoload===undefined)k.autoload=[];if(k.theme===undefined)k.theme={};if(!k.theme.basePlugin&&j.plugins.screen_theme)k.theme.basePlugin="screen_theme";if(!k.initialContent)k.initialContent="";if(!k.settings)k.settings={};if(!k.objects.notifier&&j.plugins.notifier)k.objects.notifier={};if(!k.objects.loginController&&j.plugins.userident)k.objects.loginController={};if(!k.objects.fileHistory&&
j.plugins.file_history)k.objects.fileHistory={factory:"file_history",arguments:["session"],objects:{"0":"session"}};if(!k.objects.server&&j.plugins.bespin_server){k.objects.server={factory:"bespin_server"};k.objects.filesource={factory:"bespin_filesource",arguments:["server"],objects:{"0":"server"}}}if(!k.objects.files&&j.plugins.filesystem&&k.objects.filesource)k.objects.files={arguments:["filesource"],objects:{"0":"filesource"}};if(!k.objects.editor)k.objects.editor={factory:"text_editor",arguments:[k.initialContent]};
if(!k.objects.session)k.objects.session={arguments:["editor"],objects:{"0":"editor"}};if(!k.objects.commandLine&&j.plugins.command_line)k.objects.commandLine={};if(!k.objects.toolbar&&j.plugins.toolbar)k.objects.toolbar={};if(k.gui===undefined)k.gui={};j={};for(var r in k.gui){var p=k.gui[r];if(p.component)j[p.component]=true}if(!k.gui.north&&k.objects.toolbar&&!j.toolbar)k.gui.north={component:"toolbar"};if(!k.gui.center&&k.objects.editor&&!j.editor)k.gui.center={component:"editor"};if(!k.gui.south&&
k.objects.commandLine&&!j.commandLine)k.gui.south={component:"commandLine"}};n.launchEditor=function(j,k){var r=new d;if(k===null){b.error("Cannot start editor without a configuration!");r.reject("Cannot start editor without a configuration!");return r}f(j,k).then(function(){i(j,k,r)},function(p){b.error("Error while creating objects");(new a(p)).log();r.reject(p)});return r};var f=function(j,k){var r=[];for(var p in k.objects)r.push(j.createObject(p));return e(r)},i=function(j,k,r){var p=document.createElement("div");
p.setAttribute("class","container");var u=document.createElement("div");u.setAttribute("class","center-container");p.appendChild(u);var t=k.element||document.body;h.addClass(t,"bespin");t.appendChild(p);for(var w in k.gui){var o=k.gui[w],s=j.getObject(o.component);if(!s){j="Cannot find object "+o.component+" to attach to the Bespin UI";b.error(j);r.reject(j);return}t=s.element;if(!t){j="Component "+o.component+' does not have an "element" attribute to attach to the Bespin UI';b.error(j);r.reject(j);
return}m(t).addClass(w);w=="west"||w=="east"||w=="center"?u.appendChild(t):p.appendChild(t);s.elementAppended&&s.elementAppended()}r.resolve()}});bespin.tiki.register("::events",{name:"events",dependencies:{traits:"0.0.0"}});
bespin.tiki.module("events:index",function(q,n){n.Event=function(){var m=[],l=function(){var e=arguments;m.forEach(function(d){d.func.apply(null,e)})};l.add=function(){arguments.length==1?m.push({ref:arguments[0],func:arguments[0]}):m.push({ref:arguments[0],func:arguments[1]})};l.remove=function(e){m=m.filter(function(d){return e!==d.ref})};l.removeAll=function(){m=[]};return l}});bespin.tiki.register("::uicommands",{name:"uicommands",dependencies:{}});
bespin.tiki.module("uicommands:index",function(q,n){var m=q("environment").env;q("bespin:plugins");n.jumpCommandLine=function(){m.commandLine.focus()};n.jumpEditor=function(){m.view.focus()}});bespin.tiki.register("::screen_theme",{name:"screen_theme",dependencies:{theme_manager:"0.0.0"}});bespin.tiki.module("screen_theme:index",function(){});
(function(){var q=bespin.tiki.require("jquery").$;q(document).ready(function(){bespin.tiki.require("bespin:plugins").catalog.registerMetadata({text_editor:{resourceURL:"resources/text_editor/",description:"Canvas-based text editor component and many common editing commands",dependencies:{completion:"0.0.0",undomanager:"0.0.0",settings:"0.0.0",canon:"0.0.0",rangeutils:"0.0.0",traits:"0.0.0",theme_manager:"0.0.0",keyboard:"0.0.0",edit_session:"0.0.0",syntax_manager:"0.0.0"},testmodules:["tests\\controllers\\testLayoutmanager",
"tests\\models\\testTextstorage","tests\\testScratchcanvas","tests\\utils\\testRect"],provides:[{action:"new",pointer:"views/editor#EditorView",ep:"factory",name:"text_editor"},{pointer:"views/editor#EditorView",ep:"appcomponent",name:"editor_view"},{predicates:{isTextView:true},pointer:"commands/editing#backspace",ep:"command",key:"backspace",name:"backspace"},{predicates:{isTextView:true},pointer:"commands/editing#deleteCommand",ep:"command",key:"delete",name:"delete"},{description:"Delete all lines currently selected",
key:"ctrl_d",predicates:{isTextView:true},pointer:"commands/editing#deleteLines",ep:"command",name:"deletelines"},{description:"Create a new, empty line below the current one",key:"ctrl_return",predicates:{isTextView:true},pointer:"commands/editing#openLine",ep:"command",name:"openline"},{description:"Join the current line with the following",key:"ctrl_shift_j",predicates:{isTextView:true},pointer:"commands/editing#joinLines",ep:"command",name:"joinline"},{params:[{defaultValue:"",type:"text",name:"text",
description:"The text to insert"}],pointer:"commands/editing#insertText",ep:"command",name:"insertText"},{predicates:{completing:false,isTextView:true},pointer:"commands/editing#newline",ep:"command",key:"return",name:"newline"},{predicates:{completing:false,isTextView:true},pointer:"commands/editing#tab",ep:"command",key:"tab",name:"tab"},{predicates:{isTextView:true},pointer:"commands/editing#untab",ep:"command",key:"shift_tab",name:"untab"},{predicates:{isTextView:true},ep:"command",name:"move"},
{description:"Repeat the last search (forward)",pointer:"commands/editor#findNextCommand",ep:"command",key:"ctrl_g",name:"findnext"},{description:"Repeat the last search (backward)",pointer:"commands/editor#findPrevCommand",ep:"command",key:"ctrl_shift_g",name:"findprev"},{predicates:{completing:false,isTextView:true},pointer:"commands/movement#moveDown",ep:"command",key:"down",name:"move down"},{predicates:{isTextView:true},pointer:"commands/movement#moveLeft",ep:"command",key:"left",name:"move left"},
{predicates:{isTextView:true},pointer:"commands/movement#moveRight",ep:"command",key:"right",name:"move right"},{predicates:{completing:false,isTextView:true},pointer:"commands/movement#moveUp",ep:"command",key:"up",name:"move up"},{predicates:{isTextView:true},ep:"command",name:"select"},{predicates:{isTextView:true},pointer:"commands/movement#selectDown",ep:"command",key:"shift_down",name:"select down"},{predicates:{isTextView:true},pointer:"commands/movement#selectLeft",ep:"command",key:"shift_left",
name:"select left"},{predicates:{isTextView:true},pointer:"commands/movement#selectRight",ep:"command",key:"shift_right",name:"select right"},{predicates:{isTextView:true},pointer:"commands/movement#selectUp",ep:"command",key:"shift_up",name:"select up"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineEnd",ep:"command",key:["end","ctrl_right"],name:"move lineend"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineEnd",ep:"command",key:["shift_end","ctrl_shift_right"],
name:"select lineend"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocEnd",ep:"command",key:"ctrl_down",name:"move docend"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocEnd",ep:"command",key:"ctrl_shift_down",name:"select docend"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineStart",ep:"command",key:["home","ctrl_left"],name:"move linestart"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineStart",ep:"command",key:["shift_home",
"ctrl_shift_left"],name:"select linestart"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocStart",ep:"command",key:"ctrl_up",name:"move docstart"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocStart",ep:"command",key:"ctrl_shift_up",name:"select docstart"},{predicates:{isTextView:true},pointer:"commands/movement#moveNextWord",ep:"command",key:["alt_right"],name:"move nextword"},{predicates:{isTextView:true},pointer:"commands/movement#selectNextWord",ep:"command",
key:["alt_shift_right"],name:"select nextword"},{predicates:{isTextView:true},pointer:"commands/movement#movePreviousWord",ep:"command",key:["alt_left"],name:"move prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectPreviousWord",ep:"command",key:["alt_shift_left"],name:"select prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectAll",ep:"command",key:["ctrl_a","meta_a"],name:"select all"},{predicates:{isTextView:true},ep:"command",name:"scroll"},{predicates:{isTextView:true},
pointer:"commands/scrolling#scrollDocStart",ep:"command",key:"ctrl_home",name:"scroll start"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollDocEnd",ep:"command",key:"ctrl_end",name:"scroll end"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageDown",ep:"command",key:"pagedown",name:"scroll down"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageUp",ep:"command",key:"pageup",name:"scroll up"},{pointer:"commands/editor#lcCommand",description:"Change all selected text to lowercase",
withKey:"CMD SHIFT L",ep:"command",name:"lc"},{pointer:"commands/editor#detabCommand",description:"Convert tabs to spaces.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"detab"},{pointer:"commands/editor#entabCommand",description:"Convert spaces to tabs.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"entab"},
{pointer:"commands/editor#trimCommand",description:"trim trailing or leading whitespace from each line in selection",params:[{defaultValue:"both",type:{data:[{name:"left"},{name:"right"},{name:"both"}],name:"selection"},name:"side",description:"Do we trim from the left, right or both"}],ep:"command",name:"trim"},{pointer:"commands/editor#ucCommand",description:"Change all selected text to uppercase",withKey:"CMD SHIFT U",ep:"command",name:"uc"},{predicates:{isTextView:true},pointer:"controllers/undo#undoManagerCommand",
ep:"command",key:["ctrl_shift_z"],name:"redo"},{predicates:{isTextView:true},pointer:"controllers/undo#undoManagerCommand",ep:"command",key:["ctrl_z"],name:"undo"},{description:"The distance in characters between each tab",defaultValue:8,type:"number",ep:"setting",name:"tabstop"},{description:"Customize the keymapping",defaultValue:"{}",type:"text",ep:"setting",name:"customKeymapping"},{description:"The keymapping to use",defaultValue:"standard",type:"text",ep:"setting",name:"keymapping"},{description:"The editor font size in pixels",
defaultValue:14,type:"number",ep:"setting",name:"fontsize"},{description:"The editor font face",defaultValue:"Monaco, Lucida Console, monospace",type:"text",ep:"setting",name:"fontface"},{defaultValue:{color:"#e5c138",paddingLeft:5,backgroundColor:"#4c4a41",paddingRight:10},ep:"themevariable",name:"gutter"},{defaultValue:{color:"#e6e6e6",selectedTextBackgroundColor:"#526da5",backgroundColor:"#2a211c",cursorColor:"#879aff",unfocusedCursorBackgroundColor:"#73171e",unfocusedCursorColor:"#ff0033"},ep:"themevariable",
name:"editor"},{defaultValue:{comment:"#666666",directive:"#999999",keyword:"#42A8ED",plain:"#e6e6e6",error:"#ff0000",operator:"#88BBFF",identifier:"#D841FF",string:"#039A0A"},ep:"themevariable",name:"highlighter"},{defaultValue:{nibStrokeStyle:"rgb(150, 150, 150)",fullAlpha:1,barFillStyle:"rgb(0, 0, 0)",particalAlpha:0.3,barFillGradientBottomStop:"rgb(44, 44, 44)",backgroundStyle:"#2A211C",thickness:17,padding:5,trackStrokeStyle:"rgb(150, 150, 150)",nibArrowStyle:"rgb(255, 255, 255)",barFillGradientBottomStart:"rgb(22, 22, 22)",
barFillGradientTopStop:"rgb(40, 40, 40)",barFillGradientTopStart:"rgb(90, 90, 90)",nibStyle:"rgb(100, 100, 100)",trackFillStyle:"rgba(50, 50, 50, 0.8)"},ep:"themevariable",name:"scroller"},{description:"Event: Notify when something within the editor changed.",params:[{required:true,name:"pointer",description:"Function that is called whenever a change happened."}],ep:"extensionpoint",name:"editorChange"}],type:"plugins\\supported",name:"text_editor"},less:{resourceURL:"resources/less/",description:"Leaner CSS",
contributors:[],author:"Alexis Sellier <self@cloudhead.net>",url:"http://lesscss.org",version:"1.0.11",dependencies:{},testmodules:[],provides:[],keywords:["css","parser","lesscss","browser"],type:"plugins\\thirdparty",name:"less"},theme_manager_base:{resourceURL:"resources/theme_manager_base/",name:"theme_manager_base",share:true,environments:{main:true},dependencies:{},testmodules:[],provides:[{description:"(Less)files holding the CSS style information for the UI.",params:[{required:true,name:"url",
description:"Name of the ThemeStylesFile - can also be an array of files."}],ep:"extensionpoint",name:"themestyles"},{description:"Event: Notify when the theme(styles) changed.",params:[{required:true,name:"pointer",description:"Function that is called whenever the theme is changed."}],ep:"extensionpoint",name:"themeChange"},{indexOn:"name",description:"A theme is a way change the look of the application.",params:[{required:false,name:"url",description:"Name of a ThemeStylesFile that holds theme specific CSS rules - can also be an array of files."},
{required:true,name:"pointer",description:"Function that returns the ThemeData"}],ep:"extensionpoint",name:"theme"}],type:"plugins\\supported",description:"Defines extension points required for theming"},canon:{resourceURL:"resources/canon/",name:"canon",environments:{main:true,worker:false},dependencies:{environment:"0.0.0",events:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{indexOn:"name",description:"A command is a bit of functionality with optional typed arguments which can do something small like moving the cursor around the screen, or large like cloning a project from VCS.",
ep:"extensionpoint",name:"command"},{description:"An extension point to be called whenever a new command begins output.",ep:"extensionpoint",name:"addedRequestOutput"},{description:"A dimensionsChanged is a way to be notified of changes to the dimension of Bespin",ep:"extensionpoint",name:"dimensionsChanged"},{description:"How many typed commands do we recall for reference?",defaultValue:50,type:"number",ep:"setting",name:"historyLength"},{action:"create",pointer:"history#InMemoryHistory",ep:"factory",
name:"history"}],type:"plugins\\supported",description:"Manages commands"},traits:{resourceURL:"resources/traits/",description:"Traits library, traitsjs.org",dependencies:{},testmodules:[],provides:[],type:"plugins\\thirdparty",name:"traits"},keyboard:{resourceURL:"resources/keyboard/",description:"Keyboard shortcuts",dependencies:{canon:"0.0",settings:"0.0"},testmodules:["tests\\testKeyboard"],provides:[{description:"A keymapping defines how keystrokes are interpreted.",params:[{required:true,name:"states",
description:"Holds the states and all the informations about the keymapping. See docs: pluginguide/keymapping"}],ep:"extensionpoint",name:"keymapping"}],type:"plugins\\supported",name:"keyboard"},worker_manager:{resourceURL:"resources/worker_manager/",description:"Manages a web worker on the browser side",dependencies:{canon:"0.0.0",events:"0.0.0",underscore:"0.0.0"},testmodules:[],provides:[{description:"Low-level web worker control (for plugin development)",ep:"command",name:"worker"},{description:"Restarts all web workers (for plugin development)",
pointer:"#workerRestartCommand",ep:"command",name:"worker restart"}],type:"plugins\\supported",name:"worker_manager"},diff:{testmodules:[],type:"plugins\\thirdparty",resourceURL:"resources/diff/",description:"Diff/Match/Patch module (support code, no UI)",name:"diff"},edit_session:{resourceURL:"resources/edit_session/",description:"Ties together the files being edited with the views on screen",dependencies:{events:"0.0.0"},testmodules:["tests\\testSession"],provides:[{action:"call",pointer:"#createSession",
ep:"factory",name:"session"}],type:"plugins\\supported",name:"edit_session"},syntax_manager:{resourceURL:"resources/syntax_manager/",name:"syntax_manager",environments:{main:true,worker:false},dependencies:{worker_manager:"0.0.0",events:"0.0.0",underscore:"0.0.0",syntax_directory:"0.0.0"},testmodules:[],provides:[],type:"plugins\\supported",description:"Provides syntax highlighting services for the editor"},completion:{resourceURL:"resources/completion/",description:"Code completion support",dependencies:{jquery:"0.0.0",
ctags:"0.0.0",rangeutils:"0.0.0",canon:"0.0.0",underscore:"0.0.0"},testmodules:[],provides:[{indexOn:"name",description:"Code completion support for specific languages",ep:"extensionpoint",name:"completion"},{description:"Accept the chosen completion",key:["return","tab"],predicates:{completing:true},pointer:"controller#completeCommand",ep:"command",name:"complete"},{description:"Abandon the completion",key:"escape",predicates:{completing:true},pointer:"controller#completeCancelCommand",ep:"command",
name:"complete cancel"},{description:"Choose the completion below",key:"down",predicates:{completing:true},pointer:"controller#completeDownCommand",ep:"command",name:"complete down"},{description:"Choose the completion above",key:"up",predicates:{completing:true},pointer:"controller#completeUpCommand",ep:"command",name:"complete up"}],type:"plugins\\supported",name:"completion"},environment:{testmodules:[],dependencies:{settings:"0.0.0"},resourceURL:"resources/environment/",name:"environment",type:"plugins\\supported"},
undomanager:{resourceURL:"resources/undomanager/",description:"Manages undoable events",testmodules:["tests\\testUndomanager"],provides:[{pointer:"#undoManagerCommand",ep:"command",key:["ctrl_shift_z"],name:"redo"},{pointer:"#undoManagerCommand",ep:"command",key:["ctrl_z"],name:"undo"}],type:"plugins\\supported",name:"undomanager"},command_line:{resourceURL:"resources/command_line/",description:"Provides the command line user interface",dependencies:{templater:"0.0.0",settings:"0.0.0",matcher:"0.0.0",
theme_manager_base:"0.0.0",canon:"0.0.0",keyboard:"0.0.0",diff:"0.0.0",types:"0.0.0"},testmodules:["tests\\testInput"],provides:[{url:["article.less","cli.less","menu.less","requestOutput.less","global.less"],ep:"themestyles"},{defaultValue:"@global_container_background",ep:"themevariable",name:"bg"},{defaultValue:"@global_container_background + #090807",ep:"themevariable",name:"input_bg_light"},{defaultValue:"@global_container_background - #030303",ep:"themevariable",name:"input_bg"},{defaultValue:"@global_container_background - #050506",
ep:"themevariable",name:"input_bg2"},{defaultValue:"@global_menu_inset_color_top_left",ep:"themevariable",name:"border_fg"},{defaultValue:"@global_menu_inset_color_right",ep:"themevariable",name:"border_fg2"},{defaultValue:"@global_menu_background",ep:"themevariable",name:"menu_bg"},{defaultValue:"@global_menu_border_color",ep:"themevariable",name:"border_bg"},{defaultValue:"@global_color",ep:"themevariable",name:"text"},{defaultValue:"@global_header_color",ep:"themevariable",name:"hi_text"},{defaultValue:"@global_hint_color",
ep:"themevariable",name:"lo_text"},{defaultValue:"@global_hint_color",ep:"themevariable",name:"lo_text2"},{defaultValue:"@global_link_color",ep:"themevariable",name:"link_text"},{defaultValue:"@global_error_color",ep:"themevariable",name:"error_text"},{defaultValue:"@global_selectable_hover_background",ep:"themevariable",name:"theme_text"},{comment:"#FFCE00",defaultValue:"rgb(255,206,0)",ep:"themevariable",name:"theme_text_light"},{defaultValue:"@global_selectable_hover_background - #222000",ep:"themevariable",
name:"theme_text_dark"},{defaultValue:"@global_accelerator_color",ep:"themevariable",name:"theme_text_dark2"},{comment:"#0E0906",defaultValue:"rgb(14,9,6)",ep:"themevariable",name:"input_submenu"},{defaultValue:"@global_font",ep:"themevariable",name:"fonts"},{defaultValue:"@global_selectable_hover_color",ep:"themevariable",name:"li_hover_color"},{defaultValue:"@global_hint_hover_color",ep:"themevariable",name:"li_hint_hover_color"},{defaultValue:"@global_accelerator_hover_color",ep:"themevariable",
name:"li_accelerator_hover_color"},{action:"new",pointer:"views/cli#CliInputView",ep:"factory",name:"commandLine"},{pointer:"views/cli#CliInputView",ep:"appcomponent",name:"command_line"},{description:"Display number|date|none next to each historical instruction",defaultValue:"none",type:{data:["number","date","none"],name:"selection"},ep:"setting",name:"historyTimeMode"},{description:"The maximum size (in pixels) for the command line output area",defaultValue:0,type:"number",ep:"setting",name:"minConsoleHeight"},
{description:"The minimum size (in pixels) for the command line output area",defaultValue:300,type:"number",ep:"setting",name:"maxConsoleHeight"},{predicates:{isKeyUp:false,isCommandLine:true},pointer:"commands/simple#completeCommand",ep:"command",key:"tab",name:"complete"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_1",name:"menu1"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_2",
name:"menu2"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_1",name:"menu1"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_3",name:"menu3"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_4",name:"menu4"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_5",name:"menu5"},
{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_6",name:"menu6"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_7",name:"menu7"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_8",name:"menu8"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_9",name:"menu9"},{predicates:{isKeyUp:true,
isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_0",name:"menu0"},{pointer:"commands/simple#helpCommand",description:"Get help on the available commands.",params:[{defaultValue:null,type:"text",name:"search",description:"Search string to narrow the output."}],ep:"command",name:"help"},{pointer:"commands/simple#aliasCommand",description:"define and show aliases for commands",params:[{defaultValue:null,type:"text",name:"alias",description:"optionally, your alias name"},
{defaultValue:null,type:"text",name:"command",description:"optionally, the command name"}],ep:"command",name:"alias"},{description:"evals given js code and show the result",params:[{type:"text",name:"javascript",description:"The JavaScript to evaluate"}],hidden:true,pointer:"commands/basic#evalCommand",ep:"command",name:"eval"},{description:"show the Bespin version",hidden:true,pointer:"commands/basic#versionCommand",ep:"command",name:"version"},{description:"has",hidden:true,pointer:"commands/basic#bespinCommand",
ep:"command",name:"bespin"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"commands/history#historyPreviousCommand",ep:"command",key:"up",name:"historyPrevious"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"commands/history#historyNextCommand",ep:"command",key:"down",name:"historyNext"},{params:[],description:"Show history of the commands",pointer:"commands/history#historyCommand",ep:"command",name:"history"},{pointer:"commands/history#addedRequestOutput",ep:"addedRequestOutput"},
{indexOn:"name",description:"A function to allow the command line to show a hint to the user on how they should finish what they're typing",ep:"extensionpoint",name:"typehint"},{description:"A UI for string that is constrained to be one of a number of pre-defined values",pointer:"views/basic#selection",ep:"typehint",name:"selection"},{description:"A UI for a boolean",pointer:"views/basic#bool",ep:"typehint",name:"boolean"}],type:"plugins\\supported",name:"command_line"},editing_commands:{resourceURL:"resources/editing_commands/",
description:"Provides higher level commands for working with the text.",objects:["commandLine"],testmodules:[],provides:[{description:"Search for text within this buffer",params:[{type:"text",name:"value",description:"string to search for"}],key:"ctrl_f",pointer:"#findCommand",ep:"command",name:"find"},{description:"move it! make the editor head to a line number.",params:[{type:"text",name:"line",description:"add the line number to move to in the file"}],key:"ctrl_l",pointer:"#gotoCommand",ep:"command",
name:"goto"}],type:"plugins\\supported",name:"editing_commands"},rangeutils:{testmodules:["tests\\test"],type:"plugins\\supported",resourceURL:"resources/rangeutils/",description:"Utility functions for dealing with ranges of text",name:"rangeutils"},js_syntax:{resourceURL:"resources/js_syntax/",name:"js_syntax",environments:{worker:true},dependencies:{standard_syntax:"0.0.0"},testmodules:[],provides:[{pointer:"#JSSyntax",ep:"syntax",fileexts:["js","json"],name:"js"}],type:"plugins\\supported",description:"JavaScript syntax highlighter"},
ctags:{resourceURL:"resources/ctags/",description:"Reads and writes tag files",dependencies:{traits:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins\\supported",name:"ctags"},events:{resourceURL:"resources/events/",description:"Dead simple event implementation",dependencies:{traits:"0.0"},testmodules:["tests\\test"],provides:[],type:"plugins\\supported",name:"events"},templater:{testmodules:[],resourceURL:"resources/templater/",name:"templater",type:"plugins\\supported"},matcher:{resourceURL:"resources/matcher/",
description:"Provides various routines to match items in a list",dependencies:{},testmodules:["tests\\testIndex","tests\\testPrefix","tests\\testQuick"],type:"plugins\\supported",name:"matcher"},theme_manager:{resourceURL:"resources/theme_manager/",name:"theme_manager",share:true,environments:{main:true,worker:false},dependencies:{theme_manager_base:"0.0.0",settings:"0.0.0",events:"0.0.0",less:"0.0.0"},testmodules:[],provides:[{unregister:"themestyles#unregisterThemeStyles",register:"themestyles#registerThemeStyles",
ep:"extensionhandler",name:"themestyles"},{unregister:"index#unregisterTheme",register:"index#registerTheme",ep:"extensionhandler",name:"theme"},{defaultValue:"standard",description:"The theme plugin's name to use. If set to 'standard' no theme will be used",type:"text",ep:"setting",name:"theme"},{pointer:"#appLaunched",ep:"appLaunched"}],type:"plugins\\supported",description:"Handles colors in Bespin"},standard_syntax:{resourceURL:"resources/standard_syntax/",description:"Easy-to-use basis for syntax engines",
environments:{worker:true},dependencies:{syntax_worker:"0.0.0",syntax_directory:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins\\supported",name:"standard_syntax"},types:{resourceURL:"resources/types/",description:"Defines parameter types for commands",testmodules:["tests\\testBasic","tests\\testTypes"],provides:[{indexOn:"name",description:"Commands can accept various arguments that the user enters or that are automatically supplied by the environment. Those arguments have types that define how they are supplied or completed. The pointer points to an object with methods convert(str value) and getDefault(). Both functions have `this` set to the command's `takes` parameter. If getDefault is not defined, the default on the command's `takes` is used, if there is one. The object can have a noInput property that is set to true to reflect that this type is provided directly by the system. getDefault must be defined in that case.",
ep:"extensionpoint",name:"type"},{description:"Text that the user needs to enter.",pointer:"basic#text",ep:"type",name:"text"},{description:"A JavaScript number",pointer:"basic#number",ep:"type",name:"number"},{description:"A true/false value",pointer:"basic#bool",ep:"type",name:"boolean"},{description:"An object that converts via JavaScript",pointer:"basic#object",ep:"type",name:"object"},{description:"A string that is constrained to be one of a number of pre-defined values",pointer:"basic#selection",
ep:"type",name:"selection"},{description:"A type which we don't understand from the outset, but which we hope context can help us with",ep:"type",name:"deferred"}],type:"plugins\\supported",name:"types"},jquery:{testmodules:[],resourceURL:"resources/jquery/",name:"globaljquery",type:"thirdparty"},embedded:{testmodules:[],dependencies:{theme_manager:"0.0.0",text_editor:"0.0.0",appconfig:"0.0.0",edit_session:"0.0.0",screen_theme:"0.0.0"},resourceURL:"resources/embedded/",name:"embedded",type:"plugins\\supported"},
settings:{resourceURL:"resources/settings/",description:"Infrastructure and commands for managing user preferences",share:true,dependencies:{types:"0.0"},testmodules:[],provides:[{description:"Storage for the customizable Bespin settings",pointer:"index#settings",ep:"appcomponent",name:"settings"},{indexOn:"name",description:"A setting is something that the application offers as a way to customize how it works",register:"index#addSetting",ep:"extensionpoint",name:"setting"},{description:"A settingChange is a way to be notified of changes to a setting",
ep:"extensionpoint",name:"settingChange"},{pointer:"commands#setCommand",description:"define and show settings",params:[{defaultValue:null,type:{pointer:"settings:index#getSettings",name:"selection"},name:"setting",description:"The name of the setting to display or alter"},{defaultValue:null,type:{pointer:"settings:index#getTypeSpecFromAssignment",name:"deferred"},name:"value",description:"The new value for the chosen setting"}],ep:"command",name:"set"},{pointer:"commands#unsetCommand",description:"unset a setting entirely",
params:[{type:{pointer:"settings:index#getSettings",name:"selection"},name:"setting",description:"The name of the setting to return to defaults"}],ep:"command",name:"unset"}],type:"plugins\\supported",name:"settings"},appconfig:{resourceURL:"resources/appconfig/",description:"Instantiates components and displays the GUI based on configuration.",dependencies:{jquery:"0.0.0",canon:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{description:"Event: Fired when the app is completely launched.",ep:"extensionpoint",
name:"appLaunched"}],type:"plugins\\supported",name:"appconfig"},syntax_worker:{resourceURL:"resources/syntax_worker/",description:"Coordinates multiple syntax engines",environments:{worker:true},dependencies:{syntax_directory:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins\\supported",name:"syntax_worker"},uicommands:{resourceURL:"resources/uicommands/",description:"Commands for working with the Bespin user interface beyond the editor",testmodules:[],provides:[{predicates:{isTextView:true},
pointer:"#jumpCommandLine",ep:"command",key:"ctrl_j",name:"jump-commandline"},{predicates:{isKeyUp:false,isCommandLine:true},pointer:"#jumpEditor",ep:"command",key:"ctrl_j",name:"jump-editor"}],type:"plugins\\supported",name:"uicommands"},screen_theme:{resourceURL:"resources/screen_theme/",description:"Bespins standard theme basePlugin",dependencies:{theme_manager:"0.0.0"},testmodules:[],provides:[{url:["theme.less"],ep:"themestyles"},{defaultValue:"@global_font",ep:"themevariable",name:"container_font"},
{defaultValue:"@global_font_size",ep:"themevariable",name:"container_font_size"},{defaultValue:"@global_container_background",ep:"themevariable",name:"container_bg"},{defaultValue:"@global_color",ep:"themevariable",name:"container_color"},{defaultValue:"@global_line_height",ep:"themevariable",name:"container_line_height"},{defaultValue:"@global_pane_background",ep:"themevariable",name:"pane_bg"},{defaultValue:"@global_pane_border_radius",ep:"themevariable",name:"pane_border_radius"},{defaultValue:"@global_form_font",
ep:"themevariable",name:"form_font"},{defaultValue:"@global_form_font_size",ep:"themevariable",name:"form_font_size"},{defaultValue:"@global_form_line_height",ep:"themevariable",name:"form_line_height"},{defaultValue:"@global_form_color",ep:"themevariable",name:"form_color"},{defaultValue:"@global_form_text_shadow",ep:"themevariable",name:"form_text_shadow"},{defaultValue:"@global_pane_link_color",ep:"themevariable",name:"pane_a_color"},{defaultValue:"@global_font",ep:"themevariable",name:"pane_font"},
{defaultValue:"@global_font_size",ep:"themevariable",name:"pane_font_size"},{defaultValue:"@global_pane_text_shadow",ep:"themevariable",name:"pane_text_shadow"},{defaultValue:"@global_pane_h1_font",ep:"themevariable",name:"pane_h1_font"},{defaultValue:"@global_pane_h1_font_size",ep:"themevariable",name:"pane_h1_font_size"},{defaultValue:"@global_pane_h1_color",ep:"themevariable",name:"pane_h1_color"},{defaultValue:"@global_font_size * 1.8",ep:"themevariable",name:"pane_line_height"},{defaultValue:"@global_pane_color",
ep:"themevariable",name:"pane_color"},{defaultValue:"@global_text_shadow",ep:"themevariable",name:"pane_text_shadow"},{defaultValue:"@global_font",ep:"themevariable",name:"button_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"button_font_size"},{defaultValue:"@global_button_color",ep:"themevariable",name:"button_color"},{defaultValue:"@global_button_background",ep:"themevariable",name:"button_bg"},{defaultValue:"@button_bg - #063A27",ep:"themevariable",name:"button_bg2"},{defaultValue:"@button_bg - #194A5E",
ep:"themevariable",name:"button_border"},{defaultValue:"@global_control_background",ep:"themevariable",name:"control_bg"},{defaultValue:"@global_control_color",ep:"themevariable",name:"control_color"},{defaultValue:"@global_control_border",ep:"themevariable",name:"control_border"},{defaultValue:"@global_control_border_radius",ep:"themevariable",name:"control_border_radius"},{defaultValue:"@global_control_active_background",ep:"themevariable",name:"control_active_bg"},{defaultValue:"@global_control_active_border",
ep:"themevariable",name:"control_active_border"},{defaultValue:"@global_control_active_color",ep:"themevariable",name:"control_active_color"},{defaultValue:"@global_control_active_inset_color",ep:"themevariable",name:"control_active_inset_color"}],type:"plugins\\supported",name:"screen_theme"}})})})();
(function(){var q=bespin.tiki.require("jquery").$,n=function(m,l,e){m=m.style[e]||document.defaultView.getComputedStyle(m,"").getPropertyValue(e);if(!m||m=="auto"||m=="intrinsic")m=l.style[e];return m};bespin.useBespin=function(m,l){var e=bespin.tiki.require("bespin:util/util"),d={},b=d.settings;l=l||{};for(var a in l)d[a]=l[a];l=d.settings;if(b!==undefined)for(a in b)if(l[a]===undefined)d.settings[a]=b[a];var h=null,g=new (bespin.tiki.require("bespin:promise").Promise);bespin.tiki.require.ensurePackage("::appconfig",
function(){var f=bespin.tiki.require("appconfig");if(e.isString(m))m=document.getElementById(m);if(e.none(d.initialContent))d.initialContent=m.value||m.innerHTML;m.innerHTML="";if(m.type=="textarea"){var i=m.parentNode,j=document.createElement("div"),k=function(){var p="position:relative;";["margin-top","margin-left","margin-right","margin-bottom"].forEach(function(w){p+=w+":"+n(m,j,w)+";"});var u=n(m,j,"width"),t=n(m,j,"height");p+="height:"+t+";width:"+u+";";p+="display:inline-block;";j.setAttribute("style",
p)};window.addEventListener("resize",k,false);k();for(m.nextSibling?i.insertBefore(j,m.nextSibling):i.appendChild(j);i!==document;){if(i.tagName.toUpperCase()==="FORM"){var r=i.onsubmit;i.onsubmit=function(p){m.value=h.editor.value;m.innerHTML=h.editor.value;r&&r.call(this,p)};break}i=i.parentNode}m.style.display="none";d.element=j;if(!e.none(m.getAttribute("readonly")))d.readOnly=true}else d.element=m;f.launch(d).then(function(p){h=p;g.resolve(p)})});return g};q(document).ready(function(){for(var m=
[],l=document.querySelectorAll(".bespin"),e=0;e<l.length;e++){var d=l[e],b=d.getAttribute("data-bespinoptions")||"{}";b=bespin.useBespin(d,JSON.parse(b));b.then(function(a){d.bespin=a},function(a){throw new Error("Launch failed: "+a);});m.push(b)}if(window.onBespinLoad){l=bespin.tiki.require("bespin:promise").group;l(m).then(function(){window.onBespinLoad()},function(){throw new Error("At least one Bespin failed to launch!");})}})})();
